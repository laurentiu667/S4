import{c as ee,s as Hs,t as _s,a as Sp,g as ui,b as kv,d as fl,e as fi,f as As,h as pd,i as Te,p as Ss,m as Sr,j as Tp,k as xp,n as Do,r as ps,o as oe,q as Q,u as pl,v as no,w as Le,x as Sv,y as U,z as mr,A as Ea,B as ss,C as xa,D as Ns,E as Mn,F as za,G as ml,H as os,I as Tv,J as Vt,K as Ln,L as $p,S as Ap,M as xv,N as $v,O as Mp,P as Av,Q as Mv,R as pi,T as Lv,U as Lp,V as Wp,W as Ip,X as Yu,Y as Wv,Z as Iv,_ as Ev,$ as Bv,a0 as dt,a1 as Tr,a2 as Ep,a3 as Pv,a4 as qv,a5 as Fv,a6 as wa,a7 as Bp,a8 as md,a9 as Pp,aa as Dv,ab as Ba,ac as gd,ad as ac,ae as hd,af as Ni,ag as Rv,ah as Ov,ai as aa,aj as Ki,ak as Hv,al as _v,am as Nv,an as Kv,ao as qp,ap as Ju,aq as zv,ar as Uv,as as Vv,at as yd,au as Fp,av as jv,aw as Qv,ax as sc,ay as Zu,az as Gv,aA as Xu,aB as Yv,aC as Jv,l as oc}from"./misc.C476mBjA.js";import{a as vd,g as Zv,$ as s,t as wd,b as Xv,s as ew,l as tw,d as Et,f as _e,h as Ue,H as xr,C as Nt,B as aw,c as sw,e as ow,p as nw,L as iw,i as rw,j as lw,P as cw,S as dw,T as uw,k as fw,m as pw,n as mw,o as gw,q as ef,r as Dp,u as hw,v as Rp,w as At,x as tf,y as yw,z as vw,A as ww,D as bw,G as Cw,E as Op,F as Hp,I as _p,J as kw,K as Sw,M as bd,N as Tw,O as xw,Q as Np,R as $w,U as Aw,V as Kp,W as Mw,X as Lw,Y as Ww,Z as Iw,_ as Ew}from"./vendor.mtKfjGfe.js";import{i as z,g as gl,a as Ro,b as m,c as Bw,s as Pw,A as Pe,d as qw}from"./firebase.2lhnjcQw.js";const Fw="https://api.monkeytype.com",Dw=!1,Rw=`2024.03.31_13.20.e497a192f
`,Ow="6Lc-V8McAAAAAJ7s6LGNe7MBZnRiwbsbiWts87aj",mi={backendUrl:Fw,isDevelopment:Dw,clientVersion:Rw,recaptchaSiteKey:Ow},Hw="modulepreload",_w=function(e){return"/"+e},af={},Cd=function(t,a,o){let n=Promise.resolve();if(a&&a.length>0){const r=document.getElementsByTagName("link");n=Promise.all(a.map(l=>{if(l=_w(l),l in af)return;af[l]=!0;const c=l.endsWith(".css"),d=c?'[rel="stylesheet"]':"";if(!!o)for(let p=r.length-1;p>=0;p--){const g=r[p];if(g.href===l&&(!c||g.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${d}`))return;const f=document.createElement("link");if(f.rel=c?"stylesheet":Hw,c||(f.as="script",f.crossOrigin=""),f.href=l,document.head.appendChild(f),c)return new Promise((p,g)=>{f.addEventListener("load",p),f.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${l}`)))})}))}return n.then(()=>t()).catch(r=>{const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=r,window.dispatchEvent(l),!l.defaultPrevented)throw r})};let zp=!0;function Ks(e){zp=e}function Rn(){return zp}const sf="/configs";class Nw{constructor(t){this.httpClient=t,this.httpClient=t}async get(){return await this.httpClient.get(sf)}async save(t){return await this.httpClient.patch(sf,{payload:{config:t}})}}const of="/leaderboards";class Kw{constructor(t){this.httpClient=t,this.httpClient=t}async get(t){const{language:a,mode:o,mode2:n,isDaily:r,skip:l=0,limit:c=50,daysBefore:d}=t,u=(r??!1)&&(d??0)>0,f={language:a,mode:o,mode2:n,skip:Math.max(l,0),limit:Math.max(Math.min(c,50),0),...u&&{daysBefore:d}},p=`${of}/${r?"daily":""}`;return await this.httpClient.get(p,{searchQuery:f})}async getRank(t){const{language:a,mode:o,mode2:n,isDaily:r,daysBefore:l}=t,c=(r??!1)&&(l??0)>0,d={language:a,mode:o,mode2:n,...c&&{daysBefore:l}},u=`${of}${r?"/daily":""}/rank`;return await this.httpClient.get(u,{searchQuery:d})}}const zi="/presets";class zw{constructor(t){this.httpClient=t,this.httpClient=t}async get(){return await this.httpClient.get(zi)}async add(t,a){const o={name:t,config:a};return await this.httpClient.post(zi,{payload:o})}async edit(t,a,o){const n={_id:t,name:a,config:o};return await this.httpClient.patch(zi,{payload:n})}async delete(t){return await this.httpClient.delete(`${zi}/${t}`)}}const Uw="/psas";class Vw{constructor(t){this.httpClient=t,this.httpClient=t}async get(){return await this.httpClient.get(Uw)}}const Ha="/quotes";class jw{constructor(t){this.httpClient=t,this.httpClient=t}async get(){return await this.httpClient.get(Ha)}async isSubmissionEnabled(){return await this.httpClient.get(`${Ha}/isSubmissionEnabled`)}async submit(t,a,o,n){const r={text:t,source:a,language:o,captcha:n};return await this.httpClient.post(Ha,{payload:r})}async approveSubmission(t,a,o){const n={quoteId:t,editText:a,editSource:o};return await this.httpClient.post(`${Ha}/approve`,{payload:n})}async rejectSubmission(t){return await this.httpClient.post(`${Ha}/reject`,{payload:{quoteId:t}})}async getRating(t){const a={quoteId:t.id,language:t.language};return await this.httpClient.get(`${Ha}/rating`,{searchQuery:a})}async addRating(t,a){const o={quoteId:t.id,rating:a,language:t.language};return await this.httpClient.post(`${Ha}/rating`,{payload:o})}async report(t,a,o,n,r){const l={quoteId:t,quoteLanguage:a,reason:o,comment:n,captcha:r};return await this.httpClient.post(`${Ha}/report`,{payload:l})}}const Ui="/results";class Qw{constructor(t){this.httpClient=t,this.httpClient=t}async get(t){return await this.httpClient.get(Ui,{searchQuery:{offset:t}})}async save(t){return await this.httpClient.post(Ui,{payload:{result:t}})}async updateTags(t,a){return await this.httpClient.patch(`${Ui}/tags`,{payload:{resultId:t,tagIds:a}})}async deleteAll(){return await this.httpClient.delete(Ui)}}const te="/users";class Gw{constructor(t){this.httpClient=t,this.httpClient=t}async getData(){return await this.httpClient.get(te)}async create(t,a,o,n){const r={email:o,name:t,uid:n,captcha:a};return await this.httpClient.post(`${te}/signup`,{payload:r})}async getNameAvailability(t){return await this.httpClient.get(`${te}/checkName/${t}`)}async delete(){return await this.httpClient.delete(te)}async reset(){return await this.httpClient.patch(`${te}/reset`)}async optOutOfLeaderboards(){return await this.httpClient.post(`${te}/optOutOfLeaderboards`)}async updateName(t){return await this.httpClient.patch(`${te}/name`,{payload:{name:t}})}async updateLeaderboardMemory(t,a,o,n){const r={mode:t,mode2:a,language:o,rank:n};return await this.httpClient.patch(`${te}/leaderboardMemory`,{payload:r})}async updateEmail(t,a){const o={newEmail:t,previousEmail:a};return await this.httpClient.patch(`${te}/email`,{payload:o})}async deletePersonalBests(){return await this.httpClient.delete(`${te}/personalBests`)}async addResultFilterPreset(t){return await this.httpClient.post(`${te}/resultFilterPresets`,{payload:t})}async removeResultFilterPreset(t){return await this.httpClient.delete(`${te}/resultFilterPresets/${t}`)}async createTag(t){return await this.httpClient.post(`${te}/tags`,{payload:{tagName:t}})}async editTag(t,a){const o={tagId:t,newName:a};return await this.httpClient.patch(`${te}/tags`,{payload:o})}async deleteTag(t){return await this.httpClient.delete(`${te}/tags/${t}`)}async deleteTagPersonalBest(t){return await this.httpClient.delete(`${te}/tags/${t}/personalBest`)}async getCustomThemes(){return await this.httpClient.get(`${te}/customThemes`)}async editCustomTheme(t,a){const o={themeId:t,theme:{name:a.name,colors:a.colors}};return await this.httpClient.patch(`${te}/customThemes`,{payload:o})}async deleteCustomTheme(t){const a={themeId:t};return await this.httpClient.delete(`${te}/customThemes`,{payload:a})}async addCustomTheme(t){const a={name:t.name,colors:t.colors};return await this.httpClient.post(`${te}/customThemes`,{payload:a})}async getOauthLink(){return await this.httpClient.get(`${te}/discord/oauth`)}async linkDiscord(t,a,o){return await this.httpClient.post(`${te}/discord/link`,{payload:{tokenType:t,accessToken:a,state:o}})}async unlinkDiscord(){return await this.httpClient.post(`${te}/discord/unlink`)}async addQuoteToFavorites(t,a){const o={language:t,quoteId:a};return await this.httpClient.post(`${te}/favoriteQuotes`,{payload:o})}async removeQuoteFromFavorites(t,a){const o={language:t,quoteId:a};return await this.httpClient.delete(`${te}/favoriteQuotes`,{payload:o})}async getProfileByUid(t){return await this.httpClient.get(`${te}/${t}/profile?isUid`)}async getProfileByName(t){return await this.httpClient.get(`${te}/${t}/profile`)}async updateProfile(t,a){return await this.httpClient.patch(`${te}/profile`,{payload:{...t,selectedBadgeId:a}})}async getInbox(){return await this.httpClient.get(`${te}/inbox`)}async updateInbox(t){const a={mailIdsToDelete:t.mailIdsToDelete,mailIdsToMarkRead:t.mailIdsToMarkRead};return await this.httpClient.patch(`${te}/inbox`,{payload:a})}async report(t,a,o,n){const r={uid:t,reason:a,comment:o,captcha:n};return await this.httpClient.post(`${te}/report`,{payload:r})}async verificationEmail(){return await this.httpClient.get(`${te}/verificationEmail`)}async forgotPasswordEmail(t){return await this.httpClient.post(`${te}/forgotPasswordEmail`,{payload:{email:t}})}async setStreakHourOffset(t){return await this.httpClient.post(`${te}/setStreakHourOffset`,{payload:{hourOffset:t}})}async revokeAllTokens(){return await this.httpClient.post(`${te}/revokeAllTokens`)}}const Vi="/ape-keys";class Yw{constructor(t){this.httpClient=t,this.httpClient=t}async get(){return await this.httpClient.get(Vi)}async generate(t,a){const o={name:t,enabled:a};return await this.httpClient.post(Vi,{payload:o})}async update(t,a){const o={...a};return await this.httpClient.patch(`${Vi}/${t}`,{payload:o})}async delete(t){return await this.httpClient.delete(`${Vi}/${t}`)}}const nf="/public";class Jw{constructor(t){this.httpClient=t,this.httpClient=t}async getSpeedHistogram(t){return await this.httpClient.get(`${nf}/speedHistogram`,{searchQuery:t})}async getTypingStats(){return await this.httpClient.get(`${nf}/typingStats`)}}class Zw{constructor(t){this.httpClient=t,this.httpClient=t}async get(){return await this.httpClient.get("/configuration")}}const Xt={Configs:Nw,Leaderboards:Kw,Presets:zw,Psas:Vw,Public:Jw,Quotes:jw,Results:Qw,Users:Gw,ApeKeys:Yw,Configuration:Zw};async function Xw(e){const t=z()?await Zv(gl()):"";return{params:e.searchQuery,data:e.payload,headers:{...e.headers,Accept:"application/json","Content-Type":"application/json",...t&&{Authorization:`Bearer ${t}`},"X-Client-Version":mi.clientVersion}}}function gn(e,t){return async function(a,o={}){var l,c;let n="",r;try{r=await Xw(o)}catch(d){return console.error("Failed to adapt request options"),console.error(d),d.message.includes("auth/network-request-failed")?{status:400,message:"Network error while trying to authenticate. Please try again.",data:null}:{status:400,message:ee(d,"Failed to adapt request options"),data:null}}try{let d;t==="get"||t==="delete"?d=await e(a,r):d=await e(a,r.data,r);const{message:u,data:f}=d.data;return{status:d.status,message:u,data:f}}catch(d){console.error(d);const u=d;if(n=u.message,vd.isAxiosError(u))return{status:((l=u.response)==null?void 0:l.status)??500,message:u.message,...(c=u.response)==null?void 0:c.data}}return{status:500,message:n,data:null}}}function eb(e,t){const a=vd.create({baseURL:e,timeout:t});return{get:gn(a.get,"get"),post:gn(a.post,"post"),put:gn(a.put,"put"),patch:gn(a.patch,"patch"),delete:gn(a.delete,"delete")}}const tb="",ab=mi.backendUrl,sb=`${ab}${tb}`,ea=eb(sb,1e4),E={users:new Xt.Users(ea),configs:new Xt.Configs(ea),results:new Xt.Results(ea),psas:new Xt.Psas(ea),quotes:new Xt.Quotes(ea),leaderboards:new Xt.Leaderboards(ea),presets:new Xt.Presets(ea),publicStats:new Xt.Public(ea),apeKeys:new Xt.ApeKeys(ea),configuration:new Xt.Configuration(ea)};class Ra{constructor(t,a,o,n,r,l,c){this.name=t,this.element=a,this.pathname=o,this.beforeHide=n,this.afterHide=r,this.beforeShow=l,this.afterShow=c}}const hl=new Map;function st(e,t=!0){const a=document.getElementById(e)??void 0;if(a===void 0)throw new Error(`Element with id ${e} not found`);hl.set(e,a),t&&Ve(e)}function Ve(e){const t=hl.get(e);t?t.remove():st(e,!0)}const ob={popups:document.getElementById("popups"),main:document.querySelector("main")};function at(e,t){const a=hl.get(e);ob[t].append(a)}function nb(e){return hl.has(e)}function oa(e,t=!1){const a=t?100:1e3;s(".pageLoading .fill, .pageAccount .preloader .fill").stop(!0,t).animate({width:e+"%"},a)}function $r(e){s(".pageLoading .text, .pageAccount .preloader .text").text(e)}async function Up(){return new Promise(e=>{Hs(s(".pageLoading .preloader .icon"),s(".pageLoading .preloader .barWrapper"),125,async()=>{e()}),Hs(s(".pageAccount .preloader .icon"),s(".pageAccount .preloader .barWrapper"),125,async()=>{e()})})}const ib=new Ra("loading",s(".page.pageLoading"),"/",async()=>{},async()=>{Ve("pageLoading")},async()=>{at("pageLoading","main")},async()=>{}),Kt={theme:"serika_dark",themeLight:"serika",themeDark:"serika_dark",autoSwitchTheme:!1,customTheme:!1,customThemeColors:["#323437","#e2b714","#e2b714","#646669","#2c2e31","#d1d0c5","#ca4754","#7e2a33","#ca4754","#7e2a33"],favThemes:[],showKeyTips:!0,showLiveWpm:!1,showTimerProgress:!0,smoothCaret:"medium",quickRestart:"off",punctuation:!1,numbers:!1,words:50,time:30,mode:"time",quoteLength:[1],language:"english",fontSize:1.5,freedomMode:!1,difficulty:"normal",blindMode:!1,quickEnd:!1,caretStyle:"default",paceCaretStyle:"default",flipTestColors:!1,layout:"default",funbox:"none",confidenceMode:"off",indicateTypos:"off",timerStyle:"mini",colorfulMode:!1,randomTheme:"off",timerColor:"main",timerOpacity:"1",stopOnError:"off",showAllLines:!1,keymapMode:"off",keymapStyle:"staggered",keymapLegendStyle:"lowercase",keymapLayout:"overrideSync",keymapShowTopRow:"layout",fontFamily:"Roboto_Mono",smoothLineScroll:!1,alwaysShowDecimalPlaces:!1,alwaysShowWordsHistory:!1,singleListCommandLine:"manual",capsLockWarning:!0,playSoundOnError:"off",playSoundOnClick:"off",soundVolume:"0.5",startGraphsAtZero:!0,showOutOfFocusWarning:!0,paceCaret:"off",paceCaretCustomSpeed:100,repeatedPace:!0,pageWidth:"125",accountChart:["on","on","on","on"],minWpm:"off",minWpmCustomSpeed:100,highlightMode:"letter",typingSpeedUnit:"wpm",ads:"result",hideExtraLetters:!1,strictSpace:!1,minAcc:"off",minAccCustom:90,showLiveAcc:!1,showLiveBurst:!1,monkey:!1,repeatQuotes:"off",oppositeShiftMode:"off",customBackground:"",customBackgroundSize:"cover",customBackgroundFilter:[0,1,1,1,1],customLayoutfluid:"qwerty#dvorak#colemak",monkeyPowerLevel:"off",minBurst:"off",minBurstCustomSpeed:100,burstHeatmap:!1,britishEnglish:!1,lazyMode:!1,showAverage:"off",tapeMode:"off"},rf={results:void 0,personalBests:{time:{},words:{},quote:{},zen:{},custom:{}},name:"",email:"",uid:"",isPremium:!1,config:Kt,customThemes:[],presets:[],tags:[],banned:void 0,verified:void 0,lbMemory:{time:{15:{english:0},60:{english:0}}},typingStats:{timeTyping:0,startedTests:0,completedTests:0},quoteRatings:void 0,quoteMod:!1,favoriteQuotes:{},addedAt:0,filterPresets:[],xp:0,inboxUnreadSize:0,streak:0,maxStreak:0,streakHourOffset:void 0,allTimeLbs:{time:{15:{english:{count:0,rank:0}},60:{english:{count:0,rank:0}}}}},Vp=[];function rb(e){Vp.push(e)}window.addEventListener("load",()=>{window.addEventListener("online",()=>{lf(!0)}),window.addEventListener("offline",()=>{lf(!1)})});function lf(e){Vp.forEach(t=>{try{t(e)}catch(a){console.error("Connection event subscriber threw an error"),console.error(a)}})}let Mo=!1,zs=!1,Ae=!1,mt=null,gi=!0,bo=!1,Ac=1;function nc(e){Mo=e}function cf(e){zs=e}function kd(e){Ae=e}function jp(e){mt=e}function iA(e){gi=e}function Qp(e){bo=e}function Sd(e){Ac=e}let On=navigator.onLine;function We(){return On}let Wn,Mc=!1;function yl(){Mc||Wn===void 0&&(Wn=Ro("No internet connection",0,"exclamation-triangle",!1,()=>{Mc=!0,Wn=void 0}))}const lb=wd(1e4,()=>{On?(m("You're back online",1,{customTitle:"Connection"}),Wn!==void 0&&s(`#bannerCenter .banner[id="${Wn}"] .closeButton`).trigger("click"),Mc=!1):Ae||yl()});rb(e=>{On=e,lb()});window.addEventListener("load",()=>{On=navigator.onLine,On||yl()});function cb(e){const t={};for(const a of _s(Kt)){const o=e[a]??Kt[a];t[a]=o}return t}let R;function S(){return R}function ut(e){const t=R==null?void 0:R.banned,a=R==null?void 0:R.verified,o=R==null?void 0:R.lbOptOut;try{e==null||delete e.banned}catch{}try{e==null||delete e.verified}catch{}try{e==null||delete e.lbOptOut}catch{}R=e,R&&(R.banned=t,R.verified=a,R.lbOptOut=o)}async function db(){var t,a,o,n,r,l,c;const e={...rf};try{if(!z())return!1;const[d,u,f]=await Promise.all([E.users.getData(),E.configs.get(),E.presets.get()]);if(d.status!==200)throw{message:`${d.message} (user)`,responseCode:d.status};if(u.status!==200)throw{message:`${u.message} (config)`,responseCode:u.status};if(f.status!==200)throw{message:`${f.message} (presets)`,responseCode:f.status};const p=d.data,g=u.data,h=f.data;if(p===null)throw{message:"Request was successful but user data is null",responseCode:200};e.name=p.name,e.personalBests=p.personalBests,e.personalBests??(e.personalBests={time:{},words:{},quote:{},zen:{},custom:{}});for(const w of["time","words","quote","zen","custom"])(t=e.personalBests)[w]??(t[w]={});e.banned=p.banned,e.lbOptOut=p.lbOptOut,e.verified=p.verified,e.discordId=p.discordId,e.discordAvatar=p.discordAvatar,e.needsToChangeName=p.needsToChangeName,e.typingStats={timeTyping:p.timeTyping??0,startedTests:p.startedTests??0,completedTests:p.completedTests??0},e.quoteMod=p.quoteMod,e.favoriteQuotes=p.favoriteQuotes??{},e.quoteRatings=p.quoteRatings,e.details=p.profileDetails,e.addedAt=p.addedAt,e.inventory=p.inventory,e.xp=p.xp??0,e.inboxUnreadSize=p.inboxUnreadSize??0,e.streak=((a=p==null?void 0:p.streak)==null?void 0:a.length)??0,e.maxStreak=((o=p==null?void 0:p.streak)==null?void 0:o.maxLength)??0,e.filterPresets=p.resultFilterPresets??[],e.isPremium=p==null?void 0:p.isPremium,e.allTimeLbs=p.allTimeLbs;const y=(n=p==null?void 0:p.streak)==null?void 0:n.hourOffset;if(e.streakHourOffset=y??void 0,p.lbMemory!==void 0&&(e.lbMemory=p.lbMemory),g==null?e.config={...Kt}:e.config=cb(g.config),e.customThemes=p.customThemes??[],e.tags=((r=p.tags)==null?void 0:r.map(w=>({...w,display:w.name.replaceAll("_"," ")})))??[],e.tags=(l=e.tags)==null?void 0:l.sort((w,k)=>w.name>k.name?1:w.name<k.name?-1:0),h!=null){const w=h.map(k=>({...k,display:k.name.replace(/_/gi," ")}));e.presets=w,e.presets=(c=e.presets)==null?void 0:c.sort((k,L)=>k.name>L.name?1:k.name<L.name?-1:0)}return R=e,R}catch(d){throw R=rf,d}}async function Td(e){var o;if(!z()||!R||R.results!==void 0&&(e===void 0||R.results.length>e)||!We())return!1;R.results===void 0&&($r("Downloading results..."),oa(90));const t=await E.results.get(e);if(t.status!==200)return m("Error getting results: "+t.message,-1),!1;const a=t.data;if(a==null||a.sort((n,r)=>r.timestamp-n.timestamp),a.forEach(n=>{n.bailedOut===void 0&&(n.bailedOut=!1),n.blindMode===void 0&&(n.blindMode=!1),n.lazyMode===void 0&&(n.lazyMode=!1),n.difficulty===void 0&&(n.difficulty="normal"),n.funbox===void 0&&(n.funbox="none"),(n.language===void 0||n.language===null)&&(n.language="english"),n.numbers===void 0&&(n.numbers=!1),n.punctuation===void 0&&(n.punctuation=!1),n.numbers===void 0&&(n.numbers=!1),n.quoteLength===void 0&&(n.quoteLength=-1),n.restartCount===void 0&&(n.restartCount=0),n.incompleteTestSeconds===void 0&&(n.incompleteTestSeconds=0),n.afkDuration===void 0&&(n.afkDuration=0),n.tags===void 0&&(n.tags=[]),n.correctChars!==void 0&&n.incorrectChars!==void 0&&(n.charStats=[n.correctChars,n.incorrectChars,0,0])}),R.results!==void 0&&R.results.length>0){const n=(o=Sp(R.results))==null?void 0:o.timestamp,r=a.filter(l=>l.timestamp<n);R.results.push(...r)}else R.results=a;return!0}async function ub(e){if(!R)return!1;if(R.customThemes===void 0&&(R.customThemes=[]),R.customThemes.length>=10)return m("Too many custom themes!",0),!1;const t=await E.users.addCustomTheme(e);if(t.status!==200)return m("Error adding custom theme: "+t.message,-1),!1;if(t.data===null)return m("Error adding custom theme: No data returned",-1),!1;const a={...e,_id:t.data._id};return R.customThemes.push(a),!0}async function fb(e,t){var r;if(!z()||!R)return!1;R.customThemes===void 0&&(R.customThemes=[]);const a=(r=R.customThemes)==null?void 0:r.find(l=>l._id===e);if(!a)return m("Editing failed: Custom theme with id: "+e+" does not exist",-1),!1;const o=await E.users.editCustomTheme(e,t);if(o.status!==200)return m("Error editing custom theme: "+o.message,-1),!1;const n={...t,_id:e};return R.customThemes[R.customThemes.indexOf(a)]=n,!0}async function pb(e){var o,n;if(!z()||!R||!((o=R.customThemes)==null?void 0:o.find(r=>r._id===e)))return!1;const a=await E.users.deleteCustomTheme(e);return a.status!==200?(m("Error deleting custom theme: "+a.message,-1),!1):(R.customThemes=(n=R.customThemes)==null?void 0:n.filter(r=>r._id!==e),!0)}async function Gp(e,t,a,o,n,r,l){const c=S();if(!c)return[0,0];function d(){var L;const f=[];(L=c==null?void 0:c.tags)==null||L.forEach(x=>{x.active===!0&&f.push(x._id)});let p=0,g=0,h=0,y=0,w=0,k=0;if((c==null?void 0:c.results)!==void 0){for(const x of c.results)if(x.mode===e&&(x.punctuation??!1)===a&&(x.numbers??!1)===o&&x.language===n&&x.difficulty===r&&(x.lazyMode===l||x.lazyMode===void 0&&!l)&&(f.length===0||f.some(B=>x.tags.includes(B)))){if(`${x.mode2}`!=`${t}`&&e!=="quote")continue;if(k<10&&(h+=x.wpm,y+=x.acc,k++),`${x.mode2}`==`${t}`&&(p+=x.wpm,g+=x.acc,w++,w>=10))break}}return w===0&&e==="quote"?[h/k,y/k]:[p/w,g/w]}return c===null||await Td()===null?[0,0]:d()}async function mb(e,t,a,o,n,r,l){const c=S();if(!c)return 0;function d(){var g;const f=[];(g=c==null?void 0:c.tags)==null||g.forEach(h=>{h.active===!0&&f.push(h._id)});let p=0;if((c==null?void 0:c.results)!==void 0){for(const h of c.results)if(h.mode===e&&(h.punctuation??!1)===a&&(h.numbers??!1)===o&&h.language===n&&h.difficulty===r&&(h.lazyMode===l||h.lazyMode===void 0&&!l)&&(f.length===0||f.some(y=>h.tags.includes(y)))){if(h.timestamp<Date.now()-864e5||`${h.mode2}`!=`${t}`&&e!=="quote")continue;h.wpm>p&&(p=h.wpm)}}return p}return c===null||await Td()===null?0:d()}async function xd(e,t,a,o,n,r,l,c){var f;if(!(await ui()).filter(p=>c==null?void 0:c.split("#").includes(p.name)).every(p=>p.canGetPb)||R===null||(R==null?void 0:R.personalBests)===null)return 0;const u=R==null?void 0:R.personalBests[e][t];return u===void 0?0:((f=u.find(p=>(p.punctuation??!1)===a&&(p.numbers??!1)===o&&p.difficulty===r&&p.language===n&&(p.lazyMode??!1)===l))==null?void 0:f.wpm)??0}async function gb(e,t,a,o,n,r,l,c,d,u,f){if(e==="quote"||!R)return;function p(){var h,y;if(!R)return;let g=!1;R.personalBests??(R.personalBests={time:{},words:{},quote:{},zen:{},custom:{}}),(h=R.personalBests)[e]??(h[e]={[t]:[]}),(y=R.personalBests[e])[t]??(y[t]=[]),R.personalBests[e][t].forEach(w=>{(w.punctuation??!1)===a&&(w.numbers??!1)===o&&w.difficulty===r&&w.language===n&&(w.lazyMode??!1)===l&&(g=!0,w.wpm=c,w.acc=d,w.raw=u,w.timestamp=Date.now(),w.consistency=f,w.lazyMode=l)}),g||R.personalBests[e][t].push({language:n,difficulty:r,lazyMode:l,punctuation:a,numbers:o,wpm:c,acc:d,raw:u,timestamp:Date.now(),consistency:f})}R!==null&&p()}async function hb(e,t,a,o,n,r,l,c){var p,g,h,y;if(R===null)return 0;let d=0;const u=(((p=S())==null?void 0:p.tags)??[]).filter(w=>w._id===e)[0];return u===void 0||(u.personalBests??(u.personalBests={time:{},words:{},quote:{},zen:{},custom:{}}),(g=u.personalBests)[t]??(g[t]={[a]:[]}),(h=u.personalBests[t])[a]??(h[a]=[]),d=((y=(u.personalBests[t][a]??[]).find(w=>(w.punctuation??!1)===o&&(w.numbers??!1)===n&&w.difficulty===l&&w.language===r&&(w.lazyMode===c||w.lazyMode===void 0&&!c)))==null?void 0:y.wpm)??0),d}async function yb(e,t,a,o,n,r,l,c,d,u,f,p){if(!R||t==="quote")return;function g(){var y,w,k;const h=(y=R==null?void 0:R.tags)==null?void 0:y.filter(L=>L._id===e)[0];h.personalBests??(h.personalBests={time:{},words:{},quote:{},zen:{},custom:{}}),(w=h.personalBests)[t]??(w[t]={[a]:[]}),(k=h.personalBests[t])[a]??(k[a]=[]);try{let L=!1;h.personalBests[t][a].forEach(x=>{(x.punctuation??!1)===o&&(x.numbers??!1)===n&&x.difficulty===l&&x.language===r&&(x.lazyMode===c||x.lazyMode===void 0&&!c)&&(L=!0,x.wpm=d,x.acc=u,x.raw=f,x.timestamp=Date.now(),x.consistency=p,x.lazyMode=c)}),L||h.personalBests[t][a].push({language:r,difficulty:l,lazyMode:c,punctuation:o,numbers:n,wpm:d,acc:u,raw:f,timestamp:Date.now(),consistency:p})}catch{h.personalBests={time:{},words:{},quote:{},zen:{},custom:{}},h.personalBests[t][a]=[{language:r,difficulty:l,lazyMode:c,punctuation:o,numbers:n,wpm:d,acc:u,raw:f,timestamp:Date.now(),consistency:p}]}}R!==null&&g()}async function df(e,t,a,o,n=!1){var r,l,c;if(e==="time"){const d=e,u=t,f=S();if(!f)return;f.lbMemory===void 0&&(f.lbMemory={time:{15:{english:0},60:{english:0}}}),f.lbMemory[d]===void 0&&(f.lbMemory[d]={15:{english:0},60:{english:0}}),f.lbMemory[d][u]===void 0&&(f.lbMemory[d][u]={});const p=(c=(l=(r=f.lbMemory)==null?void 0:r[d])==null?void 0:l[u])==null?void 0:c[a],g=f.lbMemory[d][u];g[a]=o,n&&p!==o&&await E.users.updateLeaderboardMemory(e,t,a,o),ut(f)}}async function Yp(e){if(z()){const t=await E.configs.save(e);t.status!==200&&m("Failed to save config: "+t.message,-1)}}function $d(e){const t=S();t&&(t==null?void 0:t.results)!==void 0&&(t.results.unshift(e),ut(t))}function Ad(e,t){const a=S();a&&(a.typingStats===void 0&&(a.typingStats={timeTyping:0,startedTests:0,completedTests:0}),a.typingStats.timeTyping+=t,a.typingStats.startedTests+=e,a.typingStats.completedTests+=1,ut(a))}function Jp(e){const t=S();t&&(t.xp===void 0&&(t.xp=0),t.xp+=e,ut(t))}function vb(e){const t=S();t&&(t.inventory===void 0&&(t.inventory={badges:[]}),t.inventory.badges.push(e),ut(t))}function wb(e){const t=S();t&&(t.streak=e,t.streak>t.maxStreak&&(t.maxStreak=t.streak),ut(t))}const Zp=[];function hi(){s("#words, #koInputVisualContainer").css("transition","none").removeClass("blurred"),s(".outOfFocusWarning").addClass("hidden"),kv(Zp)}function bb(){Zp.push(setTimeout(()=>{s("#words, #koInputVisualContainer").css("transition","0.25s").addClass("blurred"),s(".outOfFocusWarning").removeClass("hidden")},1e3))}function Xp(e,t,a){a===void 0?m(`Invalid value for ${e} (${t}). Please try to change this setting again.`,-1):m(`Invalid value for ${e} (${t}). ${a}`,-1),console.error(`Invalid value key ${e} value ${t} type ${typeof t}`)}function ic(e){return e instanceof Array}function W(e,t,a){let o=!1,n;for(const r of a)switch(r){case"boolean":typeof t=="boolean"&&(o=!0);break;case"null":t===null&&(o=!0);break;case"number":typeof t=="number"&&!isNaN(t)&&(o=!0);break;case"numberArray":ic(t)&&t.every(l=>typeof l=="number"&&!isNaN(l))&&(o=!0);break;case"string":typeof t=="string"&&(o=!0);break;case"stringArray":ic(t)&&t.every(l=>typeof l=="string")&&(o=!0);break;case"undefined":(typeof t>"u"||t===void 0)&&(o=!0);break;default:ic(r)&&r.includes(t)&&(o=!0);break}return o||Xp(e,t,n),o}async function Cb(e,t,a){let o=!1,n;for(const r of a)switch(r){case"layoutfluid":{if(typeof t!="string")break;const l=t.split(/[# ]+/);if(l.length<2||l.length>5)break;try{await fl()}catch(d){n=ee(d,"Failed to validate layoutfluid value");break}const c=await Promise.all(l.map(async d=>fi(d)));if(!c.every(d=>d!==void 0)){n=`The following inputted layouts do not exist: ${l.map((f,p)=>[f,c[p]]).filter(([f,p])=>p===void 0).map(([f])=>f).join(", ")}`;break}o=!0;break}}return o||Xp(e,t,n),o}const em=[];function he(e){em.push(e)}function $(e,t,a,o,n){em.forEach(r=>{try{r(e,t,a,o,n)}catch(l){console.error("Config event subscriber threw an error"),console.error(l)}})}let Lc;async function Pa(e,t){try{tw(Lc,e,t)}catch{console.log("Analytics unavailable")}}const ji=localStorage.getItem("acceptedCookies");let Ar;ji!=null&&ji!==""?Ar=JSON.parse(ji):Ar=null;Ar!==null&&Ar.analytics&&Wc();function Wc(){try{Lc=Xv(Bw),ew(Lc,!0),s("body").append(`
    <script
    async
    src="https://www.googletagmanager.com/gtag/js?id=UA-165993088-1"
  ><\/script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
      dataLayer.push(arguments);
    }
    gtag("js", new Date());

    gtag("config", "UA-165993088-1");
  <\/script>`)}catch(e){console.error(ee(e,"Failed to activate analytics"))}}let it={bg:"#323437",main:"#e2b714",caret:"#e2b714",sub:"#646669",subAlt:"#2c2e31",text:"#d1d0c5",error:"#ca4754",errorExtra:"#7e2a33",colorfulError:"#ca4754",colorfulErrorExtra:"#7e2a33"};async function Dt(e){return it[e]||yi(),it[e]}async function ms(){return it.bg||yi(),it}function kb(){it={bg:"",main:"",caret:"",sub:"",subAlt:"",text:"",error:"",errorExtra:"",colorfulError:"",colorfulErrorExtra:""}}function yi(){const e=getComputedStyle(document.body);it.bg=e.getPropertyValue("--bg-color").replace(" ",""),it.main=e.getPropertyValue("--main-color").replace(" ",""),it.caret=e.getPropertyValue("--caret-color").replace(" ",""),it.sub=e.getPropertyValue("--sub-color").replace(" ",""),it.subAlt=e.getPropertyValue("--sub-alt-color").replace(" ",""),it.text=e.getPropertyValue("--text-color").replace(" ",""),it.error=e.getPropertyValue("--error-color").replace(" ",""),it.errorExtra=e.getPropertyValue("--error-extra-color").replace(" ",""),it.colorfulError=e.getPropertyValue("--colorful-error-color").replace(" ",""),it.colorfulErrorExtra=e.getPropertyValue("--colorful-error-extra-color").replace(" ","")}let Mr=!1;function Sb(){Mr||(Mr=!0,console.error("Slow timer, disabling animations"))}function Hn(){Mr=!1}function Ce(){return Mr}let Ic=!1,Ft=!1;function tm(){Ft=!0}function _t(e){e?(s("header nav .account").css("opacity",1).css("pointer-events","none"),Ic?(s("header nav .account .loading").css("opacity",1).removeClass("hidden"),s("header nav .account .avatar").stop(!0,!0).css({opacity:1}).animate({opacity:0},100,()=>{s("header nav .account .avatar").addClass("hidden")})):(s("header nav .account .loading").stop(!0,!0).removeClass("hidden").css({opacity:0}).animate({opacity:1},100),s("header nav .account .user").stop(!0,!0).css({opacity:1}).animate({opacity:0},100,()=>{s("header nav .account .user").addClass("hidden")}))):(s("header nav .account").css("opacity",1).css("pointer-events","auto"),Ic?(s("header nav .account .loading").css("opacity",1).addClass("hidden"),s("header nav .account .avatar").stop(!0,!0).removeClass("hidden").css({opacity:0}).animate({opacity:1},100)):(s("header nav .account .loading").stop(!0,!0).css({opacity:1}).animate({opacity:0},100,()=>{s("header nav .account .loading").addClass("hidden")}),s("header nav .account .user").stop(!0,!0).removeClass("hidden").css({opacity:0}).animate({opacity:1},100)))}async function vl(e,t,a){z()?(e!==void 0&&(s("header nav .level").text(Math.floor(As(e))),s("header nav .bar").css({width:As(e)%1*100+"%"})),(a??"")&&(t??"")?pd(t,a).then(o=>{o!==null&&(s("header nav .account .avatar").css("background-image",`url(${o})`),Ic=!0,s("header nav .account .user").addClass("hidden"),s("header nav .account .avatar").removeClass("hidden"))}):(s("header nav .account .avatar").addClass("hidden"),s("header nav .account .user").removeClass("hidden")),s("nav .textButton.account").removeClass("hidden").css({opacity:0}).animate({opacity:1},125)):s("nav .textButton.account").css({opacity:1}).animate({opacity:0},125,()=>{s("nav .textButton.account").addClass("hidden")})}async function am(e,t,a){Ft=!1;const o=As(e),n=As(e+t),r=S();if(!r)return;if(Ft){s("nav .level").text(Math.floor(As(r.xp))),s("nav .xpBar").stop(!0,!0).css("opacity",1).animate({opacity:0},Ce()?0:250,()=>{s("nav .xpBar .xpGain").text("")});return}const l=xb(o,n),c=Tb(t,a);await Promise.all([l,c]),await Te(2e3),s("nav .level").text(Math.floor(As(r.xp))),s("nav .xpBar").stop(!0,!0).css("opacity",1).animate({opacity:0},Ce()?0:250,()=>{s("nav .xpBar .xpGain").text("")})}async function Tb(e,t){if(!t){s("nav .xpBar .xpGain").text(`+${e}`);return}const a=1e3;let o=0;const n=s("nav .xpBar .xpGain"),r=s("nav .xpBar .xpBreakdown");r.empty();async function l(c){Ft&&(o=e,c=""),r.find(".next").removeClass("next").addClass("previous"),r.append(`<div class='text next' style="opacity: 0; margin-top: 1rem;">${c}</div>`);const d=r.find(".previous");d.animate({marginTop:"-1rem",opacity:0},Ce()?0:250,()=>{d.remove()}),setTimeout(()=>{n.stop(!0,!0).text(`+${o}`).css({borderSpacing:100}).animate({borderSpacing:0},{step(u){n.css("transform",`scale(${1+u/300}) translateY(-50%)`)},duration:Ce()?0:250,easing:"swing"})},125),await Ss(r.find(".next"),{opacity:"1",marginTop:"0"},Ce()?0:250,"swing")}n.text("+0"),r.append(`<div class='text next'>time typing +${t.base}</div>`),o+=t.base??0,t["100%"]?(await Te(a),await l(`perfect +${t["100%"]}`),o+=t["100%"]):t.corrected&&(await Te(a),await l(`clean +${t.corrected}`),o+=t.corrected),!Ft&&(t.quote?(await Te(a),await l(`quote +${t.quote}`),o+=t.quote):(t.punctuation&&(await Te(a),await l(`punctuation +${t.punctuation}`),o+=t.punctuation),t.numbers&&(await Te(a),await l(`numbers +${t.numbers}`),o+=t.numbers)),!Ft&&(t.funbox&&(await Te(a),await l(`funbox +${t.funbox}`),o+=t.funbox),!Ft&&(t.streak&&(await Te(a),await l(`streak +${t.streak}`),o+=t.streak),!Ft&&(t.accPenalty&&(await Te(a),await l(`accuracy penalty -${t.accPenalty}`),o-=t.accPenalty),!Ft&&(t.incomplete&&(await Te(a),await l(`incomplete tests +${t.incomplete}`),o+=t.incomplete),!Ft&&(t.configMultiplier&&(await Te(a),await l(`global multiplier x${t.configMultiplier}`),o*=t.configMultiplier),!Ft&&(t.daily&&(await Te(a),await l(`daily bonus +${t.daily}`),o+=t.daily),!Ft&&(await Te(a),await l("")))))))))}async function xb(e,t){const a=t-e;s("nav .xpBar").stop(!0,!0).css("opacity",0),await Ss(s("nav .xpBar"),{opacity:"1"},Ce()?0:250,"linear");const o=s("nav .xpBar .bar");if(o.css("width",`${e%1*100}%`),t%1===0)await Ss(o,{width:"100%"},Ce()?0:1e3,"easeOutExpo"),Qi(),o.css("width","0%");else if(Math.floor(e)===Math.floor(t))await Ss(o,{width:`${t%1*100}%`},Ce()?0:1e3,"easeOutExpo");else{const n=Math.min(1e3/a,200);let r=a,l=!1;for(;r>1;)r-1<1?(l&&(Qi(),o.css("width","0%")),await Ss(o,{width:"100%"},Ce()?0:Sr(r-1,0,.5,1e3,200),"easeOutQuad"),r--):(l&&(Qi(),o.css("width","0%")),await Ss(o,{width:"100%"},Ce()?0:n,"linear"),r--),l=!0;Qi(),o.css("width","0%"),await Ss(o,{width:`${r%1*100}%`},Ce()?0:1e3,"easeOutExpo")}}async function Qi(){const e=await ms(),t=s("nav .level");t.text(parseInt(t.text())+1);const a=Math.random()*2-1,o=Math.random()+1;t.stop(!0,!0).css({backgroundColor:e.main,borderSpacing:100}).animate({backgroundColor:e.sub,borderSpacing:0},{step(n){t.css("transform",`scale(${1+n/200*o}) rotate(${n/10*a}deg)`)},duration:2e3,easing:"easeOutCubic",complete:()=>{t.css("background-color","")}})}const Md=[{name:"nausea",info:"I think I'm gonna be sick.",hasCSS:!0},{name:"round_round_baby",info:"...right round, like a record baby. Right, round round round.",hasCSS:!0},{name:"simon_says",info:"Type what simon says.",properties:["changesWordsVisibility","usesLayout"],forcedConfig:{highlightMode:["letter","off"]},hasCSS:!0},{name:"mirror",info:"Everything is mirrored!",hasCSS:!0},{name:"upside_down",info:"Everything is upside down!",hasCSS:!0},{name:"tts",info:"Listen closely.",properties:["changesWordsVisibility","speaks"],forcedConfig:{highlightMode:["letter","off"]},hasCSS:!0},{name:"choo_choo",info:"All the letters are spinning!",properties:["noLigatures","conflictsWithSymmetricChars"],hasCSS:!0},{name:"arrows",info:"Play it on a pad!",properties:["ignoresLanguage","ignoresLayout","nospace","noLetters","symmetricChars"],forcedConfig:{punctuation:[!1],numbers:[!1],highlightMode:["letter","off"]}},{name:"rAnDoMcAsE",info:"I kInDa LiKe HoW iNeFfIcIeNt QwErTy Is.",properties:["changesCapitalisation"]},{name:"capitals",info:"Capitalize Every Word.",properties:["changesCapitalisation"]},{name:"layoutfluid",info:"Switch between layouts specified below proportionately to the length of the test.",properties:["changesLayout","noInfiniteDuration"]},{name:"earthquake",info:"Everybody get down! The words are shaking!",properties:["noLigatures"],hasCSS:!0},{name:"space_balls",info:"In a galaxy far far away.",hasCSS:!0},{name:"gibberish",info:"Anvbuefl dizzs eoos alsb?",properties:["ignoresLanguage","unspeakable"]},{name:"58008",alias:"numbers",info:"A special mode for accountants.",properties:["ignoresLanguage","ignoresLayout","noLetters"],forcedConfig:{numbers:[!1]}},{name:"ascii",info:"Where was the ampersand again?. Only ASCII characters.",properties:["ignoresLanguage","noLetters","unspeakable"],forcedConfig:{numbers:[!1]}},{name:"specials",info:"!@#$%^&*. Only special characters.",properties:["ignoresLanguage","noLetters","unspeakable"],forcedConfig:{punctuation:[!1],numbers:[!1]}},{name:"plus_one",info:"React quickly! Only one future word is visible.",properties:["changesWordsVisibility","toPush:2","noInfiniteDuration"]},{name:"plus_two",info:"Only two future words are visible.",properties:["changesWordsVisibility","toPush:3","noInfiniteDuration"]},{name:"plus_three",info:"Only three future words are visible.",properties:["changesWordsVisibility","toPush:4","noInfiniteDuration"]},{name:"read_ahead_easy",info:"Only the current word is invisible.",properties:["changesWordsVisibility"],forcedConfig:{highlightMode:["letter","off"]},hasCSS:!0},{name:"read_ahead",info:"Current and the next word are invisible!",properties:["changesWordsVisibility"],forcedConfig:{highlightMode:["letter","off"]},hasCSS:!0},{name:"read_ahead_hard",info:"Current and the next two words are invisible!",properties:["changesWordsVisibility"],forcedConfig:{highlightMode:["letter","off"]},hasCSS:!0},{name:"memory",info:"Test your memory. Remember the words and type them blind.",properties:["changesWordsVisibility","noInfiniteDuration"],forcedConfig:{mode:["words","quote","custom"]}},{name:"nospace",info:"Whoneedsspacesanyway?",properties:["nospace"],forcedConfig:{highlightMode:["letter","off"]}},{name:"poetry",info:"Practice typing some beautiful prose.",properties:["noInfiniteDuration","ignoresLanguage"],forcedConfig:{punctuation:[!1],numbers:[!1]}},{name:"wikipedia",info:"Practice typing wikipedia sections.",properties:["noInfiniteDuration","ignoresLanguage"],forcedConfig:{punctuation:[!1],numbers:[!1]}},{name:"weakspot",info:"Focus on slow and mistyped letters.",properties:["changesWordsFrequency"]},{name:"pseudolang",info:"Nonsense words that look like the current language.",properties:["unspeakable","ignoresLanguage"]},{name:"IPv4",alias:"network",info:"For sysadmins.",properties:["ignoresLanguage","ignoresLayout","noLetters"],forcedConfig:{numbers:[!1]}},{name:"IPv6",alias:"network",info:"For sysadmins with a long beard.",properties:["ignoresLanguage","ignoresLayout","noLetters"],forcedConfig:{numbers:[!1]}},{name:"binary",alias:"numbers",info:"01000010 01100101 01100101 01110000 00100000 01100010 01101111 01101111 01110000 00101110",properties:["ignoresLanguage","ignoresLayout","noLetters"],forcedConfig:{numbers:[!1],punctuation:[!1]}},{name:"zipf",alias:"frequency",info:"Words are generated according to Zipf's law. (not all languages will produce Zipfy results, use with caution)",properties:["changesWordsFrequency"]},{name:"morse",info:"-.../././.--./ -.../---/---/.--./-.-.--/ ",properties:["ignoresLanguage","ignoresLayout","noLetters","nospace"]},{name:"crt",info:"Go back to the 1980s",properties:["noLigatures"]},{name:"backwards",info:"...sdrawkcab epyt ot yrt woN",properties:["noLigatures","conflictsWithSymmetricChars","wordOrder:reverse"]},{name:"ddoouubblleedd",info:"TTyyppee eevveerryytthhiinngg ttwwiiccee..",properties:["noLigatures"]}];function $b(){return Md}function V(e){const t=[];for(const a of e.split("#")){const o=Md.find(n=>n.name===a);o&&t.push(o)}return t}function me(e,t){const a=Md.find(o=>o.name===e);if(!a)throw new Error(`Funbox ${e} not found.`);a.functions=t}function Ec(e,t,a){var o;if(V(a).length===0)return{result:!0};if(e==="words"||e==="time")return t===0?(a==="nospace"&&console.log("break"),V(a).filter(r=>{var l;return(l=r.properties)==null?void 0:l.includes("noInfiniteDuration")}).length>0?{result:!1,forcedConfigs:[e==="words"?10:15]}:{result:!0}):{result:!0};{const n={};for(const r of V(a))if(r.forcedConfig)for(const l in r.forcedConfig)n[l]===void 0?n[l]=r.forcedConfig[l]:n[l]=Tp(n[l],r.forcedConfig[l],!0);if(n[e]===void 0)return{result:!0};if(((o=n[e])==null?void 0:o.length)===0)throw new Error("No intersection of forced configs");return{result:(n[e]??[]).includes(t),forcedConfigs:n[e]}}}function io(e,t,a,o=!1){let n=0;if(e==="mode"){let r=[];r=r.concat(V(a).filter(l=>{var c,d;return((c=l.forcedConfig)==null?void 0:c.mode)!==void 0&&!((d=l.forcedConfig)!=null&&d.mode.includes(t))})),t==="zen"&&(r=r.concat(V(a).filter(l=>{var c,d,u,f,p,g,h,y,w,k,L;return((c=l.functions)==null?void 0:c.getWord)??((d=l.functions)==null?void 0:d.pullSection)??((u=l.functions)==null?void 0:u.alterText)??((f=l.functions)==null?void 0:f.withWords)??((p=l.properties)==null?void 0:p.includes("changesCapitalisation"))??((g=l.properties)==null?void 0:g.includes("nospace"))??((h=l.properties)==null?void 0:h.find(x=>x.startsWith("toPush:")))??((y=l.properties)==null?void 0:y.includes("changesWordsVisibility"))??((w=l.properties)==null?void 0:w.includes("speaks"))??((k=l.properties)==null?void 0:k.includes("changesLayout"))??((L=l.properties)==null?void 0:L.includes("changesWordsFrequency"))}))),(t==="quote"||t==="custom")&&(r=r.concat(V(a).filter(l=>{var c,d,u,f;return((c=l.functions)==null?void 0:c.getWord)??((d=l.functions)==null?void 0:d.pullSection)??((u=l.functions)==null?void 0:u.withWords)??((f=l.properties)==null?void 0:f.includes("changesWordsFrequency"))}))),r.length>0&&(n+=1)}if(e==="words"||e==="time"){if(!Ec(e,t,a).result)if(o)n+=1;else return m("Active funboxes do not support infinite tests",0),!1}else Ec(e,t,a).result||(n+=1);return n>0?(o||m(`You can't set ${xp(e)} to ${t} with currently active funboxes.`,0,{duration:5}),!1):!0}function sm(e,t){console.log("cansetfunboxwithconfig",e,t.mode);let a=t.funbox;a==="none"?a=e:a+="#"+e;const o=[];for(const[n,r]of Object.entries(t))io(n,r,a,!0)||o.push({key:n,value:r});if(o.length>0){const n=[];for(const r of o)n.push(`${Do(xp(r.key))} cannot be set to ${r.value}.`);return m(`You can't enable ${e.replace(/_/g," ")}:<br>${n.join("<br>")}`,0,{duration:5,allowHTML:!0}),!1}else return!0}function Ld(e,t){if(t==="none"||e==="none")return!0;let a=V(e);t!==void 0&&(a=a.concat($b().filter(v=>v.name===t)));const o=V(e).filter(v=>e.split("#").find(C=>C===v.name)!==void 0).length===e.split("#").length,n=a.filter(v=>{var C,q,G;return((C=v.functions)==null?void 0:C.getWord)??((q=v.functions)==null?void 0:q.pullSection)??((G=v.functions)==null?void 0:G.withWords)}).length<=1,r=a.filter(v=>{var C;return(C=v.properties)==null?void 0:C.find(q=>q==="changesLayout")}).length===0||a.filter(v=>{var C;return(C=v.properties)==null?void 0:C.find(q=>q==="ignoresLayout"||q==="usesLayout")}).length===0,l=a.filter(v=>{var C;return(C=v.properties)==null?void 0:C.find(q=>q==="nospace"||q.startsWith("toPush"))}).length<=1,c=a.filter(v=>{var C;return(C=v.properties)==null?void 0:C.find(q=>q==="changesWordsVisibility")}).length<=1,d=a.filter(v=>{var C;return(C=v.properties)==null?void 0:C.find(q=>q==="changesWordsFrequency")}).length<=1,u=a.filter(v=>{var C;return(C=v.properties)==null?void 0:C.find(q=>q==="changesWordsFrequency")}).length===0||a.filter(v=>{var C;return(C=v.properties)==null?void 0:C.find(q=>q==="ignoresLanguage")}).length===0,f=a.filter(v=>{var C;return(C=v.properties)==null?void 0:C.find(q=>q==="noLetters")}).length===0||a.filter(v=>{var C;return(C=v.properties)==null?void 0:C.find(q=>q==="changesCapitalisation")}).length===0,p=a.filter(v=>{var C;return(C=v.properties)==null?void 0:C.find(q=>q==="conflictsWithSymmetricChars")}).length===0||a.filter(v=>{var C;return(C=v.properties)==null?void 0:C.find(q=>q==="symmetricChars")}).length===0,g=a.filter(v=>{var C;return(C=v.properties)==null?void 0:C.find(q=>q==="speaks")}).length<=1,h=a.filter(v=>{var C;return(C=v.properties)==null?void 0:C.find(q=>q==="speaks")}).length===0||a.filter(v=>{var C;return(C=v.properties)==null?void 0:C.find(q=>q==="speaks")}).length===1&&a.filter(v=>{var C;return(C=v.properties)==null?void 0:C.find(q=>q==="unspeakable")}).length===0||a.filter(v=>{var C;return(C=v.properties)==null?void 0:C.find(q=>q==="ignoresLanguage")}).length===0,y=a.filter(v=>{var C,q;return(((C=v.properties)==null?void 0:C.find(G=>G.startsWith("toPush:")))??"")||((q=v.functions)==null?void 0:q.pullSection)}).length<=1,w=a.filter(v=>v.hasCSS==!0).length<=1,k=a.filter(v=>{var C;return(C=v.functions)==null?void 0:C.punctuateWord}).length<=1,L=a.filter(v=>{var C;return(C=v.functions)==null?void 0:C.isCharCorrect}).length<=1,x=a.filter(v=>{var C;return(C=v.functions)==null?void 0:C.getWordHtml}).length<=1,B={};let D=!0;for(const v of a)if(v.forcedConfig)for(const C in v.forcedConfig)if(B[C]){if(Tp(B[C],v.forcedConfig[C],!0).length===0){D=!1;break}}else B[C]=v.forcedConfig[C];return o&&n&&r&&l&&c&&d&&u&&f&&p&&g&&h&&y&&w&&k&&L&&x&&D}let om,nm;const i={...Kt};let gr={};const Ab=Et(1e3,()=>{Object.keys(gr).length>0&&(_t(!0),Yp(gr).then(()=>{_t(!1)})),gr={}});function M(e,t=!1,a=!1){if(t)return;const n=JSON.stringify(i);window.localStorage.setItem("config",n),a||(gr[e]=i[e],Ab()),$("saveToLocalStorage",n)}function Jo(e=!1){console.log("saving full config to localStorage");const t=i,a=JSON.stringify(t);window.localStorage.setItem("config",a),e||(_t(!0),Yp(t),_t(!1)),$("saveToLocalStorage",a)}function zt(e,t){return!W("numbers",e,["boolean"])||!io("numbers",e,i.funbox)?!1:(i.mode==="quote"&&(e=!1),i.numbers=e,M("numbers",t),$("numbers",i.numbers),!0)}function ua(e,t){return!W("punctuation",e,["boolean"])||!io("punctuation",e,i.funbox)?!1:(i.mode==="quote"&&(e=!1),i.punctuation=e,M("punctuation",t),$("punctuation",i.punctuation),!0)}function Ge(e,t){if(!W("mode",e,[["time","words","quote","zen","custom"]])||!io("mode",e,i.funbox))return!1;const a=i.mode;return i.mode=e,i.mode==="custom"||i.mode==="quote"?(ua(!1,!0),zt(!1,!0)):i.mode==="zen"&&i.paceCaret!=="off"&&m("Pace caret will not work with zen mode.",0),M("mode",t),$("mode",i.mode,t,a),!0}function im(e,t){return W("play sound on error",e,[["off","1","2","3","4"]])?(i.playSoundOnError=e,M("playSoundOnError",t),$("playSoundOnError",i.playSoundOnError),!0):!1}function rm(e,t){return W("play sound on click",e,[["off","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"]])?(i.playSoundOnClick=e,M("playSoundOnClick",t),$("playSoundOnClick",i.playSoundOnClick),!0):!1}function lm(e,t){return W("sound volume",e,[["0.1","0.5","1.0"]])?(i.soundVolume=e,M("soundVolume",t),$("soundVolume",i.soundVolume),!0):!1}function ta(e,t){return W("difficulty",e,[["normal","expert","master"]])?(i.difficulty=e,M("difficulty",t),$("difficulty",i.difficulty,t),!0):!1}function Bc(e,t){return W("favorite themes",e,["stringArray"])?(i.favThemes=e,M("favThemes",t),$("favThemes",i.favThemes),!0):!1}function ka(e,t){if(!W("funbox",e,["string"]))return!1;for(const o of i.funbox.split("#"))if(!sm(o,i))return!1;const a=e||"none";return i.funbox=a,M("funbox",t),$("funbox",i.funbox),!0}function Wd(e,t){if(!W("funbox",e,["string"]))return!1;let a;const o=i.funbox.split("#");if(o[0]==="none"&&o.splice(0,1),o.includes(e))a=o.indexOf(e),o.splice(a,1),o.length===0?i.funbox="none":i.funbox=o.join("#"),a=-a-1;else{if(!sm(e,i))return!1;o.push(e),i.funbox=o.sort().join("#"),a=o.indexOf(e)}return M("funbox",t),$("funbox",i.funbox),a}function cm(e,t){return W("blind mode",e,["boolean"])?(i.blindMode=e,M("blindMode",t),$("blindMode",i.blindMode,t),!0):!1}function Mb(e,t){return W("account chart",e,[["on","off"],"stringArray"])?(e.length!==4&&(e=["on","on","on","on"]),i.accountChart=e,M("accountChart",t),$("accountChart",i.accountChart),!0):!1}function Lb(e,t){return W("account chart results",e,["boolean"])?(i.accountChart[0]=e?"on":"off",M("accountChart",t),$("accountChart",i.accountChart),!0):!1}function Wb(e,t){return W("account chart accuracy",e,["boolean"])?(i.accountChart[1]=e?"on":"off",M("accountChart",t),$("accountChart",i.accountChart),!0):!1}function Ib(e,t){return W("account chart avg 10",e,["boolean"])?(i.accountChart[2]=e?"on":"off",M("accountChart",t),$("accountChart",i.accountChart),!0):!1}function Eb(e,t){return W("account chart avg 100",e,["boolean"])?(i.accountChart[3]=e?"on":"off",M("accountChart",t),$("accountChart",i.accountChart),!0):!1}function Id(e,t){return W("stop on error",e,[["off","word","letter"]])?(i.stopOnError=e,i.stopOnError!=="off"&&(i.confidenceMode="off",M("confidenceMode",t)),M("stopOnError",t),$("stopOnError",i.stopOnError,t),!0):!1}function dm(e,t){return W("always show decimal places",e,["boolean"])?(i.alwaysShowDecimalPlaces=e,M("alwaysShowDecimalPlaces",t),$("alwaysShowDecimalPlaces",i.alwaysShowDecimalPlaces),!0):!1}function um(e,t){return W("typing speed unit",e,[["wpm","cpm","wps","cps","wph"]])?(i.typingSpeedUnit=e,M("typingSpeedUnit",t),$("typingSpeedUnit",i.typingSpeedUnit,t),!0):!1}function fm(e,t){return W("show out of focus warning",e,["boolean"])?(i.showOutOfFocusWarning=e,i.showOutOfFocusWarning||hi(),M("showOutOfFocusWarning",t),$("showOutOfFocusWarning",i.showOutOfFocusWarning),!0):!1}function pm(e,t){return W("pace caret",e,[["custom","off","average","pb","last","daily"]])?document.readyState==="complete"&&e==="pb"&&!z()?(m("PB pace caret is unavailable without an account",0),!1):(i.paceCaret=e,M("paceCaret",t),$("paceCaret",i.paceCaret,t),!0):!1}function Ed(e,t){return W("pace caret custom speed",e,["number"])?(i.paceCaretCustomSpeed=e,M("paceCaretCustomSpeed",t),$("paceCaretCustomSpeed",i.paceCaretCustomSpeed),!0):!1}function mm(e,t){return W("repeated pace",e,["boolean"])?(i.repeatedPace=e,M("repeatedPace",t),$("repeatedPace",i.repeatedPace),!0):!1}function gm(e,t){return W("min speed",e,[["off","custom"]])?(i.minWpm=e,M("minWpm",t),$("minWpm",i.minWpm,t),!0):!1}function Bd(e,t){return W("min speed custom",e,["number"])?(i.minWpmCustomSpeed=e,M("minWpmCustomSpeed",t),$("minWpmCustomSpeed",i.minWpmCustomSpeed),!0):!1}function hm(e,t){return W("min acc",e,[["off","custom"]])?(i.minAcc=e,M("minAcc",t),$("minAcc",i.minAcc,t),!0):!1}function Pd(e,t){return W("min acc custom",e,["number"])?(e>100&&(e=100),i.minAccCustom=e,M("minAccCustom",t),$("minAccCustom",i.minAccCustom),!0):!1}function ym(e,t){return W("min burst",e,[["off","fixed","flex"]])?(i.minBurst=e,M("minBurst",t),$("minBurst",i.minBurst,t),!0):!1}function qd(e,t){return W("min burst custom speed",e,["number"])?(i.minBurstCustomSpeed=e,M("minBurstCustomSpeed",t),$("minBurstCustomSpeed",i.minBurstCustomSpeed),!0):!1}function vm(e,t){return W("always show words history",e,["boolean"])?(i.alwaysShowWordsHistory=e,M("alwaysShowWordsHistory",t),$("alwaysShowWordsHistory",i.alwaysShowWordsHistory),!0):!1}function wm(e,t){return W("single list command line",e,[["manual","on"]])?(i.singleListCommandLine=e,M("singleListCommandLine",t),$("singleListCommandLine",i.singleListCommandLine),!0):!1}function bm(e,t){return W("caps lock warning",e,["boolean"])?(i.capsLockWarning=e,M("capsLockWarning",t),$("capsLockWarning",i.capsLockWarning),!0):!1}function _n(e,t){return W("show all lines",e,["boolean"])?e&&i.tapeMode!=="off"?(m("Show all lines doesn't support tape mode",0),!1):(i.showAllLines=e,M("showAllLines",t),$("showAllLines",i.showAllLines,t),!0):!1}function Cm(e,t){return W("quick end",e,["boolean"])?(i.quickEnd=e,M("quickEnd",t),$("quickEnd",i.quickEnd),!0):!1}function km(e,t){return W("ads",e,[["off","result","on","sellout"]])?(i.ads=e,M("ads",t),t||(ps(3),m("Ad settings changed. Refreshing...",0)),$("ads",i.ads),!0):!1}function Sm(e,t){return W("repeat quotes",e,[["off","typing"]])?(i.repeatQuotes=e,M("repeatQuotes",t),$("repeatQuotes",i.repeatQuotes),!0):!1}function Tm(e,t){return W("flip test colors",e,["boolean"])?(i.flipTestColors=e,M("flipTestColors",t),$("flipTestColors",i.flipTestColors),!0):!1}function xm(e,t){return W("colorful mode",e,["boolean"])?(i.colorfulMode=e,M("colorfulMode",t),$("colorfulMode",i.colorfulMode),!0):!1}function $m(e,t){return W("strict space",e,["boolean"])?(i.strictSpace=e,M("strictSpace",t),$("strictSpace",i.strictSpace),!0):!1}function Am(e,t){return W("opposite shift mode",e,[["off","on","keymap"]])?(i.oppositeShiftMode=e,M("oppositeShiftMode",t),$("oppositeShiftMode",i.oppositeShiftMode),!0):!1}function Mm(e,t){return W("page width",e,[["max","100","125","150","200"]])?(i.pageWidth=e,s("#contentWrapper").removeClass("wide125"),s("#contentWrapper").removeClass("wide150"),s("#contentWrapper").removeClass("wide200"),s("#contentWrapper").removeClass("widemax"),s("#app").removeClass("wide125"),s("#app").removeClass("wide150"),s("#app").removeClass("wide200"),s("#app").removeClass("widemax"),e!=="100"&&(s("#contentWrapper").addClass("wide"+e),s("#app").addClass("wide"+e)),M("pageWidth",t),$("pageWidth",i.pageWidth),!0):!1}function Lm(e,t){return W("caret style",e,[["off","default","block","outline","underline","carrot","banana"]])?(i.caretStyle=e,s("#caret").removeClass("off"),s("#caret").removeClass("default"),s("#caret").removeClass("underline"),s("#caret").removeClass("outline"),s("#caret").removeClass("block"),s("#caret").removeClass("carrot"),s("#caret").removeClass("banana"),e==="off"?s("#caret").addClass("off"):e==="default"?s("#caret").addClass("default"):e==="block"?s("#caret").addClass("block"):e==="outline"?s("#caret").addClass("outline"):e==="underline"?s("#caret").addClass("underline"):e==="carrot"?s("#caret").addClass("carrot"):e==="banana"&&s("#caret").addClass("banana"),M("caretStyle",t),$("caretStyle",i.caretStyle),!0):!1}function Wm(e,t){return W("pace caret style",e,[["off","default","block","outline","underline","carrot","banana"]])?(i.paceCaretStyle=e,s("#paceCaret").removeClass("off"),s("#paceCaret").removeClass("default"),s("#paceCaret").removeClass("underline"),s("#paceCaret").removeClass("outline"),s("#paceCaret").removeClass("block"),s("#paceCaret").removeClass("carrot"),s("#paceCaret").removeClass("banana"),e==="default"?s("#paceCaret").addClass("default"):e==="block"?s("#paceCaret").addClass("block"):e==="outline"?s("#paceCaret").addClass("outline"):e==="underline"?s("#paceCaret").addClass("underline"):e==="carrot"?s("#paceCaret").addClass("carrot"):e==="banana"&&s("#paceCaret").addClass("banana"),M("paceCaretStyle",t),$("paceCaretStyle",i.paceCaretStyle),!0):!1}function Im(e,t){return W("show timer progress",e,["boolean"])?(i.showTimerProgress=e,M("showTimerProgress",t),$("showTimerProgress",i.showTimerProgress),!0):!1}function Em(e,t){return W("show live speed",e,["boolean"])?(i.showLiveWpm=e,M("showLiveWpm",t),$("showLiveWpm",i.showLiveWpm),!0):!1}function Bm(e,t){return W("show live acc",e,["boolean"])?(i.showLiveAcc=e,M("showLiveAcc",t),$("showLiveAcc",i.showLiveAcc),!0):!1}function Pm(e,t){return W("show live burst",e,["boolean"])?(i.showLiveBurst=e,M("showLiveBurst",t),$("showLiveBurst",i.showLiveBurst),!0):!1}function qm(e,t){return W("show average",e,[["off","speed","acc","both"]])?(i.showAverage=e,M("showAverage",t),$("showAverage",i.showAverage,t),!0):!1}function gs(e,t){return!W("highlight mode",e,[["off","letter","word","next_word","next_two_words","next_three_words"]])||!io("highlightMode",e,i.funbox)?!1:(i.highlightMode=e,M("highlightMode",t),$("highlightMode",i.highlightMode),!0)}function Fd(e,t){return W("tape mode",e,[["off","letter","word"]])?(e!=="off"&&i.showAllLines&&_n(!1,!0),i.tapeMode=e,M("tapeMode",t),$("tapeMode",i.tapeMode),!0):!1}function Fm(e,t){return W("hide extra letters",e,["boolean"])?(i.hideExtraLetters=e,M("hideExtraLetters",t),$("hideExtraLetters",i.hideExtraLetters),!0):!1}function Dm(e,t){return W("timer style",e,[["bar","text","mini"]])?(i.timerStyle=e,M("timerStyle",t),$("timerStyle",i.timerStyle),!0):!1}function Rm(e,t){return W("timer color",e,[["black","sub","text","main"]])?(i.timerColor=e,s("#timer").removeClass("timerSub"),s("#timer").removeClass("timerText"),s("#timer").removeClass("timerMain"),s("#timerNumber").removeClass("timerSub"),s("#timerNumber").removeClass("timerText"),s("#timerNumber").removeClass("timerMain"),s("#largeLiveWpmAndAcc").removeClass("timerSub"),s("#largeLiveWpmAndAcc").removeClass("timerText"),s("#largeLiveWpmAndAcc").removeClass("timerMain"),s("#miniTimerAndLiveWpm").removeClass("timerSub"),s("#miniTimerAndLiveWpm").removeClass("timerText"),s("#miniTimerAndLiveWpm").removeClass("timerMain"),e==="main"?(s("#timer").addClass("timerMain"),s("#timerNumber").addClass("timerMain"),s("#largeLiveWpmAndAcc").addClass("timerMain"),s("#miniTimerAndLiveWpm").addClass("timerMain")):e==="sub"?(s("#timer").addClass("timerSub"),s("#timerNumber").addClass("timerSub"),s("#largeLiveWpmAndAcc").addClass("timerSub"),s("#miniTimerAndLiveWpm").addClass("timerSub")):e==="text"&&(s("#timer").addClass("timerText"),s("#timerNumber").addClass("timerText"),s("#largeLiveWpmAndAcc").addClass("timerText"),s("#miniTimerAndLiveWpm").addClass("timerText")),M("timerColor",t),$("timerColor",i.timerColor),!0):!1}function Om(e,t){return W("timer opacity",e,[["0.25","0.5","0.75","1"]])?(i.timerOpacity=e,M("timerOpacity",t),$("timerOpacity",i.timerOpacity),!0):!1}function Hm(e,t){return W("key tips",e,["boolean"])?(i.showKeyTips=e,i.showKeyTips?s("footer .keyTips").removeClass("hidden"):s("footer .keyTips").addClass("hidden"),M("showKeyTips",t),$("showKeyTips",i.showKeyTips),!0):!1}function ia(e,t){if(!W("time",e,["number"])||!io("words",e,i.funbox))return!1;const a=isNaN(e)||e<0?Kt.time:e;return i.time=a,M("time",t),$("time",i.time),!0}function $a(e,t,a){return W("quote length",e,[[-3,-2,-1,0,1,2,3],"numberArray"])?(Array.isArray(e)?(e.length===1&&e[0]===-1&&(e=[1]),i.quoteLength=e):(Array.isArray(i.quoteLength)||(i.quoteLength=[]),(e===null||isNaN(e)||e<-3||e>3)&&(e=1),e=parseInt(e.toString()),e===-1?i.quoteLength=[0,1,2,3]:a&&e>=0?i.quoteLength.includes(e)?i.quoteLength.length>1&&(i.quoteLength=i.quoteLength.filter(o=>o!==e)):i.quoteLength.push(e):i.quoteLength=[e]),M("quoteLength",t),$("quoteLength",i.quoteLength),!0):!1}function ns(e,t){if(!W("words",e,["number"])||!io("words",e,i.funbox))return!1;const a=e<0||e>1e5?Kt.words:e;return i.words=a,M("words",t),$("words",i.words),!0}function _m(e,t){return W("smooth caret",e,[["off","slow","medium","fast"]])?(i.smoothCaret=e,e==="off"?s("#caret").css("animation-name","caretFlashHard"):s("#caret").css("animation-name","caretFlashSmooth"),M("smoothCaret",t),$("smoothCaret",i.smoothCaret),!0):!1}function Nm(e,t){return W("start graphs at zero",e,["boolean"])?(i.startGraphsAtZero=e,M("startGraphsAtZero",t),$("startGraphsAtZero",i.startGraphsAtZero),!0):!1}function Km(e,t){return W("smooth line scroll",e,["boolean"])?(i.smoothLineScroll=e,M("smoothLineScroll",t),$("smoothLineScroll",i.smoothLineScroll),!0):!1}function zm(e,t){return W("quick restart mode",e,[["off","esc","tab","enter"]])?(i.quickRestart=e,M("quickRestart",t),$("quickRestart",i.quickRestart),!0):!1}function Um(e,t){return W("font family",e,["string"])?(e===""&&(e="roboto_mono",m("Empty input received, reverted to the default font.",0,{customTitle:"Custom font"})),!e||!/^[0-9a-zA-Z_.\-#+()]+$/.test(e)?(m(`Invalid font name value: "${e}".`,-1,{customTitle:"Custom font",duration:3}),!1):(i.fontFamily=e,document.documentElement.style.setProperty("--font",`"${e.replace(/_/g," ")}", "Roboto Mono", "Vazirmatn", monospace`),M("fontFamily",t),$("fontFamily",i.fontFamily),!0)):!1}function Vm(e,t){return W("freedom mode",e,["boolean"])?(e==null&&(e=!1),i.freedomMode=e,i.freedomMode&&i.confidenceMode!=="off"&&(i.confidenceMode="off"),M("freedomMode",t),$("freedomMode",i.freedomMode),!0):!1}function jm(e,t){return W("confidence mode",e,[["off","on","max"]])?(i.confidenceMode=e,i.confidenceMode!=="off"&&(i.freedomMode=!1,i.stopOnError="off",M("freedomMode",t),M("stopOnError",t)),M("confidenceMode",t),$("confidenceMode",i.confidenceMode,t),!0):!1}function Qm(e,t){return W("indicate typos",e,[["off","below","replace"]])?(i.indicateTypos=e,M("indicateTypos",t),$("indicateTypos",i.indicateTypos),!0):!1}function Gm(e,t){return W("auto switch theme",e,["boolean"])?(e=e??Kt.autoSwitchTheme,i.autoSwitchTheme=e,M("autoSwitchTheme",t),$("autoSwitchTheme",i.autoSwitchTheme),!0):!1}function es(e,t){return W("custom theme",e,["boolean"])?(i.customTheme=e,M("customTheme",t),$("customTheme",i.customTheme),!0):!1}function Ym(e,t){return W("theme",e,["string"])?(i.theme=e,i.customTheme&&es(!1),M("theme",t),$("theme",i.theme),!0):!1}function Jm(e,t){return W("theme light",e,["string"])?(i.themeLight=e,M("themeLight",t),$("themeLight",i.themeLight,t),!0):!1}function Zm(e,t){return W("theme dark",e,["string"])?(i.themeDark=e,M("themeDark",t),$("themeDark",i.themeDark,t),!0):!1}function Bb(e,t,a,o,n){return W("themes",e,["string"])?(a.length===9&&(t&&m("Missing sub alt color. Please edit it in the custom theme settings and save your changes.",0,{duration:7}),a.splice(4,0,"#000000")),i.customThemeColors=a,i.theme=e,i.customTheme=t,i.autoSwitchTheme=o,M("theme",n),$("setThemes",t),!0):!1}function Xm(e,t){var a,o;if(!W("random theme",e,[["off","on","fav","light","dark","custom"]]))return!1;if(e==="custom"){if(!z())return i.randomTheme=e,!1;if(!S())return!0;if(((o=(a=S())==null?void 0:a.customThemes)==null?void 0:o.length)===0)return m("You need to create a custom theme first",0),i.randomTheme="off",!1}return i.randomTheme=e,M("randomTheme",t),$("randomTheme",i.randomTheme),!0}function eg(e,t){return W("british english",e,["boolean"])?(e||(e=!1),i.britishEnglish=e,M("britishEnglish",t),$("britishEnglish",i.britishEnglish),!0):!1}function Nn(e,t){return W("lazy mode",e,["boolean"])?(e||(e=!1),i.lazyMode=e,M("lazyMode",t),$("lazyMode",i.lazyMode,t),!0):!1}function Kn(e,t){return W("custom theme colors",e,["stringArray"])?(e.length===9&&(m("Missing sub alt color. Please edit it in the custom theme settings and save your changes.",0,{duration:7}),e.splice(4,0,"#000000")),e!==void 0&&(i.customThemeColors=e),M("customThemeColors",t),$("customThemeColors",i.customThemeColors,t),!0):!1}function Oo(e,t){return W("language",e,["string"])?(i.language=e,Pa("changedLanguage",{language:e}),M("language",t),$("language",i.language),!0):!1}function Pb(e,t){return W("monkey",e,["boolean"])?(i.monkey=e,M("monkey",t),$("monkey",i.monkey),!0):!1}function Gt(e,t){return W("keymap mode",e,[["off","static","react","next"]])?(s(".activeKey").removeClass("activeKey"),s(".keymapKey").attr("style",""),i.keymapMode=e,M("keymapMode",t),$("keymapMode",i.keymapMode,t),!0):!1}function tg(e,t){return W("keymap legend style",e,[["lowercase","uppercase","blank","dynamic"]])?(["lowercase","uppercase","blank","dynamic"].forEach(o=>{s(".keymapLegendStyle").removeClass(o)}),e=e||"lowercase",s(".keymapKey > .letter").css("display",""),s(".keymapKey > .letter").css("text-transform",""),e==="uppercase"&&s(".keymapKey > .letter").css("text-transform","capitalize"),e==="blank"&&s(".keymapKey > .letter").css("display","none"),s(".keymapLegendStyle").addClass(e),i.keymapLegendStyle=e,M("keymapLegendStyle",t),$("keymapLegendStyle",i.keymapLegendStyle),!0):!1}function ag(e,t){return W("keymap style",e,[["staggered","alice","matrix","split","split_matrix","steno","steno_matrix"]])?(e=e||"staggered",i.keymapStyle=e,M("keymapStyle",t),$("keymapStyle",i.keymapStyle),!0):!1}function Is(e,t){return W("keymap layout",e,["string"])?(i.keymapLayout=e,M("keymapLayout",t),$("keymapLayout",i.keymapLayout),!0):!1}function sg(e,t){return W("keymapShowTopRow",e,[["always","layout","never"]])?(i.keymapShowTopRow=e,M("keymapShowTopRow",t),$("keymapShowTopRow",i.keymapShowTopRow),!0):!1}function Es(e,t){return W("layout",e,["string"])?(i.layout=e,M("layout",t),$("layout",i.layout,t),!0):!1}function wl(e,t){return typeof e=="string"&&["1","125","15","2","3","4"].includes(e)&&(e==="125"?e=1.25:e==="15"?e=1.5:e=parseInt(e)),W("font size",e,["number"])?(e<0&&(e=1),e===15&&(e=1.5),i.fontSize=e,s("#words, #caret, #paceCaret, #miniTimerAndLiveWpm").css("fontSize",e+"rem"),M("fontSize",t),$("fontSize",i.fontSize,t),s(window).trigger("resize"),!0):!1}function bl(e,t){return W("custom background",e,["string"])?(e=e.trim(),/(https|http):\/\/(www\.|).+\..+\/.+(\.png|\.gif|\.jpeg|\.jpg)/gi.test(e)&&!/[<> "]/.test(e)||e===""?(i.customBackground=e,M("customBackground",t),$("customBackground",i.customBackground)):m("Invalid custom background URL",0),!0):!1}async function Dd(e,t){const a=e.trim();if(!await Cb("layoutfluid",a,["layoutfluid"]))return!1;const o=a.replace(/ /g,"#");return i.customLayoutfluid=o,M("customLayoutfluid",t),$("customLayoutFluid",i.customLayoutfluid),!0}function Rd(e,t){return W("custom background size",e,[["max","cover","contain"]])?(i.customBackgroundSize=e,M("customBackgroundSize",t),$("customBackgroundSize",i.customBackgroundSize),!0):!1}function Od(e,t){return W("custom background filter",e,["numberArray"])?(i.customBackgroundFilter=e,M("customBackgroundFilter",t),$("customBackgroundFilter",i.customBackgroundFilter),!0):!1}function qb(e,t){return W("monkey power level",e,[["off","1","2","3","4"]])?(["off","1","2","3","4"].includes(e)||(e="off"),i.monkeyPowerLevel=e,M("monkeyPowerLevel",t),$("monkeyPowerLevel",i.monkeyPowerLevel),!0):!1}function og(e,t){return W("burst heatmap",e,["boolean"])?(e||(e=!1),i.burstHeatmap=e,M("burstHeatmap",t),$("burstHeatmap",i.burstHeatmap),!0):!1}async function vi(e){if(e===void 0)return;$("fullConfigChange"),e=Db(e);const t=e;Object.keys(Kt).forEach(a=>{if(t[a]===void 0){const o=Kt[a];t[a]=o}}),t!=null&&(km(t.ads,!0),Jm(t.themeLight,!0),Zm(t.themeDark,!0),Bb(t.theme,t.customTheme,t.customThemeColors,t.autoSwitchTheme,!0),await Dd(t.customLayoutfluid,!0),bl(t.customBackground,!0),Rd(t.customBackgroundSize,!0),Od(t.customBackgroundFilter,!0),zm(t.quickRestart,!0),Hm(t.showKeyTips,!0),ia(t.time,!0),$a(t.quoteLength,!0),ns(t.words,!0),Oo(t.language,!0),Es(t.layout,!0),wl(t.fontSize,!0),Vm(t.freedomMode,!0),Lm(t.caretStyle,!0),Wm(t.paceCaretStyle,!0),ta(t.difficulty,!0),cm(t.blindMode,!0),Cm(t.quickEnd,!0),Tm(t.flipTestColors,!0),xm(t.colorfulMode,!0),jm(t.confidenceMode,!0),Qm(t.indicateTypos,!0),Dm(t.timerStyle,!0),Rm(t.timerColor,!0),Om(t.timerOpacity,!0),Gt(t.keymapMode,!0),ag(t.keymapStyle,!0),tg(t.keymapLegendStyle,!0),Is(t.keymapLayout,!0),sg(t.keymapShowTopRow,!0),Um(t.fontFamily,!0),_m(t.smoothCaret,!0),Km(t.smoothLineScroll,!0),Em(t.showLiveWpm,!0),Bm(t.showLiveAcc,!0),Pm(t.showLiveBurst,!0),Im(t.showTimerProgress,!0),dm(t.alwaysShowDecimalPlaces,!0),vm(t.alwaysShowWordsHistory,!0),wm(t.singleListCommandLine,!0),bm(t.capsLockWarning,!0),im(t.playSoundOnError,!0),rm(t.playSoundOnClick,!0),lm(t.soundVolume,!0),Id(t.stopOnError,!0),Bc(t.favThemes,!0),ka(t.funbox,!0),Xm(t.randomTheme,!0),_n(t.showAllLines,!0),fm(t.showOutOfFocusWarning,!0),pm(t.paceCaret,!0),Ed(t.paceCaretCustomSpeed,!0),mm(t.repeatedPace,!0),Mm(t.pageWidth,!0),Mb(t.accountChart,!0),ym(t.minBurst,!0),qd(t.minBurstCustomSpeed,!0),gm(t.minWpm,!0),Bd(t.minWpmCustomSpeed,!0),hm(t.minAcc,!0),Pd(t.minAccCustom,!0),zt(t.numbers,!0),ua(t.punctuation,!0),gs(t.highlightMode,!0),um(t.typingSpeedUnit,!0),Fm(t.hideExtraLetters,!0),Nm(t.startGraphsAtZero,!0),$m(t.strictSpace,!0),Am(t.oppositeShiftMode,!0),Ge(t.mode,!0),Pb(t.monkey,!0),Sm(t.repeatQuotes,!0),qb(t.monkeyPowerLevel,!0),og(t.burstHeatmap,!0),eg(t.britishEnglish,!0),Nn(t.lazyMode,!0),qm(t.showAverage,!0),Fd(t.tapeMode,!0),$("configApplied",void 0,void 0,void 0,i)),$("fullConfigChangeFinished")}async function Hd(){await vi(Kt),Jo()}async function Fb(){console.log("loading localStorage config");const e=window.localStorage.getItem("config");let t;if(e!=null&&e!==""){try{t=JSON.parse(e)}catch{t={}}await vi(t),om=t,Jo(!0)}else await Hd();nm()}function Db(e){const t=e;return t.quickTab===!0&&(t.quickRestart="tab"),typeof t.smoothCaret=="boolean"&&(t.smoothCaret=t.smoothCaret?"medium":"off"),t.swapEscAndTab===!0&&(t.quickRestart="esc"),t.alwaysShowCPM===!0&&(t.typingSpeedUnit="cpm"),t.showAverage==="wpm"&&(t.showAverage="speed"),typeof t.playSoundOnError=="boolean"&&(t.playSoundOnError=t.playSoundOnError?"1":"off"),t}function Rb(){const e={};return Object.keys(i).filter(t=>i[t]!==Kt[t]).forEach(t=>{e[t]=i[t]}),e}const ng=new Promise(e=>{nm=e});class Ob{constructor(){this.list=[],this.sectionIndexList=[],this.length=0,this.currentIndex=0}get(t,a=!1){var o,n;return t===void 0?this.list:a?(n=(o=this.list[t])==null?void 0:o.replace(/[.?!":\-,]/g,""))==null?void 0:n.toLowerCase():this.list[t]}getCurrent(){return this.list[this.currentIndex]??""}getLast(){return this.list[this.list.length-1]}push(t,a){this.list.push(t),this.sectionIndexList.push(a),this.length=this.list.length}reset(){this.list=[],this.sectionIndexList=[],this.currentIndex=0,this.length=this.list.length}resetCurrentIndex(){this.currentIndex=0}decreaseCurrentIndex(){this.currentIndex--}increaseCurrentIndex(){this.currentIndex++}clean(){for(const t of this.list)if(/ +/.test(t)){const a=this.list.indexOf(t),o=t.split(" ");this.list.splice(a,1);for(let n=0;n<o.length;n++)this.list.splice(a+n,0,o[n])}}}const A=new Ob;let zn=!1,Lr=!1,_d=!1,se=null;function Hb(e){se=e}function _b(e){zn=e}function Nb(e){Lr=e}function Kb(e){_d=e}async function Zo(){try{oe();const e=await Cd(()=>import("./commandline.CRBlGJBp.js"),__vite__mapDeps([0,1,2,3,4]));return Q(),e}catch(e){if(Q(),e instanceof Error&&e.message.includes("Failed to fetch dynamically imported module"))m("Failed to load commandline module: could not fetch",-1);else{const t=ee(e,"Failed to load commandline module");m(t,-1)}throw e}}document.addEventListener("keydown",async e=>{if(!Rn()&&e.key!==void 0&&(e.key==="Escape"&&i.quickRestart!=="esc"||e.key==="Tab"&&i.quickRestart==="esc"&&!zn&&!e.shiftKey||e.key==="Tab"&&i.quickRestart==="esc"&&zn&&e.shiftKey||e.key.toLowerCase()==="p"&&(e.metaKey||e.ctrlKey)&&e.shiftKey)){e.preventDefault();const t=pl(),a=no(".pageAccount .miniResultChartWrapper");!t&&!a&&(await Zo()).show()}});const Gi=125,Yi=.75;class le{constructor(t){var n,r;this.open=!1,this.setupRan=!1,t.dialogId.startsWith("#")&&(t.dialogId=t.dialogId.slice(1)),this.skeletonAppendParent=t.appendTo??"popups",nb(t.dialogId)&&at(t.dialogId,this.skeletonAppendParent);const a=document.getElementById(t.dialogId),o=document.querySelector(`#${t.dialogId} > .modal`);if(a===null)throw new Error(`Dialog element with id ${t.dialogId} not found`);if(!(a instanceof HTMLDialogElement))throw new Error("Animated dialog must be an HTMLDialogElement");if(a===null)throw new Error(`Dialog element with id ${t.dialogId} not found`);if(o===null)throw new Error(`Div element inside #${t.dialogId} with class 'modal' not found`);this.dialogId=t.dialogId,this.wrapperEl=a,this.modalEl=o,this.customShowAnimations=(n=t.customAnimations)==null?void 0:n.show,this.customHideAnimations=(r=t.customAnimations)==null?void 0:r.hide,this.previousModalInChain=void 0,this.showOptionsWhenInChain=t.showOptionsWhenInChain,this.customEscapeHandler=t==null?void 0:t.customEscapeHandler,this.customWrapperClickHandler=t==null?void 0:t.customWrapperClickHandler,this.setup=t==null?void 0:t.setup,st(this.dialogId)}getPreviousModalInChain(){return this.previousModalInChain}async runSetup(){this.wrapperEl.addEventListener("keydown",t=>{t.key==="Escape"&&Le(this.dialogId)&&(this.customEscapeHandler!==void 0?this.customEscapeHandler(t):this.hide())}),this.wrapperEl.addEventListener("mousedown",t=>{t.target===this.wrapperEl&&(this.customWrapperClickHandler!==void 0?this.customWrapperClickHandler(t):this.hide())}),this.setup!==void 0&&await this.setup(this.modalEl)}getDialogId(){return this.dialogId}getWrapper(){return this.wrapperEl}getModal(){return this.modalEl}isOpen(){return this.open}focusFirstInput(t){const o=[...this.modalEl.querySelectorAll("input")].filter(n=>!n.classList.contains("hidden"))[0];o!=null?t===!0?o.focus():t==="focusAndSelect"?(o.focus(),o.select()):this.wrapperEl.focus():this.wrapperEl.focus()}async show(t){return new Promise(async a=>{var d,u,f,p,g,h,y,w,k,L,x,B,D;if(this.open||(at(this.dialogId,this.skeletonAppendParent),this.setupRan||(await this.runSetup(),this.setupRan=!0),Le(this.dialogId)))return a();const o=(((u=(d=t==null?void 0:t.customAnimation)==null?void 0:d.modal)==null?void 0:u.durationMs)??(t==null?void 0:t.animationDurationMs)??((p=(f=this.customShowAnimations)==null?void 0:f.modal)==null?void 0:p.durationMs)??Gi)*((t==null?void 0:t.modalChain)!==void 0?Yi:1);(t==null?void 0:t.modalChain)!==void 0&&(this.previousModalInChain=t.modalChain,await this.previousModalInChain.hide({animationMode:"modalOnly",animationDurationMs:o})),this.open=!0,(t==null?void 0:t.mode)==="dialog"?this.wrapperEl.show():((t==null?void 0:t.mode)==="modal"||(t==null?void 0:t.mode)===void 0)&&this.wrapperEl.showModal(),await((g=t==null?void 0:t.beforeAnimation)==null?void 0:g.call(t,this.modalEl)),setTimeout(async()=>{this.focusFirstInput(t==null?void 0:t.focusFirstInput)},1);const n=((h=t==null?void 0:t.customAnimation)==null?void 0:h.modal)??((y=this.customShowAnimations)==null?void 0:y.modal),r=((w=t==null?void 0:t.customAnimation)==null?void 0:w.wrapper)??((k=this.customShowAnimations)==null?void 0:k.wrapper)??{from:{opacity:"0"},to:{opacity:"1"},easing:"swing"},l=((x=(L=t==null?void 0:t.customAnimation)==null?void 0:L.wrapper)==null?void 0:x.durationMs)??((D=(B=this.customShowAnimations)==null?void 0:B.wrapper)==null?void 0:D.durationMs)??Gi,c=this.previousModalInChain!==void 0?"modalOnly":(t==null?void 0:t.animationMode)??"both";s(this.modalEl).stop(!0,!1),s(this.wrapperEl).stop(!0,!1),c==="both"||c==="none"?(n!=null&&n.from?(s(this.modalEl).css(n.from),s(this.modalEl).animate(n.to,c==="none"?0:o,n.easing??"swing")):s(this.modalEl).css("opacity","1"),s(this.wrapperEl).css(r.from),s(this.wrapperEl).removeClass("hidden").css("opacity","0").animate(r.to??{opacity:1},c==="none"?0:l,r.easing??"swing",async()=>{var v;this.focusFirstInput(t==null?void 0:t.focusFirstInput),await((v=t==null?void 0:t.afterAnimation)==null?void 0:v.call(t,this.modalEl)),a()})):c==="modalOnly"&&(s(this.wrapperEl).removeClass("hidden").css("opacity","1"),n!=null&&n.from?s(this.modalEl).css(n.from):s(this.modalEl).css("opacity","0"),s(this.modalEl).animate((n==null?void 0:n.to)??{opacity:1},o,(n==null?void 0:n.easing)??"swing",async()=>{var v;this.focusFirstInput(t==null?void 0:t.focusFirstInput),await((v=t==null?void 0:t.afterAnimation)==null?void 0:v.call(t,this.modalEl)),a()}))})}async hide(t){return new Promise(async a=>{var d,u,f,p,g,h,y,w,k,L,x,B,D;if(!Le(this.dialogId))return a();t!=null&&t.clearModalChain&&(this.previousModalInChain=void 0),await((d=t==null?void 0:t.beforeAnimation)==null?void 0:d.call(t,this.modalEl));const o=((u=t==null?void 0:t.customAnimation)==null?void 0:u.modal)??((f=this.customHideAnimations)==null?void 0:f.modal),n=(((g=(p=t==null?void 0:t.customAnimation)==null?void 0:p.modal)==null?void 0:g.durationMs)??(t==null?void 0:t.animationDurationMs)??((y=(h=this.customHideAnimations)==null?void 0:h.modal)==null?void 0:y.durationMs)??Gi)*(this.previousModalInChain!==void 0?Yi:1),r=((w=t==null?void 0:t.customAnimation)==null?void 0:w.wrapper)??((k=this.customHideAnimations)==null?void 0:k.wrapper)??{from:{opacity:"1"},to:{opacity:"0"},easing:"swing"},l=((x=(L=t==null?void 0:t.customAnimation)==null?void 0:L.wrapper)==null?void 0:x.durationMs)??((D=(B=this.customHideAnimations)==null?void 0:B.wrapper)==null?void 0:D.durationMs)??Gi,c=this.previousModalInChain!==void 0?"modalOnly":(t==null?void 0:t.animationMode)??"both";s(this.modalEl).stop(!0,!1),s(this.wrapperEl).stop(!0,!1),c==="both"||c==="none"?(o!=null&&o.from?(s(this.modalEl).css(o.from),s(this.modalEl).animate(o.to,c==="none"?0:n,o.easing??"swing")):s(this.modalEl).css("opacity","1"),s(this.wrapperEl).css(r.from),s(this.wrapperEl).css("opacity","1").animate((r==null?void 0:r.to)??{opacity:0},c==="none"?0:l,(r==null?void 0:r.easing)??"swing",async()=>{var v;this.wrapperEl.close(),this.wrapperEl.classList.add("hidden"),Ve(this.dialogId),this.open=!1,await((v=t==null?void 0:t.afterAnimation)==null?void 0:v.call(t,this.modalEl)),this.previousModalInChain!==void 0&&(await this.previousModalInChain.show({animationMode:"modalOnly",animationDurationMs:n*Yi,...this.previousModalInChain.showOptionsWhenInChain}),this.previousModalInChain=void 0),a()})):c==="modalOnly"&&(s(this.wrapperEl).removeClass("hidden").css("opacity","1"),o!=null&&o.from?s(this.modalEl).css(o.from):s(this.modalEl).css("opacity","1"),s(this.modalEl).animate((o==null?void 0:o.to)??{opacity:0},n,(o==null?void 0:o.easing)??"swing",async()=>{var v;this.wrapperEl.close(),s(this.wrapperEl).addClass("hidden").css("opacity","0"),Ve(this.dialogId),this.open=!1,await((v=t==null?void 0:t.afterAnimation)==null?void 0:v.call(t,this.modalEl)),this.previousModalInChain!==void 0&&(await this.previousModalInChain.show({animationMode:"modalOnly",animationDurationMs:n*Yi,...this.previousModalInChain.showOptionsWhenInChain}),this.previousModalInChain=void 0),a()}))})}destroy(){this.wrapperEl.close(),this.wrapperEl.classList.add("hidden"),Ve(this.dialogId),this.open=!1}}function ig(){rg.show()}const rg=new le({dialogId:"supportModal",setup:async e=>{var t;(t=e.querySelector("button.ads"))==null||t.addEventListener("click",async()=>{(await Zo()).show({subgroupOverride:"enableAds"},{modalChain:rg})})}});function lg(){zb.show()}const zb=new le({dialogId:"contactModal"});function Ub(){Vb.show({beforeAnimation:async()=>{s("#versionHistoryModal .modal").html(`
    <div class="preloader">
      <i class="fas fa-fw fa-spin fa-circle-notch"></i>
    </div
  `),Sv().then(e=>{s("#versionHistoryModal .modal").html('<div class="releases"></div'),e.forEach(t=>{if(!t.draft&&!t.prerelease){let a=t.body;a=a.replace(/\r\n/g,"<br>"),a=a.replace(/### (.*?)<br>/g,"<h3>$1</h3>"),a=a.replace(/<\/h3><br>/gi,"</h3>"),a=a.replace(/^- /gm,""),a=a.replace(/\*\*(.*?)\*\*/g,"<b>$1</b>"),a=a.replace(/\[(.*?)\]\((.*?)\)/g,'<a href="$2" target="_blank">$1</a>'),s("#versionHistoryModal .modal .releases").append(`
        <div class="release">
          <div class="title">${t.name}</div>
          <div class="date">${_e(new Date(t.published_at),"dd MMM yyyy")}</div>
          <div class="body">${a}</div>
        </div>
      `)}})}).catch(e=>{s("#versionHistoryModal .modal").html(`<div class="releases">Failed to fetch version history:<br>${e.message}</div`)}),s("#newVersionIndicator").addClass("hidden")}})}const Vb=new le({dialogId:"versionHistoryModal"});var np;(np=document.querySelector("footer #commandLineMobileButton"))==null||np.addEventListener("click",async()=>{(await Zo()).show({singleListOverride:!1})});var ip;(ip=document.querySelector("footer #newVersionIndicator"))==null||ip.addEventListener("click",e=>{var t;e.stopPropagation(),(t=document.querySelector("#newVersionIndicator"))==null||t.classList.add("hidden")});var rp;(rp=document.querySelector("footer .currentVersion"))==null||rp.addEventListener("click",e=>{e.shiftKey?alert(mi.clientVersion):Ub()});var lp;(lp=document.querySelector("footer .right .current-theme"))==null||lp.addEventListener("click",async e=>{var a,o;if(e.shiftKey){if(i.customTheme){es(!1);return}if(z()&&(((o=(a=S())==null?void 0:a.customThemes)==null?void 0:o.length)??0)<1){m("No custom themes!",0),es(!1);return}es(!0)}else{const n=i.customTheme?"customThemesList":"themes";(await Zo()).show({subgroupOverride:n})}});var cp;(cp=document.querySelector("footer #supportMeButton"))==null||cp.addEventListener("click",()=>{ig()});var dp;(dp=document.querySelector("footer #contactPopupButton"))==null||dp.addEventListener("click",()=>{lg()});s("#keymap").on("click",".r5 .keySpace",async()=>{(await Zo()).show({subgroupOverride:"keymapLayouts"})});let Nd=!1;function ie(){Nd=!0}function Un(){Nd=!1}function jb(){return Nd}const cg=["NumpadMultiply","NumpadSubtract","NumpadAdd","NumpadDecimal","NumpadEqual","NumpadDivide","Numpad0","Numpad1","Numpad2","Numpad3","Numpad4","Numpad5","Numpad6","Numpad7","Numpad8","Numpad9","Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal","KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight","Backslash","KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote","IntlBackslash","KeyZ","KeyX","KeyC","KeyV","KeyB","KeyN","KeyM","Comma","Period","Slash","Space","Enter","Tab","NoCode"];class Qb{constructor(){this.current="",this.history=[],this.historyLength=0,this.length=0,this.koreanStatus=!1}reset(){this.current="",this.history=[],this.length=0}resetHistory(){this.history=[],this.length=0}setCurrent(t){this.current=t,this.length=this.current.length}setKoreanStatus(t){this.koreanStatus=t}appendCurrent(t){this.current+=t,this.length=this.current.length}resetCurrent(){this.current=""}getCurrent(){return this.current}getKoreanStatus(){return this.koreanStatus}pushHistory(){this.history.push(this.current),this.historyLength=this.history.length,this.resetCurrent()}popHistory(){const t=this.history.pop()??"";return this.historyLength=this.history.length,t}getHistory(t){return t===void 0?this.history:this.history[t]}getHistoryLast(){return this.history[this.history.length-1]}}class Gb{constructor(){this.current="",this.history=[]}setCurrent(t){this.current=t}appendCurrent(t){this.current+=t}resetCurrent(){this.current=""}resetHistory(){this.history=[]}reset(){this.resetCurrent(),this.resetHistory()}getHistory(t){return this.history[t]}popHistory(){return this.history.pop()??""}pushHistory(){this.history.push(this.current),this.current=""}}let Aa={};const T=new Qb,Ne=new Gb;let Us=[],Wr=0,Cl=0,ts={},Ht={correct:0,incorrect:0},ue={spacing:{first:-1,last:-1,array:[]},duration:{array:[]}},va={total:0,lastStartTime:-1},Ma=[],kl=[],Mt=[],wi=[],Vn={count:0,words:[]},bi=[],Ir=!0;function Pc(){Wr++}function dg(){Ir=!1}function ug(){Vn.count++}function qc(e){Vn.words.push(e)}function Yb(e){Cl=e}function Sl(){Us.push(Wr),Wr=0}function Tl(){bi.push(Ir),Ir=!0}function xl(){wi.push(Vn),Vn={count:0,words:[]}}function fg(e){e?Ht.correct++:Ht.incorrect++}function Jb(e){var r,l;const t=U(mr(ue.duration.array)),a=Object.entries(Aa);a.sort((c,d)=>c[1].timestamp-d[1].timestamp);for(const c of a)pg(e,c[0]);const o=(r=a[a.length-1])==null?void 0:r[0],n=(l=Aa[o])==null?void 0:l.index;o!==void 0&&n!==void 0&&(ue.duration.array[n]=t)}let jn=0;function pg(e,t){if(!cg.includes(t))return;t==="NoCode"&&(jn--,t="NoCode"+jn);const a=Aa[t];if(a===void 0)return;const o=Math.abs(a.timestamp-e);ue.duration.array[a.index]=o,console.debug("Keyup recorded",t,o),delete Aa[t],mg(e)}function Zb(e,t){var a;if(!cg.includes(t)){console.debug("Key not tracked",t);return}if(t==="NoCode"&&(t="NoCode"+jn,jn++),Aa[t]!==void 0){console.debug("Key already down",t);return}if(Aa[t]={timestamp:e,index:ue.duration.array.length},ue.duration.array.push(0),mg((a=Aa[t])==null?void 0:a.timestamp),ue.spacing.last!==-1){const o=Math.abs(e-ue.spacing.last);ue.spacing.array.push(U(o)),console.debug("Keydown recorded",t,o)}ue.spacing.last=e,ue.spacing.first===-1&&(ue.spacing.first=e,console.debug("First keydown recorded",t,e))}function mg(e){Object.keys(Aa).length>1?va.lastStartTime===-1&&(va.lastStartTime=e):va.lastStartTime!==-1&&(va.total+=e-va.lastStartTime,va.lastStartTime=-1)}function Xb(){ue={spacing:{first:-1,last:-1,array:[]},duration:{array:[]}},va={total:0,lastStartTime:-1},Aa={},jn=0,console.debug("Keypress timings reset")}function gg(e){Object.keys(ts).includes(e)?ts[e]++:ts[e]=1}function hg(e){Ma.push(e)}function yg(e){kl.push(e)}function vg(e){Mt[A.currentIndex]===void 0?Mt.push(e):Mt[A.currentIndex]=e}function e0(){Ma=[],kl=[],Mt=[],Us=[],Wr=0,bi=[],Ir=!0,wi=[],Vn={count:0,words:[]},Cl=0,ts={},Ht={correct:0,incorrect:0},ue={spacing:{first:-1,last:-1,array:[]},duration:{array:[]}}}let Be=["The","quick","brown","fox","jumps","over","the","lazy","dog"],fe=!1,pe=!1,He=!1,Re=-1,Wt=-1,is=-1,It=" ",ro=Be.join(" "),Kd=ro;function wg(){ro=Kd}function bt(e,t=!1){ro=e,t&&(Kd=e)}function qa(e){Be=e}function t0(){return Be.join(" ")}function a0(){return Be}function Vs(e){fe=e}function js(e){pe=e}function Er(e){He=e}function Qs(e){Wt=e}function Gs(e){Re=e}function bg(e){is=e}function Qn(e){It=e}function Gn(e,t=!1){if(t){const o=Xo()[e];if(o===void 0)throw new Error(`Custom text ${e} not found`);return o.text.split(/ +/)}else{const a=Al()[e];if(a===void 0)throw new Error(`Custom text ${e} not found`);return a.split(/ +/)}}function Cg(e,t,a=!1){if(a){const o=Xo();o[e]={text:"",progress:0};const n=o[e];if(n===void 0)throw new Error("Custom text not found");typeof t=="string"?n.text=t:n.text=t.join(" "),Ud(o)}else{const o=Al();typeof t=="string"?o[e]=t:o[e]=t.join(" "),kg(o)}}function zd(e,t){const a=t?Xo():Al();delete a[e],t?Ud(a):kg(a)}function $l(e){const t=Xo()[e];if(t===void 0)throw new Error("Custom text not found");return t.progress??0}function Br(e,t){const a=Xo(),o=a[e];if(o===void 0)throw new Error("Custom text not found");o.progress=t,Ud(a)}function Al(){return JSON.parse(window.localStorage.getItem("customText")??"{}")}function Xo(){return JSON.parse(window.localStorage.getItem("customTextLong")??"{}")}function kg(e){window.localStorage.setItem("customText",JSON.stringify(e))}function Ud(e){window.localStorage.setItem("customTextLong",JSON.stringify(e))}function Pr(e=!1){return Object.keys(e?Xo():Al())}const Vd=Object.freeze(Object.defineProperty({__proto__:null,deleteCustomText:zd,get delimiter(){return It},getCustomText:Gn,getCustomTextLongProgress:$l,getCustomTextNames:Pr,getText:t0,getTextArray:a0,get isSectionRandom(){return He},get isTimeRandom(){return pe},get isWordRandom(){return fe},get popupTextareaState(){return ro},get savedPopupTextareaState(){return Kd},get section(){return is},setCustomText:Cg,setCustomTextLongProgress:Br,setDelimiter:Qn,setIsSectionRandom:Er,setIsTimeRandom:js,setIsWordRandom:Vs,setPopupTextareaState:bt,setPopupTextareaStateToSaved:wg,setSection:bg,setText:qa,setTime:Qs,setWord:Gs,get text(){return Be},get time(){return Wt},get word(){return Re}},Symbol.toStringTag,{value:"Module"}));let qr=!0;const La=document.querySelector("#caret");function Sg(){qr&&(La.style.animationName="none",La.style.opacity="1",qr=!1)}function Tg(){qr||(i.smoothCaret!=="off"&&!Ce()?La.style.animationName="caretFlashSmooth":La.style.animationName="caretFlashHard",qr=!0)}function Ci(){La.classList.add("hidden")}function s0(e,t,a,o){let n=0;if(t){const r=e?0:(a==null?void 0:a.offsetWidth)??(o==null?void 0:o.offsetWidth)??0;a!==void 0?n=a.offsetLeft+r:o!==void 0&&(n=o.offsetLeft-o.offsetWidth+r)}else a!==void 0?n=a.offsetLeft:o!==void 0&&(n=o.offsetLeft+o.offsetWidth);return n}async function da(e=!1){var G,ze;const t=Math.round(((G=document.querySelector("#caret"))==null?void 0:G.getBoundingClientRect().width)??0),a=["block","outline","underline"].includes(i.caretStyle),o=T.current.length,n=o,r=document==null?void 0:document.querySelector("#words .active"),l=(r==null?void 0:r.children.length)===0;l&&r.insertAdjacentHTML("beforeend",'<letter style="opacity: 0;">_</letter>');const c=(ze=document==null?void 0:document.querySelector("#words .active"))==null?void 0:ze.querySelectorAll("letter");if(!c)return;const d=c[n],u=c[Math.min(n-1,c.length-1)],p=(await Ea(i.language)).rightToLeft,g=s0(a,p,d,u),h=d?d.offsetTop:u.offsetTop,w=((d==null?void 0:d.offsetHeight)??(u==null?void 0:u.offsetHeight)??i.fontSize*ss(1))-La.offsetHeight;let k=r.offsetTop+h+w/2;i.caretStyle==="underline"&&(k=r.offsetTop+h-La.offsetHeight/2);let L=r.offsetLeft+g-(a?0:t/2);const x=s(document.querySelector("#wordsWrapper")).width()??0;if(i.tapeMode==="letter")L=x/2-(a?0:t/2);else if(i.tapeMode==="word")if(o===0)L=x/2-(a?0:t/2);else{let Fe=0;for(let Ie=0;Ie<o;Ie++)Fe+=s(c[Ie]).outerWidth(!0);L=x/2+Fe-(a?0:t/2)}const B=a?((d?d.offsetWidth:u.offsetWidth)??0)+"px":"";let D=s("#words .smoothScroller").height();D===void 0&&(D=0);const v=s(La);v.css("display","block");const C={top:k-D,left:L};B!==""?C.width=B:v.css("width","");const q=i.smoothCaret=="off"?0:i.smoothCaret=="slow"?150:i.smoothCaret=="medium"?100:i.smoothCaret=="fast"?85:0;if(v.stop(!0,!1).animate(C,Ce()||e?0:q),i.showAllLines){const Fe=window.innerHeight,Ie=Fe/2-v.outerHeight()/2,ot=document.body.scrollHeight;if(k>=Ie&&ot>Fe&&Ae){const Jt=k-Ie/2;window.scrollTo({left:0,top:Jt,behavior:"smooth"})}}l&&(r==null||r.replaceChildren())}function xg(e=!1){La.classList.remove("hidden"),da(e),Tg()}const Lo=document.querySelector("#capsWarning"),o0=navigator.platform.startsWith("Mac");let ba=!1,Fr=!1;function n0(){Fr||(Lo==null||Lo.classList.remove("hidden"),Fr=!0)}function i0(){Fr&&(Lo==null||Lo.classList.add("hidden"),Fr=!1)}function $g(e){var t,a,o;((t=e==null?void 0:e.originalEvent)==null?void 0:t.key)==="CapsLock"&&ba!==null?ba=!ba:ba=((o=(a=e==null?void 0:e.originalEvent)==null?void 0:a.getModifierState)==null?void 0:o.call(a,"CapsLock"))??!1;try{i.capsLockWarning&&ba?n0():i0()}catch{}}s(document).on("keyup",$g);s(document).on("keydown",e=>{o0&&$g(e)});let rs=!1,ls=!1;const uf=[["Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal"],["KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight","Backslash"],["KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote"],["KeyZ","KeyX","KeyC","KeyV","KeyB","KeyN","KeyM","Comma","Period","Slash"],["Space"]],r0=/^[^\p{L}\p{N}]{1}$/u,l0=/Mac|iPod|iPhone|iPad/.test(navigator.platform);let ff=[!1,!1];function c0(){const e=rs||ls,t=l0?e||ba:e!==ba,[a,o]=ff;if(!(a===t&&o===e))return ff=[t,e]}async function Ag(){const e=c0();if(e===void 0)return;const t=[...document.getElementsByClassName("keymapKey")].filter(d=>{const u=d.classList.contains("keymapKey"),f=!d.classList.contains("keySpace")&&!d.classList.contains("keySplitSpace");return u&&f}),a=t.map(d=>d.dataset.key);if(a.includes(void 0))return;const o=t.map(d=>d.childNodes[1]),[n,r]=e,l=i.keymapLayout==="overrideSync"?i.layout==="default"?"qwerty":i.layout:i.keymapLayout,c=await fi(l).catch(()=>{});if(c===void 0){m("Failed to load keymap layout",-1);return}for(let d=0;d<a.length;d++){const u=a[d],f=o[d],p=u[0],g=u[1];if(f===void 0||u===void 0||p===void 0||g===void 0)continue;const h=[p,g].some(D=>r0.test(D??"")),y=Mg(p,c);if(y===void 0)return;const L=Fc(y)&&(h?r:n),x=Number(L),B=u[x];f.textContent=B??""}}s(document).on("keydown",e=>{e.code==="ShiftLeft"?(rs=!0,ls=!1):e.code==="ShiftRight"&&(rs=!1,ls=!0),i.keymapLegendStyle==="dynamic"&&Ag()});s(document).on("keyup",e=>{(e.code==="ShiftLeft"||e.code==="ShiftRight")&&(rs=!1,ls=!1),i.keymapLegendStyle==="dynamic"&&Ag()});function d0(){rs=!1,ls=!1}const u0=["KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyA","KeyS","KeyD","KeyF","KeyG","IntlBackslash","KeyZ","KeyX","KeyC","KeyV","KeyB","Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6"],f0=["KeyY","KeyU","KeyI","KeyO","KeyP","KeyH","KeyJ","KeyK","KeyL","KeyB","KeyN","KeyM","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal","Backslash","BracketLeft","BracketRight","Semicolon","Quote","Comma","Period","Slash"];function Fc(e){if(!rs&&!ls||i.oppositeShiftMode==="off")return!0;const t=f0.includes(e),a=u0.includes(e);return!!(!t&&!a||rs&&t||ls&&a)}function Mg(e,t){var c,d;const a=Object.values(t.keys),o=a.findIndex(u=>u.find(f=>f.includes(e))),n=a[o];if(n===void 0)return;const r=n.findIndex(u=>u.includes(e));if(r===-1)return;let l=(c=uf[o])==null?void 0:c[r];return t.type==="iso"&&(o===2&&r===11?l="Backslash":o===3&&r===0?l="IntlBackslash":o===3&&(l=(d=uf[3])==null?void 0:d[r-1])),l}async function Lg(){return await Cd(()=>import("./howler.BYgBeqzQ.js").then(e=>e.h),__vite__mapDeps([5,1]))}let Dr=null,Ys=null;async function p0(){const e=(await Lg()).Howl;Dr===null&&(Dr={1:[{sounds:[new e({src:"../sound/error1/error1_1.wav"}),new e({src:"../sound/error1/error1_1.wav"})],counter:0}],2:[{sounds:[new e({src:"../sound/error2/error2_1.wav"}),new e({src:"../sound/error2/error2_1.wav"})],counter:0}],3:[{sounds:[new e({src:"../sound/error3/error3_1.wav"}),new e({src:"../sound/error3/error3_1.wav"})],counter:0}],4:[{sounds:[new e({src:"../sound/error4/error4_1.wav"}),new e({src:"../sound/error4/error4_1.wav"})],counter:0},{sounds:[new e({src:"../sound/error4/error4_2.wav"}),new e({src:"../sound/error4/error4_2.wav"})],counter:0}]},Howler.volume(parseFloat(i.soundVolume)))}async function Ml(){const e=(await Lg()).Howl;Ys===null&&(Ys={1:[{sounds:[new e({src:"../sound/click1/click1_1.wav"}),new e({src:"../sound/click1/click1_1.wav"})],counter:0},{sounds:[new e({src:"../sound/click1/click1_2.wav"}),new e({src:"../sound/click1/click1_2.wav"})],counter:0},{sounds:[new e({src:"../sound/click1/click1_3.wav"}),new e({src:"../sound/click1/click1_3.wav"})],counter:0}],2:[{sounds:[new e({src:"../sound/click2/click2_1.wav"}),new e({src:"../sound/click2/click2_1.wav"})],counter:0},{sounds:[new e({src:"../sound/click2/click2_2.wav"}),new e({src:"../sound/click2/click2_2.wav"})],counter:0},{sounds:[new e({src:"../sound/click2/click2_3.wav"}),new e({src:"../sound/click2/click2_3.wav"})],counter:0}],3:[{sounds:[new e({src:"../sound/click3/click3_1.wav"}),new e({src:"../sound/click3/click3_1.wav"})],counter:0},{sounds:[new e({src:"../sound/click3/click3_2.wav"}),new e({src:"../sound/click3/click3_2.wav"})],counter:0},{sounds:[new e({src:"../sound/click3/click3_3.wav"}),new e({src:"../sound/click3/click3_3.wav"})],counter:0}],4:[{sounds:[new e({src:"../sound/click4/click4_1.wav"}),new e({src:"../sound/click4/click4_11.wav"})],counter:0},{sounds:[new e({src:"../sound/click4/click4_2.wav"}),new e({src:"../sound/click4/click4_22.wav"})],counter:0},{sounds:[new e({src:"../sound/click4/click4_3.wav"}),new e({src:"../sound/click4/click4_33.wav"})],counter:0},{sounds:[new e({src:"../sound/click4/click4_4.wav"}),new e({src:"../sound/click4/click4_44.wav"})],counter:0},{sounds:[new e({src:"../sound/click4/click4_5.wav"}),new e({src:"../sound/click4/click4_55.wav"})],counter:0},{sounds:[new e({src:"../sound/click4/click4_6.wav"}),new e({src:"../sound/click4/click4_66.wav"})],counter:0}],5:[{sounds:[new e({src:"../sound/click5/click5_1.wav"}),new e({src:"../sound/click5/click5_11.wav"})],counter:0},{sounds:[new e({src:"../sound/click5/click5_2.wav"}),new e({src:"../sound/click5/click5_22.wav"})],counter:0},{sounds:[new e({src:"../sound/click5/click5_3.wav"}),new e({src:"../sound/click5/click5_33.wav"})],counter:0},{sounds:[new e({src:"../sound/click5/click5_4.wav"}),new e({src:"../sound/click5/click5_44.wav"})],counter:0},{sounds:[new e({src:"../sound/click5/click5_5.wav"}),new e({src:"../sound/click5/click5_55.wav"})],counter:0},{sounds:[new e({src:"../sound/click5/click5_6.wav"}),new e({src:"../sound/click5/click5_66.wav"})],counter:0}],6:[{sounds:[new e({src:"../sound/click6/click6_1.wav"}),new e({src:"../sound/click6/click6_11.wav"})],counter:0},{sounds:[new e({src:"../sound/click6/click6_2.wav"}),new e({src:"../sound/click6/click6_22.wav"})],counter:0},{sounds:[new e({src:"../sound/click6/click6_3.wav"}),new e({src:"../sound/click6/click6_33.wav"})],counter:0}],7:[{sounds:[new e({src:"../sound/click7/click7_1.wav"}),new e({src:"../sound/click7/click7_11.wav"})],counter:0},{sounds:[new e({src:"../sound/click7/click7_2.wav"}),new e({src:"../sound/click7/click7_22.wav"})],counter:0},{sounds:[new e({src:"../sound/click7/click7_3.wav"}),new e({src:"../sound/click7/click7_33.wav"})],counter:0}],14:[{sounds:[new e({src:"../sound/click14/click14_1.wav"}),new e({src:"../sound/click14/click14_1.wav"})],counter:0},{sounds:[new e({src:"../sound/click14/click14_2.wav"}),new e({src:"../sound/click14/click14_2.wav"})],counter:0},{sounds:[new e({src:"../sound/click14/click14_3.wav"}),new e({src:"../sound/click14/click14_3.wav"})],counter:0},{sounds:[new e({src:"../sound/click14/click14_4.wav"}),new e({src:"../sound/click14/click14_4.wav"})],counter:0},{sounds:[new e({src:"../sound/click14/click14_5.wav"}),new e({src:"../sound/click14/click14_5.wav"})],counter:0},{sounds:[new e({src:"../sound/click14/click14_6.wav"}),new e({src:"../sound/click14/click14_6.wav"})],counter:0},{sounds:[new e({src:"../sound/click14/click14_7.wav"}),new e({src:"../sound/click14/click14_7.wav"})],counter:0},{sounds:[new e({src:"../sound/click14/click14_8.wav"}),new e({src:"../sound/click14/click14_8.wav"})],counter:0}],15:[{sounds:[new e({src:"../sound/click15/click15_1.wav"}),new e({src:"../sound/click15/click15_1.wav"})],counter:0},{sounds:[new e({src:"../sound/click15/click15_2.wav"}),new e({src:"../sound/click15/click15_2.wav"})],counter:0},{sounds:[new e({src:"../sound/click15/click15_3.wav"}),new e({src:"../sound/click15/click15_3.wav"})],counter:0},{sounds:[new e({src:"../sound/click15/click15_4.wav"}),new e({src:"../sound/click15/click15_4.wav"})],counter:0},{sounds:[new e({src:"../sound/click15/click15_5.wav"}),new e({src:"../sound/click15/click15_5.wav"})],counter:0}]},Howler.volume(parseFloat(i.soundVolume)))}async function rA(e){Ys===null&&await Ml();const t=Ys;Object.keys(t).includes(e)&&(t[e][0].sounds[0].seek(0),t[e][0].sounds[0].play())}let wn="KeyA";s(document).on("keydown",e=>{wn=e.code||"KeyA"});const J={C:[16.35,32.7,65.41,130.81,261.63,523.25,1046.5,2093,4186.01],Db:[17.32,34.65,69.3,138.59,277.18,554.37,1108.73,2217.46,4434.92],D:[18.35,36.71,73.42,146.83,293.66,587.33,1174.66,2349.32,4698.64],Eb:[19.45,38.89,77.78,155.56,311.13,622.25,1244.51,2489.02,4978.03],E:[20.6,41.2,82.41,164.81,329.63,659.26,1318.51,2637.02],F:[21.83,43.65,87.31,174.61,349.23,698.46,1396.91,2793.83],Gb:[23.12,46.25,92.5,185,369.99,739.99,1479.98,2959.96],G:[24.5,49,98,196,392,783.99,1567.98,3135.96],Ab:[25.96,51.91,103.83,207.65,415.3,830.61,1661.22,3322.44],A:[27.5,55,110,220,440,880,1760,3520],Bb:[29.14,58.27,116.54,233.08,466.16,932.33,1864.66,3729.31],B:[30.87,61.74,123.47,246.94,493.88,987.77,1975.53,3951.07]};function X(e,t=0){return a=>e[a+t]??0}const Ji={KeyZ:X(J.C),KeyS:X(J.Db),KeyX:X(J.D),KeyD:X(J.Eb),KeyC:X(J.E),KeyV:X(J.F),KeyG:X(J.Gb),KeyB:X(J.G),KeyH:X(J.Ab),KeyN:X(J.A),KeyJ:X(J.Bb),KeyM:X(J.B),Comma:X(J.C,1),KeyL:X(J.Db,1),Period:X(J.D,1),Semicolon:X(J.Eb,1),Slash:X(J.E,1),KeyQ:X(J.C,1),Digit2:X(J.Db,1),KeyW:X(J.D,1),Digit3:X(J.Eb,1),KeyE:X(J.E,1),KeyR:X(J.F,1),Digit5:X(J.Gb,1),KeyT:X(J.G,1),Digit6:X(J.Ab,1),KeyY:X(J.A,1),Digit7:X(J.Bb,1),KeyU:X(J.B,1),KeyI:X(J.C,2),Digit9:X(J.Db,2),KeyO:X(J.D,2),Digit0:X(J.Eb,2),KeyP:X(J.E,2),BracketLeft:X(J.F,2),Equal:X(J.Gb,2),BracketRight:X(J.G,2)},Wg={8:"sine",9:"sawtooth",10:"square",11:"triangle"};let Ke;function Ig(){if(Ke!==null)try{Ke=new AudioContext}catch(e){Ke=null,console.error(e),m(ee(e,"Error initializing audio context")+". Notes will not play.",-1)}}const pf={pentatonic:["C","D","E","G","A"],wholetone:["C","D","E","Gb","Ab","Bb"]};function mf(e){const t={position:0,octave:4,direction:1};return async()=>{Ys===null&&await Ml(),Eg(e,t)}}const gf={position:0,octave:4,direction:1},hf={12:{name:"pentatonic",preview:mf("pentatonic"),meta:gf},13:{name:"wholetone",preview:mf("wholetone"),meta:gf}};function Eg(e,t){if(Ke===void 0&&Ig(),!Ke)return;const a=Ns(0,pf[e].length-1);Math.random()<.5&&(t.octave+=t.direction),t.octave>=6&&(t.direction=-1),t.octave<=4&&(t.direction=1);const o=pf[e][a],n=J[o][t.octave],r=Ke.createOscillator(),l=Ke.createGain();r.type="sine",l.gain.value=parseFloat(i.soundVolume)/10,r.connect(l),l.connect(Ke.destination),r.frequency.value=n,r.start(Ke.currentTime),l.gain.setTargetAtTime(0,Ke.currentTime,.3),r.stop(Ke.currentTime+2)}function m0(e,t){var c;if(Ke===void 0&&Ig(),!Ke||(wn=e??wn,!(wn in Ji)))return;const o=3+(rs||ls||ba?1:0),n=(c=Ji[wn])==null?void 0:c.call(Ji,o),r=Ke.createOscillator(),l=Ke.createGain();r.type=t??Wg[i.playSoundOnClick],l.gain.value=parseFloat(i.soundVolume)/10,r.connect(l),l.connect(Ke.destination),r.frequency.value=n,r.start(Ke.currentTime),l.gain.setTargetAtTime(0,Ke.currentTime,.15),r.stop(Ke.currentTime+.5)}async function Fa(e){if(i.playSoundOnClick==="off")return;if(i.playSoundOnClick in hf){const{name:n,meta:r}=hf[i.playSoundOnClick];Eg(n,r);return}if(i.playSoundOnClick in Wg){m0(e??void 0);return}Ys===null&&await Ml();const t=Ys[i.playSoundOnClick];if(t===void 0)throw new Error("Invalid click sound ID");const a=xa(t),o=a.sounds[a.counter];a.counter++,a.counter===2&&(a.counter=0),o.seek(0),o.play()}async function Ll(){if(i.playSoundOnError==="off")return;Dr===null&&await p0();const e=Dr[i.playSoundOnError];if(e===void 0)throw new Error("Invalid error sound ID");const t=xa(e),a=t.sounds[t.counter];t.counter++,t.counter===2&&(t.counter=0),a.seek(0),a.play()}function g0(e){try{Howler.volume(e)}catch{}}he((e,t)=>{e==="playSoundOnClick"&&t!=="off"&&Ml(),e==="soundVolume"&&g0(parseFloat(t))});let jd=[],Rt=[],Bg=0,Qd=!0,na=0,Ze=0,Js=0,ki=0,Rr=[],Dc=[];var up;const Ye=(up=document.getElementById("playpauseReplayButton"))==null?void 0:up.children[0];function Pg(e){jd=e}function Gd(){const e=document.getElementById("replayWords");if(e===null)return;e.innerHTML="";let t=0;Rt.forEach(a=>{a.action==="backWord"?t--:(a.action==="submitCorrectWord"||a.action==="submitErrorWord")&&t++}),jd.forEach((a,o)=>{if(o>t)return;const n=document.createElement("div");n.className="word";for(const r of a){const l=document.createElement("letter");l.innerHTML=r,n.appendChild(l)}e.appendChild(n)})}function Si(){var e;Rr.forEach(t=>{clearTimeout(t)}),Rr=[],Dc.forEach(t=>{clearTimeout(t)}),Dc=[],ki=Ze,Js=na,Ye!==void 0&&(Ye.className="fas fa-play",(e=Ye.parentNode)==null||e.setAttribute("aria-label","Resume replay"))}function po(e=!1){e&&i.playSoundOnError!=="off"?Ll():Fa()}function qg(e,t=!1){var o,n,r,l;let a=(o=document.getElementById("replayWords"))==null?void 0:o.children[na];if(a!==void 0){if(e.action==="correctLetter")t||po(),(n=a.children[Ze])==null||n.classList.add("correct"),Ze++;else if(e.action==="incorrectLetter"){t||po(!0);let c;Ze>=a.children.length&&(c=document.createElement("letter"),c==null||c.classList.add("extra"),c.innerHTML=((r=e.value)==null?void 0:r.toString())??"",a.appendChild(c)),c=a.children[Ze],c==null||c.classList.add("incorrect"),Ze++}else if(e.action==="setLetterIndex"&&typeof e.value=="number"){t||po(),Ze=e.value;for(const c of[...a.children].slice(Ze))c!=null&&c.classList.contains("extra")?c.remove():c.className=""}else if(e.action==="submitCorrectWord")t||po(),na++,Ze=0;else if(e.action==="submitErrorWord")t||po(!0),a==null||a.classList.add("error"),na++,Ze=0;else if(e.action==="backWord"){t||po(),na--;const c=document.getElementById("replayWords");for(c!==null&&(a=c.children[na]),Ze=a.children.length;((l=a.children[Ze-1])==null?void 0:l.className)==="";)Ze--;a==null||a.classList.remove("error")}}}function Yd(){var o;let e=0;Ze=0,na=0,Rt.forEach((n,r)=>{(na<Js||na===Js&&Ze<ki)&&(qg(n,!0),e=r+1)});const t=(o=Rt[e])==null?void 0:o.time;if(t===void 0)throw new Error("Failed to load old replay: datatime is undefined");const a=Math.floor(t/1e3);return Dg(a),e}function Fg(){var e;s("#resultReplay").stop(!0,!0).hasClass("hidden")?(Gd(),Yd(),s("#watchReplayButton").hasClass("loaded")?s("#resultReplay").removeClass("hidden").css("display","none").slideDown(250):(s("#words").html('<div class="preloader"><i class="fas fa-fw fa-spin fa-circle-notch"></i></div>'),s("#resultReplay").removeClass("hidden").css("display","none").slideDown(250))):(((e=Ye==null?void 0:Ye.parentNode)==null?void 0:e.getAttribute("aria-label"))!="Start replay"&&Si(),s("#resultReplay").slideUp(250,()=>{s("#resultReplay").addClass("hidden")}))}function h0(){s("#resultReplay").stop(!0,!0).hasClass("hidden")||Fg(),s("#replayStats").text(""),Rt=[],Bg=performance.now(),Qd=!0,ki=0,Js=0}function Or(){Qd=!1}function Bs(e,t){if(!Qd)return;const a=performance.now()-Bg;Rt.push({action:e,value:t,time:a})}function Dg(e){const a=`${Ma[e-1]??0}wpm	${e}s`;s("#replayStats").text(a)}function y0(){var n,r;if(Ze=0,na=0,Ye===void 0)return;Ye.className="fas fa-pause",(n=Ye.parentNode)==null||n.setAttribute("aria-label","Pause replay"),Gd();const e=Yd(),t=(r=Rt[e])==null?void 0:r.time;if(t===void 0)throw new Error("Failed to play replay: lastTime is undefined");let a=Math.round(t/1e3);const o=Math.round(Rt[Rt.length-1].time/1e3);for(;a<=o;){const l=a;Dc.push(setTimeout(()=>{Dg(l)},l*1e3-t)),a++}Rt.forEach((l,c)=>{c<e||Rr.push(setTimeout(()=>{qg(l)},l.time-t))}),Rr.push(setTimeout(()=>{ki=0,Js=0,Ye.className="fas fa-play",Ye.parentNode.setAttribute("aria-label","Start replay")},Rt[Rt.length-1].time-t))}function v0(){return JSON.stringify({replayData:Rt,wordsList:jd})}s(".pageTest #playpauseReplayButton").on("click",()=>{(Ye==null?void 0:Ye.className)==="fas fa-play"?y0():(Ye==null?void 0:Ye.className)==="fas fa-pause"&&Si()});s("#replayWords").on("click","letter",e=>{Si();const t=document.querySelector("#replayWords"),a=[...(t==null?void 0:t.children)??[]];Js=a.indexOf(e.target.parentNode),ki=[...a[Js].children].indexOf(e.target),Gd(),Yd()});s(".pageTest").on("click","#watchReplayButton",()=>{Fg()});class hn{constructor(t,a,o,n,r){this.unit=t,this.convertFactor=a,this.fullUnitString=o,this.histogramDataBucketSize=n,this.historyStepSize=r}fromWpm(t){return t*this.convertFactor}toWpm(t){return t/this.convertFactor}}const w0={wpm:new hn("wpm",1,"Words per Minute",10,10),cpm:new hn("cpm",5,"Characters per Minute",50,100),wps:new hn("wps",1/60,"Words per Second",.5,2),cps:new hn("cps",5/60,"Characters per Second",5,5),wph:new hn("wph",60,"Words per Hour",250,1e3)};function et(e){return w0[e]}const Wl={composing:!1,startPos:-1};function Ps(){return Wl.composing}function b0(){return Wl.startPos}function Rg(e){Wl.composing=e}function C0(e){Wl.startPos=e}const rt=16,Og=12,Rc=rt/2,k0=Og/2,yf=250;let ht=[],Qe,Ho={},Hr=[],Il=[],In=[],Jd=[],Co=[],Zi,mo,Hg=new Date,Yn=!1,_g=!1,Oc=!0,_r=!0,Hc=!1,Xi=!1;async function S0(e,t){if(!_g||Co!==void 0&&e===Co[0]&&t===Co[1]||!Yn&&!await x0()||e===void 0||t===void 0||e<0||t<0||t<e)return!1;t=Math.min(t,Qe.length-1);const a=$0(e,t,Hc);for(let o=0;o<ht.length;o++){const n=Il[o],r=n.children[0];n.classList.remove("highlight-hidden"),!Oc&&!_r?(n.classList.add("withAnimation"),r.classList.add("withAnimation")):(n.classList.remove("withAnimation"),r.classList.remove("withAnimation"));const l=a[o];l&&(n.style.right=l.highlightRight+"px",r.style.left=l.inputContainerLeft+"px",n.style.left=l.highlightLeft+"px")}return Oc=!1,_r=!1,Co=[e,t],!0}function T0(){for(const e of Il)e.classList.add("highlight-hidden");_r=!0,Co=[]}function Zd(){if(Yn){for(const e of Hr)e.remove();Il=[],Hr=[],Ho={},ht=[],In=[],Jd=[],Yn=!1,Oc=!0,_r=!0,Co=[]}}function Ng(e){_g=e}async function x0(){if(Yn||Xi)return!1;Xi=!0;const e=new Date().getTime()-Hg.getTime();if(e<yf&&await new Promise(u=>setTimeout(u,yf-e)),Hc=(await Ea(i.language)).rightToLeft,Zi=s("#resultWordsHistory")[0],mo=Zi.getBoundingClientRect(),Qe=s(Zi).find(".words .word[input]"),Qe.length===0)return Xi=!1,!1;let a=-1,o,n=0;Ho[0]=0;for(let u=1;u<Qe.length;u++){const f=Qe[u],p=Qe[u-1];f.offsetTop!=p.offsetTop&&(n++,o=Mn([Qe[a+1],p]),ht.push({firstWordIndex:a+1,lastWordIndex:u-1,rect:o}),a=u-1),Ho[u]=n}o=Mn([Qe[a+1],Qe[Qe.length-1]]),ht.push({firstWordIndex:a+1,lastWordIndex:Qe.length-1,rect:o});const r=mo.width,l=mo.height,c=mo.top,d=mo.left;return ht.forEach(u=>{const f=document.createElement("div");f.classList.add("highlightContainer"),Hr.push(f);const p=u.rect.top-k0,g=u.rect.left-Rc,h=p-c,y=g-d,w=u.rect.width+rt,k=u.rect.height+Og,L=u.rect.width,x=u.rect.height,B=h/l*100+"%",D=y/r*100+"%",v=w/r*100+"%",C=k/l*100+"%";f.style.width=v,f.style.top=B,f.style.left=D,f.style.height=C;const q=document.createElement("div"),G=document.createElement("div");G.style.top=u.rect.top-p+"px",G.style.left=u.rect.left-g+"px",G.style.width=L+"px",G.style.height=x+"px",q.className="highlight highlight-hidden",G.className="inputWordsContainer";for(let ze=u.firstWordIndex;ze<=u.lastWordIndex;ze+=1){const Fe=Qe[ze],Ie=Fe.getAttribute("input")??"";if(!Ie)continue;const ot=document.createElement("div");let Jt;Hc?Jt=u.rect.left-mo.left+rt:Jt=0,ot.style.left=Fe.offsetLeft+Rc-Jt+"px",ot.innerHTML=Ie.replace(/\t/g,"_").replace(/\n/g,"_").replace(/</g,"&lt").replace(/>/g,"&gt").slice(0,Fe.childElementCount),ot.className="inputWord",G.append(ot),Jd.push(ot)}In.push(G),Il.push(q),q.append(G),f.append(q),Zi.append(f)}),Yn=!0,Xi=!1,!0}function $0(e,t,a=!1){const o=Ho[e],n=new Array(ht.length).fill(null).map(()=>({highlightLeft:0,highlightRight:0,inputContainerLeft:0,inputContainerRight:0})),r=A0(e,t),l=Qe[e],c=ht[o],d=n[o],u=Hr[o],f=In[o];if(l===void 0||c===void 0||d===void 0||u===void 0||f===void 0)return n;if(!a)d.highlightLeft=l.offsetLeft,d.highlightRight=c.rect.width-(d.highlightLeft+r)+rt;else{const p=u.offsetLeft;d.highlightRight=c.rect.width-(l.offsetLeft+l.offsetWidth)+p+Rc,d.highlightLeft=c.rect.width-(d.highlightRight+r)+rt}a?d.inputContainerLeft=-1*(f.getBoundingClientRect().width-r-d.highlightRight):d.inputContainerLeft=-1*d.highlightLeft;for(let p=o-1;p>=0;p--){const g=n[p],h=n[p+1],y=ht[p],w=In[p];g===void 0||y===void 0||h===void 0||w===void 0||(a?(g.highlightRight=h.highlightRight+y.rect.width+rt,g.highlightLeft=y.rect.width-(g.highlightRight+r)+rt,g.inputContainerLeft=-1*(w.getBoundingClientRect().width-r-g.highlightRight)):(g.highlightLeft=h.highlightLeft+y.rect.width+rt,g.highlightRight=y.rect.width-(g.highlightLeft+r)+rt,g.inputContainerLeft=-1*g.highlightLeft))}for(let p=o+1;p<ht.length;p++){const g=n[p],h=ht[p-1],y=ht[p],w=n[p-1],k=In[p];g===void 0||h===void 0||y===void 0||w===void 0||k===void 0||(a?(g.highlightRight=-1*(h.rect.width-w.highlightRight+rt),g.highlightLeft=y.rect.width-(g.highlightRight+r)+rt,g.inputContainerLeft=-1*(k.getBoundingClientRect().width-r-g.highlightRight)):(g.highlightLeft=-1*(h.rect.width-w.highlightLeft+rt),g.highlightRight=y.rect.width-(g.highlightLeft+r)+rt,g.inputContainerLeft=-1*g.highlightLeft))}return n}function A0(e,t){var y,w;const a=Ho[e],o=Ho[t];if(a===void 0||o===void 0)return 0;const n=Qe[e],r=Qe[t],l=Jd[t],c=Qe[((y=ht[a])==null?void 0:y.lastWordIndex)??-1],d=Qe[((w=ht[o])==null?void 0:w.firstWordIndex)??-1];if(n===void 0||r===void 0||l===void 0||c===void 0||d===void 0)return 0;if(a==o){const k=Mn([n,r]),L=r.getBoundingClientRect(),x=l.getBoundingClientRect();let B=k.width+rt;return B-=L.width-x.width,B}const u=Mn([n,c]),f=Mn([d,r]);let p=u.width+f.width;for(let k=a+1;k<o;k++)p+=ht[k].rect.width;p+=2*rt*(o-a);const g=r.getBoundingClientRect(),h=l.getBoundingClientRect();return p-=g.width-h.width,p}function M0(){Hg=new Date}let Kg="loading";function ne(){return Kg}function L0(e){Kg=e}const rc={suffix:"",fallback:"-",showDecimalPlaces:void 0,rounding:Math.round};class W0{constructor(t){this.config=t}typingSpeed(t,a={}){const o={...rc,...a};if(t==null)return o.fallback??"";const n=et(this.config.typingSpeedUnit).fromWpm(t);return this.number(n,o)}percentage(t,a={}){const o={...rc,...a};return o.suffix="%"+(o.suffix??""),this.number(t,o)}accuracy(t,a={}){return this.percentage(t,{rounding:Math.floor,...a})}decimals(t,a={}){const o={...rc,...a};return this.number(t,o)}number(t,a){if(t==null)return a.fallback??"";const o=a.suffix??"";return(a.showDecimalPlaces!==void 0?a.showDecimalPlaces:this.config.alwaysShowDecimalPlaces)?U(t).toFixed(2)+o:(a.rounding??Math.round)(t).toString()+o}rank(t,a={}){const o={fallback:"-",...a};if(t==null)return o.fallback??"";let n="th";const r=t%10,l=t%100;return r===1&&l!==11&&(n="st"),r===2&&l!==12&&(n="nd"),r===3&&l!==13&&(n="rd"),t+n}}const _=new W0(i),I0=[{name:"Prime Ape",description:"Paying for a monthly subscription",icon:"fa-dollar-sign",test:e=>e.isPremium===!0},{name:"Banned",description:"This account is banned",icon:"fa-gavel",color:"var(--error-color)",test:e=>e.banned===!0},{name:"LbOptOut",description:"This account has opted out of leaderboards",icon:"fa-crown",color:"var(--error-color)",test:e=>e.lbOptOut===!0}],E0={iconsOnly:!1};function B0(e){return I0.filter(a=>a.test(e))}function P0(e,t){const a=`<i class="fas ${e.icon}"></i>`;if(t.iconsOnly)return a;const o=[];return e.background!==void 0&&o.push(`background: ${e.background};`),(e==null?void 0:e.color)!==void 0&&o.push(`color: ${e.color};`),(e==null?void 0:e.customStyle)!==void 0&&o.push(e.customStyle),`<div class="flag" ${`aria-label="${e.description}" data-balloon-pos="right"`} style="${o.join("")}">${a}</div>`}function El(e,t){const a={...E0,...t};return B0(e).map(o=>P0(o,a)).join("")}async function q0(){return(await Cd(()=>import("./html2canvas.esm.3NQT9CgR.js"),__vite__mapDeps([]))).default}function F0(e,t){let a="";for(const o of e)for(const n of o){const r=t[n].offsetLeft,l=t[n].offsetWidth,c=`[${n}]`,d=T.current[n];a+=`<hint data-length=1 data-chars-index=${c} style="left: ${r+l/2}px;">${d}</hint>`}return a=`<div class="hints">${a}</div>`,a}async function D0(e,t,a){const n=(await Ea(i.language)).rightToLeft;let r=0;for(const l of e){for(let c=0;c<l.length-1;c++){const d=a[r],u=a[r+1],f=n?u:d,p=n?d:u;if(f.offsetLeft+f.offsetWidth/2>p.offsetLeft-p.offsetWidth/2){d.dataset.length=(parseInt(d.dataset.length??"1")+parseInt(u.dataset.length??"1")).toString();const g=d.dataset.charsIndex??"[]",h=u.dataset.charsIndex??"[]";d.dataset.charsIndex=g.slice(0,-1)+","+h.slice(1);const y=l[c]??0,w=t[y].offsetLeft+(n?t[y].offsetWidth:0)+(u.offsetLeft-d.offsetLeft);d.style.left=w.toString()+"px",d.insertAdjacentHTML("beforeend",u.innerHTML),u.remove(),l.splice(c+1,1),r-=c===0?1:2,c-=c===0?1:2}r++}r++}}const R0=Et(250,async()=>{const e=await Tv(i.language);e==="no"&&m(`${Do(os(i.language))} does not support Zipf funbox, because the list is not ordered by frequency. Please try another word list.`,0,{duration:7}),e==="unknown"&&m(`${Do(os(i.language))} may not support Zipf funbox, because we don't know if it's ordered by frequency or not. If you would like to add this label, please contact us.`,0,{duration:7})});he((e,t,a)=>{(e==="language"||e==="funbox")&&i.funbox.split("#").includes("zipf")&&R0(),e==="fontSize"&&!a&&(hi(),tu(!0),eu(!0)),(e==="fontSize"||e==="fontFamily")&&_0().catch(o=>{console.error(o)}),e==="theme"&&Wo(),t!==void 0&&(e==="highlightMode"&&(J0(t),Jn()),typeof t=="boolean"&&(e==="flipTestColors"&&K0(t),e==="colorfulMode"&&z0(t),e==="highlightMode"&&ra(t),e==="burstHeatmap"&&Wo()))});let Oe=0,qe=!1,Xd=0,Ct=!1,_c=!1,hr=0,Zs=!1;function zg(e){qe=e}function Nr(e){Oe=e}function O0(e){Xd=e}let er;function Nc(e){Ct=e,e?new Promise(t=>{er=t}):(er&&er(),er=null)}function Ug(e){Zs=e}function H0(){hr=0,Oe=0}function Bl(){s("#wordsInput").trigger("focus")}function Jn(e,t=!1){const a=document.querySelector("#words .active");i.mode==="zen"&&e?a==null||a.remove():a!==null&&(i.highlightMode==="word"&&a.querySelectorAll("letter").forEach(o=>{o.classList.remove("correct")}),a.classList.remove("active"));try{const o=document.querySelectorAll("#words .word")[Oe];o.classList.add("active"),o.classList.remove("error"),Xd=document.querySelector("#words .active").offsetTop,i.highlightMode==="word"&&o.querySelectorAll("letter").forEach(n=>{n.classList.add("correct")})}catch{}!t&&N0()&&eu()}async function _0(){var r,l,c,d;if(ne()!=="test"||qe||i.indicateTypos!=="below")return;const t=(await Ea(i.language)).rightToLeft;let a,o;const n=(r=document.getElementById("words"))==null?void 0:r.querySelectorAll("div.word > div.hints > hint");for(let u=0;u<((n==null?void 0:n.length)??0);u++){const f=n==null?void 0:n[u];(!a||((l=f.parentElement)==null?void 0:l.parentElement)!==a)&&(a=(c=f.parentElement)==null?void 0:c.parentElement,o=a==null?void 0:a.querySelectorAll("letter"));const p=(d=f.dataset.charsIndex)==null?void 0:d.slice(1,-1).split(",").map(w=>parseInt(w)),g=t?parseInt(f.dataset.length??"1")-1:0;let h=(o==null?void 0:o[(p==null?void 0:p[g])??0]).offsetLeft;const y=(p==null?void 0:p.reduce((w,k)=>w+(o==null?void 0:o[k]).offsetWidth,0))??0;h+=y/2,f.style.left=h.toString()+"px"}}function Vg(e){var n;let t=!1,a="<div class='word'>";const o=V(i.funbox).find(r=>{var l;return(l=r.functions)==null?void 0:l.getWordHtml});for(let r=0;r<e.length;r++)(n=o==null?void 0:o.functions)!=null&&n.getWordHtml?a+=o.functions.getWordHtml(e.charAt(r),!0):e.charAt(r)==="	"?a+=`<letter class='tabChar'><i class="fas fa-long-arrow-alt-right fa-fw"></i></letter>`:e.charAt(r)===`
`?(t=!0,a+=`<letter class='nlChar'><i class="fas fa-level-down-alt fa-rotate-90 fa-fw"></i></letter>`):a+="<letter>"+e.charAt(r)+"</letter>";return a+="</div>",t&&(a+="<div class='newline'></div>"),a}function jg(){s("#words").empty(),i.tapeMode!=="off"?(s("#words").addClass("tape"),s("#wordsWrapper").addClass("tape")):(s("#words").removeClass("tape"),s("#wordsWrapper").removeClass("tape")),i.indicateTypos==="below"?(s("#words").addClass("indicateTyposBelow"),s("#wordsWrapper").addClass("indicateTyposBelow")):(s("#words").removeClass("indicateTyposBelow"),s("#wordsWrapper").removeClass("indicateTyposBelow"));let e="";if(i.mode!=="zen")for(let t=0;t<A.length;t++)e+=Vg(A.get(t));else e='<div class="word">word height</div><div class="word active"></div>';s("#words").html(e),tu(!0),Jn(void 0,!0),da(),eu(!0)}const Qg=["japanese","chinese","korean"];function N0(){return Qg.some(t=>i.language.startsWith(t))||i.mode!=="time"&&i.showAllLines}function eu(e=!1){var l;if(ne()!=="test"||i.tapeMode!=="off"&&!e)return;const t=document.querySelector("#wordsInput"),a=document.querySelector("#words .active");if(!a){t.style.top="0px",t.style.left="0px";return}const o=window.getComputedStyle(a),n=parseInt(o.marginTop)+parseInt(o.marginBottom),r=((l=document.querySelector("#wordsWrapper"))==null?void 0:l.offsetTop)??0;if(i.tapeMode!=="off"){t.style.top=r+a.offsetHeight+n*.25+-t.offsetHeight+"px",t.style.left=a.offsetLeft+"px";return}e&&!Qg.some(c=>i.language.startsWith(c))?(t.style.left="0px",t.style.top=r+a.offsetHeight*2+n*1.5+-t.offsetHeight+"px"):(t.style.left=a.offsetLeft+"px",t.style.top=a.offsetTop-n+r+a.offsetHeight+n+-t.offsetHeight+"px")}function tu(e=!1){if(ne()!=="test"||!e&&i.mode!=="custom")return;s("#wordsWrapper").removeClass("hidden");const t=s(document.querySelector(".word")).outerHeight(!0);if(s(document.querySelector("#words")).outerHeight(!0),i.showAllLines&&i.mode!=="time"&&!(fe&&Re===0)&&!pe)s("#words").css("height","auto").css("overflow","hidden").css("width","100%").css("margin-left","unset"),s("#wordsWrapper").css("height","auto").css("overflow","hidden"),s(".outOfFocusWarning").css("margin-top",t+ss(1)/2+"px");else{let a,o;if(i.tapeMode!=="off")a=t*2,o=t;else{let n=0,r=0,l=0;const c=document.querySelectorAll("#words .word");let d=0;const u=window.getComputedStyle(c[0]),f=parseInt(u.marginTop),p=parseInt(u.marginBottom);for(;n<3;){const h=c[l];if(!h)break;const y=h.offsetTop;y>r&&(n++,d+=h.offsetHeight+f+p,r=y),l++}n<3&&(d=d*(3/n)),a=d/3*4,o=d}s("#words").css("height",a+"px").css("overflow","hidden"),i.tapeMode!=="off"?s("#words").css("width","200%").css("margin-left","50%"):s("#words").css("width","100%").css("margin-left","unset"),s("#wordsWrapper").css("height",o+"px").css("overflow","hidden"),s(".outOfFocusWarning").css("margin-top",o/2-ss(1)/2+"px")}i.mode==="zen"&&s(document.querySelector(".word")).remove()}function vf(e){s("#words").append(Vg(e))}function K0(e){e?s("#words").addClass("flipped"):s("#words").removeClass("flipped")}function z0(e){e?s("#words").addClass("colorfulMode"):s("#words").removeClass("colorfulMode")}let wf=!1;async function U0(){var p,g;oe();let e=!1,t=!1;(no("#cookiesModal")||document.contains(document.querySelector("#cookiesModal")))&&(t=!0);function a(){Q(),s("#ad-result-wrapper").removeClass("hidden"),s("#ad-result-small-wrapper").removeClass("hidden"),s("#testConfig").removeClass("hidden"),s(".pageTest .screenshotSpacer").remove(),s("#notificationCenter").removeClass("hidden"),s("#commandLineMobileButton").removeClass("hidden"),s(".pageTest .ssWatermark").addClass("hidden"),s(".pageTest .ssWatermark").text("monkeytype.com"),s(".pageTest .buttons").removeClass("hidden"),s("noscript").removeClass("hidden"),s("#nocss").removeClass("hidden"),s("header, footer").removeClass("invisible"),s("#result").removeClass("noBalloons"),s(".wordInputHighlight").removeClass("hidden"),s(".highlightContainer").removeClass("hidden"),t&&s("#cookiesModal").removeClass("hidden"),e&&s("#resultReplay").removeClass("hidden"),z()||s(".pageTest .loginTip").removeClass("hidden"),document.querySelector("html").style.scrollBehavior="smooth",V(i.funbox).forEach(h=>{var y,w;return(w=(y=h.functions)==null?void 0:y.applyGlobalCSS)==null?void 0:w.call(y)})}s("#resultReplay").hasClass("hidden")||(e=!0,Si());const o=new Date(Date.now());s("#resultReplay").addClass("hidden"),s(".pageTest .ssWatermark").removeClass("hidden");const n=S(),r=[_e(o,"dd MMM yyyy HH:mm"),"monkeytype.com"];if((n==null?void 0:n.name)!==void 0){const h=`${n==null?void 0:n.name}${El(n,{iconsOnly:!0})}`;r.unshift(h)}s(".pageTest .ssWatermark").html(r.map(h=>`<span>${h}</span>`).join("<span class='pipe'>|</span>")),s(".pageTest .buttons").addClass("hidden"),s("#notificationCenter").addClass("hidden"),s("#commandLineMobileButton").addClass("hidden"),s(".pageTest .loginTip").addClass("hidden"),s("noscript").addClass("hidden"),s("#nocss").addClass("hidden"),s("#ad-result-wrapper").addClass("hidden"),s("#ad-result-small-wrapper").addClass("hidden"),s("#testConfig").addClass("hidden"),s(".page.pageTest").prepend("<div class='screenshotSpacer'></div>"),s("header, footer").addClass("invisible"),s("#result").addClass("noBalloons"),s(".wordInputHighlight").addClass("hidden"),s(".highlightContainer").addClass("hidden"),t&&s("#cookiesModal").addClass("hidden"),V(i.funbox).forEach(h=>{var y,w;return(w=(y=h.functions)==null?void 0:y.clearGlobal)==null?void 0:w.call(y)}),document.querySelector("html").style.scrollBehavior="auto",window.scrollTo({top:0});const l=s("#result"),c=((p=l.offset())==null?void 0:p.left)??0,d=((g=l.offset())==null?void 0:g.top)??0,u=l.outerWidth(!0),f=l.outerHeight(!0);try{const h=ss(2),y=ss(2);(await(await q0())(document.body,{backgroundColor:await Dt("bg"),width:u+h*2,height:f+y*2,x:c-h,y:d-y})).toBlob(async k=>{try{if(k===null)throw new Error("Could not create image, blob is null");const L=new ClipboardItem(Object.defineProperty({},k.type,{value:k,enumerable:!0}));await navigator.clipboard.write([L]),m("Copied to clipboard",1,{duration:2})}catch(L){console.error("Error while saving image to clipboard",L),k?(navigator.userAgent.toLowerCase().includes("firefox")&&!wf&&(wf=!0,m("On Firefox you can enable the asyncClipboard.clipboardItem permission in about:config to enable copying straight to the clipboard",0,{duration:10})),m("Could not save image to clipboard. Opening in new tab instead (make sure popups are allowed)",0,{duration:5}),open(URL.createObjectURL(k))):m(ee(L,"Error saving image to clipboard"),-1)}a()})}catch(h){m(ee(h,"Error creating image"),-1),a()}setTimeout(()=>{a()},3e3)}async function ra(e=!i.blindMode,t){var d,u;const a=t??T.current,o=document.querySelector("#words .word.active"),n=A.getCurrent();if(!n&&i.mode!=="zen")return;let r="";const l=[];let c=!1;if(i.mode==="zen")for(const f of T.current)f==="	"?r+=`<letter class='tabChar correct' style="opacity: 0"><i class="fas fa-long-arrow-alt-right fa-fw"></i></letter>`:f===`
`?(c=!0,r+=`<letter class='nlChar correct' style="opacity: 0"><i class="fas fa-level-down-alt fa-rotate-90 fa-fw"></i></letter>`):r+=`<letter class="correct">${f}</letter>`;else{let f=!1;const p=T.getKoreanStatus();if(p){const y=Ue.disassemble(n).join(""),w=Ue.disassemble(a).join(""),k=za.test(a)?a.search(za):w.length;a.search(za)<Ue.d(y).length&&y.slice(0,k)===w.slice(0,k)&&(f=!0)}else{const y=za.test(a)?a.search(za):a.length;a.search(za)<n.length&&n.slice(0,y)===a.slice(0,y)&&(f=!0)}let g=f?"correct":"incorrect";i.blindMode&&(g="correct");const h=V(i.funbox).find(y=>{var w;return(w=y.functions)==null?void 0:w.getWordHtml});for(let y=0;y<a.length;y++){const w=n[y]===a[y];let k="correct";i.highlightMode==="off"&&(k="");let L=n[y],x="",B="";if((d=h==null?void 0:h.functions)!=null&&d.getWordHtml){const D=h.functions.getWordHtml(L);D!==""&&(L=D)}else L==="	"?(x="tabChar",L='<i class="fas fa-long-arrow-alt-right fa-fw"></i>'):L===`
`&&(B="nlChar",L='<i class="fas fa-level-down-alt fa-rotate-90 fa-fw"></i>');if(w)r+=`<letter class="${i.highlightMode==="word"?g:k} ${x}${B}">${L}</letter>`;else if(L!==void 0&&Ps()&&y>=b0()&&!(p&&!f))r+=`<letter class="${i.highlightMode==="word"?g:""} dead">${L}</letter>`;else if(!e)L!==void 0&&(r+=`<letter class="${i.highlightMode==="word"?g:k} ${x}${B}">${L}</letter>`);else if(L===void 0){if(!i.hideExtraLetters){let D=a[y];(D===" "||D==="	"||D===`
`)&&(D="_"),r+=`<letter class="${i.highlightMode==="word"?g:"incorrect"} extra ${x}${B}">${D}</letter>`}}else if(r+=`<letter class="${i.highlightMode==="word"?g:"incorrect"} ${x}${B}">`+(i.indicateTypos==="replace"?a[y]===" "?"_":a[y]:L)+"</letter>",i.indicateTypos==="below")if(!(l!=null&&l.length))l.push([y]);else{const D=l[l.length-1];(D==null?void 0:D[D.length-1])===y-1?D.push(y):l.push([y])}}for(let y=a.length;y<n.length;y++)(u=h==null?void 0:h.functions)!=null&&u.getWordHtml?r+=h.functions.getWordHtml(n[y],!0):n[y]==="	"?r+=`<letter class='tabChar'><i class="fas fa-long-arrow-alt-right fa-fw"></i></letter>`:n[y]===`
`?r+=`<letter class='nlChar'><i class="fas fa-level-down-alt fa-rotate-90 fa-fw"></i></letter>`:r+=`<letter class="${i.highlightMode==="word"?g:""}">`+n[y]+"</letter>";i.highlightMode==="letter"&&i.hideExtraLetters&&(a.length>n.length&&!i.blindMode?o.classList.add("error"):a.length===n.length&&o.classList.remove("error"))}if(o.innerHTML=r,l!=null&&l.length){const f=o.querySelectorAll("letter"),p=F0(l,f);o.insertAdjacentHTML("beforeend",p);const g=o.getElementsByTagName("hint");await D0(l,f,g)}c&&s("#words").append("<div class='newline'></div>")}function ko(){var l;const e=document.querySelector("#wordsWrapper").offsetWidth;let t=0;const a=[];let o=0;if(Oe>0){for(let c=0;c<Oe;c++){const d=document.querySelectorAll("#words .word")[c];t+=s(d).outerWidth(!0)??0;const u=Math.floor(d.offsetLeft),f=Math.floor(d.offsetWidth);if(u<0-f){const p=s(s("#words .word")[c]);a.push(p),o+=p.outerWidth(!0)??0}}if(a.length>0){Oe-=a.length,a.forEach(d=>d.remove()),t-=o;const c=parseInt(s("#words").css("margin-left"),10);s("#words").css("margin-left",`${c+o}px`)}}let n=0;if(i.tapeMode==="letter"&&T.current.length>0)for(let c=0;c<T.current.length;c++){const d=document.querySelectorAll("#words .word");n+=s((l=d[Oe])==null?void 0:l.querySelectorAll("letter")[c]).outerWidth(!0)??0}const r=e/2-(t+n);i.smoothLineScroll?s("#words").stop(!0,!1).animate({marginLeft:r},Ce()?0:125):s("#words").css("margin-left",`${r}px`)}function V0(){const e=ml(i,se);let t="";i.funbox!=="none"&&(t=" "+i.funbox.split("#").join(" ")),s(".pageTest #premidTestMode").text(`${i.mode} ${e} ${os(i.language)}${t}`),s(".pageTest #premidSecondsLeft").text(i.time)}let lc=0;function au(e){var t;if(i.tapeMode==="off"&&hr>0||i.tapeMode!=="off"&&hr>=0){const a=e,o=[],n=s("#words .word");for(let l=0;l<Oe;l++){const c=s(n[l]);if(c.hasClass("hidden"))continue;Math.floor(c[0].offsetTop)<(i.tapeMode==="off"?a-10:a+10)&&o.push(s(s("#words .word")[l]))}const r=s(document.querySelector(".word")).outerHeight(!0);if(i.smoothLineScroll&&o.length>0){_c=!0;const l=s("#words .smoothScroller");l.length===0?s("#words").prepend(`<div class="smoothScroller" style="position: fixed;height:${r}px;width:100%"></div>`):l.css("height",`${(l.outerHeight(!0)??0)+r}px`),s("#words .smoothScroller").stop(!0,!1).animate({height:0},Ce()?0:125,()=>{s("#words .smoothScroller").remove()}),s("#paceCaret").stop(!0,!1).animate({top:((t=document.querySelector("#paceCaret"))==null?void 0:t.offsetTop)-r},Ce()?0:125);const c={marginTop:`-${r*(lc+1)}px`};if(i.tapeMode!=="off"){const u=document.querySelector("#wordsWrapper").offsetWidth/2;c.marginLeft=`${u}px`}lc++,s("#words").stop(!0,!1).animate(c,Ce()?0:125,()=>{lc=0,Xd=document.querySelector("#words .active").offsetTop,Oe-=o.length,_c=!1,o.forEach(d=>d.remove()),s("#words").css("marginTop","0")})}else o.forEach(l=>l.remove()),Oe-=o.length,s("#paceCaret").css({top:document.querySelector("#paceCaret").offsetTop-r})}hr++,tu()}function j0(e){e?(s("#words").addClass("rightToLeftTest"),s("#resultWordsHistory .words").addClass("rightToLeftTest"),s("#resultReplay .words").addClass("rightToLeftTest")):(s("#words").removeClass("rightToLeftTest"),s("#resultWordsHistory .words").removeClass("rightToLeftTest"),s("#resultReplay .words").removeClass("rightToLeftTest"))}function Q0(e){e?(s("#words").addClass("withLigatures"),s("#resultWordsHistory .words").addClass("withLigatures"),s("#resultReplay .words").addClass("withLigatures")):(s("#words").removeClass("withLigatures"),s("#resultWordsHistory .words").removeClass("withLigatures"),s("#resultReplay .words").removeClass("withLigatures"))}async function G0(){s("#resultWordsHistory .words").empty();let e="";for(let t=0;t<T.history.length+2;t++){const a=T.getHistory(t),o=Ne.getHistory(t),n=A.get(t),r=(a==null?void 0:a.match(/[\uac00-\ud7af]|[\u1100-\u11ff]|[\u3130-\u318f]|[\ua960-\ua97f]|[\ud7b0-\ud7ff]/g))!==null||n.match(/[\uac00-\ud7af]|[\u1100-\u11ff]|[\u3130-\u318f]|[\ua960-\ua97f]|[\ud7b0-\ud7ff]/g)!==null;let l="";try{if(a===void 0||a==="")throw new Error("empty input word");if(o!==void 0&&o!==""){const d=r?Ue.assemble(o.split("")):o;l=`<div class='word nocursor' burst="${Mt[t]}" input="${d.replace(/"/g,"&quot;").replace(/ /g,"_")}">`}else l=`<div class='word nocursor' burst="${Mt[t]}" input="${a.replace(/"/g,"&quot;").replace(/ /g,"_")}">`;if(t===T.history.length-1){const d={correct:0,incorrect:0,missed:0},u=i.mode==="zen"?a.length:n.length;for(let f=0;f<u;f++)f<a.length?i.mode==="zen"||a[f]===n[f]?d.correct++:d.incorrect++:d.missed++;(d.incorrect!==0||i.mode!=="time")&&i.mode!=="zen"&&a!==n&&(l=`<div class='word nocursor error' burst="${Mt[t]}" input="${a.replace(/"/g,"&quot;").replace(/ /g,"_")}">`)}else i.mode!=="zen"&&a!==n&&(l=`<div class='word nocursor error' burst="${Mt[t]}" input="${a.replace(/"/g,"&quot;").replace(/ /g,"_")}">`);let c;if(i.mode==="zen"||a.length>n.length?c=a.length:c=n.length,o===void 0)throw new Error("empty corrected word");for(let d=0;d<c;d++){let u;try{u=r?Ue.assemble(o.split(""))[d]:o[d]}catch{u=void 0}let f="";const p=r?Ue.assemble(o.split("")):o;d+1===c&&p!==void 0&&p.length>a.length&&(f="extraCorrected"),i.mode==="zen"||n[d]!==void 0?i.mode==="zen"||a[d]===n[d]?u===a[d]||u===void 0?l+=`<letter class="correct ${f}">${a[d]}</letter>`:l+=`<letter class="corrected ${f}">`+a[d]+"</letter>":a[d]===T.current?l+=`<letter class='correct ${f}'>`+n[d]+"</letter>":a[d]===void 0?l+="<letter>"+n[d]+"</letter>":l+=`<letter class="incorrect ${f}">`+n[d]+"</letter>":l+='<letter class="incorrect extra">'+a[d]+"</letter>"}l+="</div>"}catch{try{l="<div class='word'>";for(const d of n)l+="<letter>"+d+"</letter>";l+="</div>"}catch{}}e+=l}return s("#resultWordsHistory .words").html(e),s("#showWordHistoryButton").addClass("loaded"),!0}function Gg(e=!1){qe&&(M0(),s("#resultWordsHistory").stop(!0,!0).hasClass("hidden")?s("#resultWordsHistory .words .word").length===0?(s("#words").html('<div class="preloader"><i class="fas fa-fw fa-spin fa-circle-notch"></i></div>'),G0().then(()=>{i.burstHeatmap&&Wo(),s("#resultWordsHistory").removeClass("hidden").css("display","none").slideDown(e?0:250,()=>{i.burstHeatmap&&Wo()})})):(i.burstHeatmap&&Wo(),s("#resultWordsHistory").removeClass("hidden").css("display","none").slideDown(e?0:250)):s("#resultWordsHistory").slideUp(250,()=>{s("#resultWordsHistory").addClass("hidden")}))}async function Wo(){if(i.burstHeatmap){s("#resultWordsHistory .heatmapLegend").removeClass("hidden");let e=[...Mt];e=e.filter(d=>d!==1/0),e=e.filter(d=>d<350);const t=et(i.typingSpeedUnit);e.forEach((d,u)=>{e[u]=Math.round(t.fromWpm(d))});const a=await ms();let o=[a.colorfulError,Vt(a.colorfulError,a.text,.5),a.text,Vt(a.main,a.text,.5),a.main],n=a.sub;a.main===a.text&&(o=[a.colorfulError,Vt(a.colorfulError,a.text,.5),a.sub,Vt(a.sub,a.text,.5),a.main],n=a.subAlt);const r=e.sort((d,u)=>d-u),l=e.length,c=[{val:0,colorId:0},{val:r[l*.15|0],colorId:1},{val:r[l*.35|0],colorId:2},{val:r[l*.65|0],colorId:3},{val:r[l*.85|0],colorId:4}];c.forEach((d,u)=>{const f=c[u+1];let p="";u===0&&f?p=`<${Math.round(f.val)}`:u===4?p=`${Math.round(d.val)}+`:f&&(d.val!=f.val?p=`${Math.round(d.val)}-${Math.round(f.val)-1}`:p=`${Math.round(d.val)}-${Math.round(d.val)}`),s("#resultWordsHistory .heatmapLegend .box"+u).html(`<div>${p}</div>`)}),s("#resultWordsHistory .words .word").each((d,u)=>{const f=s(u).attr("burst");if(f===void 0)s(u).css("color",n);else{let p=parseInt(f);p=Math.round(et(i.typingSpeedUnit).fromWpm(p)),c.forEach(g=>{p>=g.val&&(s(u).addClass("heatmapInherit"),s(u).css("color",o[g.colorId]))})}}),s("#resultWordsHistory .heatmapLegend .boxes .box").each((d,u)=>{s(u).css("background",o[d])})}else s("#resultWordsHistory .heatmapLegend").addClass("hidden"),s("#resultWordsHistory .words .word").removeClass("heatmapInherit"),s("#resultWordsHistory .words .word").css("color",""),s("#resultWordsHistory .heatmapLegend .boxes .box").css("color","")}function Y0(e,t){t&&s(s("#words .word")[e]).addClass("error")}function J0(e){var a,o,n;const t=((n=(o=(a=s("#words"))==null?void 0:a.attr("class"))==null?void 0:o.split(/\s+/))==null?void 0:n.filter(r=>!r.startsWith("highlight-")))??[];e!=null&&t.push("highlight-"+e.replaceAll("_","-")),s("#words").attr("class",t.join(" "))}s(".pageTest").on("click","#saveScreenshotButton",()=>{U0()});s(".pageTest #copyWordsListButton").on("click",async()=>{let e;i.mode==="zen"?e=T.history.join(" "):e=A.get().slice(0,T.history.length).join(" "),await Yg(e)});s(".pageTest #copyMissedWordsListButton").on("click",async()=>{let e;i.mode==="zen"?e=T.history.join(" "):e=Object.keys(ts??{}).join(" "),await Yg(e)});async function Yg(e){try{await navigator.clipboard.writeText(e),m("Copied to clipboard",0,{duration:2})}catch(t){m("Could not copy to clipboard: "+t,-1)}}s(".pageTest #toggleBurstHeatmap").on("click",async()=>{og(!i.burstHeatmap),Zd()});s(".pageTest #resultWordsHistory").on("mouseleave",".words .word",()=>{s(".wordInputHighlight").remove()});s(".pageTest #result #wpmChart").on("mouseleave",()=>{Ng(!1),T0()});s(".pageTest #result #wpmChart").on("mouseenter",()=>{Ng(!0)});s(".pageTest #resultWordsHistory").on("mouseenter",".words .word",e=>{if(qe){const t=s(e.currentTarget).attr("input"),a=parseInt(s(e.currentTarget).attr("burst"));t!==void 0&&s(e.currentTarget).append(`<div class="wordInputHighlight withSpeed">
          <div class="text">
          ${t.replace(/\t/g,"_").replace(/\n/g,"_").replace(/</g,"&lt").replace(/>/g,"&gt")}
          </div>
          <div class="speed">
          ${_.typingSpeed(a,{showDecimalPlaces:!1})}
          ${i.typingSpeedUnit}
          </div>
          </div>`)}});addEventListener("resize",()=>{Zd()});s("#wordsInput").on("focus",e=>{e.target===document.activeElement&&(!qe&&i.showOutOfFocusWarning&&hi(),xg(!0))});s("#wordsInput").on("focusout",()=>{!qe&&i.showOutOfFocusWarning&&bb(),Ci()});s(".pageTest").on("click","#showWordHistoryButton",()=>{Gg()});s("#wordsWrapper").on("click",()=>{Bl()});s(document).on("keypress",()=>{qe&&tm()});he((e,t)=>{e==="quickRestart"&&(t==="off"?s(".pageTest #restartTestButton").removeClass("hidden"):s(".pageTest #restartTestButton").addClass("hidden"))});let Jg="",Zg=!1;function su(){return Jg}function hs(){return Zg}function lo(e,t){Jg=e,Zg=t}let ou=!1,Xs,en,Xg,eh,eo=!1,th;function Z0(e){th=e}function X0(){const e={lastResult:th,start:Xs,end:en,afkHistory:bi,errorHistory:wi,wpmHistory:Ma,rawHistory:kl,burstHistory:Mt,keypressCountHistory:Us,currentBurstStart:Cl,lastSecondNotRound:eo,missedWords:ts,accuracy:Ht,keypressTimings:ue,keyOverlap:va,wordsHistory:A.list.slice(0,T.history.length),inputHistory:T.history};try{e.keypressTimings.spacing.average=ue.spacing.array.reduce((t,a)=>a+=t)/ue.spacing.array.length,e.keypressTimings.spacing.sd=Ln(ue.spacing.array)}catch{}try{e.keypressTimings.duration.average=ue.duration.array.reduce((t,a)=>a+=t)/ue.duration.array.length,e.keypressTimings.duration.sd=Ln(ue.duration.array)}catch{}return e}function eC(){Xs=0,en=0,ou=!1,eo=!1}let nu=0,_o=0,iu=[];function ah(){nu++}function ru(e){_o+=e}function lu(e,t){iu.push({acc:e,seconds:t})}function sh(){nu=0,_o=0,iu=[]}function cc(){ou=!0}function Ti(e){return e===void 0?(en-Xs)/1e3:(e-Xs)/1e3}function cu(e){const t=Ti(Ae?performance.now():en),a=nh(),o=U((a.correctWordChars+a.correctSpaces)*(60/t)/5),n=U((a.allCorrectChars+a.spaces+a.incorrectChars+a.extraChars)*(60/t)/5);return{wpm:e?o:Math.round(o),raw:e?n:Math.round(n)}}function bf(e){en=e,eh=Date.now()}function tC(e){Xs=e,Xg=Date.now()}function du(e){let t=0;return e!==void 0&&(i.mode==="time"?t=Math.round(e)-Us.length:t=Math.ceil(e)-Us.length,t<0&&(t=0)),bi.filter(o=>o).length+t}function aC(){eo=!0}function oh(){var n,r;const e=T.getKoreanStatus(),t=(performance.now()-Cl)/1e3;let a;if(a=e?xr.disassemble(T.current).length:T.current.length,a===0&&(a=e?((r=xr.disassemble(T.getHistoryLast()))==null?void 0:r.length)??0:((n=T.getHistoryLast())==null?void 0:n.length)??0),a===0)return 0;const o=U(a*(60/t)/5);return Math.round(o)}function xi(){const e=Ht.correct/(Ht.correct+Ht.incorrect)*100;return isNaN(e)?100:e}function sC(){const e=Ti();Us.splice(e),Ma.splice(e),Mt.splice(e),kl.splice(e)}function oC(){const e=T.getKoreanStatus();let t=[...T.history];return Ae&&t.push(T.current),e&&(t=t.map(a=>xr.disassemble(a).join(""))),t}function nC(){const e=T.getKoreanStatus();let t=[...i.mode==="zen"?T.history:A.list];return Ae&&t.push(i.mode==="zen"?T.current:A.getCurrent()),e&&(t=t.map(a=>xr.disassemble(a).join(""))),t}function nh(){let e=0,t=0,a=0,o=0,n=0,r=0,l=0;const c=oC(),d=nC();for(let u=0;u<c.length;u++){const f=c[u],p=d[u];if(f===p)e+=p.length,t+=p.length,u<c.length-1&&$p(f)!==`
`&&l++;else if(f.length>=p.length)for(let g=0;g<f.length;g++)g<p.length?f[g]===p[g]?t++:a++:o++;else{const g={correct:0,incorrect:0,missed:0};for(let h=0;h<p.length;h++)h<f.length?f[h]===p[h]?g.correct++:g.incorrect++:g.missed++;t+=g.correct,a+=g.incorrect,u===c.length-1&&i.mode==="time"?g.incorrect===0&&(e+=g.correct):n+=g.missed}u<c.length-1&&r++}return V(i.funbox).find(u=>{var f;return(f=u.properties)==null?void 0:f.includes("nospace")})&&(r=0,l=0),{spaces:r,correctWordChars:e,allCorrectChars:t,incorrectChars:i.mode==="zen"?Ht.incorrect:a,extraChars:o,missedChars:n,correctSpaces:l}}function iC(){console.debug("Calculating result stats");let e=Ti();console.debug("Test seconds",e," (date based) ",(eh-Xg)/1e3," (performance.now based)"),i.mode!=="custom"&&(e=U(e),console.debug("Mode is not custom - rounding to 2. New time: ",e));const t=nh(),{wpm:a,raw:o}=cu(!0),n=U(xi()),r={wpm:isNaN(a)?0:a,wpmRaw:isNaN(o)?0:o,acc:n,correctChars:t.correctWordChars,incorrectChars:t.incorrectChars,missedChars:t.missedChars,extraChars:t.extraChars,allChars:t.allCorrectChars+t.spaces+t.incorrectChars+t.extraChars,time:U(e),spaces:t.spaces,correctSpaces:t.correctSpaces};return console.debug("Result stats",r),r}const qs="practiseWordsPopupWrapper",de={mode:null,punctuation:null,numbers:null,customText:null};function uu(e,t){if(i.mode==="zen")return!1;let a;e&&!t||!e&&t?a=20:a=10;let o=[];if(e&&(Object.keys(ts).forEach(f=>{const p=ts[f];p!==void 0&&o.push([f,p])}),o.sort((f,p)=>p[1]-f[1]),o=o.slice(0,a)),e&&!t&&o.length===0)return m("You haven't missed any words",0),!1;let n=[];if(t&&(n=A.get().map((f,p)=>[f,Mt[p]??0]),n.sort((f,p)=>f[1]-p[1]),n=n.slice(0,Math.min(a,Math.round(A.length*.2)))),o.length===0&&n.length===0)return m("Could not start a new custom test",0),!1;const r=[];o.forEach(f=>{for(let p=0;p<f[1];p++)r.push(f[0])}),n.forEach((f,p)=>{for(let g=0;g<n.length-p;g++)r.push(f[0])});const l=de.mode===null?i.mode:de.mode,c=de.punctuation===null?i.punctuation:de.punctuation,d=de.numbers===null?i.numbers:de.numbers;let u=null;return i.mode==="custom"&&(u={text:Be,isWordRandom:fe,isTimeRandom:pe,word:Re,time:Wt}),Ge("custom",!0),bt(r.join(It),!0),qa(r),Vs(!0),js(!1),Gs((n.length+o.length)*5),Qs(-1),lo("practise",void 0),de.mode=l,de.punctuation=c,de.numbers=d,de.customText=u,!0}function ih(){de.mode=null,de.punctuation=null,de.numbers=null,de.customText=null}function rC(){if(i.mode==="zen"){m("Practice words is unsupported in zen mode",0);return}at(qs,"popups"),Le(qs)||s("#practiseWordsPopupWrapper").stop(!0,!0).css("opacity",0).removeClass("hidden").animate({opacity:1},100,()=>{s(`#${qs}`).trigger("focus")})}function $i(){Le(qs)&&s("#practiseWordsPopupWrapper").stop(!0,!0).css("opacity",1).animate({opacity:0},100,()=>{s("#practiseWordsPopupWrapper").addClass("hidden"),Ve(qs)})}s("#practiseWordsPopupWrapper").on("click",e=>{s(e.target).attr("id")==="practiseWordsPopupWrapper"&&$i()});s("#practiseWordsPopupWrapper .button").on("keypress",e=>{e.key==="Enter"&&s(e.currentTarget).trigger("click")});s(document).on("keydown",e=>{e.key==="Escape"&&Le(qs)&&($i(),e.preventDefault())});s(".pageTest").on("click","#practiseWordsButton",()=>{rC()});he(e=>{e==="mode"&&ih()});st(qs);const Kr=document.querySelector("#liveWpm"),zr=document.querySelector("#miniTimerAndLiveWpm .wpm");function lC(e,t){let a=e;i.blindMode&&(a=t);const o=_.typingSpeed(a,{showDecimalPlaces:!1});zr.innerHTML=o,Kr.innerHTML=o}let Ur=!1;function fu(){i.showLiveWpm&&Ae&&(Ur||(i.timerStyle==="mini"?s(zr).stop(!0,!1).removeClass("hidden").css("opacity",0).animate({opacity:i.timerOpacity},125):s(Kr).stop(!0,!1).removeClass("hidden").css("opacity",0).animate({opacity:i.timerOpacity},125),Ur=!0))}function Pl(){Ur&&(s(Kr).stop(!0,!1).animate({opacity:0},125,()=>{Kr.classList.add("hidden")}),s(zr).stop(!0,!1).animate({opacity:0},125,()=>{zr.classList.add("hidden")}),Ur=!1)}he((e,t)=>{e==="showLiveWpm"&&(t?fu():Pl())});async function cC(e){if(!i.showLiveBurst)return;const t=_.typingSpeed(e,{showDecimalPlaces:!1});document.querySelector("#miniTimerAndLiveWpm .burst").innerHTML=t,document.querySelector("#liveBurst").innerHTML=t}let Vr=!1;function pu(){i.showLiveBurst&&Ae&&(Vr||(i.timerStyle==="mini"?s("#miniTimerAndLiveWpm .burst").stop(!0,!1).removeClass("hidden").css("opacity",0).animate({opacity:i.timerOpacity},125):s("#liveBurst").stop(!0,!1).removeClass("hidden").css("opacity",0).animate({opacity:i.timerOpacity},125),Vr=!0))}function ql(){Vr&&(s("#liveBurst").stop(!0,!1).animate({opacity:0},125,()=>{s("#liveBurst").addClass("hidden")}),s("#miniTimerAndLiveWpm .burst").stop(!0,!1).animate({opacity:0},125,()=>{s("#miniTimerAndLiveWpm .burst").addClass("hidden")}),Vr=!1)}he((e,t)=>{e==="showLiveBurst"&&(t?pu():ql())});function dC(e){let t=Math.floor(e);i.blindMode&&(t=100),document.querySelector("#miniTimerAndLiveWpm .acc").innerHTML=t+"%",document.querySelector("#liveAcc").innerHTML=t+"%"}let jr=!1;function mu(){i.showLiveAcc&&Ae&&(jr||(i.timerStyle==="mini"?s("#miniTimerAndLiveWpm .acc").stop(!0,!1).removeClass("hidden").css("opacity",0).animate({opacity:i.timerOpacity},125):s("#liveAcc").stop(!0,!1).removeClass("hidden").css("opacity",0).animate({opacity:i.timerOpacity},125),jr=!0))}function Fl(){jr&&(s("#liveAcc").stop(!0,!1).animate({opacity:0},125,()=>{s("#liveAcc").addClass("hidden")}),s("#miniTimerAndLiveWpm .acc").stop(!0,!1).animate({opacity:0},125,()=>{s("#miniTimerAndLiveWpm .acc").addClass("hidden")}),jr=!1)}he((e,t)=>{e==="showLiveAcc"&&(t?mu():Fl())});const Cf=3;let So=!1;function ys(e,t=!1){e&&!So?(So=!0,Sg(),s("header").addClass("focus"),s("footer").addClass("focus"),t||s("body").css("cursor","none"),s("main").addClass("focus"),s("#bannerCenter").addClass("focus"),s("#notificationCenter").addClass("focus"),s("#capsWarning").addClass("focus"),s("#ad-vertical-right-wrapper").addClass("focus"),s("#ad-vertical-left-wrapper").addClass("focus"),s("#ad-footer-wrapper").addClass("focus"),s("#ad-footer-small-wrapper").addClass("focus"),fu(),pu(),mu()):!e&&So&&(So=!1,Tg(),s("header").removeClass("focus"),s("footer").removeClass("focus"),s("body").css("cursor","default"),s("main").removeClass("focus"),s("#bannerCenter").removeClass("focus"),s("#notificationCenter").removeClass("focus"),s("#capsWarning").removeClass("focus"),s("#app").removeClass("focus"),s("#ad-vertical-right-wrapper").removeClass("focus"),s("#ad-vertical-left-wrapper").removeClass("focus"),s("#ad-footer-wrapper").removeClass("focus"),s("#ad-footer-small-wrapper").removeClass("focus"),Pl(),ql(),Fl())}s(document).on("mousemove",function(e){So&&ne()!=="loading"&&(ne()==="account"&&So||e.originalEvent&&(e.originalEvent.movementX>Cf||e.originalEvent.movementY>Cf)&&ys(!1))});let Ka=null,yr=null;function uC(){s("#typingTest #memoryTimer").stop(!0,!0).animate({opacity:1},125)}function rh(){s("#typingTest #memoryTimer").stop(!0,!0).animate({opacity:0},125)}function No(){yr!==null&&(clearInterval(yr),yr=null),Ka=null,rh()}function fC(){No(),Ka=Math.round(Math.pow(A.length,1.2)),kf(Ka),uC(),yr=setInterval(()=>{Ka!==null&&(Ka-=1,Ka===0?rh():kf(Ka),Ka<=0&&(No(),s("#wordsWrapper").addClass("hidden")))},1e3)}function kf(e){s("#typingTest #memoryTimer").text(`Timer left to memorise all words: ${e}s`)}let Io={};function tt(e,t,a){Io[e]??(Io[e]={value:t,setFunction:a})}function lh(){Object.keys(Io).forEach(e=>{const t=Io[e];t.setFunction(t.value,!0)}),Io={}}const ch=[];function pC(e){ch.push(e)}async function mC(e){ch.forEach(t=>{try{t(e)}catch(a){console.error("TTS event subscriber threw an error"),console.error(a)}})}const gu=[];function gC(e){gu.push(e)}async function dh(e,t){gu.forEach(a=>{try{a("flash",e,t)}catch(o){console.error("Keymap flash event subscriber threw an error"),console.error(o)}})}async function Sa(e){gu.forEach(t=>{try{t("highlight",e)}catch(a){console.error("Keymap highlight event subscriber threw an error"),console.error(a)}})}const hC=50,yC=20,vC=5e3,En={};class wC{constructor(){this.average=0,this.count=0}update(t){this.count<hC&&this.count++;const a=1/this.count;this.average=t*a+this.average*(1-a)}}function bC(e,t){var n;const a=ue.spacing.array;if(a.length===0||typeof a=="string")return;let o=a[a.length-1];t||(o+=vC),e in En||(En[e]=new wC),(n=En[e])==null||n.update(o)}function CC(e){let t=0,a=0;for(const o of e)o in En&&(t+=En[o].average,a++);return a===0?0:t/a}function kC(e){let t,a="";for(let o=0;o<yC;o++){const n=e.randomWord("normal"),r=CC(n);(o===0||t===void 0||r>t)&&(a=n,t=r)}return a}const SC=["—","_"," "],TC=100,xC="https://poetrydb.org/random";class $C extends Ap{constructor(t,a,o){super(t,a,o),this.title=t,this.author=a,this.words=o,this.cleanUpText()}cleanUpText(){let t=0;const a=[];for(const o of this.words){let n="";for(const r of o)SC.includes(r)||(n+=r);if(n!==""&&(a.push(n),t++,t===TC))break}this.words=a}}async function AC(){console.log("Getting poem");try{const t=(await vd.get(xC)).data[0],a=[];return t.lines.forEach(o=>{o.split(/ +/).forEach(n=>{a.push(n)})}),new $C(t.title,t.author,a)}catch(e){return console.log(e),!1}}async function MC(e){switch(e.name){case"english":return"en";case"spanish":return"es";case"french":return"fr";case"german":return"de";case"portuguese":return"pt";case"arabic":return"ar";case"italian":return"it";case"latin":return"la";case"afrikaans":return"af";case"korean":return"ko";case"russian":return"ru";case"polish":return"pl";case"czech":return"cs";case"slovak":return"sk";case"ukrainian":return"uk";case"lithuanian":return"lt";case"indonesian":return"id";case"greek":return"el";case"turkish":return"tr";case"thai":return"th";case"tamil":return"ta";case"slovenian":return"sl";case"croatian":return"hr";case"dutch":return"nl";case"danish":return"da";case"hungarian":return"hu";case"norwegian_bokmal":return"no";case"norwegian_nynorsk":return"nn";case"hebrew":return"he";case"malay":return"ms";case"romanian":return"ro";case"finnish":return"fi";case"estonian":return"et";case"welsh":return"cy";case"persian":return"fa";case"kazakh":return"kk";case"vietnamese":return"vi";case"swedish":return"sv";case"serbian":return"sr";case"georgian":return"ka";case"catalan":return"ca";case"bulgarian":return"bg";case"esperanto":return"eo";case"bangla":return"bn";case"urdu":return"ur";case"armenian":return"hy";case"myanmar":return"my";case"hindi":return"hi";case"macedonian":return"mk";case"uzbek":return"uz";case"belarusian":return"be";case"azerbaijani":return"az";case"latvian":return"lv";case"euskera":return"eu";default:return"en"}}async function LC(e){oe();let t="en",a;try{a=await xv(e)}catch(c){console.error(ee(c,"Failed to find current language group"))}a!==void 0&&(t=await MC(a));const o=`https://${t}.wikipedia.org/api/rest_v1/page/random/summary`,n={title:"",author:""},r=await fetch(o);let l=0;if(r.status===200){const c=await r.json();n.title=c.title,n.author=c.author,l=c.pageid}return new Promise((c,d)=>{r.status!==200&&(Q(),d(r.status));const u=`https://${t}.wikipedia.org/w/api.php?action=query&format=json&pageids=${l}&prop=extracts&exintro=true&origin=*`,f=new XMLHttpRequest;f.onload=()=>{if(f.readyState===4)if(f.status===200){let p=JSON.parse(f.responseText).query.pages[l.toString()].extract;p=p.replace(/<\/p><p>+/g," "),p=$v(p),p=p.replace(/\[\d+\]/gi,""),p=p.replace(/[\u200B-\u200D\uFEFF]/g,""),p=Mp(p),t==="en"&&(p=p.replace(/[^\x20-\x7E]+/g,"")),p=p.replace(/\s+/g," "),p=p.trim();const g=p.split(" "),h=new Ap(n.title,n.author,g);Q(),c(h)}else Q(),d(f.status)},f.open("GET",u),f.send()})}function uh(e,t,a,o,n){const r=[],l=Math.round(e/t);for(let c=0;c<t;c++){let u=Ns(0,2**l-1).toString(a);if(o){const f=Math.ceil(l/Math.ceil(Math.log2(a)));u="0".repeat(Math.max(0,f-u.length))+u}r.push(u)}return r.join(n)}function Sf(e,t,a,o,n,r){const l=n.split(o).map(u=>parseInt(u,a)),c=Math.round(e/t);let d=r;for(let u=0;u<t;u++)d-=c,d<0&&(-d<=c?l[u]&=2**c-1^2**-d-1:l[u]=0);return l.map(u=>u.toString(a)).join(o)+"/"+r.toString()}function WC(){return uh(32,4,10,!1,".")}function IC(){return uh(128,8,16,!0,":")}function fh(e){return e.includes(":")?Sf(128,8,16,":",e,Ns(16,32)*4):Sf(32,4,10,".",e,Ns(8,32))}let tr=null;class hu{constructor(t){this.words=t,this.length=this.words.length}randomWord(t){return t==="zipf"?this.words[Av(this.words.length)]:xa(this.words)}}async function ph(e){var a;const t=V(i.funbox).find(o=>{var n;return(n=o.functions)==null?void 0:n.withWords});return(a=t==null?void 0:t.functions)!=null&&a.withWords?t.functions.withWords(e):((tr===null||e!==tr.words)&&(tr=new hu(e)),tr)}function mh(){s("#typingTest #layoutfluidTimer").stop(!0,!0).animate({opacity:1},125)}function Bn(){s("#typingTest #layoutfluidTimer").stop(!0,!0).animate({opacity:0},125)}function dc(e,t){s("#typingTest #layoutfluidTimer").text(`${Do(t)} in: ${e}s`)}function EC(e,t){const a=Do(t.replace(/_/g," "));let o=`${a} in: ${e} words`;e===1&&(o=`${a} starting next word`),s("#typingTest #layoutfluidTimer").text(o)}const Tf=2;class BC{constructor(){this.chars={},this.count=0}addChar(t){this.count++,t in this.chars?this.chars[t]++:this.chars[t]=1}randomChar(){const t=Ns(0,this.count-1);let a=0;for(const[o,n]of Object.entries(this.chars))if(a+=n,a>t)return o;return Object.keys(this.chars)[0]}}class PC extends hu{constructor(t){super(t),this.ngrams={},this.length=1/0;for(let a of t){a+=" ";let o="";for(const n of a)o in this.ngrams||(this.ngrams[o]=new BC),this.ngrams[o].addChar(n),o=(o+n).slice(-Tf)}}randomWord(){let t="";for(;;){const a=t.slice(-Tf),o=this.ngrams[a];if(!o){t="";continue}const n=o.randomChar();if(n===" ")break;t+=n}return t}}me("simon_says",{applyConfig(){Gt("next",!0)},rememberSettings(){tt("keymapMode",i.keymapMode,Gt)}});me("tts",{applyConfig(){Gt("off",!0)},rememberSettings(){tt("keymapMode",i.keymapMode,Gt)},toggleScript(e){if(window.speechSynthesis===void 0){m("Failed to load text-to-speech script",-1);return}e[0]!==void 0&&mC(e[0])}});me("arrows",{getWord(e,t){return Mv(t===0)},rememberSettings(){tt("highlightMode",i.highlightMode,gs)},handleChar(e){return e==="a"||e==="ArrowLeft"||e==="j"?"←":e==="s"||e==="ArrowDown"||e==="k"?"↓":e==="w"||e==="ArrowUp"||e==="i"?"↑":e==="d"||e==="ArrowRight"||e==="l"?"→":e},isCharCorrect(e,t){return(e==="a"||e==="ArrowLeft"||e==="j")&&t==="←"||(e==="s"||e==="ArrowDown"||e==="k")&&t==="↓"||(e==="w"||e==="ArrowUp"||e==="i")&&t==="↑"||(e==="d"||e==="ArrowRight"||e==="l")&&t==="→"},async preventDefaultEvent(e){return["ArrowLeft","ArrowUp","ArrowRight","ArrowDown"].includes(e.key)},getWordHtml(e,t){let a="";return e==="↑"&&(t&&(a+="<letter>"),a+='<i class="fas fa-arrow-up"></i>',t&&(a+="</letter>")),e==="↓"&&(t&&(a+="<letter>"),a+='<i class="fas fa-arrow-down"></i>',t&&(a+="</letter>")),e==="←"&&(t&&(a+="<letter>"),a+='<i class="fas fa-arrow-left"></i>',t&&(a+="</letter>")),e==="→"&&(t&&(a+="<letter>"),a+='<i class="fas fa-arrow-right"></i>',t&&(a+="</letter>")),a}});me("rAnDoMcAsE",{alterText(e){let t=e[0];for(let a=1;a<e.length;a++)t[a-1]===t[a-1].toUpperCase()?t+=e[a].toLowerCase():t+=e[a].toUpperCase();return t}});me("backwards",{alterText(e){return e.split("").reverse().join("")}});me("capitals",{alterText(e){return pi(e)}});me("layoutfluid",{applyConfig(){const e=i.customLayoutfluid.split("#")[0]??"qwerty";Es(e,!0),Is(e,!0)},rememberSettings(){tt("keymapMode",i.keymapMode,Gt),tt("layout",i.layout,Es),tt("keymapLayout",i.keymapLayout,Is)},handleSpace(){if(i.mode!=="time"){const e=i.customLayoutfluid?i.customLayoutfluid.split("#"):["qwerty","dvorak","colemak"],t=A.length,a=Math.floor(t/e.length),o=Math.floor((T.history.length+1)/a),n=a-(A.currentIndex+1)%a;e[o]?(n<=3&&e[o+1]?(mh(),EC(n,e[o+1])):Bn(),n===a&&(Es(e[o]),Is(e[o]),n>3&&Bn())):Bn(),setTimeout(()=>{Sa(A.getCurrent().charAt(T.current.length).toString())},1)}},getResultContent(){return i.customLayoutfluid.replace(/#/g," ")},restart(){this.applyConfig&&this.applyConfig(),setTimeout(()=>{Sa(A.getCurrent().substring(T.current.length,T.current.length+1).toString())},1)}});me("gibberish",{getWord(){return Lv()}});me("58008",{getWord(){let e=Lp(7);return i.language.startsWith("kurdish")?e=Wp(e):i.language.startsWith("nepali")&&(e=Ip(e)),e},punctuateWord(e){if(e.length>3&&(Math.random()<.5&&(e=Yu(e,Ns(1,e.length-2),".")),Math.random()<.75)){const t=Ns(1,e.length-2);if(e[t-1]!=="."&&e[t+1]!=="."&&e[t+1]!=="0"){const a=xa(["/","*","-","+"]);e=Yu(e,t,a)}}return e},rememberSettings(){tt("numbers",i.numbers,zt)},handleChar(e){return e===`
`?" ":e}});me("ascii",{getWord(){return Wv()},punctuateWord(e){return e}});me("specials",{getWord(){return Iv()}});me("read_ahead_easy",{rememberSettings(){tt("highlightMode",i.highlightMode,gs)}});me("read_ahead",{rememberSettings(){tt("highlightMode",i.highlightMode,gs)}});me("read_ahead_hard",{rememberSettings(){tt("highlightMode",i.highlightMode,gs)}});me("memory",{applyConfig(){s("#wordsWrapper").addClass("hidden"),_n(!0,!0),i.keymapMode==="next"&&Gt("react",!0)},rememberSettings(){tt("mode",i.mode,Ge),tt("showAllLines",i.showAllLines,_n),i.keymapMode==="next"&&tt("keymapMode",i.keymapMode,Gt)},start(){No(),s("#wordsWrapper").addClass("hidden")},restart(){fC(),i.keymapMode==="next"&&Gt("react")}});me("nospace",{rememberSettings(){tt("highlightMode",i.highlightMode,gs)}});me("poetry",{async pullSection(){return AC()}});me("wikipedia",{async pullSection(e){return LC((e??"")||"english")}});me("weakspot",{getWord(e){return e!==void 0?kC(e):""}});me("pseudolang",{async withWords(e){return e!==void 0?new PC(e):new hu([])}});me("IPv4",{getWord(){return WC()},punctuateWord(e){let t=e;return Math.random()<.25&&(t=fh(e)),t},rememberSettings(){tt("numbers",i.numbers,zt)}});me("IPv6",{getWord(){return IC()},punctuateWord(e){let t=e;return Math.random()<.25&&(t=fh(e)),t.includes(":")&&(t=t.replace(/\b(?:0+:){2,}/,"::").split(":").map(a=>a.replace(/\b0+/g,"")).join(":")),t},rememberSettings(){tt("numbers",i.numbers,zt)}});me("binary",{getWord(){return Ev()}});me("zipf",{getWordsFrequencyMode(){return"zipf"}});me("ddoouubblleedd",{alterText(e){return e.replace(/./gu,"$&$&")}});function Zn(...e){V(i.funbox).forEach(t=>{var a;(a=t.functions)!=null&&a.toggleScript&&t.functions.toggleScript(e)})}function qC(e){return e==="none"&&V(i.funbox).forEach(t=>{var a,o;return(o=(a=t.functions)==null?void 0:a.clearGlobal)==null?void 0:o.call(a)}),lh(),ka(e,!1),!0}function gh(e){if(e==="none"&&qC("none"),!Ld(i.funbox,e)&&!i.funbox.split("#").includes(e))return m(`${Do(e.replace(/_/g," "))} funbox is not compatible with the current funbox selection`,0),!0;lh();const t=Wd(e,!1);return i.funbox.includes(e)?V(e).forEach(a=>{var o,n;return(n=(o=a.functions)==null?void 0:o.applyGlobalCSS)==null?void 0:n.call(o)}):V(e).forEach(a=>{var o,n;return(n=(o=a.functions)==null?void 0:o.clearGlobal)==null?void 0:n.call(o)}),!(t===!1||t===!0)}async function To(){var e,t,a,o;return s("body").attr("class",((o=(a=(t=(e=s("body"))==null?void 0:e.attr("class"))==null?void 0:t.split(/\s+/))==null?void 0:a.filter(n=>!n.startsWith("fb-")))==null?void 0:o.join(" "))??""),s("#funBoxTheme").removeAttr("href"),s("#wordsWrapper").removeClass("hidden"),No(),ie(),!0}async function Dl(e){if(e==null?e=i.funbox:i.funbox!==e&&(i.funbox=e),!Ld(i.funbox))return m(ee(void 0,`Failed to activate funbox: funboxes ${i.funbox.replace(/_/g," ")} are not compatible`),-1),ka("none",!0),await To(),!1;No(),await DC(),await RC(),s("#wordsWrapper").removeClass("hidden");let t;try{t=await Ea(i.language)}catch(o){return m(ee(o,"Failed to activate funbox"),-1),ka("none",!0),await To(),!1}if(t.ligatures&&V(i.funbox).find(o=>{var n;return(n=o.properties)==null?void 0:n.includes("noLigatures")})){m("Current language does not support this funbox mode",0),ka("none",!0),await To();return}let a=!0;for(const[o,n]of Object.entries(i)){const r=Ec(o,n,i.funbox);if(!r.result&&!r.result)if(r.forcedConfigs&&r.forcedConfigs.length>0)o==="mode"&&Ge(r.forcedConfigs[0]),o==="words"&&ns(r.forcedConfigs[0]),o==="time"&&ia(r.forcedConfigs[0]),o==="punctuation"&&ua(r.forcedConfigs[0]),o==="numbers"&&zt(r.forcedConfigs[0]),o==="highlightMode"&&gs(r.forcedConfigs[0]);else{a=!1;break}}if(!a){i.funbox.includes("#")?m(`Failed to activate funboxes ${i.funbox}: no intersecting forced configs. Disabling funbox`,-1):m(`Failed to activate funbox ${i.funbox}: no forced configs. Disabling funbox`,-1),ka("none",!0),await To();return}return ie(),V(i.funbox).forEach(async o=>{var n,r;(r=(n=o.functions)==null?void 0:n.applyConfig)==null||r.call(n)}),!0}async function FC(){V(i.funbox).forEach(async e=>{var t;(t=e.functions)!=null&&t.rememberSettings&&e.functions.rememberSettings()})}me("morse",{alterText(e){return Bv(e)}});me("crt",{applyGlobalCSS(){if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent)){const t=navigator.userAgent.match(/.*Version\/([0-9]*)\.([0-9]*).*/),a=t!==null?parseInt(t[1]??"0"):0,o=t!==null?parseInt(t[2]??"0"):0;if(a<=16&&o<=5){m("CRT is not available on Safari 16.5 or earlier.",0,{duration:5}),gh("crt");return}}s("body").append('<div id="scanline" />'),s("body").addClass("crtmode"),s("#globalFunBoxTheme").attr("href","funbox/crt.css")},clearGlobal(){s("#scanline").remove(),s("body").removeClass("crtmode"),s("#globalFunBoxTheme").attr("href","")}});async function DC(){var o,n;const e=s("body"),t=V(i.funbox).map(r=>"fb-"+r.name.replaceAll("_","-")),a=((n=(o=e==null?void 0:e.attr("class"))==null?void 0:o.split(/\s+/))==null?void 0:n.filter(r=>!r.startsWith("fb-")))??[];return e.attr("class",[...a,...t].join(" ")),!0}async function RC(){const e=s("#funBoxTheme"),t=V(i.funbox).find(n=>n.hasCSS==!0),a=t!=null?"funbox/"+t.name+".css":"",o=(e.attr("href")??"")||null;return a!=o&&e.attr("href",a),!0}const OC={keymapShowTopRow:!0,type:"matrix",keys:{row1:[],row2:["sS","tT","pP","hH","**","fF","pP","lL","tT","dD"],row3:["sS","kK","wW","rR","**","rR","bB","gG","sS","zZ"],row4:["aA","oO","eE","uU"],row5:[]}};function HC(e){if(i.mode!=="zen"){e===""&&(e=" ");try{s(".activeKey").removeClass("activeKey");let t;i.language.startsWith("korean")&&(e=Ue.disassemble(e)[0]??e),e===" "?t="#keymap .keySpace, #keymap .keySplitSpace":e==='"'?t=`#keymap .keymapKey[data-key*='${e}']`:t=`#keymap .keymapKey[data-key*="${e}"]`,s(t).addClass("activeKey")}catch(t){t instanceof Error&&console.log("could not update highlighted keymap key: "+t.message)}}}async function _C(e,t){if(e===void 0)return;e===" "?e="#keymap .keySpace, #keymap .keySplitSpace":e==='"'?e=`#keymap .keymapKey[data-key*='${e}']`:e=`#keymap .keymapKey[data-key*="${e}"]`;const a=await ms();try{let o={color:a.bg,backgroundColor:a.sub,borderColor:a.sub};t||i.blindMode?o={color:a.bg,backgroundColor:a.main,borderColor:a.main}:o={color:a.bg,backgroundColor:a.error,borderColor:a.error},s(e).stop(!0,!0).css(o).animate({color:a.sub,backgroundColor:a.subAlt,borderColor:a.sub},Ce()?0:500,"easeOutExpo")}catch{}}function NC(){s("#keymap").addClass("hidden")}function KC(){s("#keymap").removeClass("hidden")}async function Qr(e=i.layout){if(i.keymapMode!=="off"&&ne()==="test"&&e)try{let t;try{t=await fl()}catch(u){m(ee(u,"Failed to refresh keymap"),-1);return}let a=t[e],o=e;i.keymapLayout==="overrideSync"?i.layout==="default"?(a=t.qwerty,o="default"):(a=t[i.layout],o=i.layout):(a=t[i.keymapLayout],o=i.keymapLayout);const n=_d&&i.keymapMode==="next"||i.keymapShowTopRow==="always"||a.keymapShowTopRow&&i.keymapShowTopRow!=="never",r=i.keymapStyle==="matrix"||i.keymapStyle==="split_matrix",l=i.keymapStyle==="steno"||i.keymapStyle==="steno_matrix";if(l&&(a=OC),a===void 0)throw new Error("Failed to refresh keymap: layout not found");let c="";const d=Object.keys(a.keys);for(let u=0;u<d.length;u++){const f=d[u];let p=a.keys[f];f==="row1"&&(r||i.keymapStyle==="staggered")&&(p=p.slice(1));let g="";if(!(f==="row1"&&(!n||l))){if((f==="row2"||f==="row3"||f==="row4")&&!r&&!l&&(g+="<div></div>"),f==="row4"&&a.type!=="iso"&&!r&&!l&&(g+="<div></div>"),r&&(f!=="row5"&&a.matrixShowRightColumn?g+='<div class="keymapKey"></div>':g+="<div></div>"),f==="row5"){if(l)continue;const h=o.replace(/_/g," ");let y="";i.keymapLegendStyle==="blank"&&(y='style="display: none;"'),g+="<div></div>",g+=`<div class="keymapKey keySpace">
          <div class="letter" ${y}>${h}</div>
        </div>`,g+='<div class="keymapSplitSpacer"></div>',g+=`<div class="keymapKey keySplitSpace">
          <div class="letter"></div>
        </div>`}else for(let h=0;h<p.length;h++){if(f==="row2"&&h===12)continue;let y=10;if(a.matrixShowRightColumn&&(y=11),(i.keymapStyle==="matrix"||i.keymapStyle==="split_matrix")&&h>=y)continue;const w=p[h],k=f==="row3"&&(h===3||h===6);let L=w[0],x="";i.keymapLegendStyle==="blank"?x='style="display: none;"':i.keymapLegendStyle==="uppercase"&&(L=L.toUpperCase());let B="";f==="row1"&&h===0&&!r&&i.keymapStyle!=="staggered"&&(B=" invisible");const D=`<div class="keymapKey${B}" data-key="${w.replace('"',"&quot;")}">
              <span class="letter" ${x}>${L}</span>
              ${k?"<div class='bump'></div>":""}
          </div>`;let v="";(i.keymapStyle==="split"||i.keymapStyle==="split_matrix"||i.keymapStyle==="alice"||l)&&(f==="row4"&&l&&(h===0||h===2||h===4)?v+='<div class="keymapSplitSpacer"></div>':f==="row4"&&(i.keymapStyle==="split"||i.keymapStyle==="alice")&&a.type==="iso"?h===6&&(v+='<div class="keymapSplitSpacer"></div>'):f==="row1"&&(i.keymapStyle==="split"||i.keymapStyle==="alice")?h===7&&(v+='<div class="keymapSplitSpacer"></div>'):h===5&&(v+='<div class="keymapSplitSpacer"></div>')),i.keymapStyle==="alice"&&f==="row4"&&(a.type==="iso"&&h===6||a.type!=="iso"&&h===5)&&(v+='<div class="extraKey"><span class="letter"></span></div>'),g+=v+D}c+=`<div class="row r${u+1}">${g}</div>`}}s("#keymap").html(c),s("#keymap").removeClass("staggered"),s("#keymap").removeClass("matrix"),s("#keymap").removeClass("split"),s("#keymap").removeClass("split_matrix"),s("#keymap").removeClass("alice"),s("#keymap").removeClass("steno"),s("#keymap").removeClass("steno_matrix"),s("#keymap").addClass(i.keymapStyle)}catch(t){t instanceof Error&&console.log("something went wrong when changing layout, resettings: "+t.message)}}he((e,t)=>{e==="layout"&&i.keymapLayout==="overrideSync"&&Qr(i.keymapLayout),(e==="keymapLayout"||e==="keymapStyle"||e==="keymapShowTopRow"||e==="keymapMode")&&Qr(),e==="keymapMode"&&(t==="off"?NC():KC())});gC((e,t,a)=>{e==="highlight"&&HC(t),e==="flash"&&_C(t,a)});Nt.register(aw,sw,ow,nw,iw,rw,lw,cw,dw,uw,fw,pw,mw,gw);Nt.defaults.animation.duration=0;Nt.defaults.elements.line.tension=.3;Nt.defaults.elements.line.fill="origin";class tn extends Nt{constructor(t,a){super(t,a)}async updateColors(){await UC(this)}getDataset(t){var a;return(a=this.data.datasets)==null?void 0:a.find(o=>o.yAxisID===t)}getScale(t){return this.options.scales[t]}}let xf;const be=new tn(document.querySelector("#wpmChart"),{type:"line",data:{labels:[],datasets:[{clip:!1,label:"wpm",data:[],borderColor:"rgba(125, 125, 125, 1)",borderWidth:3,yAxisID:"wpm",order:2,pointRadius:1},{clip:!1,label:"raw",data:[],borderColor:"rgba(125, 125, 125, 1)",borderWidth:3,yAxisID:"raw",order:3,pointRadius:1},{clip:!1,label:"errors",data:[],borderColor:"rgba(255, 125, 125, 1)",pointBackgroundColor:"rgba(255, 125, 125, 1)",borderWidth:2,order:1,yAxisID:"error",type:"scatter",pointStyle:"crossRot",pointRadius:function(e){const t=e.dataIndex;return(e.dataset.data[t]??0)<=0?0:3},pointHoverRadius:function(e){const t=e.dataIndex;return(e.dataset.data[t]??0)<=0?0:5}}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{axis:"x",ticks:{autoSkip:!0,autoSkipPadding:20},display:!0,title:{display:!1,text:"Seconds"}},wpm:{axis:"y",display:!0,title:{display:!0,text:"Words per Minute"},beginAtZero:!0,min:0,ticks:{autoSkip:!0,autoSkipPadding:20},grid:{display:!0}},raw:{axis:"y",display:!1,title:{display:!0,text:"Raw Words per Minute"},beginAtZero:!0,min:0,ticks:{autoSkip:!0,autoSkipPadding:20},grid:{display:!1}},error:{axis:"y",display:!0,position:"right",title:{display:!0,text:"Errors"},beginAtZero:!0,ticks:{precision:0,autoSkip:!0,autoSkipPadding:20},grid:{display:!1}}},plugins:{annotation:{annotations:[]},tooltip:{animation:{duration:250},mode:"index",intersect:!1,callbacks:{afterLabel:function(e){var t;if(xf===e)return"";xf=e;try{const a=Math.round(parseFloat(e.label))-1,o=(t=wi[a])==null?void 0:t.words,n=[...new Set(o)],r=n[0],l=n[n.length-1];if(r===void 0||l===void 0)return"";S0(r,l)}catch{}return""}}}}}});let hh;const H=new tn(document.querySelector(".pageAccount #accountHistoryChart"),{type:"line",data:{datasets:[{yAxisID:"wpm",data:[],fill:!1,borderWidth:0,order:3},{yAxisID:"pb",data:[],fill:!1,stepped:!0,pointRadius:0,pointHoverRadius:0,order:4},{yAxisID:"acc",fill:!1,data:[],pointStyle:"triangle",borderWidth:0,pointRadius:3.5,order:3},{yAxisID:"wpmAvgTen",data:[],fill:!1,pointRadius:0,pointHoverRadius:0,order:2},{yAxisID:"accAvgTen",data:[],fill:!1,pointRadius:0,pointHoverRadius:0,order:2},{yAxisID:"wpmAvgHundred",data:[],fill:!1,pointRadius:0,pointHoverRadius:0,order:1},{yAxisID:"accAvgHundred",label:"accAvgHundred",data:[],fill:!1,pointRadius:0,pointHoverRadius:0,order:1}]},options:{maintainAspectRatio:!1,hover:{mode:"nearest",intersect:!1},scales:{x:{axis:"x",type:"linear",reverse:!0,min:0,ticks:{stepSize:10},display:!1,grid:{display:!1}},wpm:{axis:"y",type:"linear",beginAtZero:!0,min:0,ticks:{stepSize:10},display:!0,title:{display:!0,text:"Words per Minute"},position:"right"},pb:{axis:"y",beginAtZero:!0,min:0,ticks:{stepSize:10},display:!1},acc:{axis:"y",beginAtZero:!0,min:0,max:100,reverse:!0,ticks:{stepSize:10},display:!0,title:{display:!0,text:"Accuracy"},grid:{display:!1},position:"left"},wpmAvgTen:{axis:"y",beginAtZero:!0,min:0,ticks:{stepSize:10},display:!1,grid:{display:!1}},accAvgTen:{axis:"y",beginAtZero:!0,min:0,max:100,reverse:!0,ticks:{stepSize:10},display:!1,grid:{display:!1}},wpmAvgHundred:{axis:"y",beginAtZero:!0,min:0,ticks:{stepSize:10},display:!1,grid:{display:!1}},accAvgHundred:{axis:"y",beginAtZero:!0,min:0,max:100,reverse:!0,ticks:{stepSize:10},display:!1,grid:{display:!1}}},plugins:{annotation:{annotations:[]},tooltip:{animation:{duration:250},enabled:!0,intersect:!1,external:function(e){e!==void 0&&(e.tooltip.options.displayColors=!1)},filter:function(e){return e.datasetIndex!==1&&e.datasetIndex!==3&&e.datasetIndex!==4&&e.datasetIndex!==5&&e.datasetIndex!==6},callbacks:{title:function(){return""},beforeLabel:function(e){if(e.datasetIndex!==0){const n=e.dataset.data[e.dataIndex];return`error rate: ${U(n.errorRate)}%
acc: ${U(100-n.errorRate)}%`}const t=e.dataset.data[e.dataIndex];let a=`${i.typingSpeedUnit}: ${t.wpm}
raw: ${t.raw}
acc: ${t.acc}

mode: ${t.mode} `;(t.mode==="time"||t.mode==="words")&&(a+=t.mode2);let o=t.difficulty;return o===void 0&&(o="normal"),a+=`
difficulty: ${o}`,a+=`
punctuation: ${t.punctuation}
language: ${t.language}${t.isPb?`

new personal best`:""}

date: ${_e(new Date(t.timestamp),"dd MMM yyyy HH:mm")}`,a},label:function(){return""},afterLabel:function(e){return hh=e.dataIndex,""}}}}}}),ja=new tn(document.querySelector(".pageAccount #accountActivityChart"),{type:"bar",data:{labels:[],datasets:[{yAxisID:"count",label:"Seconds",data:[],trendlineLinear:{style:"rgba(255,105,180, .8)",lineStyle:"dotted",width:2},order:3},{yAxisID:"avgWpm",label:"Average Wpm",data:[],type:"line",order:2,tension:0,fill:!1}]},options:{responsive:!0,maintainAspectRatio:!1,hover:{mode:"nearest",intersect:!1},scales:{x:{axis:"x",ticks:{autoSkip:!0,autoSkipPadding:20},type:"time",time:{unit:"day",displayFormats:{day:"d MMM"}},bounds:"ticks",display:!0,title:{display:!1,text:"Date"},offset:!0},count:{axis:"y",beginAtZero:!0,min:0,ticks:{autoSkip:!0,autoSkipPadding:20,stepSize:1},display:!0,title:{display:!0,text:"Time typing (minutes)"}},avgWpm:{axis:"y",beginAtZero:!0,min:0,ticks:{autoSkip:!0,autoSkipPadding:20,stepSize:10},display:!0,position:"right",title:{display:!0,text:"Average Wpm"},grid:{display:!1}}},plugins:{annotation:{annotations:[]},tooltip:{animation:{duration:250},intersect:!1,mode:"index",callbacks:{title:function(e){const t=e[0],a=t.dataset.data[t.dataIndex];return _e(new Date(a.x),"dd MMM yyyy")},beforeLabel:function(e){const t=e.dataset.data[e.dataIndex];switch(e.datasetIndex){case 0:return`Time Typing: ${dt(Math.round(t.y*60),!0,!0)}
Tests Completed: ${t.amount}`;case 1:return`Average ${i.typingSpeedUnit}: ${U(t.y)}`;default:return""}},label:function(){return""}}}}}}),Eo=new tn(document.querySelector(".pageAccount #accountHistogramChart"),{type:"bar",data:{labels:[],datasets:[{yAxisID:"count",label:"Tests",data:[]}]},options:{responsive:!0,maintainAspectRatio:!1,hover:{mode:"nearest",intersect:!1},scales:{x:{axis:"x",bounds:"ticks",display:!0,title:{display:!1,text:"Bucket"},offset:!0},count:{axis:"y",beginAtZero:!0,min:0,ticks:{autoSkip:!0,autoSkipPadding:20,stepSize:10},display:!0,title:{display:!0,text:"Tests"}}},plugins:{annotation:{annotations:[]},tooltip:{animation:{duration:250},intersect:!1,mode:"index"}}}}),Bo=new tn(document.querySelector(".pageAbout #publicStatsHistogramChart"),{type:"bar",data:{labels:[],datasets:[{yAxisID:"count",label:"Users",data:[]}]},options:{responsive:!0,maintainAspectRatio:!1,hover:{mode:"nearest",intersect:!1},scales:{x:{axis:"x",bounds:"ticks",display:!0,title:{display:!1,text:"Bucket"},offset:!0},count:{axis:"y",beginAtZero:!0,min:0,ticks:{autoSkip:!0,autoSkipPadding:20,stepSize:10},display:!0,title:{display:!0,text:"Users"}}},plugins:{annotation:{annotations:[]},tooltip:{animation:{duration:250},intersect:!1,mode:"index"}}}}),qt=new tn(document.querySelector(".pageAccount #miniResultChart"),{type:"line",data:{labels:[],datasets:[{label:"wpm",data:[],borderColor:"rgba(125, 125, 125, 1)",borderWidth:2,yAxisID:"wpm",order:2,pointRadius:2},{label:"raw",data:[],borderColor:"rgba(125, 125, 125, 1)",borderWidth:2,yAxisID:"raw",order:3,pointRadius:2},{label:"errors",data:[],borderColor:"rgba(255, 125, 125, 1)",pointBackgroundColor:"rgba(255, 125, 125, 1)",borderWidth:2,order:1,yAxisID:"error",type:"scatter",pointStyle:"crossRot",pointRadius:function(e){const t=e.dataIndex;return(e.dataset.data[t]??0)<=0?0:3},pointHoverRadius:function(e){const t=e.dataIndex;return(e.dataset.data[t]??0)<=0?0:5}}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{axis:"x",ticks:{autoSkip:!0,autoSkipPadding:20},display:!0,title:{display:!1,text:"Seconds"}},wpm:{axis:"y",display:!0,title:{display:!0,text:"Words per Minute"},beginAtZero:!0,min:0,ticks:{autoSkip:!0,autoSkipPadding:20},grid:{display:!0}},raw:{axis:"y",display:!1,title:{display:!0,text:"Raw Words per Minute"},beginAtZero:!0,min:0,ticks:{autoSkip:!0,autoSkipPadding:20},grid:{display:!1}},error:{display:!0,position:"right",title:{display:!0,text:"Errors"},beginAtZero:!0,ticks:{precision:0,autoSkip:!0,autoSkipPadding:20},grid:{display:!1}}},plugins:{annotation:{annotations:[]},tooltip:{animation:{duration:250},mode:"index",intersect:!1}}}});function zC(){yh(!1),vh(!1),wh(!1),bh(!1)}function Rl(e,t){e?s(`.pageAccount ${t}`).addClass("active"):s(`.pageAccount ${t}`).removeClass("active")}function yh(e=!0){const t=i.accountChart[0]==="on";Rl(t,".toggleResultsOnChart"),H.getDataset("wpm").hidden=!t,H.getDataset("pb").hidden=!t,H.getDataset("wpmAvgTen").hidden=!t,H.getDataset("wpmAvgHundred").hidden=!t,H.getScale("wpm").display=t,e&&H.updateColors()}function vh(e=!0){const t=i.accountChart[0]==="on",a=i.accountChart[1]==="on";if(Rl(a,".toggleAccuracyOnChart"),H.getDataset("acc").hidden=!a,H.getDataset("accAvgTen").hidden=!a,H.getDataset("accAvgHundred").hidden=!a,H.getScale("acc").display=a,t)H.getScale("acc").min=0,H.getScale("accAvgTen").min=0,H.getScale("accAvgHundred").min=0;else{const o=Math.floor(Math.min(...H.getDataset("acc").data.map(n=>n.y))/10)*10;H.getScale("acc").min=o,H.getScale("accAvgTen").min=o,H.getScale("accAvgHundred").min=o}e&&H.updateColors()}function wh(e=!0){const t=i.accountChart[0]==="on",a=i.accountChart[1]==="on",o=i.accountChart[2]==="on";Rl(o,".toggleAverage10OnChart"),a&&(H.getDataset("accAvgTen").hidden=!o),t&&(H.getDataset("wpmAvgTen").hidden=!o),e&&H.updateColors()}function bh(e=!0){const t=i.accountChart[0]==="on",a=i.accountChart[1]==="on",o=i.accountChart[3]==="on";Rl(o,".toggleAverage100OnChart"),a&&(H.getDataset("accAvgHundred").hidden=!o),t&&(H.getDataset("wpmAvgHundred").hidden=!o),e&&H.updateColors()}async function UC(e){var g,h;const t=await Dt("bg"),a=await Dt("sub"),o=await Dt("subAlt"),n=await Dt("main"),r=await Dt("error"),l=await Dt("text"),c=Vt(t,o,.75);e.data.datasets[0].borderColor=y=>{var L;return((L=y.raw)==null?void 0:L.isPb)?l:n},e.data.datasets[1]&&(e.data.datasets[1].borderColor=a),e.data.datasets[2]&&(e.data.datasets[2].borderColor=r);const d=e.data.datasets[0];((h=(g=e==null?void 0:e.data)==null?void 0:g.datasets[0])==null?void 0:h.type)===void 0?e.config.type==="line"?d.pointBackgroundColor=y=>{var L;return((L=y.raw)==null?void 0:L.isPb)?l:n}:e.config.type==="bar"&&(d.backgroundColor=n):e.data.datasets[0].type==="bar"?e.data.datasets[0].backgroundColor=n:e.data.datasets[0].type==="line"&&(d.pointBackgroundColor=n);const u=e.data.datasets[1];u!==void 0&&(u.type===void 0?e.config.type==="line"?u.pointBackgroundColor=a:e.config.type==="bar"&&(u.backgroundColor=a):(u==null?void 0:u.type)==="bar"?u.backgroundColor=a:u.type==="line"&&(u.pointBackgroundColor=a)),e.data.datasets.length===2&&(u.borderColor=()=>a);const f=e.data.datasets[2];if(e.data.datasets.length===7){f.borderColor=()=>a;const y=i.accountChart[2]==="on",w=i.accountChart[3]==="on",k=Vt(t,l,.2),L=Vt(t,n,.2),x=Vt(t,n,.4),B=Vt(t,a,.2),D=Vt(t,a,.4),[v,C,q,G,ze,Fe,Ie]=e.data.datasets;if(v===void 0||C===void 0||q===void 0||G===void 0||ze===void 0||Fe===void 0||Ie===void 0)return;y&&w?(v.pointBackgroundColor=L,C.borderColor=k,q.pointBackgroundColor=B,G.borderColor=x,ze.borderColor=D,Fe.borderColor=n,Ie.borderColor=a):y&&!w||!y&&w?(C.borderColor=k,v.pointBackgroundColor=x,q.pointBackgroundColor=D,G.borderColor=n,Fe.borderColor=n,ze.borderColor=a,Ie.borderColor=a):(C.borderColor=k,v.pointBackgroundColor=n,q.pointBackgroundColor=a)}const p=e.options;Object.keys(p.scales).forEach(y=>{const w=p.scales[y];w.ticks.color=a,w.title.color=a,w.grid.color=c,w.grid.tickColor=c,w.grid.borderColor=c});try{d.trendlineLinear.style=a}catch{}e.options.plugins.annotation.annotations.forEach(y=>{y.id!=="funbox-label"&&(y.borderColor=a),y.label.backgroundColor=a,y.label.color=t}),e.update("none")}function VC(e){Nt.defaults.font.family=e.replace(/_/g," ")}function Ch(){yi(),H.updateColors(),Eo.updateColors(),Bo.updateColors(),be.updateColors(),ja.updateColors(),qt.updateColors()}he((e,t)=>{e==="accountChart"&&ne()==="account"&&(yh(),vh(),wh(),bh()),e==="fontFamily"&&VC(t)});const ge={blur:{value:0,default:0},brightness:{value:1,default:1},saturate:{value:1,default:1},opacity:{value:1,default:1}};function jC(){let e="";return Object.keys(ge).forEach(t=>{const a=t;ge[a].value!==ge[a].default&&(e+=`${t}(${ge[a].value}${t==="blur"?"rem":""}) `)}),e}function an(){const t={filter:jC(),width:`calc(100% + ${ge.blur.value*4}rem)`,height:`calc(100% + ${ge.blur.value*4}rem)`,left:`-${ge.blur.value*2}rem`,top:`-${ge.blur.value*2}rem`,position:"absolute"};s(".customBackground img").css(t)}function QC(){s(".section[data-config-name='customBackgroundFilter'] .blur input").val(ge.blur.value),s(".section[data-config-name='customBackgroundFilter'] .brightness input").val(ge.brightness.value),s(".section[data-config-name='customBackgroundFilter'] .saturate input").val(ge.saturate.value),s(".section[data-config-name='customBackgroundFilter'] .opacity input").val(ge.opacity.value)}function Ai(){s(".section[data-config-name='customBackgroundFilter'] .blur .value").html(ge.blur.value.toFixed(1)),s(".section[data-config-name='customBackgroundFilter'] .brightness .value").html(ge.brightness.value.toFixed(1)),s(".section[data-config-name='customBackgroundFilter'] .saturate .value").html(ge.saturate.value.toFixed(1)),s(".section[data-config-name='customBackgroundFilter'] .opacity .value").html(ge.opacity.value.toFixed(1))}function kh(){QC(),Ai()}function GC(e){ge.blur.value=e[0],ge.brightness.value=e[1],ge.saturate.value=e[2],ge.opacity.value=e[3],kh()}s(".section[data-config-name='customBackgroundFilter'] .blur input").on("input",()=>{ge.blur.value=parseFloat(s(".section[data-config-name='customBackgroundFilter'] .blur input").val()),Ai(),an()});s(".section[data-config-name='customBackgroundFilter'] .brightness input").on("input",()=>{ge.brightness.value=parseFloat(s(".section[data-config-name='customBackgroundFilter'] .brightness input").val()),Ai(),an()});s(".section[data-config-name='customBackgroundFilter'] .saturate input").on("input",()=>{ge.saturate.value=parseFloat(s(".section[data-config-name='customBackgroundFilter'] .saturate input").val()),Ai(),an()});s(".section[data-config-name='customBackgroundFilter'] .opacity input").on("input",()=>{ge.opacity.value=parseFloat(s(".section[data-config-name='customBackgroundFilter'] .opacity input").val()),Ai(),an()});s(".section[data-config-name='customBackgroundFilter'] input").on("input",()=>{YC()});const YC=Et(2e3,async()=>{const e=Object.keys(ge).map(t=>ge[t].value);Od(e,!1)});he((e,t)=>{e==="customBackgroundFilter"&&t&&(GC(t),an())});let xt=null,Kc=!1,vo=0;const Da=["--bg-color","--main-color","--caret-color","--sub-color","--sub-alt-color","--text-color","--error-color","--error-extra-color","--colorful-error-color","--colorful-error-extra-color"];async function JC(){setTimeout(async()=>{let e,t;t=await Dt("bg"),e=await Dt("main"),t===e&&(t="#111",e="#eee");const a=`
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
  <style>
    #bg{fill:${t};}
    path{fill:${e};}
  </style>
  <g>
    <path id="bg" d="M0 16Q0 0 16 0h32q16 0 16 16v32q0 16-16 16H16Q0 64 0 48"/>
    <path d="M9.09 24.1v21.2h5.12V33.1q.256-4.61 4.48-4.61 3.46.384 3.46 3.84v12.9h5.12v-11.5q-.128-5.25 4.48-5.25 3.46.384 3.46 3.84v12.9h5.12v-12.2q0-9.47-7.04-9.47-4.22 0-7.04 3.46-2.18-3.46-6.02-3.46-3.46 0-6.02 2.43v-2.05M47 18.9v5.12h-4.61v5.12H47v16.1h5.12v-16.1h4.61v-5.12h-4.61V18.9"/>
  </g>
</svg>`;s("#favicon").attr("href","data:image/svg+xml;base64,"+btoa(a))},125)}function ZC(){console.debug("Theme controller clearing custom theme");for(const e of Da)document.documentElement.style.setProperty(e,"")}let yn=[];async function Sh(e){return new Promise(t=>{function a(){console.debug("Theme controller swapping elements");const r=s("#currentTheme"),l=s("#nextTheme");if(l.length===0){console.debug("Theme controller failed to swap elements, next is missing");return}r.remove(),l.attr("id","currentTheme")}console.debug("Theme controller loading style",e),yn.push(setTimeout(()=>{oe()},100)),s("#nextTheme").remove();const o=document.querySelector("#currentTheme"),n=document.createElement("link");n.type="text/css",n.rel="stylesheet",n.id="nextTheme",n.onload=()=>{console.debug("Theme controller loaded style",e),Q(),a(),yn.map(r=>clearTimeout(r)),yn=[],s("#keymap .keymapKey").stop(!0,!0).removeAttr("style"),t()},n.onerror=r=>{console.debug("Theme controller failed to load style",e,r),console.error(`Failed to load theme ${e}`,r),Q(),m("Failed to load theme",0),a(),yn.map(l=>clearTimeout(l)),yn=[],s("#keymap .keymapKey").stop(!0,!0).removeAttr("style"),t()},e==="custom"?n.href="/themes/serika_dark.css":n.href=`/themes/${e}.css`,o===null?(console.debug("Theme controller appending link to the head",n),document.head.appendChild(n)):(console.debug("Theme controller inserting link after current theme",n),o.after(n))})}async function Ko(e,t,a=!1){console.debug("Theme controller applying theme",e,t,a),ZC();const o=t?"custom":e;if(kb(),s(".keymapKey").attr("style",""),await Sh(o),yi(),i.customTheme&&!a||t){const r=t??i.customThemeColors;for(let l=0;l<Da.length;l++){const c=Da[l];document.documentElement.style.setProperty(c,r[l])}}Pa("changedTheme",{theme:o});const n=await ms();s(".keymapKey").attr("style",""),Ch(),JC(),s("#metaThemeColor").attr("content",n.bg),XC(a?e:void 0)}function XC(e){let t=i.theme;i.customTheme&&(t="custom"),e!==void 0&&e!==""&&(t=e),t=t.replace(/_/g," "),s(".current-theme .text").text(t)}function Th(e,t){ek(e,t)}const ek=Et(250,(e,t)=>{Kc=!0,Ko(e,t,!0)});async function nt(e,t=!1){console.debug("Theme controller setting theme",e,t),await Ko(e,void 0,t),!t&&i.autoSwitchTheme&&(Gm(!1),m("Auto switch theme disabled",0))}async function $f(e=!0){Kc&&(Kc=!1,xt=null,e&&(i.customTheme?await Ko("custom"):await Ko(i.theme)))}let Ot=[];async function xh(){var t,a;let e;try{e=await Ep()}catch(o){console.error(ee(o,"Failed to update random theme list"));return}i.randomTheme==="fav"&&i.favThemes.length>0?Ot=i.favThemes:i.randomTheme==="light"?Ot=e.filter(o=>Pv(o.bgColor)).map(o=>o.name):i.randomTheme==="dark"?Ot=e.filter(o=>qv(o.bgColor)).map(o=>o.name):i.randomTheme==="on"?Ot=e.map(o=>o.name):i.randomTheme==="custom"&&S()&&(Ot=((a=(t=S())==null?void 0:t.customThemes)==null?void 0:a.map(o=>o._id))??[]),Tr(Ot),vo=0}async function tk(){var t,a,o,n,r;if(Ot.length===0&&(await xh(),Ot.length===0))return;xt=Ot[vo],vo++,vo>=Ot.length&&(Tr(Ot),vo=0);let e;if(i.randomTheme==="custom"){const l=(a=(t=S())==null?void 0:t.customThemes)==null?void 0:a.find(c=>c._id===xt);e=l==null?void 0:l.colors,xt="custom"}if(Th(xt,e),vo>=Ot.length){let l=xt.replace(/_/g," ");i.randomTheme==="custom"&&(l=(((r=(n=(o=S())==null?void 0:o.customThemes)==null?void 0:n.find(c=>c._id===xt))==null?void 0:r.name)??"custom").replace(/_/g," ")),m(l,0)}}async function ak(){xt!==null&&(xt=null,i.customTheme?await Ko("custom"):await Ko(i.theme))}function $h(){i.customBackgroundSize==="max"?s(".customBackground img").css({objectFit:""}):s(".customBackground img").css({objectFit:i.customBackgroundSize})}function sk(){i.customBackground===""?(s("#words").removeClass("noErrorBorder"),s("#resultWordsHistory").removeClass("noErrorBorder"),s(".customBackground img").remove()):(s("#words").addClass("noErrorBorder"),s("#resultWordsHistory").addClass("noErrorBorder"),s(".customBackground").html(`<img src="${i.customBackground}" alt="" />`),an(),$h())}var fp,pr,pp;(pp=(pr=(fp=window.matchMedia)==null?void 0:fp.call(window,"(prefers-color-scheme: dark)"))==null?void 0:pr.addEventListener)==null||pp.call(pr,"change",e=>{!i.autoSwitchTheme||i.customTheme||(e.matches?nt(i.themeDark,!0):nt(i.themeLight,!0))});he(async(e,t,a)=>{var o,n,r;e==="randomTheme"&&xh(),e==="customTheme"&&(t?await nt("custom"):await nt(i.theme)),e==="customThemeColors"&&(a?Th("custom"):await nt("custom")),e==="theme"&&(await $f(!1),await nt(t)),e==="setThemes"&&(await $f(!1),i.autoSwitchTheme?(o=window.matchMedia)!=null&&o.call(window,"(prefers-color-scheme: dark)").matches?await nt(i.themeDark,!0):await nt(i.themeLight,!0):t?await nt("custom"):await nt(i.theme)),e==="randomTheme"&&t==="off"&&await ak(),e==="customBackground"&&sk(),e==="customBackgroundSize"&&$h(),e==="autoSwitchTheme"&&(t?(n=window.matchMedia)!=null&&n.call(window,"(prefers-color-scheme: dark)").matches?await nt(i.themeDark,!0):await nt(i.themeLight,!0):await nt(i.theme)),e==="themeLight"&&i.autoSwitchTheme&&!((r=window.matchMedia)!=null&&r.call(window,"(prefers-color-scheme: dark)").matches)&&!a&&await nt(i.themeLight,!0),e==="themeDark"&&i.autoSwitchTheme&&window.matchMedia!==void 0&&window.matchMedia("(prefers-color-scheme: dark)").matches&&!a&&await nt(i.themeDark,!0)});let N=null,zc=0;function ok(e){(!zs||zs&&e>zc)&&(zc=e)}async function nk(){var r;if(i.paceCaret==="off"&&!zs||(s("#paceCaret").hasClass("hidden")||s("#paceCaret").addClass("hidden"),i.mode==="zen"))return;const e=s("#paceCaret"),t=(r=document==null?void 0:document.querySelector("#words .word"))==null?void 0:r.querySelector("letter"),a=s(t).height();if(t===void 0||a===void 0)return;const n=(await Ea(i.language)).rightToLeft;e.stop(!0,!0).animate({top:t.offsetTop-a/4,left:t.offsetLeft+(n?t.offsetWidth:0)},0,"linear")}async function Uc(){s("#paceCaret").addClass("hidden");const e=ml(i,se);let t;if(i.paceCaret==="pb"?t=await xd(i.mode,e,i.punctuation,i.numbers,i.language,i.difficulty,i.lazyMode,i.funbox):i.paceCaret==="average"?([t]=await Gp(i.mode,e,i.punctuation,i.numbers,i.language,i.difficulty,i.lazyMode),t=Math.round(t)):i.paceCaret==="daily"?(t=await mb(i.mode,e,i.punctuation,i.numbers,i.language,i.difficulty,i.lazyMode),t=Math.round(t)):i.paceCaret==="custom"?t=i.paceCaretCustomSpeed:(i.paceCaret==="last"||zs)&&(t=zc),t===void 0||t<1||Number.isNaN(t)){N=null;return}const a=t*5,o=a/60,n=60/a;N={wpm:t,cps:o,spc:n,correction:0,currentWordIndex:0,currentLetterIndex:-1,wordsStatus:{},timeout:null},await nk()}async function Ah(e){if(!(N===null||!Ae||qe)){try{if(N.currentLetterIndex++,N.currentLetterIndex>=A.get(N.currentWordIndex).length&&(N.currentLetterIndex=-1,N.currentWordIndex++),!i.blindMode){if(N.correction<0)for(;N.correction<0;)N.currentLetterIndex--,N.currentLetterIndex<=-2&&(N.currentLetterIndex=A.get(N.currentWordIndex-1).length-1,N.currentWordIndex--),N.correction++;else if(N.correction>0)for(;N.correction>0;)N.currentLetterIndex++,N.currentLetterIndex>=A.get(N.currentWordIndex).length&&(N.currentLetterIndex=-1,N.currentWordIndex++),N.correction--}}catch{N=null,s("#paceCaret").addClass("hidden");return}try{const t=s("#paceCaret");let a,o,n;try{const l=N.currentWordIndex-(A.currentIndex-Oe),c=document.querySelectorAll("#words .word")[l];N.currentLetterIndex===-1?a=c.querySelectorAll("letter")[0]:a=c.querySelectorAll("letter")[N.currentLetterIndex];const d=s(a).height(),u=s(a).width(),f=t.width();if(d===void 0||u===void 0||f===void 0)throw new Error("Undefined current letter height, width or caret width.");const g=(await Ea(i.language)).rightToLeft;o=c.offsetTop+a.offsetTop-i.fontSize*ss(1)*.1,N.currentLetterIndex===-1?n=c.offsetLeft+a.offsetLeft-f/2+(g?u:0):n=c.offsetLeft+a.offsetLeft-f/2+(g?0:u),t.removeClass("hidden")}catch{t.addClass("hidden")}const r=e-performance.now();if(o!==void 0){let l=s("#words .smoothScroller").height();l===void 0&&(l=0),s("#paceCaret").css({top:o-l}),i.smoothCaret!=="off"?t.stop(!0,!0).animate({left:n},Ce()?0:r,"linear"):t.stop(!0,!0).animate({left:n},0,"linear")}N.timeout=setTimeout(()=>{Ah(e+((N==null?void 0:N.spc)??0)*1e3).catch(()=>{N=null})},r)}catch(t){console.error(t),s("#paceCaret").addClass("hidden")}}}function ik(){(N==null?void 0:N.timeout)!=null&&clearTimeout(N.timeout),N=null}function Af(e,t){e?N!==null&&N.wordsStatus[A.currentIndex]===!0&&!i.blindMode&&(N.wordsStatus[A.currentIndex]=void 0,N.correction-=t.length+1):N!==null&&N.wordsStatus[A.currentIndex]===void 0&&!i.blindMode&&(N.wordsStatus[A.currentIndex]=!0,N.correction+=t.length+1)}function rk(){Ah(performance.now()+((N==null?void 0:N.spc)??0)*1e3)}he(e=>{e==="paceCaret"&&Uc()});let yu=0;function Xn(){return yu}function lk(e){yu=e}function ck(){yu++}function vu(){const e=i.showTimerProgress?parseFloat(i.timerOpacity):0;i.mode!=="zen"&&i.timerStyle==="bar"?s("#timerWrapper").stop(!0,!0).removeClass("hidden").animate({opacity:e},125):i.timerStyle==="text"?s("#timerNumber").stop(!0,!0).removeClass("hidden").css("opacity",0).animate({opacity:e},125):(i.mode==="zen"||i.timerStyle==="mini")&&e>0&&s("#miniTimerAndLiveWpm .time").stop(!0,!0).removeClass("hidden").animate({opacity:e},125)}function Ol(){s("#timerWrapper").stop(!0,!0).animate({opacity:0},125),s("#miniTimerAndLiveWpm .time").stop(!0,!0).animate({opacity:0},125,()=>{s("#miniTimerAndLiveWpm .time").addClass("hidden")}),s("#timerNumber").stop(!0,!0).animate({opacity:0},125)}function dk(){i.timerStyle==="bar"&&(i.mode==="time"?s("#timer").stop(!0,!0).animate({width:"100vw"},0):(i.mode==="words"||i.mode==="custom")&&s("#timer").stop(!0,!0).animate({width:"0vw"},0))}const _a=document.querySelector("#timerNumber"),Na=document.querySelector("#miniTimerAndLiveWpm .time");function Mf(){return i.mode==="custom"&&He?A.sectionIndexList[A.currentIndex]-1:T.history.length}function Mi(){var t;const e=Xn();if(i.mode==="time"||i.mode==="custom"&&pe){let a=i.time;if(i.mode==="custom"&&pe&&(a=Wt),i.timerStyle==="bar"){const o=100-(e+1)/a*100;s("#timer").stop(!0,!0).animate({width:o+"vw"},Ce()?0:1e3,"linear")}else if(i.timerStyle==="text"){let o=dt(a-e);a===0&&(o=dt(e)),_a!==null&&(_a.innerHTML="<div>"+o+"</div>")}else if(i.timerStyle==="mini"){let o=dt(a-e);a===0&&(o=dt(e)),Na!==null&&(Na.innerHTML=o)}}else if(i.mode==="words"||i.mode==="custom"||i.mode==="quote"){let a=A.length;if(i.mode==="words"&&(a=i.words),i.mode==="custom"&&(fe?a=Re:He?a=is:a=Be.length),i.mode==="quote"&&(a=((t=se==null?void 0:se.textSplit)==null?void 0:t.length)??1),i.timerStyle==="bar"){const o=Math.floor((A.currentIndex+1)/a*100);s("#timer").stop(!0,!0).animate({width:o+"vw"},Ce()?0:250)}else i.timerStyle==="text"?a===0?_a!==null&&(_a.innerHTML=`<div>${T.history.length}</div>`):_a!==null&&(_a.innerHTML=`<div>${Mf()}/${a}</div>`):i.timerStyle==="mini"&&(a===0?Na!==null&&(Na.innerHTML=`${T.history.length}`):Na!==null&&(Na.innerHTML=`${Mf()}/${a}`))}else i.mode==="zen"&&(i.timerStyle==="text"?_a!==null&&(_a.innerHTML=`<div>${T.history.length}</div>`):Na!==null&&(Na.innerHTML=`${T.history.length}`))}function uk(){Ae&&(Ol(),Mi(),setTimeout(()=>{vu()},125))}he((e,t)=>{e==="showTimerProgress"&&(t===!0&&Ae?vu():Ol()),e==="timerStyle"&&uk()});he(e=>{e==="monkey"&&Ae&&(i.monkey?s("#monkey").removeClass("hidden"):s("#monkey").addClass("hidden"))});let ei=!1,ti=!1;const uc={"00":document.querySelector("#monkey .up"),"01":document.querySelector("#monkey .right"),10:document.querySelector("#monkey .left"),11:document.querySelector("#monkey .both")},fc={"00":document.querySelector("#monkey .fast .up"),"01":document.querySelector("#monkey .fast .right"),10:document.querySelector("#monkey .fast .left"),11:document.querySelector("#monkey .fast .both")};let pc="right";function Lf(e){return e?"1":"0"}function Mh(){var e,t,a;if(i.monkey&&!((e=document.querySelector("#monkey"))!=null&&e.classList.contains("hidden"))){Object.keys(uc).forEach(n=>{var r;(r=uc[n])==null||r.classList.add("hidden")}),Object.keys(fc).forEach(n=>{var r;(r=fc[n])==null||r.classList.add("hidden")});const o=`${Lf(ei)}${Lf(ti)}`;(t=uc[o])==null||t.classList.remove("hidden"),(a=fc[o])==null||a.classList.remove("hidden")}}function fk(e){if(!i.monkey)return;const t=Sr(e,130,180,0,1);s("#monkey .fast").animate({opacity:t},1e3);let a=Sr(e,130,180,.25,.01);a===.25&&(a=0),s("#monkey").css({animationDuration:a+"s"})}function pk(){i.monkey&&(!ei&&pc==="right"?(ei=!0,pc="left"):ti||(ti=!0,pc="right"),Mh())}function mk(){i.monkey&&(ei?ei=!1:ti&&(ti=!1),Mh())}function gk(){i.monkey&&s("#monkey").css("opacity",0).removeClass("hidden").animate({opacity:1},125)}function Lh(){s("#monkey").css("opacity",1).animate({opacity:1},125,()=>{s("#monkey").addClass("hidden"),s("#monkey .fast").stop(!0,!0).css("opacity",0),s("#monkey").stop(!0,!0).css({animationDuration:"0s"})})}const Wh=[];function hk(e){Wh.push(e)}function Gr(e,t,a){Wh.forEach(o=>{try{o(e,t,a)}catch(n){console.error("Timer event subscriber threw an error"),console.error(n)}})}let Ms=0,Qt=null;const ar=1e3;let sr=0,$e=!1;function yk(){$e=!0}function wu(){lk(0),Qt!==null&&clearTimeout(Qt)}function vk(){$e&&console.time("premid");const e=document.querySelector("#premidSecondsLeft");e!==null&&(e.innerHTML=(i.time-Xn()).toString()),$e&&console.timeEnd("premid")}function wk(){$e&&console.time("timer progress update"),(i.mode==="time"||i.mode==="custom"&&pe)&&Mi(),$e&&console.timeEnd("timer progress update")}function bk(){$e&&console.time("calculate wpm and raw");const e=cu();return $e&&console.timeEnd("calculate wpm and raw"),$e&&console.time("update live wpm"),lC(e.wpm,e.raw),$e&&console.timeEnd("update live wpm"),$e&&console.time("push to history"),hg(e.wpm),yg(e.raw),$e&&console.timeEnd("push to history"),e}function Ck(e){$e&&console.time("update monkey");const t=i.blindMode?e.raw:e.wpm;fk(t),$e&&console.timeEnd("update monkey")}function kk(){$e&&console.time("calculate acc");const e=U(xi());return $e&&console.timeEnd("calculate acc"),e}function Sk(){if($e&&console.time("layoutfluid"),i.funbox.split("#").includes("layoutfluid")&&i.mode==="time"){const e=i.customLayoutfluid?i.customLayoutfluid.split("#"):["qwerty","dvorak","colemak"],t=i.time/e.length,a=Xn(),o=Math.floor(a/t),n=e[o],r=[];for(let l=1;l<e.length;l++)r.push(Math.floor(t*l));r.includes(a+3)?(mh(),dc(3,e[o+1])):r.includes(a+2)?dc(2,e[o+1]):r.includes(a+1)&&dc(1,e[o+1]),i.layout!==n&&n!==void 0&&(Bn(),Es(n,!0),Is(n,!0))}$e&&console.timeEnd("layoutfluid")}function Tk(e,t){if($e&&console.time("fail conditions"),Sl(),xl(),Tl(),i.minWpm==="custom"&&e.wpm<i.minWpmCustomSpeed&&A.currentIndex>3){Qt!==null&&clearTimeout(Qt),Hn(),Ms=0,Gr("fail","min speed");return}if(i.minAcc==="custom"&&t<i.minAccCustom){Qt!==null&&clearTimeout(Qt),Hn(),Ms=0,Gr("fail","min accuracy");return}$e&&console.timeEnd("fail conditions")}function xk(){if($e&&console.time("times up check"),(i.mode==="time"||i.mode==="custom"&&pe)&&(Xn()>=i.time&&i.time!==0&&i.mode==="time"||Xn()>=Wt&&Wt!==0&&i.mode==="custom")){Qt!==null&&clearTimeout(Qt),Ci(),T.pushHistory(),Ne.pushHistory(),Hn(),Ms=0,Gr("finish");return}$e&&console.timeEnd("times up check")}let Vc=[];function $k(){return Vc}async function Ak(){$e&&console.time("timer step -----------------------------"),ck(),vk(),wk();const e=bk(),t=kk();Ck(e),Sk(),Tk(e,t),xk(),$e&&console.timeEnd("timer step -----------------------------")}async function Mk(){Hn(),Ms=0,Vc=[],sr=Xs+ar,function e(){const t=sr-performance.now();Vc.push({dateNow:Date.now(),now:performance.now(),expected:sr,nextDelay:t}),(i.mode==="time"&&i.time<130&&i.time>0||i.mode==="words"&&i.words<250&&i.words>0)&&(t<ar/2&&Sb(),t<ar/10&&(Ms++,Ms>5&&(m('This could be caused by "efficiency mode" on Microsoft Edge.'),m("Stopping the test due to bad performance. This would cause test calculations to be incorrect. If this happens a lot, please report this.",-1),Gr("fail","slow timer")))),Qt=setTimeout(function(){if(!Ae){Qt!==null&&clearTimeout(Qt),Hn(),Ms=0;return}Ak(),sr+=ar,e()},t)}()}let ai=0,bu=!1,Ih;function Lk(e){if(bu&&new Date().getDate()>Ih){ai=e;return}ai+=e}function Wk(){return dt(Math.round(ai),!0,!0)+(bu?" today":" session")}function Ik(){const e=new Date;e.setSeconds(0),e.setMinutes(0),e.setHours(0),e.setMilliseconds(0),Ih=e.getDate();const t=e.getTime();ai=0;const a=S();if(!a)return;const o=a.results;o==null||o.forEach(n=>{const r=new Date(n.timestamp);r.setSeconds(0),r.setMinutes(0),r.setHours(0),r.setMilliseconds(0),r.getTime()>=t&&(ai+=n.testDuration+n.incompleteTestSeconds-n.afkDuration)}),bu=!0}let jc=!1;function Eh(){mt&&!jc&&!Ct&&(m("Challenge cleared",0),jp(null))}function Ek(e){var t,a,o;try{if(mt){const n=e.afkDuration/e.testDuration*100;if(n>10)return m("Challenge failed: AFK time is greater than 10%",0),null;if(mt.requirements===void 0)return m(`${mt.display} challenge passed!`,1),mt.name;{let r=!0;const l=[];for(const c in mt.requirements){if(!r)return null;const d=mt.requirements[c];if(d===void 0)throw new Error("Requirement value is undefined");if(c==="wpm"){const u=Object.keys(d)[0];u==="exact"?Math.round(e.wpm)!==d.exact&&(r=!1,l.push(`WPM not ${d.exact}`)):u==="min"&&e.wpm<Number(d.min)&&(r=!1,l.push(`WPM below ${d.min}`))}else if(c==="acc"){const u=Object.keys(d)[0];u==="exact"?e.acc!==d.exact&&(r=!1,l.push(`Accuracy not ${d.exact}`)):u==="min"&&e.acc<Number(d.min)&&(r=!1,l.push(`Accuracy below ${d.min}`))}else if(c==="afk")Object.keys(d)[0]==="max"&&Math.round(n)>Number(d.max)&&(r=!1,l.push(`AFK percentage above ${d.max}`));else if(c==="time")Object.keys(d)[0]==="min"&&Math.round(e.testDuration)<Number(d.min)&&(r=!1,l.push(`Test time below ${d.min}`));else if(c==="funbox"){const u=(t=d.exact)==null?void 0:t.toString().split("#").sort().join("#");if(u===void 0)throw new Error("Funbox mode is undefined");if(u!==e.funbox){r=!1;for(const p of u.split("#"))((a=e.funbox)==null?void 0:a.split("#").find(g=>g===p))===void 0&&l.push(`${p} funbox not active`);const f=(o=e.funbox)==null?void 0:o.split("#");if(f!==void 0&&f.length>0)for(const p of f)u.split("#").find(g=>g===p)===void 0&&l.push(`${p} funbox active`)}}else if(c==="raw")Object.keys(d)[0]==="exact"&&Math.round(e.rawWpm)!==d.exact&&(r=!1,l.push(`Raw WPM not ${d.exact}`));else if(c==="con")Object.keys(d)[0]==="exact"&&Math.round(e.consistency)!==d.exact&&(r=!1,l.push(`Consistency not ${d.exact}`));else if(c==="config")for(const u in d){const f=d[u];i[u]!==f&&(r=!1,l.push(`${u} not set to ${f}`))}}return r?(mt.autoRole&&m("You will receive a role shortly. Please don't post a screenshot in challenge submissions.",1,{duration:5}),m(`${mt.display} challenge passed!`,1),mt.name):(m(`${mt.display} challenge failed: ${l.join(", ")}`,0),null)}}else return null}catch(n){return console.error(n),m(`Something went wrong when verifying challenge: ${n.message}`,0),null}}async function lA(e){jc=!0,ka("none");let t;try{t=await Fv()}catch(n){const r=ee(n,"Failed to setup challenge");return m(r,-1),ie(),setTimeout(()=>{s("header .config").removeClass("hidden"),s(".page.pageTest").removeClass("hidden")},250),!1}const a=t.filter(n=>n.name===e)[0];let o;try{if(a===void 0)return m("Challenge not found",0),ie(),setTimeout(()=>{s("header .config").removeClass("hidden"),s(".page.pageTest").removeClass("hidden")},250),!1;if(a.type==="customTime")ia(a.parameters[0],!0),Ge("time",!0),ta("normal",!0),a.name==="englishMaster"&&(Oo("english_10k",!0),zt(!0,!0),ua(!0,!0));else if(a.type==="customWords")ns(a.parameters[0],!0),Ge("words",!0),ta("normal",!0);else if(a.type==="customText")Qn(" "),bt(a.parameters[0],!0),qa(a.parameters[0].split(" ")),js(!1),Er(!1),Vs(a.parameters[1]),Gs(a.parameters[2]),Qs(-1),Ge("custom",!0),ta("normal",!0);else if(a.type==="script"){oe();const n=await fetch("/challenges/"+a.parameters[0]);if(Q(),n.status!==200)throw new Error(`${n.status} ${n.statusText}`);let l=(await n.text()).trim();l=l.replace(/[\n\r\t ]/gm," "),l=l.replace(/ +/gm," "),Qn(" "),bt(l,!0),qa(l.split(" ")),Vs(!1),Er(!1),js(!1),Qs(-1),Gs(-1),Ge("custom",!0),ta("normal",!0),a.parameters[1]!==null&&Ym(a.parameters[1]),a.parameters[2]!==null&&Dl(a.parameters[2])}else a.type==="accuracy"?(ia(0,!0),Ge("time",!0),ta("master",!0)):a.type==="funbox"?(ka(a.parameters[0],!0),ta("normal",!0),a.parameters[1]==="words"?ns(a.parameters[2],!0):a.parameters[1]==="time"&&ia(a.parameters[2],!0),Ge(a.parameters[1],!0),a.parameters[3]!==void 0&&ta(a.parameters[3],!0)):a.type==="special"&&a.name==="semimak"&&(Ge("time",!0),ia(120,!0),Oo("english_10k",!0),ua(!0,!0),Id("word",!0),Es("semimak",!0),Is("overrideSync",!0),Gt("static",!0));return ie(),o=a.message,s("header .config").removeClass("hidden"),s(".page.pageTest").removeClass("hidden"),o===void 0?m(`Challenge '${a.display}' loaded.`,0):m("Challenge loaded. "+o,0),jp(a),jc=!1,!0}catch(n){return m(ee(n,"Failed to load challenge"),-1),!1}}he(e=>{["difficulty","numbers","punctuation","mode","funbox","paceCaret","showAllLines","showLiveWpm","highlightMode","time","words","keymapMode","keymapLayout","layout"].includes(e)&&Eh()});let Ut=0,ae=null,ye=null;function Bk(){ae=null}function Pk(){s("#quoteRateModal .quote .text").text("-"),s("#quoteRateModal .quote .source .val").text("-"),s("#quoteRateModal .quote .id .val").text("-"),s("#quoteRateModal .quote .length .val").text("-"),s("#quoteRateModal .ratingCount .val").text("-"),s("#quoteRateModal .ratingAverage .val").text("-")}function Bh(e){return!e.totalRating||!e.ratings?0:Math.round(e.totalRating/e.ratings*10)/10}async function Ph(e){if(!e)return;ye=e;const t=await E.quotes.getRating(ye);if(Q(),t.status!==200){m("Failed to get quote ratings: "+t.message,-1);return}return t.data===null?{}:(ae=t.data,ae!==void 0&&!ae.average&&(ae.average=Bh(ae)),ae)}function vr(e){const t=e||Ut;s("#quoteRateModal .star").removeClass("active");for(let a=1;a<=t;a++)s(`#quoteRateModal .star[data-rating=${a}]`).addClass("active")}async function qk(){var e;ae||await Ph(),s("#quoteRateModal .ratingCount .val").text((ae==null?void 0:ae.ratings)??"0"),s("#quoteRateModal .ratingAverage .val").text(((e=ae==null?void 0:ae.average)==null?void 0:e.toFixed(1))??"-")}function Fk(){if(!ye)return;let e;ye.group===0?e="short":ye.group===1?e="medium":ye.group===2?e="long":ye.group===3&&(e="thicc"),s("#quoteRateModal .quote .text").text(ye.text),s("#quoteRateModal .quote .source .val").text(ye.source),s("#quoteRateModal .quote .id .val").text(ye.id),s("#quoteRateModal .quote .length .val").text(e),qk()}function Dk(e,t){qh.show({...t,beforeAnimation:async()=>{var n,r;Pk(),ye=e,Ut=0;const a=S(),o=(r=(n=a==null?void 0:a.quoteRatings)==null?void 0:n[ye.language])==null?void 0:r[ye.id];o&&(Ut=o),vr(),Fk()}})}function Rk(e=!1){qh.hide({clearModalChain:e})}async function Ok(){var n,r;if(Ut===0)return m("Please select a rating");if(!ye)return;Rk(!0);const e=await E.quotes.addRating(ye,Ut);if(Q(),e.status!==200)return m("Failed to submit quote rating: "+e.message,-1);const t=S();if(!t)return;const a=t.quoteRatings??{},o=(a==null?void 0:a[ye.language])??{};if(o!=null&&o[ye.id]){const l=(n=a[ye.language])==null?void 0:n[ye.id],c=Ut-l;o[ye.id]=Ut,ae={ratings:ae==null?void 0:ae.ratings,totalRating:isNaN(ae==null?void 0:ae.totalRating)?0:(ae==null?void 0:ae.totalRating)+c,quoteId:ye.id,language:ye.language},m("Rating updated",1)}else o[ye.id]=Ut,ae!=null&&ae.ratings&&ae.totalRating?(ae.ratings++,ae.totalRating+=Ut):ae={ratings:1,totalRating:Ut,quoteId:ye.id,language:ye.language},m("Rating submitted",1);t.quoteRatings=a,ut(t),ae.average=Bh(ae),s(".pageTest #result #rateQuoteButton .rating").text((r=ae.average)==null?void 0:r.toFixed(1)),s(".pageTest #result #rateQuoteButton .icon").removeClass("far"),s(".pageTest #result #rateQuoteButton .icon").addClass("fas")}async function Hk(e){var a;(a=e.querySelector(".submitButton"))==null||a.addEventListener("click",()=>{Ok()});const t=e.querySelectorAll(".stars button.star");for(const o of t)o.addEventListener("click",n=>{Ut=parseInt(n.currentTarget.getAttribute("data-rating")),vr()}),o.addEventListener("mouseenter",n=>{const r=parseInt(n.currentTarget.getAttribute("data-rating"));vr(r)}),o.addEventListener("mouseleave",()=>{vr()})}const qh=new le({dialogId:"quoteRateModal",setup:Hk}),_k=[{type:"leaderboard_atf",selectorId:"ad-result-wrapper"},{type:"med_rect_btf",selectorId:"ad-result-small-wrapper"}],Nk=[{type:"leaderboard_atf",selectorId:"ad-result-wrapper"},{type:"med_rect_btf",selectorId:"ad-result-small-wrapper"},{type:"sky_btf",selectorId:"ad-vertical-right-wrapper"},{type:"sky_btf",selectorId:"ad-vertical-left-wrapper"}],Kk=[{type:"leaderboard_atf",selectorId:"ad-result-wrapper"},{type:"med_rect_btf",selectorId:"ad-result-small-wrapper"},{type:"sky_btf",selectorId:"ad-vertical-right-wrapper"},{type:"sky_btf",selectorId:"ad-vertical-left-wrapper"},{type:"leaderboard_btf",selectorId:"ad-footer-wrapper"},{type:"med_rect_btf",selectorId:"ad-footer-small-wrapper"},{type:"leaderboard_btf",selectorId:"ad-about-1-wrapper"},{type:"med_rect_btf",selectorId:"ad-about-1-small-wrapper"},{type:"leaderboard_btf",selectorId:"ad-about-2-wrapper"},{type:"med_rect_btf",selectorId:"ad-about-2-small-wrapper"},{type:"leaderboard_btf",selectorId:"ad-settings-1-wrapper"},{type:"med_rect_btf",selectorId:"ad-settings-1-small-wrapper"},{type:"leaderboard_btf",selectorId:"ad-settings-2-wrapper"},{type:"med_rect_btf",selectorId:"ad-settings-2-small-wrapper"},{type:"leaderboard_btf",selectorId:"ad-settings-3-wrapper"},{type:"med_rect_btf",selectorId:"ad-settings-3-small-wrapper"},{type:"leaderboard_btf",selectorId:"ad-account-1-wrapper"},{type:"med_rect_btf",selectorId:"ad-account-1-small-wrapper"},{type:"leaderboard_btf",selectorId:"ad-account-2-wrapper"},{type:"med_rect_btf",selectorId:"ad-account-2-small-wrapper"}];let Hl=!1;function zk(){const e="1024888",t="74058";window.ramp={que:[],passiveMode:!0,forcePath:"320x50-test",onReady:()=>{Hl=!0,_l()}};const a=document.getElementsByTagName("head")[0],o=document.createElement("script");o.setAttribute("async",!0),o.src=`//cdn.intergient.com/${e}/${t}/ramp.js`,a.appendChild(o),window._pwGA4PageviewId="".concat(Date.now()),window.dataLayer=window.dataLayer||[],window.gtag=window.gtag||function(){dataLayer.push(arguments)},gtag("js",new Date),gtag("config","G-KETCPNHRJF",{send_page_view:!1}),gtag("event","ramp_js",{send_to:"G-KETCPNHRJF",pageview_id:window._pwGA4PageviewId})}function Fh(){let e;i.ads==="result"?e=_k:i.ads==="on"?e=Nk:i.ads==="sellout"&&(e=Kk);const t=[];for(const a of e){const o=document.querySelector(`#${a.selectorId}`);o&&window.getComputedStyle(o).display!=="none"&&o.offsetParent!==null&&t.push(a)}return t}async function _l(){if(Hl){if(ne()==="test"&&!qe){ramp.destroyUnits("all");return}await ramp.destroyUnits("all"),await ramp.addUnits(Fh()),await ramp.displayUnits()}}async function Uk(){}function Vk(){Hl&&ramp.destroyUnits("all")}async function jk(){if(!Hl)return;const e=Fh();await ramp.addUnits(e),await ramp.displayUnits()}const Qk=900;let or=!0;const Gk=1330;let nr=!0,Li=!1,Nl,si;function Dh(){zk(),setInterval(()=>{Ae||Uk()},6e4),Li=!0}function Yk(){Qc(),Rh(),Jk()}function Qc(){s("#ad-footer-wrapper").remove(),s("#ad-footer-small-wrapper").remove(),s("#ad-about-1-wrapper").remove(),s("#ad-about-1-small-wrapper").remove(),s("#ad-about-2-wrapper").remove(),s("#ad-about-2-small-wrapper").remove(),s("#ad-settings-1-wrapper").remove(),s("#ad-settings-1-small-wrapper").remove(),s("#ad-settings-2-wrapper").remove(),s("#ad-settings-2-small-wrapper").remove(),s("#ad-settings-3-wrapper").remove(),s("#ad-settings-3-small-wrapper").remove(),s("#ad-account-1-wrapper").remove(),s("#ad-account-1-small-wrapper").remove(),s("#ad-account-2-wrapper").remove(),s("#ad-account-2-small-wrapper").remove()}function Rh(){s("#ad-vertical-right-wrapper").remove(),s("#ad-vertical-left-wrapper").remove()}function Jk(){s("#ad-result-wrapper").remove(),s("#ad-result-small-wrapper").remove()}function Oh(){const t=s("#bannerCenter").height()+ss(2)+"px";s("#ad-vertical-left-wrapper").css("margin-top",t),s("#ad-vertical-right-wrapper").css("margin-top",t)}function Hh(e=!1){const t=or;window.innerWidth>Qk?or=!0:or=!1,!e&&(i.ads==="off"||!Li||t!==or&&_l())}function _h(e=!1){const t=nr;window.innerWidth>Gk?nr=!0:nr=!1,!e&&(i.ads==="off"||!Li||t!==nr&&_l())}async function Cu(){return new Promise(e=>{window.ramp===void 0&&(Nl=!0),e()})}async function ku(){return new Promise(e=>{if(si===void 0){si=!1,e();return}e()})}async function Zk(){return i.ads==="off"?!1:Li?(await Cu(),await ku(),Nl||si?!1:_l()):(Dh(),!0)}async function Xk(){if(i.ads!=="off"){if(Li||Dh(),await Cu(),await ku(),Nl){s("#ad-result-wrapper .iconAndText .text").html(`
    Using an ad blocker? No worries
    <div class="smalltext">
      We understand ads can be annoying
      <br />
      You can
      <i>disable all ads</i>
      in the settings
    </div>
    `);return}if(si){s("#ad-result-wrapper .iconAndText .text").html(`
    Ads not working? Ooops
    <div class="smalltext">
      You may have a cookie popup blocker enabled - ads will not show without your consent
      <br />
      You can also 
      <i>disable all ads</i>
      in the settings if you wish
    </div>
    `);return}jk()}}function Yr(e){e?(s("#ad-vertical-left-wrapper").removeClass("testPage"),s("#ad-vertical-right-wrapper").removeClass("testPage"),s("#ad-footer-wrapper").removeClass("testPage"),s("#ad-footer-small-wrapper").removeClass("testPage")):(s("#ad-vertical-left-wrapper").addClass("testPage"),s("#ad-vertical-right-wrapper").addClass("testPage"),s("#ad-footer-wrapper").addClass("testPage"),s("#ad-footer-small-wrapper").addClass("testPage"))}function eS(){ramp.showCmpModal()}function tS(){Vk()}const aS=Et(500,Oh),sS=Et(500,Hh),oS=Et(500,_h);s(window).on("resize",()=>{aS(),sS(),oS()});he((e,t)=>{e==="ads"&&(t==="off"?Yk():t==="result"?(Qc(),Rh()):t==="on"&&Qc())});Pw(()=>{Oh()});s(document).ready(()=>{Hh(!0),_h()});window.onerror=function(e){};const mc={quotes:[],length:0,language:null,groups:[]};class nS{constructor(){this.quoteCollection=mc,this.quoteQueue=[],this.queueIndex=0}async getQuotes(t,a){var n;const o=wa(t);if(this.quoteCollection.language!==o){let r;try{r=await Bp(`quotes/${o}.json`)}catch(l){if(l instanceof Error&&((n=l==null?void 0:l.message)!=null&&n.includes("404")))return mc;throw l}if(r.quotes===void 0||r.quotes.length===0)return mc;this.quoteCollection={quotes:[],length:r.quotes.length,groups:[],language:r.language},r.quotes.forEach(l=>{const c={text:l.text,britishText:l.britishText,source:l.source,length:l.length,id:l.id,language:r.language,group:0};this.quoteCollection.quotes.push(c)}),r.groups.forEach((l,c)=>{const d=l[0],u=l[1];this.quoteCollection.groups[c]=this.quoteCollection.quotes.filter(f=>f.length>=d&&f.length<=u?(f.group=c,!0):!1)}),a!==void 0&&this.updateQuoteQueue(a)}return this.quoteCollection}getQuoteById(t){return this.quoteCollection.quotes.find(o=>o.id===t)}updateQuoteQueue(t){this.quoteQueue=[],t.forEach(a=>{var o;a<0||(o=this.quoteCollection.groups[a])==null||o.forEach(n=>{this.quoteQueue.push(n)})}),Tr(this.quoteQueue),this.queueIndex=0}getRandomQuote(){if(this.quoteQueue.length===0)return null;this.queueIndex>=this.quoteQueue.length&&(this.queueIndex=0,Tr(this.quoteQueue));const t=this.quoteQueue[this.queueIndex];return this.queueIndex+=1,t}getCurrentQuote(){return this.quoteQueue.length===0?null:this.quoteQueue[this.queueIndex]}getRandomFavoriteQuote(t){const a=S();if(!a)return null;const o=wa(t),n=[],{favoriteQuotes:r}=a;if(r===void 0||(Object.keys(r).forEach(d=>{wa(d)===o&&n.push(...r[d]??[])}),n.length===0))return null;const l=xa(n);return this.getQuoteById(parseInt(l,10))??null}isQuoteFavorite({language:t,id:a}){const o=S();if(!o)return!1;const{favoriteQuotes:n}=o;if(n===void 0)return!1;const r=wa(t);return Object.keys(n).find(c=>r!==wa(c)?!1:(n[c]??[]).includes(a.toString()))!==void 0}}const la=new nS;he((e,t)=>{e==="quoteLength"&&la.updateQuoteQueue(t)});let Nh=!1;function Wf(){return Nh}function iS(){Nh=!0,console.log("Glarses Mode On - test result will be hidden. You can check the stats in the console (here)"),console.log("To disable Glarses Mode refresh the page.")}function rS(){s("#result .stats .wpm .crown").css("opacity",0).addClass("hidden")}function lS(){s("#result .stats .wpm .crown").removeClass("hidden").css("opacity","0").animate({opacity:1},250,"easeOutCubic")}function cS(){s("#testConfig").removeClass("invisible"),s("#mobileTestConfigButton").removeClass("invisible")}function dS(){s("#testConfig").addClass("invisible"),s("#mobileTestConfigButton").addClass("invisible")}async function uS(){s("#testConfig .mode .textButton").removeClass("active"),s("#testConfig .mode .textButton[mode='"+i.mode+"']").addClass("active"),s("#testConfig .puncAndNum").css({maxWidth:0,opacity:0}),s("#testConfig .spacer").addClass("scrolled"),s("#testConfig .time").addClass("hidden"),s("#testConfig .wordCount").addClass("hidden"),s("#testConfig .customText").addClass("hidden"),s("#testConfig .quoteLength").addClass("hidden"),s("#testConfig .zen").addClass("hidden"),i.mode==="time"?(s("#testConfig .puncAndNum").css({maxWidth:"",opacity:1}),s("#testConfig .leftSpacer").removeClass("scrolled"),s("#testConfig .rightSpacer").removeClass("scrolled"),s("#testConfig .time").removeClass("hidden"),Ts("time",i.time)):i.mode==="words"?(s("#testConfig .puncAndNum").css({maxWidth:"",opacity:1}),s("#testConfig .leftSpacer").removeClass("scrolled"),s("#testConfig .rightSpacer").removeClass("scrolled"),s("#testConfig .wordCount").removeClass("hidden"),Ts("words",i.words)):i.mode==="quote"?(s("#testConfig .rightSpacer").removeClass("scrolled"),s("#testConfig .quoteLength").removeClass("hidden"),Ts("quoteLength",i.quoteLength)):i.mode==="custom"&&(s("#testConfig .puncAndNum").css({maxWidth:"",opacity:1}),s("#testConfig .leftSpacer").removeClass("scrolled"),s("#testConfig .rightSpacer").removeClass("scrolled"),s("#testConfig .customText").removeClass("hidden")),Ts("numbers",i.numbers),Ts("punctuation",i.punctuation)}async function fS(e,t){var h,y,w;if(e===t)return;s("#testConfig .mode .textButton").removeClass("active"),s("#testConfig .mode .textButton[mode='"+t+"']").addClass("active");const a={time:"time",words:"wordCount",custom:"customText",quote:"quoteLength",zen:"zen"},o=250,n={both:"easeInOutSine",in:"easeInSine",out:"easeOutSine"},r={time:!0,words:!0,custom:!0,quote:!1,zen:!1},l=s("#testConfig .puncAndNum");if(!r[e]&&r[t]){l.css("maxWidth","");const k=Math.round(((h=l[0])==null?void 0:h.getBoundingClientRect().width)??224);s("#testConfig .leftSpacer").removeClass("scrolled"),l.css({opacity:0,maxWidth:0}).animate({opacity:1,maxWidth:k},o,n.both)}else r[e]&&!r[t]&&(s("#testConfig .leftSpacer").addClass("scrolled"),l.css({opacity:1,maxWidth:""}).animate({opacity:0,maxWidth:"0"},o,n.both));t==="zen"?s("#testConfig .rightSpacer").addClass("scrolled"):s("#testConfig .rightSpacer").removeClass("scrolled");const c=s(`#testConfig .${a[t]}`),d=s(`#testConfig .${a[e]}`),u=Math.round(((y=d[0])==null?void 0:y.getBoundingClientRect().width)??0);d.addClass("hidden"),c.removeClass("hidden");const f=Math.round(((w=c[0])==null?void 0:w.getBoundingClientRect().width)??0);d.removeClass("hidden"),c.addClass("hidden");const g=(f-u)/2;d.css({opacity:1,width:u}).animate({width:u+g,opacity:0},o/2,n.in,()=>{d.css({opacity:1,width:"unset"}).addClass("hidden"),c.css({opacity:0,width:u+g}).removeClass("hidden").animate({opacity:1,width:f},o/2,n.out,()=>{c.css("width","unset")})})}function Ts(e,t){if(e==="time"){s("#testConfig .time .textButton").removeClass("active");const a=[15,30,60,120].includes(t)?t:"custom";s("#testConfig .time .textButton[timeConfig='"+a+"']").addClass("active")}else if(e==="words"){s("#testConfig .wordCount .textButton").removeClass("active");const a=[10,25,50,100,200].includes(t)?t:"custom";s("#testConfig .wordCount .textButton[wordCount='"+a+"']").addClass("active")}else e==="quoteLength"?(s("#testConfig .quoteLength .textButton").removeClass("active"),t.forEach(a=>{s("#testConfig .quoteLength .textButton[quoteLength='"+a+"']").addClass("active")})):e==="numbers"?t===!1?s("#testConfig .numbersMode.textButton").removeClass("active"):s("#testConfig .numbersMode.textButton").addClass("active"):e==="punctuation"&&(t===!1?s("#testConfig .punctuationMode.textButton").removeClass("active"):s("#testConfig .punctuationMode.textButton").addClass("active"))}function pS(){s("#testConfig .quoteLength .favorite").removeClass("hidden")}function mS(){s("#testConfig .quoteLength .favorite").addClass("hidden")}he((e,t,a,o)=>{if(ne()==="test")if(e==="mode"){fS(o,t);let n;i.mode==="time"?n=i.time:i.mode==="words"?n=i.words:i.mode==="quote"&&(n=i.quoteLength),n!==void 0&&Ts(i.mode,n)}else["time","quoteLength","words","numbers","punctuation"].includes(e)&&t!==void 0&&Ts(e,t)});let I,Va,wr=!1,ha="",wo="";function gS(){wr=!wr,m(wr?"on":"off",1)}let to=[];async function Kh(){var l;const e=et(i.typingSpeedUnit),t=[];for(let c=1;c<=Ma.length;c++)eo&&c===Ma.length?t.push(U(I.testDuration).toString()):t.push(c.toString());be.getScale("wpm").title.text=e.fullUnitString;const a=[...Ma.map(c=>U(e.fromWpm(c)))];if(I.chartData==="toolong")return;const o=[...I.chartData.raw.map(c=>U(e.fromWpm(c)))];i.mode!=="time"&&eo&&I.testDuration%1<.5&&(t.pop(),a.pop(),o.pop());let n=o;if(wr||(n=Pp(n,1),n=n.map(c=>Math.round(c))),be.data.labels=t,be.getDataset("wpm").data=a,be.getDataset("wpm").label=i.typingSpeedUnit,be.getDataset("raw").data=n,Va=Math.max(Math.max(...n),Math.max(...a)),i.startGraphsAtZero)be.getScale("wpm").min=0,be.getScale("raw").min=0;else{const c=Math.min(Math.min(...n),Math.min(...a));be.getScale("wpm").min=c,be.getScale("raw").min=c}be.getDataset("error").data=I.chartData.err;const r=await Dt("sub");if(i.funbox!=="none"){let c="";for(const d of V(i.funbox))c+=d.name,(l=d.functions)!=null&&l.getResultContent&&(c+="("+d.functions.getResultContent()+")"),c+=" ";c=c.trimEnd(),to.push({display:!0,id:"funbox-label",type:"line",scaleID:"wpm",value:be.getScale("wpm").min,borderColor:"transparent",borderWidth:1,borderDash:[2,2],label:{backgroundColor:"transparent",font:{family:i.fontFamily.replace(/_/g," "),size:11,style:"normal",weight:Nt.defaults.font.weight,lineHeight:Nt.defaults.font.lineHeight},color:r,padding:3,borderRadius:3,position:"start",enabled:!0,content:`${c}`}})}be.getScale("wpm").max=Va,be.getScale("raw").max=Va,be.getScale("error").max=Math.max(...I.chartData.err)}async function zh(){const e=await ms(),t=await xd(I.mode,I.mode2,I.punctuation??!1,I.numbers??!1,I.language,I.difficulty,I.lazyMode??!1,I.funbox??"none");if(t===0)return;const a=et(i.typingSpeedUnit),o=U(a.fromWpm(t)).toFixed(2);to.push({display:!0,type:"line",id:"lpb",scaleID:"wpm",value:o,borderColor:e.sub,borderWidth:1,borderDash:[2,2],label:{backgroundColor:e.sub,font:{family:i.fontFamily.replace(/_/g," "),size:11,style:"normal",weight:Nt.defaults.font.weight,lineHeight:Nt.defaults.font.lineHeight},color:e.bg,padding:3,borderRadius:3,position:"center",enabled:!0,content:`PB: ${o}`}});const n=a.fromWpm(20);Va>=parseFloat(o)-n&&Va<=parseFloat(o)+n&&(Va=Math.round(parseFloat(o)+n)),be.getScale("wpm").max=Va,be.getScale("raw").max=Va}function Uh(){let e=!1;if(I.wpm>=1e3&&(e=!0),s("#result .stats .wpm .top .text").text(i.typingSpeedUnit),e?s("#result .stats .wpm .bottom").text("Infinite"):s("#result .stats .wpm .bottom").text(_.typingSpeed(I.wpm)),s("#result .stats .raw .bottom").text(_.typingSpeed(I.rawWpm)),s("#result .stats .acc .bottom").text(I.acc===100?"100%":_.accuracy(I.acc)),i.alwaysShowDecimalPlaces){i.typingSpeedUnit!="wpm"?(s("#result .stats .wpm .bottom").attr("aria-label",I.wpm.toFixed(2)+" wpm"),s("#result .stats .raw .bottom").attr("aria-label",I.rawWpm.toFixed(2)+" wpm")):(s("#result .stats .wpm .bottom").removeAttr("aria-label"),s("#result .stats .raw .bottom").removeAttr("aria-label"));let t=U(I.testDuration).toFixed(2)+"s";I.testDuration>61&&(t=dt(U(I.testDuration))),s("#result .stats .time .bottom .text").text(t),s("#result .stats .acc .bottom").attr("aria-label",`${Ht.correct} correct / ${Ht.incorrect} incorrect`)}else{const t={showDecimalPlaces:!0,suffix:` ${i.typingSpeedUnit}`};let a=_.typingSpeed(I.wpm,t),o=_.typingSpeed(I.rawWpm,t);i.typingSpeedUnit!="wpm"&&(a+=" ("+I.wpm.toFixed(2)+" wpm)",o+=" ("+I.rawWpm.toFixed(2)+" wpm)"),s("#result .stats .wpm .bottom").attr("aria-label",a),s("#result .stats .raw .bottom").attr("aria-label",o),s("#result .stats .acc .bottom").attr("aria-label",`${I.acc===100?"100":_.percentage(I.acc,{showDecimalPlaces:!0})} (${Ht.correct} correct / ${Ht.incorrect} incorrect)`)}}function hS(){s("#result .stats .consistency .bottom").text(_.percentage(I.consistency)),i.alwaysShowDecimalPlaces?s("#result .stats .consistency .bottom").attr("aria-label",_.percentage(I.keyConsistency,{showDecimalPlaces:!0,suffix:" key"})):s("#result .stats .consistency .bottom").attr("aria-label",`${I.consistency}% (${I.keyConsistency}% key)`)}function yS(){const e=U(I.afkDuration/I.testDuration*100);if(s("#result .stats .time .bottom .afk").text(""),e>0&&s("#result .stats .time .bottom .afk").text(e+"% afk"),s("#result .stats .time .bottom").attr("aria-label",`${I.afkDuration}s afk ${e}%`),i.alwaysShowDecimalPlaces){let t=U(I.testDuration).toFixed(2)+"s";I.testDuration>61&&(t=dt(U(I.testDuration))),s("#result .stats .time .bottom .text").text(t)}else{let t=Math.round(I.testDuration)+"s";I.testDuration>61&&(t=dt(Math.round(I.testDuration))),s("#result .stats .time .bottom .text").text(t),s("#result .stats .time .bottom").attr("aria-label",`${U(I.testDuration)}s (${I.afkDuration}s afk ${e}%)`)}}function vS(){s("#result .stats .time .bottom .timeToday").text(Wk())}function wS(){s("#result .stats .key .bottom").text(I.charStats[0]+"/"+I.charStats[1]+"/"+I.charStats[2]+"/"+I.charStats[3])}function bS(){lS()}function CS(){if(Ce())return;const e=getComputedStyle(document.body),t=[e.getPropertyValue("--main-color"),e.getPropertyValue("--text-color"),e.getPropertyValue("--sub-color")],a=Date.now()+125;(function o(){ef({particleCount:5,angle:60,spread:75,origin:{x:0},colors:t}),ef({particleCount:5,angle:120,spread:75,origin:{x:1},colors:t}),Date.now()<a&&requestAnimationFrame(o)})()}function kS(){rS(),s("#result .stats .wpm .crown").attr("aria-label","")}async function SS(){let e=0;const t=await xd(i.mode,I.mode2,i.punctuation,i.numbers,i.language,i.difficulty,i.lazyMode,i.funbox);e=Math.abs(I.wpm-t),s("#result .stats .wpm .crown").attr("aria-label","+"+_.typingSpeed(e,{showDecimalPlaces:!0}))}async function TS(e){var d,u,f,p,g;const t=[],a=((u=(d=S())==null?void 0:d.tags)==null?void 0:u.length)??0;try{(p=(f=S())==null?void 0:f.tags)==null||p.forEach(h=>{h.active===!0&&t.push(h)})}catch{}a===0?s("#result .stats .tags").addClass("hidden"):s("#result .stats .tags").removeClass("hidden"),t.length===0?s("#result .stats .tags .bottom").html("<div class='noTags'>no tags</div>"):s("#result .stats .tags .bottom").text(""),s("#result .stats .tags .editTagsButton").attr("data-result-id",""),s("#result .stats .tags .editTagsButton").attr("data-active-tag-ids",t.map(h=>h._id).join(",")),s("#result .stats .tags .editTagsButton").addClass("invisible");const o=((g=I.funbox)==null?void 0:g.split("#"))??[],r=(await Promise.all(o.map(async h=>Dv(h)))).every(h=>h==null?void 0:h.canGetPb);let l="start",c=15;t.forEach(async h=>{const y=await hb(h._id,i.mode,I.mode2,i.punctuation,i.numbers,i.language,i.difficulty,i.lazyMode);s("#result .stats .tags .bottom").append(`
      <div tagid="${h._id}" aria-label="PB: ${y}" data-balloon-pos="up">${h.display}<i class="fas fa-crown hidden"></i></div>
    `);const w=et(i.typingSpeedUnit);if(i.mode!=="quote"&&!e&&(I.funbox==="none"||o.length===0||r))if(y<I.wpm)await yb(h._id,i.mode,I.mode2,i.punctuation,i.numbers,i.language,i.difficulty,i.lazyMode,I.wpm,I.acc,I.rawWpm,I.consistency),s(`#result .stats .tags .bottom div[tagid="${h._id}"] .fas`).removeClass("hidden"),s(`#result .stats .tags .bottom div[tagid="${h._id}"]`).attr("aria-label","+"+U(I.wpm-y));else{const k=await ms();to.push({display:!0,type:"line",id:"tpb",scaleID:"wpm",value:w.fromWpm(y),borderColor:k.sub,borderWidth:1,borderDash:[2,2],label:{backgroundColor:k.sub,font:{family:i.fontFamily.replace(/_/g," "),size:11,style:"normal",weight:Nt.defaults.font.weight,lineHeight:Nt.defaults.font.lineHeight},color:k.bg,padding:3,borderRadius:3,position:l,xAdjust:c,enabled:!0,content:`${h.display} PB: ${U(w.fromWpm(y)).toFixed(2)}`}}),l==="start"?(l="end",c=-15):(l="start",c=15)}})}function xS(e){let t="";t+=i.mode,i.mode==="time"?t+=" "+i.time:i.mode==="words"?t+=" "+i.words:i.mode==="quote"&&(e==null?void 0:e.group)!==void 0&&(t+=" "+["short","medium","long","thicc"][e.group]);const a=V(i.funbox).find(o=>{var n;return(n=o.properties)==null?void 0:n.includes("ignoresLanguage")})!==void 0;i.mode!=="custom"&&!a&&(t+="<br>"+os(I.language)),i.punctuation&&(t+="<br>punctuation"),i.numbers&&(t+="<br>numbers"),i.blindMode&&(t+="<br>blind"),i.lazyMode&&(t+="<br>lazy"),i.funbox!=="none"&&(t+="<br>"+i.funbox.replace(/_/g," ").replace(/#/g,", ")),i.difficulty==="expert"?t+="<br>expert":i.difficulty==="master"&&(t+="<br>master"),i.stopOnError!=="off"&&(t+=`<br>stop on ${i.stopOnError}`),s("#result .stats .testType .bottom").html(t)}function $S(e,t,a,o,n){let r="";if(e&&(r+=`<br>failed (${t})`),a&&(r+="<br>afk detected"),ou){r+="<br>invalid";const l=[];(I.wpm<0||I.wpm>350&&I.mode!=="words"&&I.mode2!=="10"||I.wpm>420&&I.mode==="words"&&I.mode2==="10")&&l.push("wpm"),(I.rawWpm<0||I.rawWpm>350&&I.mode!=="words"&&I.mode2!=="10"||I.rawWpm>420&&I.mode==="words"&&I.mode2==="10")&&l.push("raw"),(I.acc<75||I.acc>100)&&l.push("accuracy"),l.length>0&&(r+=` (${l.join(",")})`)}o&&(r+="<br>repeated"),I.bailedOut&&(r+="<br>bailed out"),n&&(r+="<br>too short"),r===""?s("#result .stats .info").addClass("hidden"):(s("#result .stats .info").removeClass("hidden"),r=r.substring(4),s("#result .stats .info .bottom").html(r))}function AS(e){var t,a,o;if(i.mode==="quote"){if(e===null){console.error("Failed to update quote rating button: randomQuote is null");return}((o=(a=(t=S())==null?void 0:t.quoteRatings)==null?void 0:a[e.language])==null?void 0:o[e.id])&&s(".pageTest #result #rateQuoteButton .icon").removeClass("far").addClass("fas"),Ph(e).then(r=>{var l;s(".pageTest #result #rateQuoteButton .rating").text(((l=r==null?void 0:r.average)==null?void 0:l.toFixed(1))??"")}).catch(r=>{s(".pageTest #result #rateQuoteButton .rating").text("?")}),s(".pageTest #result #rateQuoteButton").css({opacity:0}).removeClass("hidden").css({opacity:1})}}function MS(e){const t=s(".pageTest #result #favoriteQuoteButton .icon");if(i.mode!=="quote"||!z()){t.parent().addClass("hidden");return}if(e===null){console.error("Failed to update quote favorite button: randomQuote is null");return}ha=i.mode==="quote"?e.language:"",wo=i.mode==="quote"?e.id.toString():"";const a=la.isQuoteFavorite(e);t.removeClass(a?"far":"fas").addClass(a?"fas":"far"),t.parent().removeClass("hidden")}function LS(e){i.mode==="quote"?(s("#result .stats .source").removeClass("hidden"),s("#result .stats .source .bottom").html((e==null?void 0:e.source)??"Error: Source unknown")):s("#result .stats .source").addClass("hidden")}async function WS(e,t,a,o,n,r,l,c){to=[],I=Object.assign({},e),kS(),s("#resultWordsHistory .words").empty(),s("#result #resultWordsHistory").addClass("hidden"),s("#retrySavingResultButton").addClass("hidden"),s(".pageTest #result #rateQuoteButton .icon").removeClass("fas").addClass("far"),s(".pageTest #result #rateQuoteButton .rating").text(""),s(".pageTest #result #rateQuoteButton").addClass("hidden"),s("#words").removeClass("blurred"),s("#wordsInput").trigger("blur"),s("#result .stats .time .bottom .afk").text(""),z()?s("#result .loginTip").addClass("hidden"):s("#result .loginTip").removeClass("hidden"),i.ads==="off"||i.ads==="result"?s("#result #watchVideoAdButton").addClass("hidden"):s("#result #watchVideoAdButton").removeClass("hidden"),Uh(),hS(),yS(),wS(),xS(l),LS(l),MS(l),await Kh(),await zh(),await TS(c),$S(t,a,o,n,r),be.options.plugins.annotation.annotations=to,be.updateColors(),be.resize(),s("#result .stats .tags").hasClass("hidden")&&s("#result .stats .info").hasClass("hidden")?s("#result .stats .infoAndTags").addClass("hidden"):s("#result .stats .infoAndTags").removeClass("hidden"),Wf()?(s("main #result .noStressMessage").remove(),s("main #result").prepend(`

      <div class='noStressMessage' style="
        text-align: center;
        grid-column: 1/3;
        font-size: 2rem;
        padding-bottom: 2rem;
      ">
      <i class="fas fa-check"></i>
      </div>

    `),s("main #result .stats").addClass("hidden"),s("main #result .chart").addClass("hidden"),s("main #result #resultWordsHistory").addClass("hidden"),s("main #result #resultReplay").addClass("hidden"),s("main #result .loginTip").addClass("hidden"),s("main #result #showWordHistoryButton").addClass("hidden"),s("main #result #watchReplayButton").addClass("hidden"),s("main #result #saveScreenshotButton").addClass("hidden"),console.log(`Test Completed: ${I.wpm} wpm ${I.acc}% acc ${I.rawWpm} raw ${I.consistency}% consistency`)):(s("main #result .stats").removeClass("hidden"),s("main #result .chart").removeClass("hidden"),z()||s("main #result .loginTip").removeClass("hidden"),s("main #result #showWordHistoryButton").removeClass("hidden"),s("main #result #watchReplayButton").removeClass("hidden"),s("main #result #saveScreenshotButton").removeClass("hidden")),window.scrollY>0&&s([document.documentElement,document.body]).stop().animate({scrollTop:0},250),dS(),Hs(s("#typingTest"),s("#result"),250,async()=>{s("#result").trigger("focus"),Xk(),Ug(!1),s("#words").empty(),be.resize(),window.scrollTo({top:0})},async()=>{ys(!1),s("#resultExtraButtons").removeClass("hidden").css("opacity",0).animate({opacity:1},125);const d=md(i.mode,i.words,i.time,Vd,hs()??!1);i.alwaysShowWordsHistory&&d&&!Wf()&&Gg(!0),Yr(!0),To()})}function IS(e,t){var o,n;const a=[];if(e.length>0)for(const r of e)(n=(o=S())==null?void 0:o.tags)==null||n.forEach(l=>{r===l._id&&a.push(l.display)});if(e.length===0)s(".pageTest #result .tags .bottom").html("<div class='noTags'>no tags</div>");else{s(".pageTest #result .tags .bottom div.noTags").remove();const r=s(".pageTest #result .tags .bottom div[tagid]"),l=[];r.each((d,u)=>{const f=s(u).attr("tagid");e.includes(f)?l.push(f):s(u).remove()});let c="";e.forEach((d,u)=>{l.includes(d)||(t.includes(d)?c+=`<div tagid="${d}" data-balloon-pos="up">${a[u]}<i class="fas fa-crown"></i></div>`:c+=`<div tagid="${d}">${a[u]}</div>`)}),s(".pageTest #result .tags .bottom").append(c),s(".pageTest #result .tags .top .editTagsButton").attr("active-tag-ids",e.join(","))}}s(".pageTest #favoriteQuoteButton").on("click",async()=>{var a,o,n,r,l;if(ha===""||wo===""){m("Could not get quote stats!",-1);return}const e=s(".pageTest #favoriteQuoteButton .icon"),t=S();if(t)if(e.hasClass("fas")){oe();const c=await E.users.removeQuoteFromFavorites(ha,wo);if(Q(),m(c.message,c.status===200?1:-1),c.status===200){e.removeClass("fas").addClass("far");const d=(o=(a=t.favoriteQuotes)==null?void 0:a[ha])==null?void 0:o.indexOf(wo);(r=(n=t.favoriteQuotes)==null?void 0:n[ha])==null||r.splice(d,1)}}else{oe();const c=await E.users.addQuoteToFavorites(ha,wo);Q(),m(c.message,c.status===200?1:-1),c.status===200&&(e.removeClass("far").addClass("fas"),t.favoriteQuotes===void 0&&(t.favoriteQuotes={}),t.favoriteQuotes[ha]||(t.favoriteQuotes[ha]=[]),(l=t.favoriteQuotes[ha])==null||l.push(wo))}});he(async e=>{["typingSpeedUnit","startGraphsAtZero"].includes(e)&&qe&&(to=[],Uh(),await Kh(),await zh(),Wo(),be.options.plugins.annotation.annotations=to,be.updateColors(),be.resize())});const K={particles:[],rendering:!1},ES=1e3,BS=.05,PS=4,qS=.6,ir=1500,go=.3,If=[6,3],rr=10;function FS(){const e=document.createElement("canvas");return e.style.cssText="position:fixed;top:0;left:0;pointer-events:none;z-index:999999",e.height=window.innerHeight,e.width=window.innerWidth,window.addEventListener("resize",()=>{e.height=window.innerHeight,e.width=window.innerWidth}),document.body.appendChild(e),e}function DS(e,t,a){return{x:e,y:t,color:a,alpha:1,prev:{x:e,y:t},vel:{x:ir-Math.random()*ir*2,y:ir-Math.random()*ir*2}}}function RS(e){!K.canvas||!K.deltaTime||(e.prev.x=e.x,e.prev.y=e.y,e.x+=e.vel.x*K.deltaTime,e.y+=e.vel.y*K.deltaTime,e.x>K.canvas.width?(e.vel.x*=-go,e.x=K.canvas.width-(e.x-K.canvas.width)*go):e.x<0&&(e.vel.x*=-go,e.x*=-go),e.y>K.canvas.height?(e.vel.y*=-go,e.y=K.canvas.height-(e.y-K.canvas.height)*go):e.y<0&&(e.vel.y*=-1,e.y*=-1),e.vel.y+=ES*K.deltaTime,e.vel.x*=1-BS*K.deltaTime,e.alpha*=1-qS*K.deltaTime)}function OS(){K.caret=s("#caret"),K.canvas=FS(),K.context2d=K.canvas.getContext("2d")}function Vh(){if(!K.lastFrame||!K.context2d||!K.canvas)return;K.rendering=!0;const e=Date.now();K.deltaTime=(e-K.lastFrame)/1e3,K.lastFrame=e,K.context2d.clearRect(0,0,K.canvas.width,K.canvas.height);const t=[];for(const a of K.particles)a.alpha<.1||(RS(a),K.context2d.globalAlpha=a.alpha,K.context2d.strokeStyle=a.color,K.context2d.lineWidth=PS,K.context2d.beginPath(),K.context2d.moveTo(Math.round(a.prev.x),Math.round(a.prev.y)),K.context2d.lineTo(Math.round(a.x),Math.round(a.y)),K.context2d.stroke(),t.push(a));K.particles=t,K.particles.length&&!Ce()?requestAnimationFrame(Vh):(K.context2d.clearRect(0,0,K.canvas.width,K.canvas.height),K.rendering=!1)}function jh(e=!1){if(!K.resetTimeOut)return;delete K.resetTimeOut,clearTimeout(K.resetTimeOut);const t=s(document.body);t.css("transition","all .25s, transform 0.8s"),t.css("transform","translate(0,0)"),setTimeout(()=>{t.css("transition","all .25s, transform .05s"),s("html").css("overflow","inherit"),s("html").css("overflow-y","scroll")},e?0:1e3)}function HS(){K.rendering||(K.lastFrame=Date.now(),Vh())}function _S(){const e=Math.floor(Math.random()*256).toString(16),t=Math.floor(Math.random()*256).toString(16),a=Math.floor(Math.random()*256).toString(16);return`#${e}${t}${a}`}async function Qh(e=!0,t=!1){var n,r;if(i.monkeyPowerLevel==="off"||Ce())return;if(i.blindMode&&(e=!0),["3","4"].includes(i.monkeyPowerLevel)){s("html").css("overflow","hidden");const l=[Math.round(rr-Math.random()*rr),Math.round(rr-Math.random()*rr)];s(document.body).css("transform",`translate(${l[0]}px, ${l[1]}px)`),K.resetTimeOut&&clearTimeout(K.resetTimeOut),K.resetTimeOut=setTimeout(jh,2e3)}const a=(n=K.caret)==null?void 0:n.offset(),o=[(a==null?void 0:a.left)??0,((a==null?void 0:a.top)??0)+(((r=K.caret)==null?void 0:r.height())??0)];for(let l=Math.round((If[0]+Math.random()*If[1])*(t?2:1));l>0;l--){const c=["2","4"].includes(i.monkeyPowerLevel)?_S():e?await Dt("caret"):await Dt("error");K.particles.push(DS(...o,c))}HS()}let gc=[];async function NS(){return gc.length===0&&(gc=await Bp("languages/britishenglish.json")),gc}async function Gh(e,t){var o;const a=await NS();if(e.includes("-"))return(await Promise.all(e.split("-").map(async n=>Gh(n,t)))).join("-");{const n=a.find(r=>e.match(RegExp(`^([\\W]*${r[0]}[\\W]*)$`,"gi")));return!n||(i.mode==="quote"||i.mode==="custom"&&!pe&&!fe&&!He)&&((o=n[2])!=null&&o.includes(t))?e:e.replace(RegExp(`^(?:([\\W]*)(${n[0]})([\\W]*))$`,"gi"),(r,l,c,d)=>l+(c.charAt(0)===c.charAt(0).toUpperCase()?c===c.toUpperCase()?n[1].toUpperCase():pi(n[1]):n[1])+d)}}const KS=[["áàâäåãąą́āą̄ă","a"],["éèêëẽęę́ēę̄ėě","e"],["íìîïĩįį́īį̄ı","i"],["óòôöøõóōǫǫ́ǭő","o"],["úùûüŭũúūůű","u"],["ńňñ","n"],["çĉčć","c"],["řŕṛ","r"],["ďđḍ","d"],["ťțṭ","t"],["ṃ","m"],["æ","ae"],["œ","oe"],["ẅŵ","w"],["ĝğg̃","g"],["ĥ","h"],["ĵ","j"],["ńṇ","n"],["ŝśšșşṣ","s"],["ß","ss"],["żźž","z"],["ÿỹýÿŷ","y"],["łľĺ","l"],["أإآ","ا"],["َ",""],["ُ",""],["ِ",""],["ْ",""],["ً",""],["ٌ",""],["ٍ",""],["ّ",""],["ё","е"],["ά","α"],["έ","ε"],["ί","ι"],["ύ","υ"],["ό","ο"],["ή","η"],["ώ","ω"],["þ","th"]],zS=new Map(KS.flatMap(e=>[...e[0]].map(t=>[t,e[1]])));function US(e,t){const a=e.toLowerCase(),o=t==null?void 0:t.find(n=>n[0].includes(a));return o!==void 0?o[1]:zS.get(a)}function VS(e,t){if(!e)return e;const a=e.toUpperCase(),o=[...e].map((r,l)=>r==a[l]),n=[];for(let r=0;r<e.length;r++){const l=e[r],c=o[r],d=US(l,t);d!==void 0?c?(n.push(d.substring(0,1).toUpperCase()),n.push(d.substring(1))):n.push(d):n.push(c?l.toUpperCase():l)}return n.join("")}const Yh=[["are",["aren't"]],["can",["can't"]],["could",["couldn't"]],["did",["didn't"]],["does",["doesn't"]],["do",["don't"]],["had",["hadn't"]],["has",["hasn't"]],["have",["haven't"]],["is",["isn't"]],["it",["it's","it'll"]],["i",["i'm","i'll","i've","i'd"]],["you",["you'll","you're","you've","you'd"]],["that",["that's","that'll","that'd"]],["must",["mustn't","must've"]],["there",["there's","there'll","there'd"]],["he",["he's","he'll","he'd"]],["she",["she's","she'll","she'd"]],["we",["we're","we'll","we'd"]],["they",["they're","they'll","they'd"]],["should",["shouldn't","should've"]],["was",["wasn't"]],["were",["weren't"]],["will",["won't"]],["would",["wouldn't","would've"]],["going",["goin'"]]];async function jS(e){return Yh.find(t=>e.match(RegExp(`^([\\W]*${t[0]}[\\W]*)$`,"gi")))!==void 0}async function QS(e){const t=Yh.find(o=>e.match(RegExp(`^([\\W]*${o[0]}[\\W]*)$`,"gi")));if(t===void 0)return e;const a=xa(t[1]);return e.replace(RegExp(`^(?:([\\W]*)(${t[0]})([\\W]*))$`,"gi"),(o,n,r,l)=>n+(r.charAt(0)===r.charAt(0).toUpperCase()?GS(r)?a.toUpperCase():pi(a):a)+l)}function GS(e){return e==="I"?!1:e===e.toUpperCase()}function YS(e){return/[?!.؟]/.test(e)}let ho="";async function JS(e,t,a,o){var d;let n=t;const r=i.language.split("_")[0],l=$p(e),c=V(i.funbox).find(u=>{var f;return(f=u.functions)==null?void 0:f.punctuateWord});if((d=c==null?void 0:c.functions)!=null&&d.punctuateWord)return c.functions.punctuateWord(n);if(r!=="code"&&r!=="georgian"&&(a===0||YS(l))){if(n=pi(n),r==="turkish"&&(n=n.replace(/I/g,"İ")),r==="spanish"||r==="catalan"){const u=Math.random();u>.9?(n="¿"+n,ho="?"):u>.8&&(n="¡"+n,ho="!")}}else if(Math.random()<.1&&l!=="."&&l!==","&&a!==o-2||a===o-1)if(r==="spanish"||r==="catalan")(ho==="?"||ho==="!")&&(n+=ho,ho="");else{const u=Math.random();u<=.8?r==="kurdish"?n+=".":r==="nepali"?n+="।":r==="japanese"?n+="。":n+=".":u>.8&&u<.9?r==="french"?n="?":r==="arabic"||r==="persian"||r==="urdu"||r==="kurdish"?n+="؟":r==="greek"?n+=";":r==="japanese"?n+="？":n+="?":r==="french"?n="!":r==="japanese"?n+="！":n+="!"}else if(Math.random()<.01&&l!==","&&l!=="."&&r!=="russian")n=`"${n}"`;else if(Math.random()<.011&&l!==","&&l!=="."&&r!=="russian"&&r!=="ukrainian"&&r!=="slovak")n=`'${n}'`;else if(Math.random()<.012&&l!==","&&l!==".")if(r==="code"){const u=Math.random(),f=["()","{}","[]","<>"];i.language.startsWith("code_javascript")&&f.push("``");const p=Math.floor(u*f.length),g=f[p];n=`${g[0]}${n}${g[1]}`}else r==="japanese"?n=`（${n}）`:n=`(${n})`;else if(Math.random()<.013&&l!==","&&l!=="."&&l!==";"&&l!=="؛"&&l!==":")r==="french"?n=":":r==="greek"?n="·":n+=":";else if(Math.random()<.014&&l!==","&&l!=="."&&e!=="-")n="-";else if(Math.random()<.015&&l!==","&&l!=="."&&l!==";"&&l!=="؛"&&l!==":")r==="french"?n=";":r==="greek"?n="·":r==="arabic"||r==="kurdish"?n+="؛":n+=";";else if(Math.random()<.2&&l!==",")r==="arabic"||r==="urdu"||r==="persian"||r==="kurdish"?n+="،":r==="japanese"?n+="、":n+=",";else if(Math.random()<.25&&r==="code"){const u=["{","}","[","]","(",")",";","=","+","%","/"],f=["{","}","[","]","(",")",";","=","+","%","/","/*","*/","//","!=","==","<=",">=","||","&&","<<",">>","%=","&=","*=","++","+=","--","-=","/=","^=","|="];i.language.startsWith("code_c")&&!i.language.startsWith("code_css")||i.language.startsWith("code_arduino")?n=xa(f):i.language.startsWith("code_javascript")?n=xa([...u,"`"]):n=xa(u)}else Math.random()<.5&&r==="english"&&await jS(n)&&(n=await ZS(n));return n}async function ZS(e){return QS(e)}function XS(){var t;const e=V(i.funbox).find(a=>{var o;return(o=a.functions)==null?void 0:o.getWordsFrequencyMode});if((t=e==null?void 0:e.functions)!=null&&t.getWordsFrequencyMode)return e.functions.getWordsFrequencyMode()}async function e1(){var a;const e=[],t=V(i.funbox).find(o=>{var n;return(n=o.functions)==null?void 0:n.pullSection});if((a=t==null?void 0:t.functions)!=null&&a.pullSection){const o=await t.functions.pullSection(i.language);if(o===!1||o===void 0)throw Wd(t.name),new Error("Failed to pull section");for(const n of o.words){if(e.length>=i.words&&i.mode==="words")break;e.push(n)}}return e}function t1(e,t,a){var n;const o=V(i.funbox).find(r=>{var l;return(l=r.functions)==null?void 0:l.getWord});return(n=o==null?void 0:o.functions)!=null&&n.getWord&&(e=o.functions.getWord(a,t)),e}function a1(e){var t;for(const a of V(i.funbox))(t=a.functions)!=null&&t.alterText&&(e=a.functions.alterText(e));return e}async function s1(e,t){return!i.britishEnglish||!i.language.includes("english")||i.mode==="quote"&&(se==null?void 0:se.britishText)!==void 0&&(se==null?void 0:se.britishText)!==""?e:await Gh(e,t)}function o1(e,t){const a=!t.noLazyMode||i.mode==="custom";return i.lazyMode&&a&&(e=VS(e,t.additionalAccents)),e}function n1(){var t,a;const e=((a=(t=V(i.funbox).find(o=>{var n;return(n=o.properties)==null?void 0:n.find(r=>r.startsWith("wordOrder"))}))==null?void 0:t.properties)==null?void 0:a.find(o=>o.startsWith("wordOrder")))??"";return e?e.split(":")[1]:"normal"}function i1(){var a,o;let e=100;const t=((o=(a=V(i.funbox).find(n=>{var r;return(r=n.properties)==null?void 0:r.find(l=>l.startsWith("toPush"))}))==null?void 0:a.properties)==null?void 0:o.find(n=>n.startsWith("toPush:")))??"";if(i.showAllLines&&(i.mode==="custom"&&(fe?e=Re:!pe&&!fe&&(e=Be.length)),i.mode==="words"&&(e=i.words)),i.mode==="words"&&i.words===0&&(e=100),i.mode==="custom"&&fe&&Re===0&&(e=100),i.mode==="custom"&&It==="|"&&(e=100),t&&(e=+t.split(":")[1]),i.mode==="words"&&i.words!==0&&i.words<e&&(e=i.words),i.mode==="custom"&&!He&&!pe&&fe&&Re!==0&&Re<e&&(e=Re),i.mode==="custom"&&!pe&&!fe&&!He&&Be.length!==0&&Be.length<e){let n=0;for(const r of Be)/ /g.test(r)?n+=r.split(" ").length:n++;e=n}return e}class sa extends Error{constructor(t){super(t),this.name="WordGenError"}}let Jr=[],br=!1;async function r1(e){var c;Jr=[],Ls=[],Fs=0,Pn=[];const t={words:[],sectionIndexes:[]},a=V(i.funbox).find(d=>{var u;return(u=d.functions)==null?void 0:u.pullSection});br=((c=a==null?void 0:a.functions)==null?void 0:c.pullSection)!==void 0;const o=i1(),n=n1();console.debug("Word order",n);let r=e.words;i.mode==="custom"&&(n==="reverse"?r=Be.reverse():r=Be);const l=await ph(r);if(i.mode==="quote"){const d=await l1(e,l,o);return n==="reverse"&&(d.words.reverse(),d.sectionIndexes.reverse()),d}if(i.mode==="time"||i.mode==="words"||i.mode==="custom"){let d=!1,u=0;for(;!d;){const f=await Su(l,u,e,o,Ba(t.words,-1)??"",Ba(t.words,-2)??"");t.words.push(f.word),t.sectionIndexes.push(f.sectionIndex);const p=He&&is!==0&&Fs>=is,g=!He&&!pe&&Fs>=l.length;(i.mode==="custom"&&Ls.length===0&&It==="|"&&(p||g)||t.words.length>=o)&&(d=!0),u++}}return Pn=[],t}async function l1(e,t,a){const o={words:[],sectionIndexes:[]},n=e.name.startsWith("swiss_german")?"german":e.name;if((await la.getQuotes(n,i.quoteLength)).length===0)throw Ge("words"),new sa(`No ${i.language.replace(/_\d*k$/g,"").replace(/_/g," ")} quotes found`);let l;if(i.quoteLength.includes(-2)&&i.quoteLength.length===1){const c=la.getQuoteById(Ac);if(c===void 0)throw $a(-1),new sa(`Quote ${Ac} does not exist`);l=c}else if(i.quoteLength.includes(-3)){const c=la.getRandomFavoriteQuote(i.language);if(c===null)throw $a(-1),new sa("No favorite quotes found");l=c}else{const c=la.getRandomQuote();if(c===null)throw $a(-1),new sa("No quotes found for selected quote length");l=c}if(l.language=wa(i.language),l.text=l.text.replace(/ +/gm," "),l.text=l.text.replace(/( *(\r\n|\r|\n) *)/g,`
 `),l.text=l.text.replace(/…/g,"..."),l.text=l.text.trim(),l.britishText!==void 0&&l.britishText!==""&&i.britishEnglish?l.textSplit=l.britishText.split(" "):l.textSplit=l.text.split(" "),Hb(l),se===null)throw new sa("Random quote is null");if(se.textSplit===void 0)throw new sa("Random quote textSplit is undefined");Jr=se.textSplit;for(let c=0;c<Math.min(a,Jr.length);c++){const d=await Su(t,c,e,a,Ba(o.words,-1)??"",Ba(o.words,-2)??"");o.words.push(d.word),o.sectionIndexes.push(c)}return o}let Fs=0,Ls=[],Pn=[];async function Su(e,t,a,o,n,r){console.debug("Getting next word",{wordset:e,wordIndex:t,language:a,wordsBound:o,previousWord:n,previousWord2:r});const l=XS()??"normal";let c=e.randomWord(l);const d=n.replace(/[.?!":\-,]/g,"").toLowerCase(),u=r.replace(/[.?!":\-,']/g,"").toLowerCase();if(Ls.length===0){const f=await e1();if(i.mode==="quote")c=Jr[t];else if(i.mode==="custom"&&!fe&&!pe&&!He)c=Be[Fs];else if(i.mode==="custom"&&(fe||pe||He)&&(e.length<4||de.mode!==null))c=e.randomWord(l);else if(i.mode==="custom"&&He){c=e.randomWord(l);const p=Ba(Pn,-1),g=Ba(Pn,-2);let h=0;for(;h<100&&(p===c||g===c);)h++,c=e.randomWord(l)}else if(br)c=f.join(" ");else{let p=0,g=c.split(" ")[0].toLowerCase();for(;p<100&&(d===g||u===g||i.mode!=="custom"&&!i.punctuation&&c==="I"||i.mode!=="custom"&&!i.punctuation&&!i.language.startsWith("code")&&/[-=_+[\]{};'\\:"|,./<>?]/i.test(c)||i.mode!=="custom"&&!i.numbers&&/[0-9]/i.test(c));)p++,c=e.randomWord(l),g=c.split(" ")[0]}c=c.replace(/ +/g," "),c=c.replace(/(^ )|( $)/g,""),c=t1(c,t,e),Ls=[...c.split(" ")],Pn.push(c),c=Ls.shift(),Fs++}else c=Ls.shift();if(c===void 0)throw new sa("Random word is undefined");if(c==="")throw new sa("Random word is empty");if(/ /g.test(c))throw new sa("Random word contains spaces");return i.mode!=="custom"&&i.mode!=="quote"&&/[A-Z]/.test(c)&&!i.punctuation&&!i.language.startsWith("german")&&!i.language.startsWith("swiss_german")&&!i.language.startsWith("code")&&!i.language.startsWith("klingon")&&!br&&(c=c.toLowerCase()),c=c.replace(/ +/gm," "),c=c.replace(/(^ )|( $)/gm,""),c=o1(c,a),c=await s1(c,d),i.language.startsWith("swiss_german")&&(c=c.replace(/ß/g,"ss")),i.punctuation&&!a.originalPunctuation&&!br&&(c=await JS(n,c,t,o)),i.numbers&&Math.random()<.1&&(c=Lp(4),i.language.startsWith("kurdish")?c=Wp(c):i.language.startsWith("nepali")&&(c=Ip(c))),c=a1(c),console.debug("Word:",c),{word:c,sectionIndex:Fs}}let Jh=0,Zh=0;async function c1(){const e=ml(i,se),[t,a]=(await Gp(i.mode,e,i.punctuation,i.numbers,i.language,i.difficulty,i.lazyMode)).map(U);Jh=i.alwaysShowDecimalPlaces?t:Math.round(t),Zh=i.alwaysShowDecimalPlaces?a:Math.floor(a)}function d1(){return Jh}function u1(){return Zh}he(e=>{["difficulty","blindMode","stopOnError","paceCaret","minWpm","minAcc","minBurst","confidenceMode","layout","showAverage","typingSpeedUnit","quickRestart"].includes(e)&&cs()});async function cs(){var o,n;s(".pageTest #testModesNotice").empty(),Mo&&i.mode!=="quote"&&s(".pageTest #testModesNotice").append('<div class="textButton noInteraction" style="color:var(--error-color);"><i class="fas fa-sync-alt"></i>repeated</div>'),gi||s(".pageTest #testModesNotice").append('<div class="textButton" commands="resultSaving" style="color:var(--error-color);"><i class="fas fa-save"></i>saving disabled</div>'),zn&&(i.quickRestart==="esc"&&(s(".pageTest #testModesNotice").append('<div class="textButton noInteraction"><i class="fas fa-long-arrow-alt-right"></i>shift + tab to open commandline</div>'),s(".pageTest #testModesNotice").append('<div class="textButton noInteraction"><i class="fas fa-level-down-alt fa-rotate-90"></i>shift + esc to restart</div>')),i.quickRestart==="tab"&&s(".pageTest #testModesNotice").append('<div class="textButton noInteraction"><i class="fas fa-level-down-alt fa-rotate-90"></i>shift + tab to restart</div>')),Lr&&i.quickRestart==="enter"&&s(".pageTest #testModesNotice").append('<div class="textButton noInteraction"><i class="fas fa-level-down-alt fa-rotate-90"></i>shift + enter to restart</div>');const e=su(),t=hs();if(i.mode==="custom"&&e!==""&&t&&s(".pageTest #testModesNotice").append(`<div class="textButton noInteraction"><i class="fas fa-book"></i>${e} (shift + enter to save progress)</div>`),mt&&s(".pageTest #testModesNotice").append(`<div class="textButton noInteraction"><i class="fas fa-award"></i>${mt.display}</div>`),i.mode==="zen"&&s(".pageTest #testModesNotice").append('<div class="textButton noInteraction"><i class="fas fa-poll"></i>shift + enter to finish zen </div>'),i.mode!=="zen"&&s(".pageTest #testModesNotice").append(`<div class="textButton" commands="languages"><i class="fas fa-globe-americas"></i>${os(i.language,i.mode==="quote")}</div>`),i.difficulty==="expert"?s(".pageTest #testModesNotice").append('<div class="textButton" commands="difficulty"><i class="fas fa-star-half-alt"></i>expert</div>'):i.difficulty==="master"&&s(".pageTest #testModesNotice").append('<div class="textButton" commands="difficulty"><i class="fas fa-star"></i>master</div>'),i.blindMode&&s(".pageTest #testModesNotice").append('<div class="textButton" commands="blindMode"><i class="fas fa-eye-slash"></i>blind</div>'),i.lazyMode&&s(".pageTest #testModesNotice").append('<div class="textButton" commands="lazyMode"><i class="fas fa-couch"></i>lazy</div>'),i.paceCaret!=="off"||i.repeatedPace&&zs){const r=_.typingSpeed((N==null?void 0:N.wpm)??0,{showDecimalPlaces:!1,suffix:` ${i.typingSpeedUnit}`});s(".pageTest #testModesNotice").append(`<div class="textButton" commands="paceCaretMode"><i class="fas fa-tachometer-alt"></i>${i.paceCaret==="average"?"average":i.paceCaret==="pb"?"pb":i.paceCaret==="last"?"last":i.paceCaret==="daily"?"daily":"custom"} pace ${r}</div>`)}if(i.showAverage!=="off"){const r=d1(),l=u1();if(z()&&r>0){const c=["speed","both"].includes(i.showAverage)?_.typingSpeed(r,{suffix:` ${i.typingSpeedUnit}`,showDecimalPlaces:!1}):"",d=["acc","both"].includes(i.showAverage)?_.accuracy(l,{suffix:" acc",showDecimalPlaces:!1}):"",u=`${c} ${d}`.trim();s(".pageTest #testModesNotice").append(`<div class="textButton" commands="showAverage"><i class="fas fa-chart-bar"></i>avg: ${u}</div>`)}}i.minWpm!=="off"&&s(".pageTest #testModesNotice").append(`<div class="textButton" commands="minWpm"><i class="fas fa-bomb"></i>min ${_.typingSpeed(i.minWpmCustomSpeed,{showDecimalPlaces:!1,suffix:` ${i.typingSpeedUnit}`})}</div>`),i.minAcc!=="off"&&s(".pageTest #testModesNotice").append(`<div class="textButton" commands="minAcc"><i class="fas fa-bomb"></i>min ${i.minAccCustom}% acc</div>`),i.minBurst!=="off"&&s(".pageTest #testModesNotice").append(`<div class="textButton" commands="minBurst"><i class="fas fa-bomb"></i>min ${_.typingSpeed(i.minBurstCustomSpeed,{showDecimalPlaces:!1})} ${i.typingSpeedUnit} burst ${i.minBurst==="flex"?"(flex)":""}</div>`),i.funbox!=="none"&&s(".pageTest #testModesNotice").append(`<div class="textButton" commands="funbox"><i class="fas fa-gamepad"></i>${i.funbox.replace(/_/g," ").replace(/#/g,", ")}</div>`),i.confidenceMode==="on"&&s(".pageTest #testModesNotice").append('<div class="textButton" commands="confidenceMode"><i class="fas fa-backspace"></i>confidence</div>'),i.confidenceMode==="max"&&s(".pageTest #testModesNotice").append('<div class="textButton" commands="confidenceMode"><i class="fas fa-backspace"></i>max confidence</div>'),i.stopOnError!=="off"&&s(".pageTest #testModesNotice").append(`<div class="textButton" commands="stopOnError"><i class="fas fa-hand-paper"></i>stop on ${i.stopOnError}</div>`),i.layout!=="default"&&s(".pageTest #testModesNotice").append(`<div class="textButton" commands="layouts"><i class="fas fa-keyboard"></i>emulating ${i.layout.replace(/_/g," ")}</div>`),i.oppositeShiftMode!=="off"&&s(".pageTest #testModesNotice").append(`<div class="textButton" commands="oppositeShiftMode"><i class="fas fa-exchange-alt"></i>opposite shift${i.oppositeShiftMode==="keymap"?" (keymap)":""}</div>`);let a="";try{(n=(o=S())==null?void 0:o.tags)==null||n.forEach(r=>{r.active===!0&&(a+=r.display+", ")}),a!==""&&s(".pageTest #testModesNotice").append(`<div class="textButton" commands="tags"><i class="fas fa-tag"></i>${a.substring(0,a.length-2)}</div>`)}catch{}}function f1(){return(localStorage.getItem("prefersArabicLazyMode")??"true")==="true"}function p1(e){localStorage.setItem("prefersArabicLazyMode",e?"true":"false")}let oi="";const m1=document.getElementById("koInputVisual");let ct=null;function g1(){ct=null}function Tu(e){ct!==null&&(ct.uid=e,delete ct.hash,ct.hash=Dp(ct))}function h1(e){var t;if(Rn())return!1;z()?Pa("testStarted"):Pa("testStartedNoLogin"),kd(!0),h0(),Pg(A.list),Xb(),dk(),vu(),s("#liveWpm").text("0"),fu(),mu(),pu(),Mi(),wu(),gk();for(const a of V(i.funbox))(t=a.functions)!=null&&t.start&&a.functions.start();try{(i.paceCaret!=="off"||i.repeatedPace&&zs)&&rk()}catch{}return tC(e),Mk(),!0}function Y(e={}){var o,n;if(e={...{withSameWordset:!1,practiseMissed:!1,noAnim:!1,nosave:!1},...e},Ct||Zs){event==null||event.preventDefault();return}if(ne()==="test"&&!jb()&&(i.mode!=="zen"&&(event==null||event.preventDefault()),!md(i.mode,i.words,i.time,Vd,hs()??!1))){let r="Use your mouse to confirm.";i.quickRestart==="tab"?r="Press shift + tab or use your mouse to confirm.":i.quickRestart==="esc"?r="Press shift + escape or use your mouse to confirm.":i.quickRestart==="enter"&&(r="Press shift + enter or use your mouse to confirm."),m(`Quick restart disabled in long tests. ${r}`,0,{duration:4,important:!0});return}if(e.withSameWordset&&(((n=(o=V(i.funbox).find(l=>{var c;return(c=l.properties)==null?void 0:c.find(d=>d.startsWith("toPush"))}))==null?void 0:o.properties)==null?void 0:n.find(l=>l.startsWith("toPush:")))??"")&&(m("You can't repeat a test with currently active funboxes",0,{important:!0}),e.withSameWordset=!1),Ae&&(Mo&&(e.withSameWordset=!0),gi)){Sl(),xl(),Tl();const r=Ti(performance.now()),l=du(r);let c=U(r-l);c<0&&(c=0),ru(c),ah();const d=U(xi());lu(d,c)}i.mode==="quote"&&se!==null&&i.language.startsWith(se.language)&&i.repeatQuotes==="typing"&&(Ae||oi!=="")&&(e.withSameWordset=!0),de.mode!==null&&!e.withSameWordset&&!e.practiseMissed&&(m("Reverting to previous settings.",0),de.punctuation!==null&&ua(de.punctuation),de.numbers!==null&&zt(de.numbers),de.customText&&(qa(de.customText.text),js(de.customText.isTimeRandom),Vs(de.customText.isWordRandom),Gs(de.customText.word),Qs(de.customText.time),bt(de.customText.text.join(It))),Ge(de.mode),ih()),Un(),wu(),eC(),e0(),Ne.reset(),d0(),Ci(),kd(!1),Or(),Pl(),Fl(),ql(),Ol(),Si(),Qp(!1),ik(),Lh(),T.setKoreanStatus(!1),Bn(),No(),Bk(),H0(),qe&&(i.randomTheme!=="off"&&tk(),tm()),We()||yl();let a=null;qe?a=s("#result"):a=s("#typingTest"),zg(!1),Ks(!0),Nc(!0),a.stop(!0,!0).animate({opacity:0},e.noAnim?0:125,async()=>{var c;s("#result").addClass("hidden"),s("#typingTest").css("opacity",0).removeClass("hidden"),s("#wordsInput").val(" "),i.language.startsWith("korean")?(m1.innerText=" ",i.mode!=="zen"?s("#koInputVisualContainer").show():s("#koInputVisualContainer").hide()):s("#koInputVisualContainer").hide(),ys(!1),ne()==="test"&&Yr(!1),cS(),tS(),await FC(),Gc=0,oi="";let r=!1;i.repeatedPace&&e.withSameWordset&&(r=!0),e.withSameWordset?(await Dl(),nc(!0),cf(r),Or(),A.resetCurrentIndex(),T.reset(),jg(),i.keymapMode==="next"&&i.mode!=="zen"&&Sa(Ba([...A.getCurrent()],0)),Zn(A.getCurrent()),await Uc()):(nc(!1),cf(r),await Yc(),await Uc()),i.mode==="quote"&&nc(!1);for(const d of V(i.funbox))(c=d.functions)!=null&&c.restart&&d.functions.restart();i.showAverage!=="off"?c1().then(()=>{cs()}):cs(),s("#wordsInput").is(":focus")&&hi(),Bl(),s("#typingTest").css("opacity",0).removeClass("hidden").stop(!0,!0).animate({opacity:1},e.noAnim?0:125,()=>{document.querySelector("#miniTimerAndLiveWpm .wpm").innerHTML="0",document.querySelector("#miniTimerAndLiveWpm .acc").innerHTML="100%",document.querySelector("#miniTimerAndLiveWpm .burst").innerHTML="0",document.querySelector("#liveWpm").innerHTML="0",document.querySelector("#liveAcc").innerHTML="100%",document.querySelector("#liveBurst").innerHTML="0",Nc(!1),V0(),Un(),Ks(!1)})}),Zd()}let Cr,Gc=0;async function Yc(){if(console.debug("Initializing test"),Gc++,Gc>=4){Nc(!1),m("Too many test reinitialization attempts. Something is going very wrong. Please contact support.",-1,{important:!0});return}jh(),Or(),A.reset(),Nr(0),T.resetHistory(),T.resetCurrent();let e;try{e=await gd(i.language)}catch(d){m(ee(d,"Failed to load language"),-1)}if(!e||e.name!==i.language){Oo("english"),await Yc();return}ne()==="test"&&await Dl(),i.mode==="quote"&&i.quoteLength.includes(-3)&&!z()&&$a(-1),i.tapeMode!=="off"&&e.rightToLeft&&(m("This language does not support tape mode.",0,{important:!0}),Fd("off"));const t=!e.noLazyMode||i.mode==="custom";i.lazyMode&&!t?(Cr=!0,m("This language does not support lazy mode.",0,{important:!0}),Nn(!1,!0)):Cr&&!e.noLazyMode&&Nn(!0,!0),!i.lazyMode&&!e.noLazyMode&&(Cr=!1);let a,o;try{const d=await r1(e);a=d.words,o=d.sectionIndexes}catch(d){console.error(d),d instanceof sa?m(d.message,0,{important:!0}):m(ee(d,"Failed to generate words"),-1,{important:!0}),await Yc();return}const n=!!_d;let r=!1,l=!1,c=!1;for(const d of a)/\t/g.test(d)&&!r&&(r=!0),/\d/g.test(d)&&!l&&(l=!0),/\n/g.test(d)&&!c&&(c=!0);_b(r),Kb(l),Nb(c),n!==l&&Qr();for(let d=0;d<a.length;d++)A.push(a[d],o[d]);i.keymapMode==="next"&&i.mode!=="zen"&&Sa(Ba([...A.getCurrent()],0)),Zn(A.getCurrent()),j0(e.rightToLeft),Q0(e.ligatures??!1),jg(),console.debug("Test initialized with words",a),console.debug("Test initialized with section indexes",o)}async function y1(){var c,d,u,f;let e=100;const t=(d=(c=V(i.funbox).find(p=>{var g;return(g=p.properties)==null?void 0:g.find(h=>h.startsWith("toPush"))}))==null?void 0:c.properties)==null?void 0:d.find(p=>p.startsWith("toPush:")),a=t==null?void 0:t.split(":")[1];if(a!==void 0&&(e=+a-1),A.length-T.history.length>e||i.mode==="words"&&A.length>=i.words&&i.words>0||i.mode==="custom"&&fe&&A.length>=Re&&Re!==0||i.mode==="custom"&&!fe&&!pe&&!He&&A.length>=Be.length||i.mode==="quote"&&A.length>=(((u=se==null?void 0:se.textSplit)==null?void 0:u.length)??0)||i.mode==="custom"&&He&&Fs>=is&&Ls.length===0&&is!==0)return;const o=V(i.funbox).find(p=>{var g;return(g=p.functions)==null?void 0:g.pullSection});if((f=o==null?void 0:o.functions)!=null&&f.pullSection&&A.length-A.currentIndex<20){const p=await o.functions.pullSection(i.language);if(p===!1){m("Error while getting section. Please try again later",-1),Wd(o.name),Y();return}if(p===void 0)return;let g=0;for(let h=0;h<p.words.length;h++){const y=p.words[h];if(g>=i.words&&i.mode==="words")break;g++,A.push(y,h),vf(y)}}const n=i.mode!=="custom"?await Ea(i.language):{...await Ea(i.language),words:Be},r=await ph(n.words),l=await Su(r,A.length,n,e,A.get(A.length-1),A.get(A.length-2));A.push(l.word,l.sectionIndex),vf(l.word)}const Ws={completedEvent:null,canRetry:!1};async function v1(){const{completedEvent:e}=Ws;if(e===null){m("Could not retry saving the result as the result no longer exists.",0,{duration:5,important:!0});return}Ws.canRetry&&(Ws.canRetry=!1,s("#retrySavingResultButton").addClass("hidden"),_t(!0),m("Retrying to save..."),await Xh(e,!0))}function w1(e){var q;let t=U(ue.spacing.first-Xs);(t<0||i.mode==="zen")&&(t=0);let a=U(en-ue.spacing.last);(a<0||i.mode==="zen")&&(a=0);const o=iC();if(o.time%1!==0&&i.mode!=="time"&&aC(),ok(o.wpm),eo&&!e){const G=cu();hg(G.wpm),yg(G.raw),Sl(),xl(),Tl()}const n=Us.map(G=>Math.round(G/5*60));if(i.mode!=="time"&&eo&&o.time%1>=.5){const G=1/(o.time%1);n[n.length-1]=Math.round(n[n.length-1]*G)}const r=Ln(n),l=mr(n);let c=U(ac(r/l)),d=ue.spacing.array.slice();d.length>0&&(d=d.slice(0,d.length-1));let u=U(ac(Ln(d)/mr(d)));(!c||isNaN(c))&&(c=0),(!u||isNaN(u))&&(u=0);const f=[];for(const G of wi)f.push(G.count??0);const p={wpm:Ma,raw:n,err:f},g=Ln(p.wpm??[]),h=mr(p.wpm??[]),y=U(ac(g/h)),w=isNaN(y)?0:y;let k=null;i.mode==="custom"&&(k={},k.textLen=Be.length,k.isWordRandom=fe,k.isTimeRandom=pe,k.word=Re,k.time=Wt);const L=[];for(const G of((q=S())==null?void 0:q.tags)??[])G.active===!0&&L.push(G._id);const x=parseFloat(o.time.toString()),B=du(x);let D=i.language;i.mode==="quote"&&(D=wa(i.language));const v=(se==null?void 0:se.group)??-1,C={wpm:o.wpm,rawWpm:o.wpmRaw,charStats:[o.correctChars+o.correctSpaces,o.incorrectChars,o.extraChars,o.missedChars],charTotal:o.allChars,acc:o.acc,mode:i.mode,mode2:ml(i,se),quoteLength:v,punctuation:i.punctuation,numbers:i.numbers,lazyMode:i.lazyMode,timestamp:Date.now(),language:D,restartCount:nu,incompleteTests:iu,incompleteTestSeconds:_o<0?0:U(_o),difficulty:i.difficulty,blindMode:i.blindMode,tags:L,keySpacing:ue.spacing.array,keyDuration:ue.duration.array,keyOverlap:U(va.total),lastKeyToEnd:a,startToFirstKey:t,consistency:c,wpmConsistency:w,keyConsistency:u,funbox:i.funbox,bailedOut:bo,chartData:p,customText:k,testDuration:x,afkDuration:B};return C.mode!=="custom"&&delete C.customText,C.mode!=="quote"&&delete C.quoteLength,C}async function ao(e=!1){var h,y,w,k,L,x;if(!Ae)return;Ug(!0);const t=performance.now();bf(t),await Te(1),T.current.length!==0&&(T.pushHistory(),Ne.pushHistory(),Pg(T.history)),Jb(t);const a=(t-ue.spacing.last)/1e3;if((i.mode==="zen"||bo)&&a<7&&bf(ue.spacing.last),zg(!0),kd(!1),Or(),Ci(),Pl(),Fl(),ql(),Ol(),hi(),wu(),Lh(),cs(),Mt.length!==((h=T.getHistory())==null?void 0:h.length)){const B=oh();vg(B)}(i.mode==="zen"||bo)&&sC();const o=w1(e);function n(B){return typeof B=="number"?isNaN(B)?1:0:typeof B>"u"?1:typeof B=="object"&&B!==null?Object.values(B).reduce((D,v)=>D+n(v),0):0}let r=!1;n(o)>0&&(console.log(o),m("Failed to build result object: One of the fields is undefined or NaN",-1),r=!0);const l=JSON.parse(JSON.stringify(o));let d=bi.slice(-5).every(B=>B);bo&&(d=!1);const u=parseInt(l.mode2);let f=!1;if(e?(m(`Test failed - ${oi}`,0,{duration:1}),r=!0):d?(m("Test invalid - AFK detected",0),r=!0):Mo?(m("Test invalid - repeated",0),r=!0):i.mode==="time"&&u<15&&u>0||i.mode==="time"&&u===0&&l.testDuration<15||i.mode==="words"&&u<10&&u>0||i.mode==="words"&&u===0&&l.testDuration<15||i.mode==="custom"&&!fe&&!pe&&!He&&Be.length<10||i.mode==="custom"&&fe&&!pe&&!He&&Re<10||i.mode==="custom"&&!fe&&!He&&pe&&Wt<15||i.mode==="custom"&&!fe&&!pe&&He&&A.length<10||i.mode==="zen"&&l.testDuration<15?(m("Test invalid - too short",0),f=!0,r=!0):l.wpm<0||l.wpm>350&&l.mode!=="words"&&l.mode2!=="10"||l.wpm>420&&l.mode==="words"&&l.mode2==="10"?(m("Test invalid - wpm",0),cc(),r=!0):l.rawWpm<0||l.rawWpm>350&&l.mode!=="words"&&l.mode2!=="10"||l.rawWpm>420&&l.mode==="words"&&l.mode2==="10"?(m("Test invalid - raw",0),cc(),r=!0):(!((y=S())!=null&&y.lbOptOut)&&(l.acc<75||l.acc>100)||((w=S())==null?void 0:w.lbOptOut)===!0&&(l.acc<50||l.acc>100))&&(m("Test invalid - accuracy",0),cc(),r=!0),Mo){const B=l.testDuration,D=l.afkDuration;let v=U(B-D);v<0&&(v=0);const C=l.acc;ru(v),lu(C,v)}const p=su(),g=hs();if(i.mode==="custom"&&p!==""&&g)if(bo||T.history.length<A.length){const B=(k=T.getHistory())==null?void 0:k.length,D=$l(p)+B;Br(p,D),m("Long custom text progress saved",1,{duration:5,important:!0});let v=Gn(p,!0);v=v.slice(D),bt(v.join(It),!0),qa(v)}else{Br(p,0);const B=Gn(p,!0);bt(B.join(It),!0),qa(B),m("Long custom text completed",1,{duration:5,important:!0})}if(r||(Lk(l.testDuration+(_o<0?0:U(_o))-l.afkDuration),vS()),z()?s(".pageTest #result #reportQuoteButton").removeClass("hidden"):(s(".pageTest #result #rateQuoteButton").addClass("hidden"),s(".pageTest #result #reportQuoteButton").addClass("hidden"),Pa("testCompletedNoLogin"),r||(ct=l),r=!0),s("#result .stats .dailyLeaderboard").addClass("hidden"),Z0(JSON.parse(JSON.stringify(l))),We()||yl(),await WS(l,e,oi,d,Mo,f,se,r),l.chartData!=="toolong"&&delete l.chartData.unsmoothedRaw,l.testDuration>122&&(l.chartData="toolong",l.keySpacing="toolong",l.keyDuration="toolong"),r){Pa("testCompletedInvalid");return}sh(),l.uid=(x=(L=Pe)==null?void 0:L.currentUser)==null?void 0:x.uid,AS(se),_t(!0),l.bailedOut!==!0&&(l.challenge=Ek(l)),l.challenge===null&&(l==null||delete l.challenge),l.hash=Dp(l),await Xh(l,!1)}async function Xh(e,t){var o,n,r,l,c,d,u,f,p,g,h;if(!gi){m("Result not saved: disabled by user",-1,{duration:3,customTitle:"Notice",important:!0}),_t(!1);return}if(!We()){m("Result not saved: offline",-1,{duration:2,customTitle:"Notice",important:!0}),_t(!1),Ws.canRetry=!0,s("#retrySavingResultButton").removeClass("hidden"),t||(Ws.completedEvent=e);return}const a=await E.results.save(e);if(_t(!1),a.status!==200)return[460,461,463,464,465].includes(a.status)||(Ws.canRetry=!0,s("#retrySavingResultButton").removeClass("hidden"),t||(Ws.completedEvent=e)),console.log("Error saving result",e),a.message==="Old key data format"&&(a.message="Old key data format. Please refresh the page to download the new update. If the problem persists, please contact support."),m("Failed to save result: "+a.message,-1);if(s("#result .stats .tags .editTagsButton").attr("data-result-id",(o=a.data)==null?void 0:o.insertedId),s("#result .stats .tags .editTagsButton").removeClass("invisible"),((n=a==null?void 0:a.data)==null?void 0:n.xp)!==void 0){const y=((r=S())==null?void 0:r.xp)??0;am(y,a.data.xp,a.data.xpBreakdown),Jp(a.data.xp)}((l=a==null?void 0:a.data)==null?void 0:l.streak)!==void 0&&wb(a.data.streak),((c=a==null?void 0:a.data)==null?void 0:c.insertedId)!==void 0&&(e._id=a.data.insertedId,((d=a==null?void 0:a.data)==null?void 0:d.isPb)!==void 0&&a.data.isPb&&(e.isPb=!0),$d(e),Ad(e.incompleteTests.length+1,e.testDuration+e.incompleteTestSeconds-e.afkDuration)),Pa("testCompleted"),((u=a==null?void 0:a.data)==null?void 0:u.isPb)!==void 0&&a.data.isPb&&((g=(p=(f=S())==null?void 0:f.personalBests)==null?void 0:p[i.mode])!=null&&g[e.mode2]&&CS(),bS(),await SS(),await gb(i.mode,e.mode2,i.punctuation,i.numbers,i.language,i.difficulty,i.lazyMode,e.wpm,e.acc,e.rawWpm,e.consistency)),((h=a==null?void 0:a.data)==null?void 0:h.dailyLeaderboardRank)===void 0?s("#result .stats .dailyLeaderboard").addClass("hidden"):(s("#result .stats .dailyLeaderboard").css({maxWidth:"13rem",opacity:0}).removeClass("hidden").animate({opacity:1},500),s("#result .stats .dailyLeaderboard .bottom").html(_.rank(a.data.dailyLeaderboardRank,{fallback:""}))),s("#retrySavingResultButton").addClass("hidden"),t&&m("Result saved",1,{important:!0})}function qn(e){if(oi=e,Sl(),xl(),Tl(),ao(!0),!gi)return;const t=Ti(performance.now()),a=du(t);let o=U(t-a);o<0&&(o=0),ru(o),ah();const n=U(xi());lu(n,o)}s(".pageTest").on("click","#testModesNotice .textButton.restart",()=>{Y()});s(".pageTest").on("click","#restartTestButton",()=>{ie(),!Zs&&(Ae&&i.repeatQuotes==="typing"&&i.mode==="quote"?Y({withSameWordset:!0}):Y())});s(".pageTest").on("click","#retrySavingResultButton",v1);s(".pageTest").on("click","#nextTestButton",()=>{ie(),Y()});s(".pageTest").on("click","#restartTestButtonWithSameWordset",()=>{if(i.mode==="zen"){m("Repeat test disabled in zen mode");return}ie(),Y({withSameWordset:!0})});s(".pageTest").on("click","#testConfig .mode .textButton",e=>{if(Ct||s(e.currentTarget).hasClass("active"))return;const t=s(e.currentTarget).attr("mode")??"time";t!==void 0&&(Ge(t),ie(),Y())});s(".pageTest").on("click","#testConfig .wordCount .textButton",e=>{if(Ct)return;const t=s(e.currentTarget).attr("wordCount")??"15";t!=="custom"&&(ns(parseInt(t)),ie(),Y())});s(".pageTest").on("click","#testConfig .time .textButton",e=>{if(Ct)return;const t=s(e.currentTarget).attr("timeConfig")??"10";t!=="custom"&&(ia(parseInt(t)),ie(),Y())});s(".pageTest").on("click","#testConfig .quoteLength .textButton",e=>{if(Ct)return;let t=parseInt(s(e.currentTarget).attr("quoteLength")??"1");t!==-2&&(t===-1&&(t=[0,1,2,3]),$a(t,!1,e.shiftKey),ie(),Y())});s(".pageTest").on("click","#testConfig .punctuationMode.textButton",()=>{Ct||(ua(!i.punctuation),ie(),Y())});s(".pageTest").on("click","#testConfig .numbersMode.textButton",()=>{Ct||(zt(!i.numbers),ie(),Y())});s("#popups").on("click","#practiseWordsPopup .button.missed",()=>{uu(!0,!1)&&($i(),Y({practiseMissed:!0}))});s("#popups").on("click","#practiseWordsPopup .button.slow",()=>{uu(!1,!0)&&($i(),Y({practiseMissed:!0}))});s("#popups").on("click","#practiseWordsPopup .button.both",()=>{uu(!0,!0)&&($i(),Y({practiseMissed:!0}))});s("header").on("click","nav #startTestButton, #logo",()=>{ne()==="test"&&Y()});he((e,t,a)=>{ne()==="test"&&(e==="language"&&(t!=null&&t.startsWith("arabic")&&f1()&&Nn(!0,!0),Y()),e==="difficulty"&&!a&&Y(),e==="showAllLines"&&!a&&Y(),e==="tapeMode"&&!a&&Y(),e==="customLayoutFluid"&&i.funbox.includes("layoutfluid")&&Y(),e==="keymapMode"&&t==="next"&&i.mode!=="zen"&&setTimeout(()=>{Sa(Ba([...A.getCurrent()],0))},0)),e==="lazyMode"&&!a&&(i.language.startsWith("arabic")&&p1(t),t===!1&&(Cr=!1))});hk((e,t)=>{e==="fail"&&t!==void 0&&qn(t),e==="finish"&&ao()});function ey(e){xu.show({...e,focusFirstInput:"focusAndSelect",beforeAnimation:async t=>{t.querySelector("input").value=`${i.words}`}})}function b1(e=!1){xu.hide({clearModalChain:e})}function C1(){var t;const e=parseInt((t=xu.getModal().querySelector("input"))==null?void 0:t.value,10);e!==null&&!isNaN(e)&&e>=0&&isFinite(e)?ns(e)&&(ie(),Y(),e>2e3?m("Stay safe and take breaks!",0):e===0&&m("Infinite words! Make sure to use Bail Out from the command line to save your result.",0,{duration:7})):m("Custom word amount must be at least 1",0),b1(!0)}const xu=new le({dialogId:"customWordAmountModal",setup:async e=>{e.addEventListener("submit",t=>{t.preventDefault(),C1()})}}),Tt={_id:"default-result-filters-id",name:"default result filters",pb:{no:!0,yes:!0},difficulty:{normal:!0,expert:!0,master:!0},mode:{words:!0,time:!0,quote:!0,zen:!0,custom:!0},words:{10:!0,25:!0,50:!0,100:!0,custom:!0},time:{15:!0,30:!0,60:!0,120:!0,custom:!0},quoteLength:{short:!0,medium:!0,long:!0,thicc:!0},punctuation:{on:!0,off:!0},numbers:{on:!0,off:!0},date:{last_day:!1,last_week:!1,last_month:!1,last_3months:!1,all:!0},tags:{none:!0},language:{},funbox:{none:!0}};let j=Tt;function ds(){window.localStorage.setItem("resultFilters",JSON.stringify(j))}async function k1(){try{const e=window.localStorage.getItem("resultFilters")??"";if(!e)j=Tt;else{const a=JSON.parse(e);let o=!1;for(const n of Object.keys(Tt)){if(o)break;if(a[n]===void 0){o=!0;break}if(typeof Tt[n]=="object"){for(const r of Object.keys(Tt[n]))if(a[n][r]===void 0){o=!0;break}}}o?j=Tt:j=a}const t={none:!1};Object.keys(Tt.tags).forEach(a=>{j.tags[a]!==void 0?t[a]=j.tags[a]:t[a]=!0}),j.tags=t,ds()}catch{console.log("error in loading result filters"),j=Tt,ds()}}async function $u(){var o;const e=document.querySelector(".pageAccount .presetFilterButtons"),t=document.querySelector(".pageAccount .presetFilterButtons .filterBtns");if(!e||!t)return;t.innerHTML="";const a=((o=S())==null?void 0:o.filterPresets.map(n=>(n.name=n.name.replace(/_/g," "),n)))??[];if(a.length>0){let n="";for(const r of a)n+=`<div class="filterPresets">
      <div class="select-filter-preset button" data-id="${r._id}">${r.name} </div>
      <div class="button delete-filter-preset" data-id="${r._id}">
        <i class="fas fa-fw fa-trash"></i>
      </div>
    </div>`;t.innerHTML=n,e.classList.remove("hidden")}else e.classList.add("hidden")}async function S1(e){var a;const t=(a=S())==null?void 0:a.filterPresets.find(o=>o._id===e);t&&(j=E1(t),ds(),vs()),s(".pageAccount .group.presetFilterButtons .filterBtns .filterPresets .select-filter-preset").removeClass("active"),s(`.pageAccount .group.presetFilterButtons .filterBtns .filterPresets .select-filter-preset[data-id=${e}]`).addClass("active")}function ty(e){return JSON.parse(JSON.stringify(e))}function T1(e){const t=S();t&&ut({...t,filterPresets:[...t.filterPresets,ty(e)]})}async function x1(e){e=e.replace(/ /g,"_"),oe();const t=await E.users.addResultFilterPreset({...j,name:e});Q(),t.status===200?(T1({...j,name:e,_id:t.data}),$u(),m("Filter preset created",1)):(m("Error creating filter preset: "+t.message,-1),console.log("error creating filter preset: "+t.message))}function $1(e){const t=S();if(!t)return;const a=[...t.filterPresets],o=a.findIndex(n=>n._id===e);o>-1&&a.splice(o,1),ut({...t,filterPresets:a})}async function A1(e){oe();const t=await E.users.removeResultFilterPreset(e);Q(),t.status===200?($1(e),$u(),Mu(),m("Filter preset deleted",1)):(m("Error deleting filter preset: "+t.message,-1),console.log("error deleting filter preset",t.message))}function Au(){s(".pageAccount .group.presetFilterButtons .filterBtns .filterPresets .select-filter-preset").removeClass("active")}function zo(){return j}function ay(e){return j[e]}function Ee(e,t){return j[e][t]}function Qa(e,t){Object.keys(ay(e)).forEach(a=>{j[e][a]=t})}function M1(e){e.forEach(t=>{Tt.tags[t._id]=!0})}function Mu(){j=Tt,ds()}function vs(){var o,n,r,l,c;const e={};for(const d of _s(zo()))if(!(d==="_id"||d==="name")){e[d]={all:!0,array:[]};for(const u of _s(ay(d))){const f=e[d];if(f===void 0)continue;const p=Ee(d,u);p===!0?(o=f.array)==null||o.push(u):f.all!==void 0&&(f.all=!1);let g;d==="date"?g=s(`.pageAccount .group.topFilters .filterGroup[group="${d}"] button[filter="${u}"]`):g=s(`.pageAccount .group.filterButtons .filterGroup[group="${d}"] button[filter="${u}"]`),p===!0?g.addClass("active"):g.removeClass("active")}}function t(d){var f,p,g,h,y;let u="";return u+="<div class='group'>",d==="difficulty"?u+='<span aria-label="Difficulty" data-balloon-pos="up"><i class="fas fa-fw fa-star"></i>':d==="mode"?u+='<span aria-label="Mode" data-balloon-pos="up"><i class="fas fa-fw fa-bars"></i>':d==="punctuation"?u+='<span aria-label="Punctuation" data-balloon-pos="up"><i class="fas fa-fw fa-at"></i>':d==="numbers"?u+='<span aria-label="Numbers" data-balloon-pos="up"><i class="fas fa-fw fa-hashtag"></i>':d==="words"?u+='<span aria-label="Words" data-balloon-pos="up"><i class="fas fa-fw fa-font"></i>':d==="time"?u+='<span aria-label="Time" data-balloon-pos="up"><i class="fas fa-fw fa-clock"></i>':d==="date"?u+='<span aria-label="Date" data-balloon-pos="up"><i class="fas fa-fw fa-calendar"></i>':d==="tags"?u+='<span aria-label="Tags" data-balloon-pos="up"><i class="fas fa-fw fa-tags"></i>':d==="language"?u+='<span aria-label="Language" data-balloon-pos="up"><i class="fas fa-fw fa-globe-americas"></i>':d==="funbox"&&(u+='<span aria-label="Funbox" data-balloon-pos="up"><i class="fas fa-fw fa-gamepad"></i>'),(f=e[d])!=null&&f.all?u+="all":d==="tags"?u+=(g=(p=e.tags)==null?void 0:p.array)==null?void 0:g.map(w=>{var x,B,D;if(w==="none")return w;const k=S();if(k===void 0)return w;const L=(x=k.tags)==null?void 0:x.filter(v=>v._id===w)[0];return L!==void 0?(D=(B=k.tags)==null?void 0:B.filter(v=>v._id===w)[0])==null?void 0:D.display:L}).join(", "):u+=(y=(h=e[d])==null?void 0:h.array)==null?void 0:y.join(", ").replace(/_/g," "),u+="</span></div>",u}let a="";a+=t("date"),a+='<div class="spacer"></div>',a+=t("mode"),a+='<div class="spacer"></div>',(r=(n=e.mode)==null?void 0:n.array)!=null&&r.includes("time")&&(a+=t("time"),a+='<div class="spacer"></div>'),(c=(l=e.mode)==null?void 0:l.array)!=null&&c.includes("words")&&(a+=t("words"),a+='<div class="spacer"></div>'),a+=t("difficulty"),a+='<div class="spacer"></div>',a+=t("punctuation"),a+='<div class="spacer"></div>',a+=t("numbers"),a+='<div class="spacer"></div>',a+=t("language"),a+='<div class="spacer"></div>',a+=t("funbox"),a+='<div class="spacer"></div>',a+=t("tags"),setTimeout(()=>{s(".pageAccount .group.chart .above").html(a)},0)}function L1(e,t){Au();try{e==="date"&&Qa("date",!1);const o=!j[e][t];j[e][t]=o,ds()}catch(a){m("Something went wrong toggling filter. Reverting to defaults.",0),console.log("toggling filter error"),console.error(a),Mu(),vs()}}s(".pageAccount .filterButtons .buttonsAndTitle .buttons, .pageAccount .group.topFilters .buttonsAndTitle.testDate .buttons").on("click","button",e=>{const t=s(e.target).parents(".buttons").attr("group"),a=s(e.target).attr("filter");s(e.target).hasClass("allFilters")?(_s(zo()).forEach(o=>{o==="_id"||o==="name"||Qa(o,!0)}),Qa("date",!1),j.date.all=!0):s(e.target).hasClass("noFilters")?_s(zo()).forEach(o=>{o==="_id"||o==="name"||o!=="date"&&Qa(o,!1)}):s(e.target).is("button")&&(e.shiftKey?(Qa(t,!1),j[t][a]=!0):L1(t,a)),vs(),ds()});s(".pageAccount .topFilters button.allFilters").on("click",()=>{Au(),console.log(zo()),_s(zo()).forEach(e=>{e==="_id"||e==="name"||Qa(e,!0)}),Qa("date",!1),j.date.all=!0,vs(),ds()});s(".pageAccount .topFilters button.currentConfigFilter").on("click",()=>{var e,t;if(Au(),_s(zo()).forEach(a=>{a==="_id"||a==="name"||Qa(a,!1)}),j.pb.no=!0,j.pb.yes=!0,j.difficulty[i.difficulty]=!0,j.mode[i.mode]=!0,i.mode==="time")if([15,30,60,120].includes(i.time)){const a=i.time;j.time[a]=!0}else j.time.custom=!0;else if(i.mode==="words")if([10,25,50,100,200].includes(i.words)){const a=i.words;j.words[a]=!0}else j.words.custom=!0;else i.mode==="quote"&&["short","medium","long","thicc"].forEach((o,n)=>{i.quoteLength.includes(n)?j.quoteLength[o]=!0:j.quoteLength[o]=!1});if(i.punctuation?j.punctuation.on=!0:j.punctuation.off=!0,i.numbers?j.numbers.on=!0:j.numbers.off=!0,i.mode==="quote"&&/english.*/.test(i.language)?j.language.english=!0:j.language[i.language]=!0,i.funbox==="none")j.funbox.none=!0;else for(const a of i.funbox.split("#"))j.funbox[a]=!0;j.tags.none=!0,(t=(e=S())==null?void 0:e.tags)==null||t.forEach(a=>{a.active===!0&&(j.tags.none=!1,j.tags[a._id]=!0)}),j.date.all=!0,vs(),ds()});s(".pageAccount .topFilters button.toggleAdvancedFilters").on("click",()=>{s(".pageAccount .filterButtons").slideToggle(250),s(".pageAccount .topFilters button.toggleAdvancedFilters").toggleClass("active")});async function W1(){var o;let e;try{e=await hd()}catch(n){console.error(ee(n,"Failed to append language buttons"))}if(e){let n="";for(const l of e)n+=`<button filter="${l}">${os(l)}</button>`;const r=document.querySelector(".pageAccount .content .filterButtons .buttonsAndTitle.languages .buttons");r&&(r.innerHTML=n)}let t;try{t=await ui()}catch(n){console.error(ee(n,"Failed to append funbox buttons"))}if(t){let n="";for(const l of t)n+=`<button filter="${l.name}">${l.name.replace(/_/g," ")}</button>`;const r=document.querySelector(".pageAccount .content .filterButtons .buttonsAndTitle.funbox .buttons");r&&(r.innerHTML='<button filter="none">none</button>'+n)}const a=S();if((((o=a==null?void 0:a.tags)==null?void 0:o.length)??0)>0){s(".pageAccount .content .filterButtons .buttonsAndTitle.tags").removeClass("hidden");let n='<button filter="none">no tag</button>';for(const l of(a==null?void 0:a.tags)??[])n+=`<button filter="${l._id}">${l.display}</button>`;const r=document.querySelector(".pageAccount .content .filterButtons .buttonsAndTitle.tags .buttons");r&&(r.innerHTML=n)}else s(".pageAccount .content .filterButtons .buttonsAndTitle.tags").addClass("hidden");$u()}function I1(){s(".pageAccount .content .filterButtons .buttonsAndTitle.languages .buttons").empty(),s(".pageAccount .content .filterButtons .buttonsAndTitle.funbox .buttons").empty(),s(".pageAccount .content .filterButtons .buttonsAndTitle.tags .buttons").empty()}s(".group.presetFilterButtons .filterBtns").on("click",".filterPresets .delete-filter-preset",e=>{A1(s(e.currentTarget).data("id"))});function E1(e){const t=ty(e);return Object.entries(Tt).forEach(a=>{const o=a[0],n=a[1];t[o]===void 0&&(t[o]=n)}),t}function B1(e,t){s(".pageAccount .miniResultChartWrapper").css({top:t,left:e})}function P1(){s(".pageAccount .miniResultChartWrapper").stop(!0,!0).fadeIn(125),s(".pageAccount .miniResultChartBg").stop(!0,!0).fadeIn(125)}function sy(){s(".pageAccount .miniResultChartWrapper").stop(!0,!0).fadeOut(125),s(".pageAccount .miniResultChartBg").stop(!0,!0).fadeOut(125)}function q1(e){let t=[];for(let r=1;r<=e.wpm.length;r++)t.push(r.toString());e.wpm=e.wpm.slice(0,e.raw.length),e.err=e.err.slice(0,e.raw.length),t=t.slice(0,e.raw.length);const a=Pp(e.raw,1);qt.data.labels=t,qt.getDataset("wpm").data=e.wpm,qt.getDataset("raw").data=a,qt.getDataset("error").data=e.err;const o=Math.max(Math.max(...e.wpm),Math.max(...e.raw)),n=Math.min(Math.min(...e.wpm),Math.min(...e.raw));qt.getScale("wpm").max=Math.round(o),qt.getScale("raw").max=Math.round(o),i.startGraphsAtZero?(qt.getScale("wpm").min=0,qt.getScale("raw").min=0):(qt.getScale("wpm").min=Math.round(n),qt.getScale("raw").min=Math.round(n)),qt.updateColors()}s(document).on("keydown",e=>{e.key==="Escape"&&no(".pageAccount .miniResultChartWrapper")&&(sy(),e.preventDefault())});s(".pageAccount").on("click",".miniResultChartBg",()=>{sy()});function Lu(){s(".pageAccount .globalTimeTyping .val").text("-"),s(".pageAccount .globalTestsStarted .val").text("-"),s(".pageAccount .globalTestsCompleted .val").text("-")}function F1(){var t;const e=S();if(e){if(e.typingStats!==void 0){const a=((t=e==null?void 0:e.typingStats)==null?void 0:t.timeTyping)??0;let o="";a===0?o="-":o=dt(Math.round(a),!0,!0),s(".pageAccount .globalTimeTyping .val").text(o)}e.typingStats!==void 0&&(s(".pageAccount .globalTestsStarted .val").text(e.typingStats.startedTests),s(".pageAccount .globalTestsCompleted .val").text(e.typingStats.completedTests))}}function D1(e){const t=e?"Profile":"Account",o=e?"":`<div class="buttonGroup"><button
  class="showAllButton"
  data-balloon-pos="left"
  aria-label="Show all personal bests"
>
  <i class="fas fa-ellipsis-v"></i>
</button></div>`;s(`.page${t} .profile .pbsWords`).html(`
      <div class="group">
      <div class="quick">
        <div class="test">10 words</div>
        <div class="wpm">-</div>
        <div class="acc">-</div>
      </div>
    </div>
    <div class="group">
      <div class="quick">
        <div class="test">25 words</div>
        <div class="wpm">-</div>
        <div class="acc">-</div>
      </div>
    </div>
    <div class="group">
      <div class="quick">
        <div class="test">50 words</div>
        <div class="wpm">-</div>
        <div class="acc">-</div>
      </div>
    </div>
    <div class="group">
      <div class="quick">
        <div class="test">100 words</div>
        <div class="wpm">-</div>
        <div class="acc">-</div>
      </div>
    </div>
    ${o}
  `),s(`.page${t} .profile .pbsTime`).html(`
      <div class="group">
      <div class="quick">
        <div class="test">15 seconds</div>
        <div class="wpm">-</div>
        <div class="acc">-</div>
      </div>
    </div>
    <div class="group">
      <div class="quick">
        <div class="test">30 seconds</div>
        <div class="wpm">-</div>
        <div class="acc">-</div>
      </div>
    </div>
    <div class="group">
      <div class="quick">
        <div class="test">60 seconds</div>
        <div class="wpm">-</div>
        <div class="acc">-</div>
      </div>
    </div>
    <div class="group">
      <div class="quick">
        <div class="test">120 seconds</div>
        <div class="wpm">-</div>
        <div class="acc">-</div>
      </div>
    </div>
    ${o}
  `)}function Jc(e,t=!1){if(D1(t),e===void 0)return;let a="";const o=t?"Profile":"Account";s(`.page${o} .profile .pbsTime`).html(""),s(`.page${o} .profile .pbsWords`).html("");const n=["15","30","60","120"],r=["10","25","50","100"];n.forEach(c=>{a+=Ef(e,"time",c)});const l=t?"":`<div class="buttonGroup"><button
      class="showAllButton"
      data-balloon-pos="left"
      aria-label="Show all personal bests"
    >
      <i class="fas fa-ellipsis-v"></i>
    </button></div>`;s(`.page${o} .profile .pbsTime`).append(a+l),a="",r.forEach(c=>{a+=Ef(e,"words",c)}),s(`.page${o} .profile .pbsWords`).append(a+l)}function Ef(e,t,a){let o="",n="";const r=`${a} ${t==="time"?"seconds":"words"}`,l=i.typingSpeedUnit;try{const c=(e[t][a]??[]).sort((u,f)=>f.wpm-u.wpm)[0];if(c===void 0)throw new Error("No PB data found");const d=new Date(c.timestamp);c.timestamp&&(n=_e(d,"dd MMM yyyy")),o=`<div class="quick">
      <div class="test">${r}</div>
      <div class="wpm">${_.typingSpeed(c.wpm,{showDecimalPlaces:!1})}</div>
      <div class="acc">${_.accuracy(c.acc,{showDecimalPlaces:!1})}</div>
    </div>
    <div class="fullTest">
      <div>${r}</div>
      <div>${_.typingSpeed(c.wpm,{suffix:` ${l}`})}</div>
      <div>${_.typingSpeed(c.raw,{suffix:" raw"})}</div>
      <div>${_.accuracy(c.acc,{suffix:" acc"})}</div>
      <div>${_.percentage(c.consistency,{suffix:" con"})}</div>
      <div>${n}</div>
    </div>`}catch{o=`<div class="quick">
    <div class="test">${r}</div>
    <div class="wpm">-</div>
    <div class="acc">-</div>
  </div>`}return`
  <div class="group">
  ${o}
  </div>
  `}const oy={1:{id:1,name:"Developer",description:"I made this",icon:"fa-laptop",color:"white",customStyle:"animation: rgb-bg 10s linear infinite;"},2:{id:2,name:"Collaborator",description:"I helped make this",icon:"fa-code",color:"white",customStyle:"animation: rgb-bg 10s linear infinite;"},3:{id:3,name:"Server Mod",description:"Discord server moderator",icon:"fa-hammer",color:"white",customStyle:"animation: rgb-bg 10s linear infinite;"},4:{id:4,name:"OG Account",description:"First 1000 users on the site",icon:"fa-baby",color:"var(--bg-color)",background:"var(--main-color)"},5:{id:5,name:"OG Discordian",description:"First 1000 Discord server members",icon:"fa-baby",color:"var(--bg-color)",background:"var(--main-color)"},6:{id:6,name:"Supporter",description:"Donated money",icon:"fa-heart",color:"var(--text-color)",background:"var(--sub-color)"},7:{id:7,name:"Sugar Daddy",description:"Donated a lot of money",icon:"fa-gem",color:"var(--bg-color)",background:"var(--main-color)"},8:{id:8,name:"Monkey Supporter",description:"Donated more money",icon:"fa-heart",color:"var(--bg-color)",background:"var(--main-color)"},9:{id:9,name:"White Hat",description:"Reported critical vulnerabilities on the site",icon:"fa-user-secret",color:"var(--bg-color)",background:"var(--main-color)"},10:{id:10,name:"Bug Hunter",description:"Reported or helped track down bugs on the site",icon:"fa-bug",color:"var(--text-color)",background:"var(--sub-color)"},11:{id:11,name:"Content Creator",description:"Verified content creator",icon:"fa-video",color:"var(--text-color)",background:"var(--sub-color)"},12:{id:12,name:"Contributor",description:"Contributed to the site",icon:"fa-hands-helping",color:"var(--text-color)",background:"var(--sub-color)"},13:{id:13,name:"Mythical",description:"Yes, I'm actually this fast",icon:"fa-rocket",color:"white",customStyle:"animation: rgb-bg 10s linear infinite;"},14:{id:14,name:"All Year Long",description:"Reached a streak of 365 days",icon:"fa-fire",color:"var(--bg-color)",background:"var(--main-color)"}};function Zr(e,t=!1,a=!1,o=!1){const n=oy[e];if(!n&&!o)return"";let r="";(n==null?void 0:n.background)!==void 0&&(r+=`background: ${n.background};`),(n==null?void 0:n.color)!==void 0&&(r+=`color: ${n.color};`),(n==null?void 0:n.customStyle)!==void 0&&(r+=n.customStyle);const l=(n==null?void 0:n.name)??"Badge Name Missing",c=(n==null?void 0:n.description)??"Badge Description Missing",d=(t?l+": ":"")+c;let u="";a||(u=`aria-label="${d}" data-balloon-pos="right"`);let f="";(n==null?void 0:n.icon)!==void 0?f=`<i class="fas ${t?"fa-fw":""} ${n.icon}"></i>`:f='<i class="fas fa-question"></i>';const p=`<div class="text">${l}</div>`;return`<div class="badge" ${u} style="${r}">${f}${t?"":p}</div>`}function R1(e){return oy[e]}async function Xr(e,t){var q,G,ze,Fe,Ie,ot,Jt,tc,co,ln,cn,dn,Fi,un,Cs,ma,Di,uo,fn,pn;const a=e.charAt(0).toUpperCase()+e.slice(1),o=s(`.page${a} .profile`),n=s(`.page${a} .profile .details`);o.attr("uid",t.uid??""),o.attr("name",t.name??"");const r=t.banned===!0;if(n===void 0||t===void 0||t.name===void 0||t.addedAt===void 0)return;if(n.find(".placeholderAvatar").removeClass("hidden"),t.discordAvatar!==void 0&&t.discordId!==void 0&&!r?pd(t.discordId,t.discordAvatar,256).then(we=>{we!==null&&(n.find(".placeholderAvatar").addClass("hidden"),n.find(".avatar").css("background-image",`url(${we})`))}):n.find(".avatar").removeAttr("style"),(q=t.inventory)!=null&&q.badges&&!r){let we="",b="";for(const Z of t.inventory.badges)Z.selected===!0?we=Zr(Z.id):b+=Zr(Z.id,!0);n.find(".badges").empty().append(we),n.find(".allBadges").empty().append(b)}n.find(".name").text(t.name),n.find(".userFlags").html(El(t)),t.lbOptOut===!0&&(e==="profile"?o.find(".lbOptOutReminder").removeClass("hidden").text("Note: This account has opted out of the leaderboards, meaning their results aren't verified by the anticheat system and may not be legitimate."):o.find(".lbOptOutReminder").addClass("hidden")),setTimeout(()=>{Wu(e)},10);const l="Joined "+_e(t.addedAt??0,"dd MMM yyyy"),c=new Date(t.addedAt),d=hw(new Date,c),u=`${d} day${d!==1?"s":""} ago`;n.find(".joined").text(l).attr("aria-label",u);let f="";if(t.streak&&(t==null?void 0:t.streak)>1?(n.find(".streak").text(`Current streak: ${t.streak} ${t.streak===1?"day":"days"}`),f=`Longest streak: ${t.maxStreak} ${t.maxStreak===1?"day":"days"}`):(n.find(".streak").text(""),f=""),e==="account"){const we=(G=S())==null?void 0:G.results,b=we==null?void 0:we[0],Z=t.streakHourOffset,re=1e3*60*60*24;let kt=Ni(Z)+re;kt<Date.now()&&(kt+=re);const Zt=Rp(kt);if(console.debug("Streak hour offset"),console.debug("date.now()",Date.now(),new Date(Date.now())),console.debug("dayInMilis",re),console.debug("difTarget",new Date(Ni(Z)+re)),console.debug("timeDif",Zt),console.debug("Misc.getCurrentDayTimestamp()",Ni(),new Date(Ni())),console.debug("profile.streakHourOffset",Z),b){const ga=Rv(b.timestamp,Z),ce=Ov(b.timestamp,Z);console.debug("lastResult.timestamp",b.timestamp,new Date(b.timestamp)),console.debug("isToday",ga),console.debug("isYesterday",ce);const Bt=Z?`(${Z>0?"+":""}${Z} offset)`:"";ga?(f+=`
Claimed today: yes`,f+=`
Come back in: ${Zt} ${Bt}`):(f+=`
Claimed today: no`,f+=`
Streak lost in: ${Zt} ${Bt}`),console.debug(f),Z===void 0&&(f+=`

If the streak reset time doesn't line up with your timezone, you can change it in Settings > Danger zone > Update streak hour offset.`)}}n.find(".streak").attr("aria-label",f).attr("data-balloon-break","");let p="",g="";t.typingStats.completedTests!==void 0&&t.typingStats.startedTests!==void 0&&(p=Math.floor(t.typingStats.completedTests/t.typingStats.startedTests*100).toString(),g=((t.typingStats.startedTests-t.typingStats.completedTests)/t.typingStats.completedTests).toFixed(1));const h=n.find(".typingStats");h.find(".started .value").text(((ze=t.typingStats)==null?void 0:ze.startedTests)??0),h.find(".completed .value").text(((Fe=t.typingStats)==null?void 0:Fe.completedTests)??0).attr("data-balloon-pos","up").attr("aria-label",`${p}% (${g} restarts per completed test)`),h.find(".timeTyping .value").text(dt(Math.round(((Ie=t.typingStats)==null?void 0:Ie.timeTyping)??0),!0,!0));let y=!1,w=!1,k=!1;if(!r&&(y=!!(((ot=t.details)==null?void 0:ot.bio)??""),n.find(".bio .value").text(((Jt=t.details)==null?void 0:Jt.bio)??""),w=!!(((tc=t.details)==null?void 0:tc.keyboard)??""),n.find(".keyboard .value").text(((co=t.details)==null?void 0:co.keyboard)??""),((ln=t.details)==null?void 0:ln.socialProfiles.github)!==void 0||((cn=t.details)==null?void 0:cn.socialProfiles.twitter)!==void 0||((dn=t.details)==null?void 0:dn.socialProfiles.website)!==void 0)){k=!0;const we=n.find(".socials .value");we.empty();const b=((Fi=t.details)==null?void 0:Fi.socialProfiles.github)??"";b&&we.append(`<a href='https://github.com/${aa(b)}/' target="_blank" rel="nofollow me" aria-label="${aa(b)}" data-balloon-pos="up" class="textButton"><i class="fab fa-fw fa-github"></i></a>`);const Z=((un=t.details)==null?void 0:un.socialProfiles.twitter)??"";Z&&we.append(`<a href='https://twitter.com/${aa(Z)}' target="_blank" rel="nofollow me" aria-label="${aa(Z)}" data-balloon-pos="up" class="textButton"><i class="fab fa-fw fa-twitter"></i></a>`);const re=((Cs=t.details)==null?void 0:Cs.socialProfiles.website)??"",kt=/^https?:\/\/(?:www\.)?([^/]+)/,Zt=((ma=re==null?void 0:re.match(kt))==null?void 0:ma[1])??re;re&&we.append(`<a href='${aa(re)}' target="_blank" rel="nofollow me" aria-label="${aa(Zt??"")}" data-balloon-pos="up" class="textButton"><i class="fas fa-fw fa-globe"></i></a>`)}const L=t.xp??0,x=As(L),B=Math.floor(x),D=Hv(B),v=Math.round(D*(x%1));if(n.find(".level").text(B).attr("aria-label",`${Ki(L)} total xp`),n.find(".xp").text(`${Ki(v)}/${Ki(D)}`),n.find(".xpBar .bar").css("width",`${v/D*100}%`),n.find(".xp").attr("aria-label",`${Ki(D-v)} xp until next level`),r)o.find(".leaderboardsPositions").addClass("hidden");else{o.find(".leaderboardsPositions").removeClass("hidden");const we=((uo=(Di=t.allTimeLbs.time)==null?void 0:Di["15"])==null?void 0:uo.english)??null,b=((pn=(fn=t.allTimeLbs.time)==null?void 0:fn["60"])==null?void 0:pn.english)??null;we===null&&b===null?o.find(".leaderboardsPositions").addClass("hidden"):(we!==null&&(o.find(".leaderboardsPositions .group.t15 .pos").text(_.rank(we==null?void 0:we.rank)),o.find(".leaderboardsPositions .group.t15 .topPercentage").text(Bf(we))),b!==null&&(o.find(".leaderboardsPositions .group.t60 .pos").text(_.rank(b==null?void 0:b.rank)),o.find(".leaderboardsPositions .group.t60 .topPercentage").text(Bf(b))))}const C=y||w;y?n.find(".bio").removeClass("hidden"):n.find(".bio").addClass("hidden"),w?n.find(".keyboard").removeClass("hidden"):n.find(".keyboard").addClass("hidden"),C?(n.find(".bioAndKeyboard").removeClass("hidden"),n.find(".sep2").removeClass("hidden")):(n.find(".bioAndKeyboard").addClass("hidden"),n.find(".sep2").addClass("hidden")),k?(n.find(".socials").removeClass("hidden"),n.find(".sep3").removeClass("hidden")):(n.find(".socials").addClass("hidden"),n.find(".sep3").addClass("hidden")),n.removeClass("none"),n.removeClass("bioAndKey"),n.removeClass("soc"),n.removeClass("both"),!k&&!C?n.addClass("none"):k&&!C?n.addClass("soc"):!k&&C?n.addClass("bioAndKey"):k&&C&&n.addClass("both")}function Wu(e){if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent))return;let a;if(e==="account"?a=s(".pageAccount .profile .details"):e==="profile"&&(a=s(".pageProfile .profile .details")),!a)return;const o=a.find(".user"),n=o.parent()[0],r=o[0],l=ss(2);if(!r||!n)return;r.style.fontSize="10px";const c=n.clientWidth,d=r.clientWidth,f=c/d*10,p=Math.min(Math.max(f,10),l);r.style.fontSize=`${p}px`}const O1=wd(1e3,()=>{const e=ne();e&&["account","profile"].includes(e)&&Wu(e)});s(window).on("resize",()=>{O1()});function Bf(e){return e.rank===void 0?"-":e.rank===1?"GOAT":"Top "+_.percentage(e.rank/e.count*100)}let ny;function Iu(){return ny}async function H1(){const e=await E.configuration.get();if(e.status!==200){console.error("Could not fetch configuration",e.message);return}else ny=e.data??void 0}function Zc(){s(".pageAccount .resultBatches").addClass("hidden")}function _1(){s(".pageAccount .resultBatches").removeClass("hidden")}async function N1(){var f,p,g,h,y;const e=(f=S())==null?void 0:f.results;if(e===void 0){console.error("(Result batches) Results are missing but they should be available at the time of drawing the account page?"),Zc();return}K1();const t=((g=(p=S())==null?void 0:p.typingStats)==null?void 0:g.completedTests)??0,a=Math.round(e.length/t*100),o=((h=Iu())==null?void 0:h.results.limits)??{regularUser:0,premiumUser:0},n=(y=S())!=null&&y.isPremium?o.premiumUser:o.regularUser,r=Math.round((e==null?void 0:e.length)/n*100),l=s(".pageAccount .resultBatches .bars"),c={downloaded:{fill:l.find(".downloaded .fill"),rightText:l.find(".downloaded.rightText")},limit:{fill:l.find(".limit .fill"),rightText:l.find(".limit.rightText")}};c.downloaded.fill.css("width",Math.min(a,100)+"%"),c.downloaded.rightText.text(`${e==null?void 0:e.length} / ${t} (${a}%)`);const d=await ms();c.limit.fill.css({width:Math.min(r,100)+"%",background:Vt(d.sub,d.error,Sr(r,50,100,0,1))}),c.limit.rightText.text(`${e==null?void 0:e.length} / ${n} (${r}%)`),s(".pageAccount .resultBatches > .text").text(""),e.length>=t&&(Xc(),Pf("all results loaded")),e.length>=n&&(Xc(),Pf("limit reached"))}function Xc(){s(".pageAccount .resultBatches button").prop("disabled",!0)}function K1(){s(".pageAccount .resultBatches button").prop("disabled",!1)}function Pf(e){s(".pageAccount .resultBatches button").text(e)}function z1(){var o,n,r,l;if(!(((o=S())==null?void 0:o.isPremium)??!1)){Zc();return}const t=((r=(n=S())==null?void 0:n.typingStats)==null?void 0:r.completedTests)??0,a=((l=Iu())==null?void 0:l.results.maxBatchSize)??0;if(t<=a){Zc();return}_1()}let Je=!1;function U1(){Je=!Je,Je&&console.log("filterDebug is on")}let xe=[],xs=0;function Kl(e){var a;if(xe===void 0||xe.length===0)return;let t;e&&e>xs?t=Math.ceil(e/10)*10:t=xs+10;for(let o=xs;o<t;o++){const n=xe[o];if(!n)continue;let r=n.difficulty;r===void 0&&(r="normal");let l=`<span aria-label="${(a=n.language)==null?void 0:a.replace("_"," ")}" data-balloon-pos="up"><i class="fas fa-fw fa-globe-americas"></i></span>`;r==="normal"?l+=`<span aria-label="${n.difficulty}" data-balloon-pos="up"><i class="far fa-fw fa-star"></i></span>`:r==="expert"?l+=`<span aria-label="${n.difficulty}" data-balloon-pos="up"><i class="fas fa-fw fa-star-half-alt"></i></span>`:r==="master"&&(l+=`<span aria-label="${n.difficulty}" data-balloon-pos="up"><i class="fas fa-fw fa-star"></i></span>`),n.punctuation&&(l+='<span aria-label="punctuation" data-balloon-pos="up"><i class="fas fa-fw fa-at"></i></span>'),n.numbers&&(l+='<span aria-label="numbers" data-balloon-pos="up"><i class="fas fa-fw fa-hashtag"></i></span>'),n.blindMode&&(l+='<span aria-label="blind mode" data-balloon-pos="up"><i class="fas fa-fw fa-eye-slash"></i></span>'),n.lazyMode&&(l+='<span aria-label="lazy mode" data-balloon-pos="up"><i class="fas fa-fw fa-couch"></i></span>'),n.funbox!=="none"&&n.funbox!==void 0&&(l+=`<span aria-label="${n.funbox.replace(/_/g," ").replace(/#/g,", ")}" data-balloon-pos="up"><i class="fas fa-gamepad"></i></span>`),n.chartData===void 0?l+='<span class="miniResultChartButton" aria-label="No chart data found" data-balloon-pos="up"><i class="fas fa-chart-line"></i></span>':n.chartData==="toolong"?l+='<span class="miniResultChartButton" aria-label="Chart history is not available for long tests" data-balloon-pos="up"><i class="fas fa-chart-line"></i></span>':l+=`<span class="miniResultChartButton" aria-label="View graph" data-balloon-pos="up" filteredResultsId="${o}" style="opacity: 1"><i class="fas fa-chart-line"></i></span>`;let c="no tags";n.tags!==void 0&&n.tags.length>0&&(c="",n.tags.forEach(w=>{var k,L;(L=(k=S())==null?void 0:k.tags)==null||L.forEach(x=>{w===x._id&&(c+=x.display+", ")})}),c=c.substring(0,c.length-2));let d;n.tags===void 0?d="[]":d=JSON.stringify(n.tags);const u=n.tags!==void 0&&n.tags.length>0,f=n.tags!==void 0&&n.tags.length>1?"fa-tags":"fa-tag",p=`<button class="textButton resultEditTagsButton ${u?"active":""}" data-result-id="${n._id}" data-tags='${d}' aria-label="${c}" data-balloon-pos="up"><i class="fas fa-fw ${f}"></i></button>`;let g="";n.isPb?g='<i class="fas fa-fw fa-crown"></i>':g="";const h=n.charStats.join("/"),y=new Date(n.timestamp);s(".pageAccount .history table tbody").append(`
    <tr class="resultRow" id="result-${o}">
    <td>${g}</td>
    <td>${_.typingSpeed(n.wpm,{showDecimalPlaces:!0})}</td>
    <td>${_.typingSpeed(n.rawWpm,{showDecimalPlaces:!0})}</td>
    <td>${_.percentage(n.acc,{showDecimalPlaces:!0})}</td>
    <td>${_.percentage(n.consistency,{showDecimalPlaces:!0})}</td>
    <td>${h}</td>
    <td>${n.mode} ${n.mode2}</td>
    <td class="infoIcons">${l}</td>
    <td>${p}</td>
    <td>${_e(y,"dd MMM yyyy")}<br>
    ${_e(y,"HH:mm")}
    </td>
    </tr>`)}xs=t,xs>=xe.length?s(".pageAccount .loadMoreButton").addClass("hidden"):s(".pageAccount .loadMoreButton").removeClass("hidden")}async function V1(){await H.updateColors(),await Te(0),await ja.updateColors(),await Te(0),await Eo.updateColors(),await Te(0)}function j1(){s(".pageAccount .history table tbody").empty(),Eo.getDataset("count").data=[],ja.getDataset("count").data=[],ja.getDataset("avgWpm").data=[],H.getDataset("wpm").data=[],H.getDataset("pb").data=[],H.getDataset("acc").data=[],H.getDataset("wpmAvgTen").data=[],H.getDataset("accAvgTen").data=[],H.getDataset("wpmAvgHundred").data=[],H.getDataset("accAvgHundred").data=[]}let lr=0,pt=[],yo=[];async function iy(){var fn,pn,we;$r("Displaying stats..."),oa(100),console.log("updating account page"),yi(),F1();const e=S();if(!e)return;Jc(e.personalBests),Xr("account",e),N1(),pt=[],yo=[];const t=[];xs=0;let a=0,o="",n=0,r=0,l=0,c=0,d=0,u=0,f=0,p=0;const g={total:0,count:0,last10Total:0,last10Count:0,max:0};let h=0;lr=0;let y=0,w=0,k=0,L=0;const x={},B=[],D=et(i.typingSpeedUnit);xe=[],s(".pageAccount .history table tbody").empty(),(pn=(fn=S())==null?void 0:fn.results)==null||pn.forEach(b=>{var Bt,mn,Ri,Oi;try{if(!Ee("pb",b.isPb?"yes":"no")){Je&&console.log("skipping result due to pb filter",b);return}let St=b.difficulty;if(St===void 0&&(St="normal"),!Ee("difficulty",St)){Je&&console.log("skipping result due to difficulty filter",b);return}if(!Ee("mode",b.mode)){Je&&console.log("skipping result due to mode filter",b);return}if(b.mode==="time"){let De="custom";if(["15","30","60","120"].includes(`${b.mode2}`)&&(De=`${b.mode2}`),!Ee("time",De)){Je&&console.log("skipping result due to time filter",b);return}}else if(b.mode==="words"){let De="custom";if(["10","25","50","100","200"].includes(`${b.mode2}`)&&(De=`${b.mode2}`),!Ee("words",De)){Je&&console.log("skipping result due to word filter",b);return}}if(b.quoteLength!==null){let De;if(b.quoteLength===0?De="short":b.quoteLength===1?De="medium":b.quoteLength===2?De="long":b.quoteLength===3&&(De="thicc"),De!==void 0&&!Ee("quoteLength",De)){Je&&console.log("skipping result due to quoteLength filter",b);return}}let ks=Ee("language",b.language??"english");if(b.language==="english_expanded"&&Ee("language","english_1k")&&(ks=!0),!ks){Je&&console.log("skipping result due to language filter",b);return}let Hi="off";if(b.punctuation&&(Hi="on"),!Ee("punctuation",Hi)){Je&&console.log("skipping result due to punctuation filter",b);return}let _i="off";if(b.numbers&&(_i="on"),!Ee("numbers",_i)){Je&&console.log("skipping result due to numbers filter",b);return}if(b.funbox==="none"||b.funbox===void 0){if(!Ee("funbox","none")){Je&&console.log("skipping result due to funbox filter",b);return}}else{let De=0;for(const fo of b.funbox.split("#"))if(Ee("funbox",fo)){De++;break}if(De===0){Je&&console.log("skipping result due to funbox filter",b);return}}let ft=!0;if(b.tags===void 0||b.tags.length===0)(((mn=(Bt=S())==null?void 0:Bt.tags)==null?void 0:mn.length)??0)>0?Ee("tags","none")&&(ft=!1):ft=!1;else{const De=(Oi=(Ri=S())==null?void 0:Ri.tags)==null?void 0:Oi.map(fo=>fo._id);if(De===void 0)return;b.tags.forEach(fo=>{ft&&(De!=null&&De.includes(fo)?Ee("tags",fo)&&(ft=!1):Ee("tags","none")&&(ft=!1))})}if(ft){Je&&console.log("skipping result due to tag filter",b);return}const Pt=Math.abs(b.timestamp-Date.now())/1e3;let Gu=!0;if((Ee("date","all")||Ee("date","last_day")&&Pt<=86400||Ee("date","last_week")&&Pt<=604800||Ee("date","last_month")&&Pt<=2592e3||Ee("date","last_3months")&&Pt<=7776e3)&&(Gu=!1),Gu){Je&&console.log("skipping result due to date filter",b);return}xe.push(b)}catch(St){m("Something went wrong when filtering. Resetting filters.",0),console.log(b),console.error(St),Mu(),vs(),Wi();return}h+=Math.round(b.wpm/60*b.testDuration);const Z=new Date(b.timestamp);Z.setSeconds(0),Z.setMinutes(0),Z.setHours(0),Z.setMilliseconds(0);const re=Z.getTime(),kt=x[re];kt!==void 0?(kt.amount++,kt.time+=b.testDuration+b.incompleteTestSeconds-(b.afkDuration??0),kt.totalWpm+=b.wpm):x[re]={amount:1,time:b.testDuration+b.incompleteTestSeconds-(b.afkDuration??0),totalWpm:b.wpm};const Zt=D.histogramDataBucketSize,ga=Math.floor(Math.round(D.fromWpm(b.wpm))/Zt);if(B.length<=ga)for(let St=B.length;St<=ga;St++)B.push(0);B[ga]++;let ce=0;if(b.testDuration===void 0&&b.mode2!=="custom"&&b.mode2!=="zen"?b.mode==="time"?ce=parseInt(b.mode2):b.mode==="words"&&(ce=parseInt(b.mode2)/b.wpm*60):ce=parseFloat(b.testDuration),b.incompleteTestSeconds!==void 0?ce+=b.incompleteTestSeconds:b.restartCount!==void 0&&b.restartCount>0&&(ce+=ce/4*b.restartCount),lr+=ce,c<10&&(c++,d+=b.wpm,p+=b.acc,b.consistency!==void 0&&(k+=b.consistency)),l++,b.consistency!==void 0&&(L++,w+=b.consistency,b.consistency>y&&(y=b.consistency)),b.rawWpm!==null&&(g.last10Count<10&&(g.last10Count++,g.last10Total+=b.rawWpm),g.total+=b.rawWpm,g.count++,b.rawWpm>g.max&&(g.max=b.rawWpm)),b.acc>u&&(u=b.acc),f+=b.acc,b.restartCount!==void 0&&(n+=b.restartCount),pt.push({x:xe.length,y:U(D.fromWpm(b.wpm)),wpm:U(D.fromWpm(b.wpm)),acc:b.acc,mode:b.mode,mode2:b.mode2,punctuation:b.punctuation,language:b.language,timestamp:b.timestamp,difficulty:b.difficulty,raw:U(D.fromWpm(b.rawWpm)),isPb:b.isPb??!1}),t.push(b.wpm),yo.push({x:xe.length,y:b.acc,errorRate:100-b.acc}),b.wpm>a){const St=b.punctuation?",<br>with punctuation":"",ks=b.numbers?",<br> "+(b.punctuation?"&":"")+"with numbers":"";a=b.wpm,b.mode==="custom"?o=b.mode:o=b.mode+" "+b.mode2+St+ks}r+=b.wpm}),s(".pageAccount .group.history table thead tr td:nth-child(2)").text(i.typingSpeedUnit),await Te(0),Kl();const v=[],C=[],q=D.historyStepSize;for(const b of Object.keys(x)){const Z=parseInt(b),re=x[Z];re!==void 0&&(v.push({x:Z,y:re.time/60,amount:re.amount}),C.push({x:Z,y:U(D.fromWpm(re.totalWpm)/re.amount)}))}const ze=ja.options.scales.avgWpm;ze.title.text="Average "+i.typingSpeedUnit,ze.ticks.stepSize=q,ja.getDataset("count").data=v,ja.getDataset("avgWpm").data=C;const Fe=[],Ie=[],ot=D.histogramDataBucketSize,Jt=ot-(ot<=1?.01:1);B.forEach((b,Z)=>{const re=Z*ot;Ie.push(`${re} - ${re+Jt}`),Fe.push({x:re,y:b})}),Eo.data.labels=Ie,Eo.getDataset("count").data=Fe;const co=H.options.scales.wpm;if(co.title.text=D.fullUnitString,pt.length>0){let b=0;const Z=[];for(let ce=pt.length-1;ce>=0;ce--){const Bt=pt[ce];Bt.y>b&&(b=Bt.y,Z.push(Bt))}Z.push({x:1,y:(we=Sp(Z))==null?void 0:we.y});const re=[],kt=[],Zt=[],ga=[];for(let ce=0;ce<pt.length;ce++){const Bt=pt.slice(ce,ce+10),mn=yo.slice(ce,ce+10),Ri=Bt.reduce((ft,{y:Pt})=>ft+Pt,0)/Bt.length,Oi=mn.reduce((ft,{y:Pt})=>ft+Pt,0)/mn.length;re.push({x:ce+1,y:Ri}),kt.push({x:ce+1,y:Oi});const St=pt.slice(ce,ce+100),ks=yo.slice(ce,ce+100),Hi=St.reduce((ft,{y:Pt})=>ft+Pt,0)/St.length,_i=ks.reduce((ft,{y:Pt})=>ft+Pt,0)/ks.length;Zt.push({x:ce+1,y:Hi}),ga.push({x:ce+1,y:_i})}H.getDataset("wpm").data=pt,H.getDataset("pb").data=Z,H.getDataset("acc").data=yo,H.getDataset("wpmAvgTen").data=re,H.getDataset("accAvgTen").data=kt,H.getDataset("wpmAvgHundred").data=Zt,H.getDataset("accAvgHundred").data=ga,H.getScale("x").max=pt.length+1}const ln=pt.map(b=>b.y),cn=Math.min(...ln),dn=Math.max(...ln),Fi=isFinite(cn)?cn:0,un=isFinite(dn)?dn:0,Cs=Math.floor(un)+(q-Math.floor(un)%q);if(co.max=Cs,co.ticks.stepSize=q,H.getScale("pb").max=Cs,H.getScale("wpmAvgTen").max=Cs,H.getScale("wpmAvgHundred").max=Cs,i.startGraphsAtZero)H.getScale("wpm").min=0,H.getScale("pb").min=0,H.getScale("wpmAvgTen").min=0,H.getScale("wpmAvgHundred").min=0;else{const b=Math.floor(Fi/q)*q;H.getScale("wpm").min=b,H.getScale("pb").min=b,H.getScale("wpmAvgTen").min=b,H.getScale("wpmAvgHundred").min=b}pt===void 0||pt.length===0?(s(".pageAccount .group.noDataError").removeClass("hidden"),s(".pageAccount .group.chart").addClass("hidden"),s(".pageAccount .group.dailyActivityChart").addClass("hidden"),s(".pageAccount .group.histogramChart").addClass("hidden"),s(".pageAccount .group.aboveHistory").addClass("hidden"),s(".pageAccount .group.history").addClass("hidden"),s(".pageAccount .triplegroup.stats").addClass("hidden"),s(".pageAccount .group.estimatedWordsTyped").addClass("hidden")):(s(".pageAccount .group.noDataError").addClass("hidden"),s(".pageAccount .group.chart").removeClass("hidden"),s(".pageAccount .group.dailyActivityChart").removeClass("hidden"),s(".pageAccount .group.histogramChart").removeClass("hidden"),s(".pageAccount .group.aboveHistory").removeClass("hidden"),s(".pageAccount .group.history").removeClass("hidden"),s(".pageAccount .triplegroup.stats").removeClass("hidden"),s(".pageAccount .group.estimatedWordsTyped").removeClass("hidden")),s(".pageAccount .timeTotalFiltered .val").text(dt(Math.round(lr),!0,!0));const ma=i.typingSpeedUnit;s(".pageAccount .highestWpm .title").text(`highest ${ma}`),s(".pageAccount .highestWpm .val").text(_.typingSpeed(a)),s(".pageAccount .averageWpm .title").text(`average ${ma}`),s(".pageAccount .averageWpm .val").text(_.typingSpeed(r/l)),s(".pageAccount .averageWpm10 .title").text(`average ${ma} (last 10 tests)`),s(".pageAccount .averageWpm10 .val").text(_.typingSpeed(d/c)),s(".pageAccount .highestRaw .title").text(`highest raw ${ma}`),s(".pageAccount .highestRaw .val").text(_.typingSpeed(g.max)),s(".pageAccount .averageRaw .title").text(`average raw ${ma}`),s(".pageAccount .averageRaw .val").text(_.typingSpeed(g.total/g.count)),s(".pageAccount .averageRaw10 .title").text(`average raw ${ma} (last 10 tests)`),s(".pageAccount .averageRaw10 .val").text(_.typingSpeed(g.last10Total/g.last10Count)),s(".pageAccount .highestWpm .mode").html(o),s(".pageAccount .testsTaken .val").text(l),s(".pageAccount .highestAcc .val").text(_.accuracy(u)),s(".pageAccount .avgAcc .val").text(_.accuracy(f/l)),s(".pageAccount .avgAcc10 .val").text(_.accuracy(p/c)),w===0||w===void 0?(s(".pageAccount .avgCons .val").text("-"),s(".pageAccount .avgCons10 .val").text("-")):(s(".pageAccount .highestCons .val").text(_.percentage(y)),s(".pageAccount .avgCons .val").text(_.percentage(w/L)),s(".pageAccount .avgCons10 .val").text(_.percentage(k/Math.min(c,L)))),s(".pageAccount .testsStarted .val").text(`${l+n}`),s(".pageAccount .testsCompleted .val").text(`${l}(${Math.floor(l/(l+n)*100)}%)`),s(".pageAccount .testsCompleted .avgres").text(`
    ${(n/l).toFixed(1)} restarts per completed test
  `);const Di=xe.map(b=>b.wpm).reverse(),uo=Nv(Di);if(uo){const Z=(uo[1][1]-uo[0][1])*(3600/lr),re=Z>0?"+":"";s(".pageAccount .group.chart .below .text").text(`Speed change per hour spent typing: ${re+_.typingSpeed(Z,{showDecimalPlaces:!0})} ${i.typingSpeedUnit}`)}s(".pageAccount .estimatedWordsTyped .val").text(h),(pt.length||yo.length)&&(zC(),H.options.animation=!1,H.update(),delete H.options.animation),await Te(0),ja.update(),Eo.update(),oa(100,!0),ys(!1),Hs(s(".pageAccount .preloader"),s(".pageAccount .content"),250,async()=>{s(".page.pageAccount").css("height","unset")},async()=>{setTimeout(()=>{Wu("account")},10)})}async function Eu(e){const t=await Td(e);if(!t&&!We()){m("Could not get results - you are offline",-1,{duration:5});return}Ik(),t&&vs()}async function Wi(){if(oa(0,!0),S()===null)m("Missing account data. Please refresh.",-1),s(".pageAccount .preloader").html("Missing account data. Please refresh.");else{oa(90),await Eu();try{await Te(0),await iy()}catch(e){console.error(e),m(`Something went wrong: ${e}`,-1)}}}function Q1(e,t){var n,r;const a=[];if(t.length>0)for(const l of t)(r=(n=S())==null?void 0:n.tags)==null||r.forEach(c=>{l===c._id&&a.push(c.display)});const o=s(`.pageAccount .resultEditTagsButton[data-result-id='${e}']`);o.attr("data-tags",JSON.stringify(t)),t.length>0?(o.attr("aria-label",a.join(", ")),o.addClass("active"),t.length>1?o.html('<i class="fas fa-fw fa-tags"></i>'):o.html('<i class="fas fa-fw fa-tag"></i>')):(o.attr("aria-label","no tags"),o.removeClass("active"),o.html('<i class="fas fa-fw fa-tag"></i>'))}function ws(e,t,a=null){var c,d;if(s("td").removeClass("headerSorted"),s("td").children("i").remove(),s(t).addClass("headerSorted"),xe.length<2)return;const o=e;let n=!0;a!==null?a?s(t).append('<i class="fas fa-sort-down" aria-hidden="true"></i>'):(n=!1,s(t).append('<i class="fas fa-sort-up" aria-hidden="true"></i>')):parseInt((c=xe==null?void 0:xe[0])==null?void 0:c[o])<=parseInt((d=xe==null?void 0:xe[xe.length-1])==null?void 0:d[o])?(n=!0,s(t).append('<i class="fas fa-sort-down" aria-hidden="true"></i>')):(n=!1,s(t).append('<i class="fas fa-sort-up", aria-hidden="true"></i>'));const r=[],l=[];for(;r.length<xe.length;){let u=Number.MAX_VALUE,f=-1,p=-1;for(const[g,h]of xe.entries())n?h[o]>=f&&!l.includes(g)&&(f=h[o],p=g):h[o]<=u&&!l.includes(g)&&(u=h[o],p=g);r.push(xe[p]),l.push(p)}xe=r,s(".pageAccount .history table tbody").empty(),xs=0,Kl()}s(".pageAccount button.toggleResultsOnChart").on("click",()=>{Lb(i.accountChart[0]!=="on")});s(".pageAccount button.toggleAccuracyOnChart").on("click",()=>{Wb(i.accountChart[1]!=="on")});s(".pageAccount button.toggleAverage10OnChart").on("click",()=>{Ib(i.accountChart[2]!=="on")});s(".pageAccount button.toggleAverage100OnChart").on("click",()=>{Eb(i.accountChart[3]!=="on")});s(".pageAccount .loadMoreButton").on("click",()=>{Kl()});s(".pageAccount #accountHistoryChart").on("click",()=>{var n;const e=hh;if(Kl(e),window===void 0)return;const t=s(window).height()??0,o=(((n=s(`#result-${e}`).offset())==null?void 0:n.top)??0)-t/2;s([document.documentElement,document.body]).animate({scrollTop:o},500),s(".resultRow").removeClass("active"),s(`#result-${e}`).addClass("active")});s(".pageAccount").on("click",".miniResultChartButton",e=>{var a;console.log("updating");const t=s(e.currentTarget).attr("filteredResultsId");t!==void 0&&(q1((a=xe[parseInt(t)])==null?void 0:a.chartData),P1(),B1(e.pageX-(s(".pageAccount .miniResultChartWrapper").outerWidth()??0),e.pageY+30))});s(".pageAccount .group.history").on("click",".history-wpm-header",()=>{ws("wpm",".history-wpm-header")});s(".pageAccount .group.history").on("click",".history-raw-header",()=>{ws("rawWpm",".history-raw-header")});s(".pageAccount .group.history").on("click",".history-acc-header",()=>{ws("acc",".history-acc-header")});s(".pageAccount .group.history").on("click",".history-correct-chars-header",()=>{ws("correctChars",".history-correct-chars-header")});s(".pageAccount .group.history").on("click",".history-incorrect-chars-header",()=>{ws("incorrectChars",".history-incorrect-chars-header")});s(".pageAccount .group.history").on("click",".history-consistency-header",()=>{ws("consistency",".history-consistency-header")});s(".pageAccount .group.history").on("click",".history-date-header",()=>{ws("timestamp",".history-date-header")});s(".pageAccount .group.history").on("click",".buttonsAndTitle .buttons button",()=>{ws("timestamp",".history-date-header",!0)});s(".pageAccount .group.topFilters, .pageAccount .filterButtons").on("click","button",()=>{setTimeout(()=>{Wi()},0)});s(".pageAccount .group.presetFilterButtons").on("click",".filterBtns .filterPresets .select-filter-preset",async e=>{await S1(s(e.target).data("id")),Wi()});s(".pageAccount .content .group.aboveHistory .exportCSV").on("click",()=>{_v(xe)});s(".pageAccount .profile").on("click",".details .copyLink",()=>{const e=S();if(!e)return;const{name:t}=e,a=`${location.origin}/profile/${t}`;navigator.clipboard.writeText(a).then(function(){m("URL Copied to clipboard",0)},function(){alert("Failed to copy using the Clipboard API. Here's the link: "+a)})});s(".pageAccount button.loadMoreResults").on("click",async()=>{var t,a;const e=((a=(t=S())==null?void 0:t.results)==null?void 0:a.length)??0;oe(),Xc(),await Eu(e),await iy(),Q()});he(e=>{ne()==="account"&&e==="typingSpeedUnit"&&Wi()});const G1=new Ra("account",s(".page.pageAccount"),"/account",async()=>{},async()=>{j1(),I1(),Ve("pageAccount")},async()=>{var e;at("pageAccount","main"),((e=S())==null?void 0:e.results)===void 0&&(s(".pageLoading .fill, .pageAccount .fill").css("width","0%"),s(".pageAccount .content").addClass("hidden"),s(".pageAccount .preloader").removeClass("hidden"),await Up()),await W1(),vs(),await Te(0),Wi().then(()=>{var t,a;V1(),s(".pageAccount .content p.accountVerificatinNotice").remove(),((a=(t=Pe)==null?void 0:t.currentUser)==null?void 0:a.emailVerified)===!1&&s(".pageAccount .content").prepend('<p class="accountVerificatinNotice" style="text-align:center">Your account is not verified - <button class="sendVerificationEmail">send the verification email again</button>'),z1()})},async()=>{});s(()=>{st("pageAccount")});const Me={resultId:"",startingTags:[],tags:[],source:"accountPage"};function ry(e,t,a){if(!We()){m("You are offline",0,{duration:2});return}if(e===""){m("Failed to show edit result tags modal: result id is empty",-1);return}Me.resultId=e,Me.startingTags=[...t],Me.tags=[...t],Me.source=a,Bu.show({beforeAnimation:async()=>{Y1(),ly()}})}function qf(){Bu.hide()}function Y1(){var t;const e=Bu.getModal().querySelector(".buttons");if(e===null){m("Failed to append buttons to edit result tags modal: could not find buttons element",-1);return}e.innerHTML="";for(const a of((t=S())==null?void 0:t.tags)??[]){const o=document.createElement("button");o.classList.add("toggleTag"),o.setAttribute("data-tag-id",a._id),o.innerHTML=a.display,o.addEventListener("click",n=>{J1(a._id),ly()}),e.appendChild(o)}}function ly(){for(const e of s("#editResultTagsModal .modal .buttons button")){const t=s(e).attr("data-tag-id")??"";Me.tags.includes(t)?s(e).addClass("active"):s(e).removeClass("active")}}function J1(e){Me.tags.includes(e)?Me.tags=Me.tags.filter(t=>t!==e):Me.tags.push(e)}async function Z1(){var a,o,n;oe();const e=await E.results.updateTags(Me.resultId,Me.tags);if(Q(),Me.tags=Me.tags.filter(r=>r!==void 0),e.status!==200)return m("Failed to update result tags: "+e.message,-1);const t=((a=e.data)==null?void 0:a.tagPbs)??[];m("Tags updated",1,{duration:2}),(n=(o=S())==null?void 0:o.results)==null||n.forEach(r=>{r._id===Me.resultId&&(r.tags=Me.tags)}),Me.source==="accountPage"?Q1(Me.resultId,Me.tags):Me.source==="resultPage"&&IS(Me.tags,t)}const Bu=new le({dialogId:"editResultTagsModal",setup:async e=>{var t;(t=e.querySelector("button.saveButton"))==null||t.addEventListener("click",a=>{if(Kv(Me.startingTags,Me.tags)){qf();return}qf(),Z1()})}});function cy(e){const t=/((-\s*)?\d+(\.\d+)?\s*[hms]?)/g,a=[...e.toLowerCase().matchAll(t)].map(o=>{const n=o[0],r=parseFloat(n.replace(/\s+/g,""));return n.includes("h")?3600*r:n.includes("m")?60*r:r}).reduce((o,n)=>o+n,0);return Math.floor(a)}function X1(e){const t=Math.floor(e/3600),a=Math.floor(e%3600/60),o=e%3600%60,n=[];return t>0&&n.push(`${t} hour${t===1?"":"s"}`),a>0&&n.push(`${a} minute${a===1?"":"s"}`),o>0&&n.push(`${o} second${o===1?"":"s"}`),n.length===3?`${n[0]}, ${n[1]} and ${n[2]}`:n.length===2?`${n[0]} and ${n[1]}`:`${n[0]}`}function dy(){const e=s("#customTestDurationModal input").val(),t=cy(e);let a="";t<0?a="Negative time? Really?":t===0?a="Infinite test":a=X1(t),s("#customTestDurationModal .preview").text(a)}function uy(e){fy.show({...e,focusFirstInput:"focusAndSelect",beforeAnimation:async t=>{t.querySelector("input").value=`${i.time}`,dy()}})}function eT(e=!1){fy.hide({clearModalChain:e})}function tT(){const e=cy(s("#customTestDurationModal input").val());if(e!==null&&!isNaN(e)&&e>=0&&isFinite(e))ia(e),ie(),Y(),e>=1800?m("Stay safe and take breaks!",0):e===0&&m("Infinite time! Make sure to use Bail Out from the command line to save your result.",0,{duration:7});else{m("Custom time must be a positive number or zero",0);return}eT(!0)}async function aT(e){var t;e.addEventListener("submit",a=>{a.preventDefault(),tT()}),(t=e.querySelector("input"))==null||t.addEventListener("input",a=>{dy()})}const fy=new le({dialogId:"customTestDurationModal",setup:aT}),sT=mi.recaptchaSiteKey,Wa={};function Ii(e,t,a){if(Wa[t]!==void 0&&Wa[t]!==null)return;const o=grecaptcha.render(e,{sitekey:sT,callback:a});Wa[t]=o}function sn(e){Wa[e]===void 0||Wa[e]===null||grecaptcha.reset(Wa[e])}function zl(e){return Wa[e]===void 0||Wa[e]===null?"":grecaptcha.getResponse(Wa[e])}let Ff=!1;async function oT(){if(Ff)return;const e=await qp();for(const t of e)t.name!=="swiss_german"&&s("#quoteSubmitModal .newQuoteLanguage").append(`<option value="${t.name}">${t.name.replace(/_/g," ")}</option>`);Ff=!0}let bn;async function nT(){const e=s("#quoteSubmitModal .newQuoteText").val(),t=s("#quoteSubmitModal .newQuoteSource").val(),a=s("#quoteSubmitModal .newQuoteLanguage").val(),o=zl("submitQuote");if(!e||!t||!a)return m("Please fill in all fields",0);oe();const n=await E.quotes.submit(e,t,a,o);if(Q(),n.status!==200)return m("Failed to submit quote: "+n.message,-1);m("Quote submitted.",1),s("#quoteSubmitModal .newQuoteText").val(""),s("#quoteSubmitModal .newQuoteSource").val(""),s("#quoteSubmitModal .characterCount").removeClass("red"),s("#quoteSubmitModal .characterCount").text("-"),sn("submitQuote")}async function iT(e){py.show({...e,focusFirstInput:!0,afterAnimation:async()=>{Ii(document.querySelector("#quoteSubmitModal .g-recaptcha"),"submitQuote"),await oT(),bn=new At({select:"#quoteSubmitModal .newQuoteLanguage"}),s("#quoteSubmitModal .newQuoteLanguage").val(wa(i.language)),s("#quoteSubmitModal .newQuoteLanguage").trigger("change"),s("#quoteSubmitModal input").val("")}})}function rT(e){py.hide({clearModalChain:e,afterAnimation:async()=>{sn("submitQuote"),bn==null||bn.destroy(),bn=void 0}})}async function lT(e){var t,a;(t=e.querySelector("textarea"))==null||t.addEventListener("input",o=>{const n=o.target.value.length;s("#quoteSubmitModal .characterCount").text(n),n<60?s("#quoteSubmitModal .characterCount").addClass("red"):s("#quoteSubmitModal .characterCount").removeClass("red")}),(a=e.querySelector("button"))==null||a.addEventListener("click",()=>{nT(),rT(!0)})}const py=new le({dialogId:"quoteSubmitModal",setup:lT});let us=[];function Ul(){s("#quoteApproveModal .quotes").empty(),us.forEach((e,t)=>{const a=s(`
      <div class="quote" data-id="${t}" data-db-id="${e._id}">
        <textarea class="text">${e.text}</textarea>
        <input type="text" class="source" placeholder="Source" value="${e.source}">
        <div class="buttons">
          <button disabled class="textButton undo" aria-label="Undo changes" data-balloon-pos="left"><i class="fas fa-fw fa-undo-alt"></i></button>
          <button class="textButton refuse" aria-label="Refuse quote" data-balloon-pos="left"><i class="fas fa-fw fa-times"></i></button>
          <button class="textButton approve" aria-label="Approve quote" data-balloon-pos="left"><i class="fas fa-fw fa-check"></i></button>
          <button class="textButton edit hidden" aria-label="Edit and approve quote" data-balloon-pos="left"><i class="fas fa-fw fa-pen"></i></button>
        </div>
        <div class="bottom">
          <div class="length ${e.text.length<60?"red":""}"><i class="fas fa-fw fa-ruler"></i>${e.text.length}</div>
          <div class="language"><i class="fas fa-fw fa-globe-americas"></i>${e.language}</div>
          <div class="timestamp"><i class="fas fa-fw fa-calendar"></i>${_e(new Date(e.timestamp),"dd MMM yyyy HH:mm")}</div>
        </div>
      </div>
    `);s("#quoteApproveModal .quotes").append(a),a.find(".source").on("input",()=>{s(`#quoteApproveModal .quote[data-id=${t}] .undo`).prop("disabled",!1),s(`#quoteApproveModal .quote[data-id=${t}] .approve`).addClass("hidden"),s(`#quoteApproveModal .quote[data-id=${t}] .edit`).removeClass("hidden")}),a.find(".text").on("input",()=>{s(`#quoteApproveModal .quote[data-id=${t}] .undo`).prop("disabled",!1),s(`#quoteApproveModal .quote[data-id=${t}] .approve`).addClass("hidden"),s(`#quoteApproveModal .quote[data-id=${t}] .edit`).removeClass("hidden"),my(t)}),a.find(".undo").on("click",()=>{dT(t)}),a.find(".approve").on("click",()=>{uT(t,e._id)}),a.find(".refuse").on("click",()=>{fT(t,e._id)}),a.find(".edit").on("click",()=>{pT(t,e._id)})})}function my(e){var a;const t=(a=s(`#quoteApproveModal .quote[data-id=${e}] .text`).val())==null?void 0:a.length;s(`#quoteApproveModal .quote[data-id=${e}] .length`).html(`<i class="fas fa-fw fa-ruler"></i>${t}`),t<60?s(`#quoteApproveModal .quote[data-id=${e}] .length`).addClass("red"):s(`#quoteApproveModal .quote[data-id=${e}] .length`).removeClass("red")}async function gy(){oe();const e=await E.quotes.get();if(Q(),e.status!==200)return m("Failed to get new quotes: "+e.message,-1);us=e.data??[],Ul()}async function cT(e){gT.show({...e,beforeAnimation:async()=>{us=[],gy()}})}function Pu(e){const t=s(`#quoteApproveModal .quotes .quote[data-id=${e}]`);t.find("button").prop("disabled",!1),t.find(".edit").hasClass("hidden")&&t.find(".undo").prop("disabled",!0)}function dT(e){var t,a;s(`#quoteApproveModal .quote[data-id=${e}] .text`).val(((t=us[e])==null?void 0:t.text)??""),s(`#quoteApproveModal .quote[data-id=${e}] .source`).val(((a=us[e])==null?void 0:a.source)??""),s(`#quoteApproveModal .quote[data-id=${e}] .undo`).prop("disabled",!0),s(`#quoteApproveModal .quote[data-id=${e}] .approve`).removeClass("hidden"),s(`#quoteApproveModal .quote[data-id=${e}] .edit`).addClass("hidden"),my(e)}async function uT(e,t){if(!confirm("Are you sure?"))return;const a=s(`#quoteApproveModal .quotes .quote[data-id=${e}]`);a.find("button").prop("disabled",!0),a.find("textarea, input").prop("disabled",!0),oe();const o=await E.quotes.approveSubmission(t);if(Q(),o.status!==200)return Pu(e),a.find("textarea, input").prop("disabled",!1),m("Failed to approve quote: "+o.message,-1);m(`Quote approved. ${o.message??""}`,1),us.splice(e,1),Ul()}async function fT(e,t){if(!confirm("Are you sure?"))return;const a=s(`#quoteApproveModal .quotes .quote[data-id=${e}]`);a.find("button").prop("disabled",!0),a.find("textarea, input").prop("disabled",!0),oe();const o=await E.quotes.rejectSubmission(t);if(Q(),o.status!==200)return Pu(e),a.find("textarea, input").prop("disabled",!1),m("Failed to refuse quote: "+o.message,-1);m("Quote refused.",1),us.splice(e,1),Ul()}async function pT(e,t){if(!confirm("Are you sure?"))return;const a=s(`#quoteApproveModal .quote[data-id=${e}] .text`).val(),o=s(`#quoteApproveModal .quote[data-id=${e}] .source`).val(),n=s(`#quoteApproveModal .quotes .quote[data-id=${e}]`);n.find("button").prop("disabled",!0),n.find("textarea, input").prop("disabled",!0),oe();const r=await E.quotes.approveSubmission(t,a,o);if(Q(),r.status!==200)return Pu(e),n.find("textarea, input").prop("disabled",!1),m("Failed to approve quote: "+r.message,-1);m(`Quote edited and approved. ${r.message??""}`,1),us.splice(e,1),Ul()}async function mT(e){var t;(t=e.querySelector("button.refreshList"))==null||t.addEventListener("click",()=>{s("#quoteApproveModal .quotes").empty(),gy()})}const gT=new le({dialogId:"quoteApproveModal",setup:mT}),Po={quoteToReport:void 0,reasonSelect:void 0};async function hy(e,t){yy.show({mode:"dialog",...t,beforeAnimation:async()=>{var n;Ii(document.querySelector("#quoteReportModal .g-recaptcha"),"quoteReportModal");const a=i.language==="swiss_german"?"german":i.language,{quotes:o}=await la.getQuotes(a);Po.quoteToReport=o.find(r=>r.id===e),s("#quoteReportModal .quote").text((n=Po.quoteToReport)==null?void 0:n.text),s("#quoteReportModal .reason").val("Grammatical error"),s("#quoteReportModal .comment").val(""),s("#quoteReportModal .characterCount").text("-"),Po.reasonSelect=new At({select:"#quoteReportModal .reason",settings:{showSearch:!1}})}})}async function hT(e=!1){yy.hide({clearModalChain:e,afterAnimation:async()=>{var t;sn("quoteReportModal"),(t=Po.reasonSelect)==null||t.destroy(),Po.reasonSelect=void 0}})}async function yT(){var d;const e=zl("quoteReportModal");if(!e)return m("Please complete the captcha");const t=(d=Po.quoteToReport)==null?void 0:d.id.toString(),a=wa(i.language),o=s("#quoteReportModal .reason").val(),n=s("#quoteReportModal .comment").val(),r=e;if(t===void 0||t==="")return m("Please select a quote");if(!o)return m("Please select a valid report reason");if(!n)return m("Please provide a comment");const l=n.length-250;if(l>0)return m(`Report comment is ${l} character(s) too long`);oe();const c=await E.quotes.report(t,a,o,n,r);if(Q(),c.status!==200)return m("Failed to report quote: "+c.message,-1);m("Report submitted. Thank you!",1),hT(!0)}async function vT(e){var t,a;(t=e.querySelector(".comment"))==null||t.addEventListener("input",()=>{const o=s("#quoteReportModal .comment").val().length;s("#quoteReportModal .characterCount").text(o),o>250?s("#quoteReportModal .characterCount").addClass("red"):s("#quoteReportModal .characterCount").removeClass("red")}),(a=e.querySelector("button"))==null||a.addEventListener("click",async()=>{await yT()})}const yy=new le({dialogId:"quoteReportModal",setup:vT}),wT={fuzzyMatchSensitivity:.2,scoreForSimilarMatch:.5,scoreForExactMatch:1};function bT(e,t){return t===0?0:Math.log10(e/t)}const Df=.4;function CT(e,t){return Df+(1-Df)*(t.termFrequencies[e]/t.maxTermFrequency)}function Rf(e){return e.match(/[^\\\][.,"/#!?$%^&*;:{}=\-_`~()\s]+/g)??[]}const kT=(e,t,a=wT)=>{const o={},n={};e.forEach((c,d)=>{const u=Rf(t(c)),f={id:d,termFrequencies:{},maxTermFrequency:0};let p=0;u.forEach(g=>{var y,w;const h=tf(g);h in n||(n[h]=new Set),(y=n[h])==null||y.add(g),h in o||(o[h]=new Set),(w=o[h])==null||w.add(f),h in f.termFrequencies||(f.termFrequencies[h]=0),f.termFrequencies[h]++,p=Math.max(p,f.termFrequencies[h])}),f.maxTermFrequency=p});const r=Object.keys(o);return{query:c=>{const d={results:[],matchedQueryTerms:[]},u=new Set(Rf(c).map(h=>tf(h)));if(u.size===0)return d;const f=new Map,p=new Set;u.forEach(h=>{r.forEach(y=>{var x;const{similarity:w}=yw(h,y),k=y===h,L=w>=1-a.fuzzyMatchSensitivity;if(k||L){const B=o[y],D=bT(e.length,B.size);B.forEach(v=>{const C=f.get(v.id)??0,q=CT(y,v),G=k?a.scoreForExactMatch:0,ze=L?a.scoreForSimilarMatch:0,Ie=(G+ze)*D*q;f.set(v.id,C+Ie)}),(x=n[y])==null||x.forEach(v=>{p.add(v)})}})});const g=[...f].sort((h,y)=>y[1]-h[1]).map(h=>e[h[0]]);return d.results=g,d.matchedQueryTerms=[...p],d}}};function ST(e,t){const a=[];let o=[];const n=new Set(t);for(const r of e)n.has(r)?(o.length>0&&a.push(o.join("")),a.push(r),o=[]):o.push(r);return o.length>0&&a.push(o.join("")),a}const hc={},yc=100;let Ga=1;function TT(e,t,a){if(e in hc)return hc[e];const o=kT(t,a);return hc[e]=o,o}function vc(e,t){return t.length===0?e:ST(e,'.,"/#!$%^&*;:{}=-_`~() '.split("")).map(n=>t.find(l=>n.startsWith(l))!==void 0?`<span class="highlight">${n}</span>`:n).join("")}function xT(e){const t=s("#quoteSearchModal .quoteLengthFilter").val();if(t.length===0)return e;const a=t.map(n=>parseInt(n,10));return e.filter(n=>a.includes(n.group))}function $T(e){const t=document.querySelector(".toggleFavorites").classList.contains("active");return e.filter(o=>t?la.isQuoteFavorite(o):!0)}function AT(e,t){let a;e.length<101?a="short":e.length<301?a="medium":e.length<601?a="long":a="thicc";const o=!z(),n=!o&&la.isQuoteFavorite(e);return`
  <div class="searchResult" data-quote-id="${e.id}">

    <div class="text">
      ${vc(e.text,t)}
    </div>

    <div class="id">
      <div class="sub">id</div>
      <span class="quote-id">
        ${vc(e.id.toString(),t)}
      </span>
    </div>

    <div class="length">
      <div class="sub">length</div>
      ${a}
    </div>

    <div class="source">
      <div class="sub">source</div>
      ${vc(e.source,t)}
    </div>

    <div class="textButton report ${o&&"hidden"}" aria-label="Report quote" data-balloon-pos="left">
      <i class="fas fa-flag report"></i>
    </div>

    <div class="textButton favorite ${o&&"hidden"}" aria-label="Favorite quote" data-balloon-pos="left">
      <i class="${n?"fas":"far"} fa-heart favorite"></i>
    </div>

  </div>
  `}async function el(e){var p,g;const{quotes:t}=await la.getQuotes(i.language),a=TT(i.language,t,h=>`${h.text} ${h.id} ${h.source}`),{results:o,matchedQueryTerms:n}=a.query(e),r=xT($T(e===""?t:o)),l=s("#quoteSearchResults");l.empty();const c=Math.ceil(r.length/yc);if(Ga>=c?s("#quoteSearchPageNavigator .nextPage").prop("disabled",!0):s("#quoteSearchPageNavigator .nextPage").prop("disabled",!1),Ga<=1?s("#quoteSearchPageNavigator .prevPage").prop("disabled",!0):s("#quoteSearchPageNavigator .prevPage").prop("disabled",!1),r.length===0){s("#quoteSearchModal  .pageInfo").html("No search results");return}const d=(Ga-1)*yc,u=Math.min(Ga*yc,r.length);s("#quoteSearchModal  .pageInfo").html(`${d+1} - ${u} of ${r.length}`),r.slice(d,u).forEach(h=>{const y=AT(h,n);l.append(y)});const f=so.getModal().querySelectorAll(".searchResult");for(const h of f){const y=parseInt(h.dataset.quoteId);(p=h.querySelector(".textButton.favorite"))==null||p.addEventListener("click",w=>{if(w.stopPropagation(),y===void 0||isNaN(y)){m("Could not toggle quote favorite: quote id is not a number",-1);return}WT(`${y}`)}),(g=h.querySelector(".textButton.report"))==null||g.addEventListener("click",w=>{if(w.stopPropagation(),y===void 0||isNaN(y)){m("Could not open quote report modal: quote id is not a number",-1);return}hy(y,{modalChain:so})}),h.addEventListener("click",w=>{Sd(y),LT(y)})}}let Cn;async function vy(e){so.show({...e,focusFirstInput:!0,beforeAnimation:async()=>{var a,o,n;z()?(s("#quoteSearchModal .goToQuoteSubmit").removeClass("hidden"),s("#quoteSearchModal .toggleFavorites").removeClass("hidden")):(s("#quoteSearchModal .goToQuoteSubmit").addClass("hidden"),s("#quoteSearchModal .toggleFavorites").addClass("hidden")),((a=S())==null?void 0:a.quoteMod)!==void 0&&(((o=S())==null?void 0:o.quoteMod)===!0||((n=S())==null?void 0:n.quoteMod)!=="")?s("#quoteSearchModal .goToQuoteApprove").removeClass("hidden"):s("#quoteSearchModal .goToQuoteApprove").addClass("hidden"),Cn=new At({select:"#quoteSearchModal .quoteLengthFilter",settings:{showSearch:!1,placeholderText:"filter by length",contentLocation:so.getModal()},data:[{text:"short",value:"0"},{text:"medium",value:"1"},{text:"long",value:"2"},{text:"thicc",value:"3"}]})},afterAnimation:async()=>{const t=s("#quoteSearchModal input").val();Ga=1,el(t)}})}function MT(e=!1){so.hide({clearModalChain:e,afterAnimation:async()=>{Cn==null||Cn.destroy(),Cn=void 0}})}function LT(e){if(isNaN(e)&&(e=parseInt(document.getElementById("searchBox").value)),e!==null&&!isNaN(e)&&e>=0)$a(-2,!1),Sd(e),ie();else{m("Quote ID must be at least 1",0);return}Y(),MT(!0)}const wc=Et(250,()=>{const e=document.getElementById("searchBox").value;Ga=1,el(e)});async function WT(e){var n,r,l,c,d;const t=i.language;if(t===""||e===""){m("Could not get quote stats!",-1);return}const a=s(`#quoteSearchModal .searchResult[data-quote-id=${e}] .textButton.favorite i`),o=S();if(o)if(a.hasClass("fas")){oe();const u=await E.users.removeQuoteFromFavorites(t,e);if(Q(),m(u.message,u.status===200?1:-1),u.status===200){a.removeClass("fas").addClass("far");const f=(r=(n=o.favoriteQuotes)==null?void 0:n[t])==null?void 0:r.indexOf(e);(c=(l=o.favoriteQuotes)==null?void 0:l[t])==null||c.splice(f,1)}}else{oe();const u=await E.users.addQuoteToFavorites(t,e);Q(),m(u.message,u.status===200?1:-1),u.status===200&&(a.removeClass("far").addClass("fas"),o.favoriteQuotes===void 0&&(o.favoriteQuotes={}),o.favoriteQuotes[t]||(o.favoriteQuotes[t]=[]),(d=o.favoriteQuotes[t])==null||d.push(e))}}async function IT(e){var t,a,o,n,r,l,c;(t=e.querySelector(".searchBox"))==null||t.addEventListener("input",d=>{wc()}),(a=e.querySelector("button.toggleFavorites"))==null||a.addEventListener("click",d=>{z()&&(s(d.target).toggleClass("active"),wc())}),(o=e.querySelector(".goToQuoteApprove"))==null||o.addEventListener("click",d=>{cT({modalChain:so})}),(n=e.querySelector(".goToQuoteSubmit"))==null||n.addEventListener("click",async d=>{var f;oe();const u=((f=(await E.quotes.isSubmissionEnabled()).data)==null?void 0:f.isEnabled)??!1;if(Q(),!u){m("Quote submission is disabled temporarily due to a large submission queue.",0,{duration:5});return}iT({modalChain:so})}),(r=e.querySelector(".quoteLengthFilter"))==null||r.addEventListener("change",wc),(l=e.querySelector(".nextPage"))==null||l.addEventListener("click",()=>{const d=document.getElementById("searchBox").value;Ga++,el(d)}),(c=e.querySelector(".prevPage"))==null||c.addEventListener("click",()=>{const d=document.getElementById("searchBox").value;Ga--,el(d)})}const so=new le({dialogId:"quoteSearchModal",setup:IT}),wy={homeKeys:{display:"home keys",getIncludeString:e=>{const t=e.keys.row3.slice(0,4),a=e.keys.row3.slice(6,10);return[...t,...a]},getExcludeString:e=>{const t=e.keys.row2,a=e.keys.row4,o=e.keys.row3.slice(10),n=e.keys.row3.slice(4,6);return[...t,...n,...o,...a]}},leftHand:{display:"left hand",getIncludeString:e=>{const t=e.keys.row2.slice(0,5),a=e.keys.row3.slice(0,5),o=e.keys.row4.slice(0,5);return[...t,...a,...o]},getExcludeString:e=>{const t=e.keys.row2.slice(5),a=e.keys.row3.slice(5),o=e.keys.row4.slice(5);return[...t,...a,...o]}},rightHand:{display:"right hand",getIncludeString:e=>{const t=e.keys.row2.slice(5),a=e.keys.row3.slice(5),o=e.keys.row4.slice(4);return[...t,...a,...o]},getExcludeString:e=>{const t=e.keys.row2.slice(0,5),a=e.keys.row3.slice(0,5),o=e.keys.row4.slice(0,4);return[...t,...a,...o]}},homeRow:{display:"home row",getIncludeString:e=>e.keys.row3,getExcludeString:e=>{const t=e.keys.row2,a=e.keys.row4;return[...t,...a]}},topRow:{display:"top row",getIncludeString:e=>e.keys.row2,getExcludeString:e=>{const t=e.keys.row3,a=e.keys.row4;return[...t,...a]}},bottomRow:{display:"bottom row",getIncludeString:e=>e.keys.row4,getExcludeString:e=>{const t=e.keys.row2,a=e.keys.row3;return[...t,...a]}}};async function ET(){s("#wordFilterModal .languageInput").empty(),s("#wordFilterModal .layoutInput").empty(),s("wordFilterModal .presetInput").empty();let e,t;try{e=await hd()}catch(a){console.error(ee(a,"Failed to initialise word filter popup language list"));return}try{t=await fl()}catch(a){console.error(ee(a,"Failed to initialise word filter popup preset list"));return}e.forEach(a=>{const o=a.replace(/_/gi," ");s("#wordFilterModal .languageInput").append(`
        <option value=${a}>${o}</option>
      `)});for(const a in t){const o=a.replace(/_/gi," ");s("#wordFilterModal .layoutInput").append(`
      <option value=${a}>${o}</option>
    `)}for(const[a,o]of Object.entries(wy))s("#wordFilterModal .presetInput").append(`<option value=${a}>${o.display}</option>`)}let kn,Sn,Tn;async function BT(e){qo.show({...e,beforeAnimation:async t=>{kn=new At({select:"#wordFilterModal .languageInput",settings:{contentLocation:t}}),Sn=new At({select:"#wordFilterModal .layoutInput",settings:{contentLocation:qo.getModal()}}),Tn=new At({select:"#wordFilterModal .presetInput",settings:{contentLocation:qo.getModal()}}),s("#wordFilterModal .loadingIndicator").removeClass("hidden"),qT()}})}function Of(e){qo.hide({clearModalChain:e,afterAnimation:async()=>{kn==null||kn.destroy(),Sn==null||Sn.destroy(),Tn==null||Tn.destroy(),kn=void 0,Sn=void 0,Tn=void 0}})}async function PT(e){let t=s("#wordFilterModal .wordIncludeInput").val();t=Ju(t==null?void 0:t.trim()),t=t.replace(/\s+/gi,"|");const a=new RegExp(t,"i");let o=s("#wordFilterModal .wordExcludeInput").val();o=Ju(o.trim()),o=o.replace(/\s+/gi,"|");const n=new RegExp(o,"i"),r=[];let l;try{l=await gd(e)}catch(p){return m(ee(p,"Failed to filter language words"),-1),[]}const c=s("#wordFilterModal .wordMaxInput").val(),d=s("#wordFilterModal .wordMinInput").val();let u,f;c===""?u=999:u=parseInt(c),d===""?f=1:f=parseInt(d);for(const p of l.words){const g=a.test(p),h=n.test(p);(g&&!h||g&&o==="")&&p.length<=u&&p.length>=f&&r.push(p)}return r}async function Hf(e){const t=s("#wordFilterModal .languageInput").val(),a=await PT(t);if(a.length===0){m("No words found",0),Of(!0);return}const o=a.join(It);bt((e?"":ro+" ")+o),Of(!0)}function _f(){for(const e of qo.getModal().querySelectorAll("button"))e.setAttribute("disabled","true")}function qT(){for(const e of qo.getModal().querySelectorAll("button"))e.removeAttribute("disabled")}async function FT(){await ET(),s("#wordFilterModal button.generateButton").on("click",async()=>{const e=s("#wordFilterModal .presetInput").val(),t=s("#wordFilterModal .layoutInput").val(),a=wy[e];if(a===void 0){m(`Preset ${e} not found`,-1);return}const o=await fi(t);s("#wordIncludeInput").val(a.getIncludeString(o).map(n=>n[0]).join(" ")),s("#wordExcludeInput").val(a.getExcludeString(o).map(n=>n[0]).join(" "))}),s("#wordFilterModal button.addButton").on("click",()=>{s("#wordFilterModal .loadingIndicator").removeClass("hidden"),_f(),setTimeout(()=>{Hf(!1)},0)}),s("#wordFilterModal button.setButton").on("click",()=>{s("#wordFilterModal .loadingIndicator").removeClass("hidden"),_f(),setTimeout(()=>{Hf(!0)},0)})}const qo=new le({dialogId:"wordFilterModal",setup:FT}),ni="savedTextsPopupWrapper";function DT(){const e=Pr(),t=s("#savedTextsPopup .list").empty();let a="";if(e.length===0)a+="<div>No saved custom texts found</div>";else for(const l of e)a+=`<div class="savedText">
      <div class="button name">${aa(l)}</div>
      <div class="button delete">
      <i class="fas fa-fw fa-trash"></i>
      </div>
      </div>`;t.html(a);const o=Pr(!0),n=s("#savedTextsPopup .listLong").empty();let r="";if(o.length===0)r+="<div>No saved long custom texts found</div>";else for(const l of o)r+=`<div class="savedText">
      <div class="button name">${aa(l)}</div>
      <div class="button ${$l(l)<=0?"disabled":""} resetProgress">reset</div>
      <div class="button delete">
      <i class="fas fa-fw fa-trash"></i>
      </div>
      </div>`;n.html(r)}let ed;async function Vl(e=!1,t){at(ni,"popups"),Le(ni)||(ed=t,DT(),s("#savedTextsPopupWrapper").stop(!0,!0).css("opacity",0).removeClass("hidden").animate({opacity:1},e?0:125))}function on(e=!1,t=!1){Le(ni)&&s("#savedTextsPopupWrapper").stop(!0,!0).css("opacity",1).animate({opacity:0},e?0:125,()=>{s("#savedTextsPopupWrapper").addClass("hidden"),Ve(ni),ed&&!t&&ed()})}function by(e,t){let a=Gn(e,t);t&&(a=a.slice($l(e))),bt(a.join(" "))}s("#popups").on("click","#savedTextsPopupWrapper .list .savedText .button.name",e=>{const t=s(e.target).text();lo(t,!1),by(t,!1),on(!0)});s("#popups").on("click","#savedTextsPopupWrapper .list .savedText .button.delete",()=>{on(!0,!0)});s("#popups").on("click","#savedTextsPopupWrapper .listLong .savedText .button.name",e=>{const t=s(e.target).text();lo(t,!0),by(t,!0),on(!0)});s("#popups").on("click","#savedTextsPopupWrapper .listLong .savedText .button.resetProgress",()=>{on(!0,!0)});s("#popups").on("click","#savedTextsPopupWrapper .listLong .savedText .button.delete",()=>{on(!0,!0)});s("#savedTextsPopupWrapper").on("mousedown",e=>{s(e.target).attr("id")==="savedTextsPopupWrapper"&&on(!0)});st(ni);class bs{constructor(t,a){var n;this.inputElement=t,s(this.inputElement).wrap('<div class="inputAndIndicator"></div>'),this.parentElement=s(this.inputElement).parent(".inputAndIndicator"),this.options=a,this.currentStatus=null;let o='<div class="statusIndicator">';for(const[r,l]of Object.entries(a))o+=`
      <div
        class="indicator level${l.level} hidden"
        data-option-id="${r}"
        
        ${(((n=l.message)==null?void 0:n.length)??0)>27?'data-balloon-length="large"':""}
        data-balloon-pos="up"
        ${l.message??""?`aria-label="${l.message}"`:""}
      >
        <i class="fas fa-fw ${l.icon} ${l.spinIcon?"fa-spin":""}"></i>
      </div>
      `;o+="</div>",this.parentElement.append(o)}hide(){this.parentElement.find(".statusIndicator div").addClass("hidden"),this.currentStatus=null,s(this.inputElement).css("padding-right","0.5em")}show(t,a){this.hide(),this.currentStatus=t;const o=this.parentElement.find(`[data-option-id="${t}"]`);o.removeClass("hidden"),a!==void 0&&a!==""&&(a.length>20?o.attr("data-balloon-length","large"):o.removeAttr("data-balloon-length"),o.attr("aria-label",a)),s(this.inputElement).css("padding-right","2.1em")}get(){return this.currentStatus}}const ii="saveCustomTextPopupWrapper",Fn=new bs(s("#saveCustomTextPopup .textName"),{available:{icon:"fa-check",level:1},unavailable:{icon:"fa-times",level:-1},loading:{icon:"fa-circle-notch",spinIcon:!0,level:0}});let td;async function RT(e=!1,t){at(ii,"popups"),Le(ii)||(td=t,s("#saveCustomTextPopupWrapper").stop(!0,!0).css("opacity",0).removeClass("hidden").animate({opacity:1},e?0:125,()=>{s("#saveCustomTextPopupWrapper .textName").val(""),s("#saveCustomTextPopupWrapper .isLongText").prop("checked",!1),s("#saveCustomTextPopupWrapper .button.save").addClass("disabled")}))}function Cy(e=!1){Le(ii)&&s("#saveCustomTextPopupWrapper").stop(!0,!0).css("opacity",1).animate({opacity:0},e?0:125,()=>{s("#saveCustomTextPopupWrapper").addClass("hidden"),Ve(ii),td&&td()})}function OT(){const e=s("#saveCustomTextPopupWrapper .textName").val(),t=s("#saveCustomTextPopupWrapper .isLongText").prop("checked");let a=ro.normalize();return e?a.length===0?(m("Custom text can't be empty",0),!1):(a=a.replace(/( *(\r\n|\r|\n) *)/g,`
 `),Cg(e,a,t),lo(e,t),m("Custom text saved",1),!0):(m("Custom text needs a name",0),!1)}s("#popups").on("click","#saveCustomTextPopupWrapper .button.save",()=>{OT()&&Cy(!0)});s("#saveCustomTextPopupWrapper").on("mousedown",e=>{s(e.target).attr("id")==="saveCustomTextPopupWrapper"&&Cy(!0)});function HT(){const e=s("#saveCustomTextPopup .textName").val(),t=s("#saveCustomTextPopupWrapper .isLongText").prop("checked");e?Pr(t).includes(e)?(Fn.show("unavailable"),s("#saveCustomTextPopupWrapper .button.save").addClass("disabled")):(Fn.show("available"),s("#saveCustomTextPopupWrapper .button.save").removeClass("disabled")):(Fn.hide(),s("#saveCustomTextPopupWrapper .button.save").addClass("disabled"))}const ky=Et(500,HT);s("#saveCustomTextPopup .textName").on("input",()=>{s("#saveCustomTextPopup .textName").val().length>0&&(Fn.show("loading"),ky())});s("#saveCustomTextPopupWrapper .isLongText").on("change",()=>{s("#saveCustomTextPopup .textName").val().length>0&&(Fn.show("loading"),ky())});st(ii);const qu="customTextPopupWrapper",Fo="#customTextPopupWrapper",P="#customTextPopup";function Sy(){hs()===!0?(s(`${P} .longCustomTextWarning`).removeClass("hidden"),s(`${P} .randomWordsCheckbox input`).prop("checked",!1),s(`${P} .delimiterCheck input`).prop("checked",!1),s(`${P} .typographyCheck`).prop("checked",!0),s(`${P} .replaceNewlineWithSpace input`).prop("checked",!1),s(`${P} .inputs`).addClass("disabled")):(s(`${P} .longCustomTextWarning`).addClass("hidden"),s(`${P} .inputs`).removeClass("disabled"))}function jl(e=!1){at(qu,"popups"),no(Fo)||(Sy(),He||pe||fe?s(`${P} .randomWordsCheckbox input`).prop("checked",!0):s(`${P} .randomWordsCheckbox input`).prop("checked",!1),It==="|"?s(`${P} .delimiterCheck input`).prop("checked",!0):s(`${P} .delimiterCheck input`).prop("checked",!1),s(`${P} .randomWordsCheckbox input`).prop("checked")?s(`${P} .inputs .randomInputFields`).removeClass("disabled"):s(`${P} .inputs .randomInputFields`).addClass("disabled"),s(`${P} .replaceNewlineWithSpace input`).prop("checked")?s(`${P} .inputs .replaceNewLinesButtons`).removeClass("disabled"):s(`${P} .inputs .replaceNewLinesButtons`).addClass("disabled"),s(`${P} textarea`).val(ro),s(Fo).stop(!0,!0).css("opacity",0).removeClass("hidden").animate({opacity:1},e?0:125,()=>{s(`${P} .wordcount input`).val(Re===-1?"":Re),s(`${P} .time input`).val(Wt===-1?"":Wt),s(`${P} textarea`).trigger("focus")})),setTimeout(()=>{hs()||s(`${P} textarea`).trigger("focus")},e?10:150)}s(`${P} .delimiterCheck input`).on("change",()=>{let e;if(s(`${P} .delimiterCheck input`).prop("checked")?(e="|",s(`${P} .randomInputFields .sectioncount `).removeClass("hidden"),s(`${P} .randomInputFields .wordcount input `).val(""),s(`${P} .randomInputFields .wordcount `).addClass("hidden")):(e=" ",s(`${P} .randomInputFields .sectioncount input `).val(""),s(`${P} .randomInputFields .sectioncount `).addClass("hidden"),s(`${P} .randomInputFields .wordcount `).removeClass("hidden")),s(`${P} textarea`).val()!==Be.join(It)){let o=s(`${P} textarea`).val().split(It).join(e);o=o.replace(/\n /g,`
`),s(`${P} textarea`).val(o)}else{let t=Be.join(e);t=t.replace(/\n /g,`
`),s(`${P} textarea`).val(t)}Qn(e)});function nn(e={}){e.noAnim===void 0&&(e.noAnim=!1),e.resetState===void 0&&(e.resetState=!0),no(Fo)&&s(Fo).stop(!0,!0).css("opacity",1).animate({opacity:0},e.noAnim?0:125,()=>{e.resetState&&wg(),s(Fo).addClass("hidden"),Ve(qu)})}s(Fo).on("mousedown",e=>{s(e.target).attr("id")==="customTextPopupWrapper"&&nn()});s(`${P} .inputs .randomWordsCheckbox input`).on("change",()=>{s(`${P} .randomWordsCheckbox input`).prop("checked")?s(`${P} .inputs .randomInputFields`).removeClass("disabled"):s(`${P} .inputs .randomInputFields`).addClass("disabled")});s(`${P} .replaceNewlineWithSpace input`).on("change",()=>{s(`${P} .replaceNewlineWithSpace input`).prop("checked")?s(`${P} .inputs .replaceNewLinesButtons`).removeClass("disabled"):s(`${P} .inputs .replaceNewLinesButtons`).addClass("disabled")});s(`${P} .inputs .replaceNewLinesButtons .button`).on("click",e=>{s(`${P} .inputs .replaceNewLinesButtons .button`).removeClass("active"),s(e.target).addClass("active")});s(`${P} textarea`).on("input",()=>{bt(s(`${P} textarea`).val())});s(`${P} textarea`).on("keypress",e=>{if(no("#customTextPopup .longCustomTextWarning")){e.preventDefault();return}e.code==="Enter"&&e.ctrlKey&&s(`${P} .button.apply`).trigger("click"),hs()&&su()!==""&&(lo("",void 0),m("Disabled long custom text progress tracking",0,{duration:5}),Sy())});s(`${P} .randomInputFields .wordcount input`).on("keypress",()=>{s(`${P} .randomInputFields .time input`).val(""),s(`${P} .randomInputFields .sectioncount input`).val("")});s(`${P} .randomInputFields .time input`).on("keypress",()=>{s(`${P} .randomInputFields .wordcount input`).val(""),s(`${P} .randomInputFields .sectioncount input`).val("")});s(`${P} .randomInputFields .sectioncount input`).on("keypress",()=>{s(`${P} .randomInputFields .time input`).val(""),s(`${P} .randomInputFields .wordcount input`).val("")});function _T(){let e=s(`${P} textarea`).val().normalize();if(e===""){m("Text cannot be empty",0);return}if(bt(e,!0),e=e.trim(),e=e.replace(/[\u2000-\u200A\u202F\u205F\u00A0]/g," "),e=e.replace(/[\u200B-\u200D\u2060\uFEFF]/g,""),s(`${P} .replaceControlCharacters input`).prop("checked")&&(e=e.replace(/([^\\]|^)\\t/gm,"$1	"),e=e.replace(/([^\\]|^)\\n/gm,`$1
`),e=e.replace(/\\\\t/gm,"\\t"),e=e.replace(/\\\\n/gm,"\\n")),e=e.replace(/ +/gm," "),e=e.replace(/( *(\r\n|\r|\n) *)/g,`
 `),s(`${P} .typographyCheck input`).prop("checked")&&(e=Mp(e)),s(`${P} .replaceNewlineWithSpace input`).prop("checked")){let a=!0;s(s(`${P} .replaceNewLinesButtons .button`)[0]).hasClass("active")&&(a=!1),a?(e=e.replace(/\n/gm,". "),e=e.replace(/\.\. /gm,". "),e=e.replace(/ +/gm," ")):(e=e.replace(/\n/gm," "),e=e.replace(/ +/gm," "))}const t=e.split(It).filter(a=>a!=="");if(qa(t),Gs(parseInt(s(`${P} .wordcount input`).val()||"-1")),Qs(parseInt(s(`${P} .time input`).val()||"-1")),bg(parseInt(s(`${P} .sectioncount input`).val()||"-1")),Vs(s(`${P} .randomWordsCheckbox input`).prop("checked")&&Re>-1),js(s(`${P} .randomWordsCheckbox input`).prop("checked")&&Wt>-1),Er(s(`${P} .randomWordsCheckbox input`).prop("checked")&&is>-1),s(`${P} .randomWordsCheckbox input`).prop("checked")&&!pe&&!fe&&!He){m("You need to specify word count or time in seconds to start a random custom test",0,{duration:5});return}if(s(`${P} .randomWordsCheckbox input`).prop("checked")&&pe&&fe){m("You need to pick between word count or time in seconds to start a random custom test",0,{duration:5});return}(fe&&Re===0||pe&&Wt===0)&&m("Infinite words! Make sure to use Bail Out from the command line to save your result.",0,{duration:7}),Eh(),ie(),i.mode!=="custom"&&Ge("custom"),Y(),nn()}s("#popups").on("click",`${P} .button.apply`,()=>{_T()});s(".pageTest").on("click","#testConfig .customText .textButton",()=>{jl()});s(document).on("keydown",e=>{e.key==="Escape"&&no("#customTextPopupWrapper")&&(nn(),e.preventDefault())});s("#popups").on("click",`${P} .wordfilter`,()=>{nn({noAnim:!0,resetState:!1}),BT()});s(`${P} .buttonsTop .showSavedTexts`).on("click",()=>{nn({noAnim:!0}),Vl(!0,()=>{jl(!0)})});s("#customTextPopupWrapper .buttonsTop .saveCustomText").on("click",()=>{nn({noAnim:!0,resetState:!1}),RT(!0,()=>{jl(!0)})});s("#customTextPopupWrapper .longCustomTextWarning .button").on("click",()=>{s("#customTextPopup .longCustomTextWarning").addClass("hidden")});s("#fileInput").on("change",()=>{var t;const e=(t=s("#fileInput")[0].files)==null?void 0:t[0];if(e){if(e.type!=="text/plain"){m("File is not a text file",-1,{duration:5});return}const a=new FileReader;a.readAsText(e,"UTF-8"),a.onload=o=>{var r;const n=(r=o.target)==null?void 0:r.result;s(`${P} textarea`).val(n),s("#fileInput").val("")},a.onerror=()=>{m("Failed to read file",-1,{duration:5})}}});st(qu);function Ty(){const e=s("#mobileTestConfigModal");if(e.find("button").removeClass("active"),e.find(`.modeGroup button[data-mode='${i.mode}']`).addClass("active"),e.find(".timeGroup").addClass("hidden"),e.find(".wordsGroup").addClass("hidden"),e.find(".quoteGroup").addClass("hidden"),e.find(".customGroup").addClass("hidden"),e.find(`.${i.mode}Group`).removeClass("hidden"),i.punctuation?e.find(".punctuation").addClass("active"):e.find(".punctuation").removeClass("active"),i.numbers?e.find(".numbers").addClass("active"):e.find(".numbers").removeClass("active"),i.mode==="time")e.find(`.timeGroup button[data-time='${i.time}']`).addClass("active"),e.find(".punctuation").removeClass("disabled"),e.find(".numbers").removeClass("disabled");else if(i.mode==="words")e.find(`.wordsGroup button[data-words='${i.words}']`).addClass("active"),e.find(".punctuation").removeClass("disabled"),e.find(".numbers").removeClass("disabled");else if(i.mode==="quote"){for(const t of i.quoteLength)e.find(`.quoteGroup button[data-quoteLength='${t}']`).addClass("active");e.find(".punctuation").addClass("disabled"),e.find(".numbers").addClass("disabled")}else i.mode==="zen"?(e.find(".punctuation").addClass("disabled"),e.find(".numbers").addClass("disabled")):i.mode==="custom"&&(e.find(".punctuation").removeClass("disabled"),e.find(".numbers").removeClass("disabled"))}function NT(){Dn.show({beforeAnimation:async()=>{Ty()}})}function KT(){Dn.hide()}async function zT(e){var l,c,d;const t=e.querySelectorAll(".wordsGroup button");for(const u of t)u.addEventListener("click",f=>{const g=f.currentTarget.getAttribute("data-words");if(g==="custom")ey({modalChain:Dn});else if(g!==void 0){const h=parseInt(g);ns(h),ie(),Y()}});const a=e.querySelectorAll(".modeGroup button");for(const u of a)u.addEventListener("click",f=>{const g=f.currentTarget.getAttribute("data-mode");g!==i.mode&&(Ge(g),ie(),Y())});const o=e.querySelectorAll(".timeGroup button");for(const u of o)u.addEventListener("click",f=>{const g=f.currentTarget.getAttribute("data-time");if(g==="custom")uy({modalChain:Dn});else if(g!==void 0){const h=parseInt(g);ia(h),ie(),Y()}});const n=e.querySelectorAll(".quoteGroup button");for(const u of n)u.addEventListener("click",f=>{const p=f.currentTarget,g=parseInt(p.getAttribute("data-quoteLength")??"0",10);if(g===-2)vy({modalChain:Dn});else{let h=g;g===-1&&(h=[0,1,2,3]),$a(h,!1,f.shiftKey),ie(),Y()}});(l=e.querySelector(".customChange"))==null||l.addEventListener("click",()=>{KT(),jl()}),(c=e.querySelector(".punctuation"))==null||c.addEventListener("click",()=>{ua(!i.punctuation),ie(),Y()}),(d=e.querySelector(".numbers"))==null||d.addEventListener("click",()=>{zt(!i.numbers),ie(),Y()});const r=e.querySelectorAll("button");for(const u of r)u.addEventListener("click",()=>{Ty()})}const Dn=new le({dialogId:"mobileTestConfigModal",setup:zT});s(".pageTest").on("click","#testModesNotice .textButton",async e=>{const t=s(e.currentTarget).attr("commands");t!==void 0&&(await Zo()).show({subgroupOverride:t})});s(".pageTest").on("click","#testConfig .wordCount .textButton",e=>{s(e.currentTarget).attr("wordCount")==="custom"&&ey()});s(".pageTest").on("click","#testConfig .time .textButton",e=>{s(e.currentTarget).attr("timeconfig")==="custom"&&uy()});s(".pageTest").on("click",".tags .editTagsButton",()=>{var e,t;if((((t=(e=S())==null?void 0:e.tags)==null?void 0:t.length)??0)>0){const a=s(".pageTest .tags .editTagsButton").attr("data-result-id"),o=s(".pageTest .tags .editTagsButton").attr("data-active-tag-ids"),n=o===""?[]:o.split(",");ry(a,n,"resultPage")}});s(".pageTest").on("click","#mobileTestConfigButton",()=>{NT()});s(".pageTest #rateQuoteButton").on("click",async()=>{if(se===null){m("Failed to show quote rating popup: no quote",-1);return}Dk(se)});s(".pageTest #reportQuoteButton").on("click",async()=>{if(se===null){m("Failed to show quote report popup: no quote",-1);return}hy(se==null?void 0:se.id)});s(".pageTest").on("click","#testConfig .quoteLength .textButton",e=>{parseInt(s(e.currentTarget).attr("quoteLength")??"0")===-2&&vy()});var mp;(mp=document.querySelector("#pageAbout #supportMeAboutButton"))==null||mp.addEventListener("click",()=>{ig()});var gp;(gp=document.querySelector("#pageAbout #contactPopupButton2"))==null||gp.addEventListener("click",()=>{lg()});const Fu={includeBackground:!1};function UT(){ad.show({beforeAnimation:async e=>{e.querySelector("input[type='checkbox']").checked=!1,Fu.includeBackground=!1}})}async function VT(){const e={c:Da.map(t=>s(`.pageSettings .customTheme .customThemeEdit #${t}[type='color']`).attr("value"))};return Fu.includeBackground&&(e.i=i.customBackground,e.s=i.customBackgroundSize,e.f=i.customBackgroundFilter),window.location.origin+"?customTheme="+btoa(JSON.stringify(e))}async function jT(){const e=await VT();try{await navigator.clipboard.writeText(e),m("URL Copied to clipboard",1),ad.hide()}catch{m("Looks like we couldn't copy the link straight to your clipboard. Please copy it manually.",0,{duration:5}),sd.show({modalChain:ad,focusFirstInput:"focusAndSelect",beforeAnimation:async a=>{a.querySelector("input").value=e}})}}const ad=new le({dialogId:"shareCustomThemeModal",setup:async e=>{var t,a;(t=e.querySelector("button"))==null||t.addEventListener("click",jT),(a=e.querySelector("input[type='checkbox']"))==null||a.addEventListener("change",o=>{Fu.includeBackground=o.target.checked})}}),sd=new le({dialogId:"shareCustomThemeUrlModal",customEscapeHandler:async()=>{await sd.hide({clearModalChain:!0})},customWrapperClickHandler:async()=>{await sd.hide({clearModalChain:!0})}});function QT(){const e=localStorage.getItem("acceptedCookies")??"";return e?JSON.parse(e):null}function bc(e){localStorage.setItem("acceptedCookies",JSON.stringify(e))}function GT(){QT()===null&&xy()}function xy(e){ri.show({beforeAnimation:async()=>{e&&$y()},afterAnimation:async()=>{Le("cookiesModal")||ri.destroy()}})}function $y(){var e,t;(e=ri.getModal().querySelector(".main"))==null||e.classList.add("hidden"),(t=ri.getModal().querySelector(".settings"))==null||t.classList.remove("hidden")}async function Cc(){ri.hide({afterAnimation:async()=>{Bl()}})}const ri=new le({dialogId:"cookiesModal",customEscapeHandler:()=>{},customWrapperClickHandler:()=>{},setup:async e=>{var t,a,o,n,r;(t=e.querySelector(".acceptAll"))==null||t.addEventListener("click",()=>{bc({security:!0,analytics:!0}),Wc(),Cc()}),(a=e.querySelector(".rejectAll"))==null||a.addEventListener("click",()=>{bc({security:!0,analytics:!1}),Cc()}),(o=e.querySelector(".openSettings"))==null||o.addEventListener("click",()=>{$y()}),(n=e.querySelector(".cookie.ads .textButton"))==null||n.addEventListener("click",()=>{try{eS()}catch{console.error("Failed to open ad consent UI"),m("Failed to open Ad consent popup. Do you have an ad or cookie popup blocker enabled?",-1)}}),(r=e.querySelector(".acceptSelected"))==null||r.addEventListener("click",()=>{const l=e.querySelector(".cookie.analytics input").checked;bc({security:!0,analytics:l}),Cc(),l===!0&&Wc()})}});function YT(){if(!We()){m("You are offline",0,{duration:2});return}li.show({focusFirstInput:!0,beforeAnimation:async e=>{var t,a,o,n;((t=S())==null?void 0:t.streakHourOffset)!==void 0?((a=e.querySelector("input"))==null||a.remove(),(o=e.querySelector(".preview"))==null||o.remove(),(n=e.querySelector("button"))==null||n.remove(),e.querySelector(".text").textContent="You have already set your streak hour offset."):(e.querySelector("input").value="0",Ay())}})}function Ay(){var n;const e=parseInt((n=li.getModal().querySelector("input"))==null?void 0:n.value,10),t=li.getModal().querySelector(".preview"),a=new Date;a.setUTCHours(0),a.setUTCMinutes(0),a.setUTCSeconds(0),a.setUTCMilliseconds(0);const o=new Date;o.setUTCHours(0),o.setUTCMinutes(0),o.setUTCSeconds(0),o.setUTCMilliseconds(0),o.setHours(o.getHours()- -1*e),t.innerHTML=`
    <div class="row"><div>Current local reset time:</div><div>${a.toLocaleTimeString()}</div></div>
    <div class="row"><div>New local reset time:</div><div>${o.toLocaleTimeString()}</div></div>
  `}function JT(){li.hide()}async function ZT(){var a;const e=parseInt((a=li.getModal().querySelector("input"))==null?void 0:a.value,10);if(isNaN(e)){m("Streak hour offset must be a number",0);return}if(e<-11||e>12){m("Streak hour offset must be between -11 and 12",0);return}oe();const t=await E.users.setStreakHourOffset(e);if(Q(),t.status!==200)m("Failed to set streak hour offset: "+t.message,-1);else{m("Streak hour offset set",1);const o=S();o.streakHourOffset=e,ut(o),JT()}}const li=new le({dialogId:"streakHourOffsetModal",setup:async e=>{var t,a;(t=e.querySelector("input"))==null||t.addEventListener("input",()=>{Ay()}),(a=e.querySelector("button"))==null||a.addEventListener("click",()=>{ZT()})}});class O{constructor(t,a,o,n,r){if(this.configName=t,this.configValue=i[t],this.mode=o,this.configFunction=a,this.setCallback=n,this.updateCallback=r,this.updateUI(),this.mode==="select"){const l=document.querySelector(`.pageSettings .section[data-config-name=${this.configName}] select`);l==null||l.addEventListener("change",c=>{const d=s(c.target);d.hasClass("disabled")||d.hasClass("no-auto-handle")||this.setValue(d.val())})}else this.mode==="button"&&s(".pageSettings").on("click",`.section[data-config-name='${this.configName}'] button`,l=>{const c=s(l.currentTarget);if(c.hasClass("disabled")||c.hasClass("no-auto-handle"))return;const d=c.attr("data-config-value");if(d===void 0||d===""){console.error(`Failed to handle settings button click for ${t}: data-${t} is missing or empty.`),m("Button is missing data property. Please report this.",-1);return}let u=d;u==="true"&&(u=!0),u==="false"&&(u=!1),this.setValue(u)})}setValue(t){this.configFunction(t),this.updateUI(),this.setCallback&&this.setCallback()}updateUI(){if(this.configValue=i[this.configName],s(`.pageSettings .section[data-config-name='${this.configName}'] button`).removeClass("active"),this.mode==="select"){const t=document.querySelector(`.pageSettings .section[data-config-name='${this.configName}'] select`);if(t===null)return;t.value=this.configValue;const a=t.slim;a==null||a.store.setSelectedBy("value",[this.configValue]),a==null||a.render.renderValues(),a==null||a.render.renderOptions(a.store.getData())}else this.mode==="button"&&s(`.pageSettings .section[data-config-name='${this.configName}'] button[data-config-value='${this.configValue}']`).addClass("active");this.updateCallback&&this.updateCallback()}}function Ei(){var t,a;const e=[];try{(a=(t=S())==null?void 0:t.tags)==null||a.forEach(o=>{o.active===!0&&e.push(o._id)}),window.localStorage.setItem("activeTags",JSON.stringify(e))}catch{}}function XT(e=!1){var a;const t=S();t&&(t.tags=(a=t.tags)==null?void 0:a.map(o=>(o.active=!1,o)),ut(t),cs(),e||Ei())}function ex(e,t,a=!1){var n;const o=S();o&&(o.tags=(n=o.tags)==null?void 0:n.map(r=>(r._id===e&&(r.active=t),r)),ut(o),cs(),a||Ei())}function My(e,t=!1){var a,o;(o=(a=S())==null?void 0:a.tags)==null||o.forEach(n=>{n._id===e&&(n.active===void 0?n.active=!0:n.active=!n.active)}),cs(),t||Ei()}function tx(){let e=window.localStorage.getItem("activeTags");if(e!=null&&e!==""){try{e=JSON.parse(e)??[]}catch{e=[]}e.forEach(t=>{My(t,!0)}),Ei()}}async function ax(e){var o;const t=S();if(!t)return;const a=(o=t.presets)==null?void 0:o.find(n=>n._id===e);if(a===void 0){m("Preset not found",0);return}if(await vi(a.config),XT(!0),a.config.tags){for(const n of a.config.tags)ex(n,!0,!1);Ei()}Y(),m("Preset applied",1,{duration:2}),Jo()}function sx(){var t;let e=i.theme;i.randomTheme!=="off"&&i.randomTheme!=="custom"&&xt!==null&&(e=xt),document.querySelectorAll(".pageSettings .section.themes .theme").forEach(a=>{a.classList.remove("active")}),(t=document.querySelector(`.pageSettings .section.themes .theme[theme='${e}']`))==null||t.classList.add("active")}function Uo(e,t,a=!1,o=!1){if(a){const d=e.find("input.color").attr("id");d===void 0&&console.error("Could not find color ID!"),!o&&d!==void 0&&document.documentElement.style.setProperty(d,t);const u=e.find("label");u.val(t),u.attr("value",t),u.attr("for")!=="--bg-color"&&u.css("background-color",t),e.find("input.input").val(t),e.find("input.color").attr("value",t);return}const n=[{rule:/\b[0-9]{1,3},\s?[0-9]{1,3},\s?[0-9]{1,3}\s*\b/,start:"rgb(",end:")"},{rule:/\b[A-Z, a-z, 0-9]{6}\b/,start:"#",end:""},{rule:/\b[0-9]{1,3},\s?[0-9]{1,3}%,\s?[0-9]{1,3}%?\s*\b/,start:"hsl(",end:")"}];t=t.replace("°","");for(const d of n)if(t.match(d.rule)){t=d.start+t+d.end;break}s(".colorConverter").css("color",t);const r=zv(s(".colorConverter").css("color"));if(r===void 0)return;t=r;const l=e.find("input.color").attr("id");l===void 0&&console.error("Could not find color ID!"),!o&&l!==void 0&&document.documentElement.style.setProperty(l,t);const c=e.find("label");c.val(t),c.attr("value",t),c.attr("for")!=="--bg-color"&&c.css("background-color",t),e.find("input.input").val(t),e.find("input.color").attr("value",t)}async function Vo(){var e;if(i.customTheme){const t=s(".pageSettings .section.themes .allCustomThemes.buttons").empty(),a=s(".pageSettings .section.themes .addCustomThemeButton");if(z())s(".pageSettings .section.themes .customThemeEdit #saveCustomThemeButton").text("save as new");else{s(".pageSettings .section.themes .customThemeEdit #saveCustomThemeButton").text("save");return}a.removeClass("hidden"),(((e=S())==null?void 0:e.customThemes)??[]).forEach(n=>{const r=n.colors[0],l=n.colors[1];t.append(`<div class="customTheme button" customThemeId='${n._id}' 
        style="color:${l};background:${r}">
        <div class="editButton"><i class="fas fa-pen"></i></div>
        <div class="text">${n.name.replace(/_/g," ")}</div>
        <div class="delButton"><i class="fas fa-trash fa-fw"></i></div>
        </div>`)})}else{const t=document.querySelector(".pageSettings .section.themes .favThemes.buttons");t.innerHTML="";let a="";const o=document.querySelector(".pageSettings .section.themes .allThemes.buttons");o.innerHTML="";let n="",r=i.theme;i.randomTheme!=="off"&&i.randomTheme!=="custom"&&xt!==null&&(r=xt);let l;try{l=await Uv()}catch(c){m(ee(c,"Failed to refresh theme buttons"),-1);return}if(i.favThemes.length>0){t.style.marginBottom="1rem",t.style.marginTop="1rem";for(const c of l)if(i.favThemes.includes(c.name)){const d=r===c.name?"active":"";a+=`<div class="theme button ${d}" theme='${c.name}' style="background: ${c.bgColor}; color: ${c.mainColor};outline: 0 solid ${c.mainColor};">
            <div class="favButton active"><i class="fas fa-star"></i></div>
            <div class="text">${c.name.replace(/_/g," ")}</div>
            <div class="themeBubbles" style="background: ${c.bgColor};outline: 0.25rem solid ${c.bgColor};">
              <div class="themeBubble" style="background: ${c.mainColor}"></div>
              <div class="themeBubble" style="background: ${c.subColor}"></div>
              <div class="themeBubble" style="background: ${c.textColor}"></div>
            </div>
            </div>
            `}t.innerHTML=a}else t.style.marginBottom="0",t.style.marginTop="0";for(const c of l){if(i.favThemes.includes(c.name))continue;const d=r===c.name?"active":"";n+=`<div class="theme button ${d}" theme='${c.name}' style="background: ${c.bgColor}; color: ${c.mainColor};outline: 0 solid ${c.mainColor};">
        <div class="favButton"><i class="far fa-star"></i></div>
        <div class="text">${c.name.replace(/_/g," ")}</div>
        <div class="themeBubbles" style="background: ${c.bgColor};outline: 0.25rem solid ${c.bgColor};">
          <div class="themeBubble" style="background: ${c.mainColor}"></div>
          <div class="themeBubble" style="background: ${c.subColor}"></div>
          <div class="themeBubble" style="background: ${c.textColor}"></div>
        </div>
        </div>
        `}o.innerHTML=n}}function ox(e=!1){s(".pageSettings .section.themes .tabContainer .customTheme .colorPicker").each((t,a)=>{const o=i.customThemeColors[Da.indexOf(s(a).find("input.color").attr("id"))];Uo(s(a),o,!1,e)})}function nx(e){if(i.favThemes.includes(e))Bc(i.favThemes.filter(t=>t!==e));else{const t=i.favThemes;t.push(e),Bc(t)}Jo()}function ix(){const e=[];for(const t of Da)e.push(s(`.pageSettings .customTheme .customThemeEdit #${t}[type='color']`).attr("value"));Kn(e),m("Custom theme saved",1)}function od(e=!1){const t=s(".pageSettings .section.themes .tabs button[data-tab='preset']"),a=s(".pageSettings .section.themes .tabs button[data-tab='custom']");i.customTheme?(t.removeClass("active"),(!a.hasClass("active")||e)&&(a.addClass("active"),Vo()),Hs(s('.pageSettings [tabContent="preset"]'),s('.pageSettings [tabContent="custom"]'),250)):(a.removeClass("active"),(!t.hasClass("active")||e)&&(t.addClass("active"),Vo()),Hs(s('.pageSettings [tabContent="custom"]'),s('.pageSettings [tabContent="preset"]'),250))}s(".pageSettings .section.themes .tabs button").on("click",e=>{s(".pageSettings .section.themes .tabs button").removeClass("active");const t=s(e.currentTarget);t.addClass("active"),t.attr("data-tab")==="preset"?es(!1):es(!0)});s(".pageSettings").on("click"," .section.themes .customTheme.button",e=>{var o,n;if(s(e.target).hasClass("delButton")||s(e.target).hasClass("editButton"))return;const t=s(e.currentTarget).attr("customThemeId")??"",a=(n=(o=S())==null?void 0:o.customThemes)==null?void 0:n.find(r=>r._id===t);if(a===void 0){console.error("Could not find custom theme in snapshot for id ",t);return}Kn(a.colors)});s(".pageSettings").on("click",".section.themes .theme .favButton",e=>{const t=s(e.currentTarget).parents(".theme.button").attr("theme");t!==void 0?nx(t):console.error("Could not find the theme attribute attached to the button clicked!")});s(".pageSettings").on("click",".section.themes .theme.button",e=>{const t=s(e.currentTarget).attr("theme");!s(e.target).hasClass("favButton")&&t!==void 0&&Ym(t)});s(".pageSettings .section.themes .tabContainer .customTheme input[type=color]").on("input",e=>{const t=s(e.currentTarget).attr("id"),a=s(e.currentTarget).val();Uo(s(".colorPicker #"+t).parent(),a,!0)});s(".pageSettings .section.themes .tabContainer .customTheme input[type=color]").on("change",e=>{const t=s(e.currentTarget).attr("id"),a=s(e.currentTarget).val();Uo(s(".colorPicker #"+t).parent(),a)});s(".pageSettings .section.themes .tabContainer .customTheme input.input").on("blur",e=>{if(e.target.id==="name")return;const t=s(e.currentTarget).attr("id"),a=s(e.currentTarget).val();Uo(s(".colorPicker #"+t).parent(),a)}).on("keypress",function(e){if(e.target.id!=="name"&&e.code==="Enter"){s(this).attr("disabled","disabled");const t=s(e.currentTarget).attr("id"),a=s(e.currentTarget).val();Uo(s(".colorPicker #"+t).parent(),a),s(this).removeAttr("disabled")}});s(".pageSettings #loadCustomColorsFromPreset").on("click",async()=>{await Sh(i.theme),Da.forEach(t=>{document.documentElement.style.setProperty(t,"")}),Ch();const e=await ms();Da.forEach(t=>{let a;t==="--bg-color"?a=e.bg:t==="--main-color"?a=e.main:t==="--sub-color"?a=e.sub:t==="--sub-alt-color"?a=e.subAlt:t==="--caret-color"?a=e.caret:t==="--text-color"?a=e.text:t==="--error-color"?a=e.error:t==="--error-extra-color"?a=e.errorExtra:t==="--colorful-error-color"?a=e.colorfulError:t==="--colorful-error-extra-color"&&(a=e.colorfulErrorExtra),Uo(s(".colorPicker #"+t).parent(),a)})});s(".pageSettings #saveCustomThemeButton").on("click",async()=>{if(ix(),z()){const e={name:"custom",colors:i.customThemeColors};oe();const t=await ub(e);Q(),t&&od(!0)}else od(!0)});he(e=>{e==="customThemeId"&&Vo(),e==="theme"&&ne()==="settings"&&sx()});const Ca={mode:"import",value:""};function Ly(e,t){Ca.mode=e,Ca.value=t??"",nd.show({focusFirstInput:"focusAndSelect",beforeAnimation:async a=>{var o,n,r,l;a.querySelector("input").value=Ca.value,Ca.mode==="export"?((o=a.querySelector("button"))==null||o.classList.add("hidden"),(n=a.querySelector("input"))==null||n.setAttribute("readonly","true")):Ca.mode==="import"&&((r=a.querySelector("button"))==null||r.classList.remove("hidden"),(l=a.querySelector("input"))==null||l.removeAttribute("readonly"))}})}const nd=new le({dialogId:"importExportSettingsModal",setup:async e=>{var t;(t=e.querySelector("input"))==null||t.addEventListener("input",a=>{Ca.value=a.target.value}),e==null||e.addEventListener("submit",async a=>{if(a.preventDefault(),Ca.mode==="import"){if(Ca.value===""){nd.hide();return}try{await vi(JSON.parse(Ca.value))}catch(o){m("Failed to import settings: "+o,-1)}Jo(),nd.hide()}})}}),F={};async function rx(){await ng,F.smoothCaret=new O("smoothCaret",_m,"button"),F.difficulty=new O("difficulty",ta,"button"),F.quickRestart=new O("quickRestart",zm,"button"),F.showLiveWpm=new O("showLiveWpm",Em,"button",()=>{var e;(e=F.keymapMode)==null||e.updateUI()}),F.showLiveAcc=new O("showLiveAcc",Bm,"button"),F.showLiveBurst=new O("showLiveBurst",Pm,"button"),F.showTimerProgress=new O("showTimerProgress",Im,"button"),F.showAverage=new O("showAverage",qm,"button"),F.keymapMode=new O("keymapMode",Gt,"button",()=>{var e;(e=F.showLiveWpm)==null||e.updateUI()},()=>{i.keymapMode==="off"?(s(".pageSettings .section[data-config-name='keymapStyle']").addClass("hidden"),s(".pageSettings .section[data-config-name='keymapLayout']").addClass("hidden"),s(".pageSettings .section[data-config-name='keymapLegendStyle']").addClass("hidden"),s(".pageSettings .section[data-config-name='keymapShowTopRow']").addClass("hidden")):(s(".pageSettings .section[data-config-name='keymapStyle']").removeClass("hidden"),s(".pageSettings .section[data-config-name='keymapLayout']").removeClass("hidden"),s(".pageSettings .section[data-config-name='keymapLegendStyle']").removeClass("hidden"),s(".pageSettings .section[data-config-name='keymapShowTopRow']").removeClass("hidden"))}),F.keymapMatrix=new O("keymapStyle",ag,"button"),F.keymapLayout=new O("keymapLayout",Is,"select"),F.keymapLegendStyle=new O("keymapLegendStyle",tg,"button"),F.keymapShowTopRow=new O("keymapShowTopRow",sg,"button"),F.showKeyTips=new O("showKeyTips",Hm,"button",void 0,()=>{i.showKeyTips?s(".pageSettings .tip").removeClass("hidden"):s(".pageSettings .tip").addClass("hidden")}),F.freedomMode=new O("freedomMode",Vm,"button",()=>{var e;(e=F.confidenceMode)==null||e.updateUI()}),F.strictSpace=new O("strictSpace",$m,"button"),F.oppositeShiftMode=new O("oppositeShiftMode",Am,"button"),F.confidenceMode=new O("confidenceMode",jm,"button",()=>{var e,t;(e=F.freedomMode)==null||e.updateUI(),(t=F.stopOnError)==null||t.updateUI()}),F.indicateTypos=new O("indicateTypos",Qm,"button"),F.hideExtraLetters=new O("hideExtraLetters",Fm,"button"),F.blindMode=new O("blindMode",cm,"button"),F.quickEnd=new O("quickEnd",Cm,"button"),F.repeatQuotes=new O("repeatQuotes",Sm,"button"),F.ads=new O("ads",km,"button"),F.alwaysShowWordsHistory=new O("alwaysShowWordsHistory",vm,"button"),F.britishEnglish=new O("britishEnglish",eg,"button"),F.singleListCommandLine=new O("singleListCommandLine",wm,"button"),F.capsLockWarning=new O("capsLockWarning",bm,"button"),F.flipTestColors=new O("flipTestColors",Tm,"button"),F.showOutOfFocusWarning=new O("showOutOfFocusWarning",fm,"button"),F.colorfulMode=new O("colorfulMode",xm,"button"),F.startGraphsAtZero=new O("startGraphsAtZero",Nm,"button"),F.autoSwitchTheme=new O("autoSwitchTheme",Gm,"button"),F.randomTheme=new O("randomTheme",Xm,"button"),F.stopOnError=new O("stopOnError",Id,"button",()=>{var e;(e=F.confidenceMode)==null||e.updateUI()}),F.soundVolume=new O("soundVolume",lm,"button"),F.playSoundOnError=new O("playSoundOnError",im,"button",()=>{i.playSoundOnError!=="off"&&Ll()}),F.playSoundOnClick=new O("playSoundOnClick",rm,"button",()=>{i.playSoundOnClick!=="off"&&Fa("KeyQ")}),F.showAllLines=new O("showAllLines",_n,"button"),F.paceCaret=new O("paceCaret",pm,"button"),F.repeatedPace=new O("repeatedPace",mm,"button"),F.minWpm=new O("minWpm",gm,"button"),F.minAcc=new O("minAcc",hm,"button"),F.minBurst=new O("minBurst",ym,"button"),F.smoothLineScroll=new O("smoothLineScroll",Km,"button"),F.lazyMode=new O("lazyMode",Nn,"button"),F.layout=new O("layout",Es,"select"),F.language=new O("language",Oo,"select"),F.fontSize=new O("fontSize",wl,"button"),F.pageWidth=new O("pageWidth",Mm,"button"),F.caretStyle=new O("caretStyle",Lm,"button"),F.paceCaretStyle=new O("paceCaretStyle",Wm,"button"),F.timerStyle=new O("timerStyle",Dm,"button"),F.highlightMode=new O("highlightMode",gs,"button"),F.tapeMode=new O("tapeMode",Fd,"button"),F.timerOpacity=new O("timerOpacity",Om,"button"),F.timerColor=new O("timerColor",Rm,"button"),F.fontFamily=new O("fontFamily",Um,"button",void 0,()=>{const e=s(".pageSettings .section[data-config-name='fontFamily'] .buttons button[data-config-value='custom']");s(".pageSettings .section[data-config-name='fontFamily'] .buttons .active").length===0?(e.addClass("active"),e.text(`Custom (${i.fontFamily.replace(/_/g," ")})`)):e.text("Custom")}),F.alwaysShowDecimalPlaces=new O("alwaysShowDecimalPlaces",dm,"button"),F.typingSpeedUnit=new O("typingSpeedUnit",um,"button"),F.customBackgroundSize=new O("customBackgroundSize",Rd,"button")}function lx(){var e,t;s(".pageSettings .section.themes .favThemes.buttons").empty(),s(".pageSettings .section.themes .allThemes.buttons").empty(),s(".pageSettings .section.themes .allCustomThemes.buttons").empty(),s(".pageSettings .section[data-config-name='funbox'] .buttons").empty(),s(".pageSettings .section[data-config-name='fontFamily'] .buttons").empty();for(const a of document.querySelectorAll(".pageSettings select"))(t=(e=a==null?void 0:a.slim)==null?void 0:e.destroy)==null||t.call(e)}let Nf=!1;async function cx(){var D;i.showKeyTips?s(".pageSettings .tip").removeClass("hidden"):s(".pageSettings .tip").addClass("hidden");let e;try{e=await qp()}catch(v){console.error(ee(v,"Failed to initialize settings language picker"))}const t=document.querySelector(".pageSettings .section[data-config-name='language'] select");let a="";if(e)for(const v of e){a+=`<optgroup label="${v.name}">`;for(const C of v.languages){const q=C===i.language?"selected":"",G=os(C);a+=`<option value="${C}" ${q}>${G}</option>`}a+="</optgroup>"}t.innerHTML=a,new At({select:t,settings:{searchPlaceholder:"search"}});let o;try{o=await fl()}catch(v){console.error(ee(v,"Failed to refresh keymap"))}const n=document.querySelector(".pageSettings .section[data-config-name='layout'] select"),r=document.querySelector(".pageSettings .section[data-config-name='keymapLayout'] select");let l='<option value="default">off</option>',c='<option value="overrideSync">emulator sync</option>';if(o)for(const v of Object.keys(o)){const C=`<option value="${v}">${v.replace(/_/g," ")}</option>`;v.toString()!=="korean"&&(l+=C),v.toString()!=="default"&&(c+=C)}n.innerHTML=l,r.innerHTML=c,new At({select:n}),new At({select:r});let d;try{d=await Ep()}catch(v){console.error(ee(v,"Failed to load themes into dropdown boxes"))}const u=document.querySelector(".pageSettings .section[data-config-name='autoSwitchThemeInputs'] select.light"),f=document.querySelector(".pageSettings .section[data-config-name='autoSwitchThemeInputs'] select.dark");let p="",g="";if(d)for(const v of d){const C=`<option value="${v.name}" ${v.name===i.themeLight?"selected":""}>${v.name.replace(/_/g," ")}</option>`;p+=C;const q=`<option value="${v.name}" ${v.name===i.themeDark?"selected":""}>${v.name.replace(/_/g," ")}</option>`;g+=q}u.innerHTML=p,f.innerHTML=g,new At({select:u,events:{afterChange:v=>{var C;Jm((C=v[0])==null?void 0:C.value)}}}),new At({select:f,events:{afterChange:v=>{var C;Zm((C=v[0])==null?void 0:C.value)}}});const h=document.querySelector(".pageSettings .section[data-config-name='funbox'] .buttons");h.innerHTML=`<div class="funbox button" data-config-value='none'>none</div>`;let y="",w;try{w=await ui()}catch(v){console.error(ee(v,"Failed to get funbox list"))}if(w){for(const v of w)v.name==="mirror"?y+=`<div class="funbox button" data-config-value='${v.name}' aria-label="${v.info}" data-balloon-pos="up" data-balloon-length="fit" style="transform:scaleX(-1);">${v.name.replace(/_/g," ")}</div>`:v.name==="upside_down"?y+=`<div class="funbox button" data-config-value='${v.name}' aria-label="${v.info}" data-balloon-pos="up" data-balloon-length="fit" style="transform:scaleX(-1) scaleY(-1);">${v.name.replace(/_/g," ")}</div>`:y+=`<div class="funbox button" data-config-value='${v.name}' aria-label="${v.info}" data-balloon-pos="up" data-balloon-length="fit">${v.name.replace(/_/g," ")}</div>`;h.innerHTML=y}let k=!0;const L=document.querySelector(".pageSettings .section[data-config-name='fontFamily'] .buttons");L.innerHTML="";let x="",B;try{B=await Vv()}catch(v){console.error(ee(v,"Failed to update fonts settings buttons"))}if(B){for(const v of B)i.fontFamily===v.name&&(k=!1),x+=`<button class="${i.fontFamily===v.name?" active":""}" style="font-family:${v.display!==void 0?v.display:v.name}" data-config-value="${v.name.replace(/ /g,"_")}">${v.display!==void 0?v.display:v.name}</button>`;x+=k?`<button class="no-auto-handle active" data-config-value="custom">Custom (${i.fontFamily.replace(/_/g," ")})</button>`:'<button class="no-auto-handle" data-config-value="custom"">Custom</button>',L.innerHTML=x}if(s(".pageSettings .section[data-config-name='customBackgroundSize'] input").val(i.customBackground),s(".pageSettings .section[data-config-name='fontSize'] input").val(i.fontSize),s(".pageSettings .section[data-config-name='customLayoutfluid'] input").val(i.customLayoutfluid.replace(/#/g," ")),tl(!0),!Nf)await rx(),Nf=!0;else for(const v of Object.keys(F))(D=F[v])==null||D.updateUI();tl(!1),await Vo(),await ng}function Wy(){s(".sectionGroupTitle[group='account']").addClass("hidden"),s(".settingsGroup.account").addClass("hidden"),s(".pageSettings .section.needsAccount").addClass("hidden"),s(".pageSettings .quickNav .accountTitleLink").addClass("hidden")}function dx(){var e;s(".sectionGroupTitle[group='account']").removeClass("hidden"),s(".settingsGroup.account").removeClass("hidden"),s(".pageSettings .section.needsAccount").removeClass("hidden"),s(".pageSettings .quickNav .accountTitleLink").removeClass("hidden"),Ey(),By(),Ql(),((e=S())==null?void 0:e.lbOptOut)===!0&&s(".pageSettings .section.optOutOfLeaderboards").remove()}function Ql(){var e;if(!z())s(".pageSettings .section.discordIntegration").addClass("hidden");else{if(!S())return;s(".pageSettings .section.discordIntegration").removeClass("hidden"),((e=S())==null?void 0:e.discordId)===void 0?(s(".pageSettings .section.discordIntegration .buttons").removeClass("hidden"),s(".pageSettings .section.discordIntegration .info").addClass("hidden")):(s(".pageSettings .section.discordIntegration .buttons").addClass("hidden"),s(".pageSettings .section.discordIntegration .info").removeClass("hidden"))}}function Gl(){if(s(".pageSettings .section.passwordAuthSettings button").addClass("hidden"),s(".pageSettings .section.googleAuthSettings button").addClass("hidden"),!z())return;const e=gl(),t=e.providerData.find(o=>o.providerId==="password"),a=e.providerData.find(o=>o.providerId==="google.com");t?(s(".pageSettings .section.passwordAuthSettings #emailPasswordAuth").removeClass("hidden"),s(".pageSettings .section.passwordAuthSettings #passPasswordAuth").removeClass("hidden")):s(".pageSettings .section.passwordAuthSettings #addPasswordAuth").removeClass("hidden"),a?(s(".pageSettings .section.googleAuthSettings #removeGoogleAuth").removeClass("hidden"),t?s(".pageSettings .section.googleAuthSettings #removeGoogleAuth").removeClass("disabled"):s(".pageSettings .section.googleAuthSettings #removeGoogleAuth").addClass("disabled")):s(".pageSettings .section.googleAuthSettings #addGoogleAuth").removeClass("hidden")}function Iy(){s(".pageSettings .section[data-config-name='funbox'] .button").removeClass("active"),s(".pageSettings .section[data-config-name='funbox'] .button").removeClass("disabled"),ui().then(e=>{e.forEach(t=>{!Ld(i.funbox,t.name)&&!i.funbox.split("#").includes(t.name)&&s(`.pageSettings .section[data-config-name='funbox'] .button[data-config-value='${t.name}']`).addClass("disabled")})}).catch(e=>{m(`Failed to update funbox buttons: ${e.message}`,-1)}),i.funbox.split("#").forEach(e=>{s(`.pageSettings .section[data-config-name='funbox'] .button[data-config-value='${e}']`).addClass("active")})}function Ey(){var e,t;if(z()&&S()){const a=s(".pageSettings .section.tags .tagsList").empty();(t=(e=S())==null?void 0:e.tags)==null||t.forEach(o=>{a.append(`

      <div class="buttons tag" data-id="${o._id}" data-name="${o.name}" data-display="${o.display}">
        <button class="tagButton ${o.active?"active":""}" active="${o.active}">
          ${o.display}
        </button>
        <button class="clearPbButton">
          <i class="fas fa-crown fa-fw"></i>
        </button>
        <button class="editButton">
          <i class="fas fa-pen fa-fw"></i>
        </button>
        <button class="removeButton">
          <i class="fas fa-trash fa-fw"></i>
        </button>
      </div>

      `)}),s(".pageSettings .section.tags").removeClass("hidden")}else s(".pageSettings .section.tags").addClass("hidden")}function By(){var e,t;if(z()&&S()){const a=s(".pageSettings .section.presets .presetsList").empty();(t=(e=S())==null?void 0:e.presets)==null||t.forEach(o=>{a.append(`
      <div class="buttons preset" data-id="${o._id}" data-name="${o.name}" data-display="${o.display}">
        <button class="presetButton">${o.display}</button>
        <button class="editButton">
          <i class="fas fa-pen fa-fw"></i>
        </button>
        <button class="removeButton">
          <i class="fas fa-trash fa-fw"></i>
        </button>
      </div>
      
      `)}),s(".pageSettings .section.presets").removeClass("hidden")}else s(".pageSettings .section.presets").addClass("hidden")}async function Ya(e=!0){var o;if(e)for(const n of Object.keys(F))(o=F[n])==null||o.updateUI();Ey(),By(),Iy(),Ql(),Gl(),await Te(0),od(!0),ox(!0),s(".pageSettings .section[data-config-name='paceCaret'] input.customPaceCaretSpeed").val(et(i.typingSpeedUnit).fromWpm(i.paceCaretCustomSpeed)),s(".pageSettings .section[data-config-name='minWpm'] input.customMinWpmSpeed").val(et(i.typingSpeedUnit).fromWpm(i.minWpmCustomSpeed)),s(".pageSettings .section[data-config-name='minAcc'] input.customMinAcc").val(i.minAccCustom),s(".pageSettings .section[data-config-name='minBurst'] input.customMinBurst").val(et(i.typingSpeedUnit).fromWpm(i.minBurstCustomSpeed)),i.autoSwitchTheme?s(".pageSettings .section[data-config-name='autoSwitchThemeInputs']").removeClass("hidden"):s(".pageSettings .section[data-config-name='autoSwitchThemeInputs']").addClass("hidden"),i.customBackground!==""?s(".pageSettings .section[data-config-name='customBackgroundFilter']").removeClass("hidden"):s(".pageSettings .section[data-config-name='customBackgroundFilter']").addClass("hidden"),z()?dx():Wy(),kh();const t=window.navigator.userAgent.toLowerCase().includes("mac")?"cmd":"ctrl",a=i.quickRestart==="esc"?"tab":"esc";s(".pageSettings .tip").html(`
    tip: You can also change all these settings quickly using the
    command line (<key>${a}</key> or <key>${t}</key> + <key>shift</key> + <key>p</key>)`)}function Py(e){const t=s(`.pageSettings .settingsGroup.${e}`);t.stop(!0,!0).slideToggle(250).toggleClass("slideup"),t.hasClass("slideup")?s(`.pageSettings .sectionGroupTitle[group=${e}]`).addClass("rotateIcon"):s(`.pageSettings .sectionGroupTitle[group=${e}]`).removeClass("rotateIcon")}s(".pageSettings .section[data-config-name='paceCaret']").on("focusout","input.customPaceCaretSpeed",()=>{const e=parseInt(s(".pageSettings .section[data-config-name='paceCaret'] input.customPaceCaretSpeed").val()),t=et(i.typingSpeedUnit).toWpm(e);Ed(t)});s(".pageSettings .section[data-config-name='paceCaret']").on("click","button.save",()=>{const e=parseInt(s(".pageSettings .section[data-config-name='paceCaret'] input.customPaceCaretSpeed").val()),t=et(i.typingSpeedUnit).toWpm(e);Ed(t)});s(".pageSettings .section[data-config-name='minWpm']").on("focusout","input.customMinWpmSpeed",()=>{const e=parseInt(s(".pageSettings .section[data-config-name='minWpm'] input.customMinWpmSpeed").val()),t=et(i.typingSpeedUnit).toWpm(e);Bd(t)});s(".pageSettings .section[data-config-name='minWpm']").on("click","button.save",()=>{const e=parseInt(s(".pageSettings .section[data-config-name='minWpm'] input.customMinWpmSpeed").val()),t=et(i.typingSpeedUnit).toWpm(e);Bd(t)});s(".pageSettings .section[data-config-name='minAcc']").on("focusout","input.customMinAcc",()=>{Pd(parseInt(s(".pageSettings .section[data-config-name='minAcc'] input.customMinAcc").val()))});s(".pageSettings .section[data-config-name='minAcc']").on("click","button.save",()=>{Pd(parseInt(s(".pageSettings .section[data-config-name='minAcc'] input.customMinAcc").val()))});s(".pageSettings .section[data-config-name='minBurst']").on("focusout","input.customMinBurst",()=>{const e=parseInt(s(".pageSettings .section[data-config-name='minBurst'] input.customMinBurst").val()),t=et(i.typingSpeedUnit).toWpm(e);qd(t)});s(".pageSettings .section[data-config-name='minBurst']").on("click","button.save",()=>{const e=parseInt(s(".pageSettings .section[data-config-name='minBurst'] input.customMinBurst").val()),t=et(i.typingSpeedUnit).toWpm(e);qd(t)});s(".pageSettings .section[data-config-name='funbox']").on("click",".button",e=>{const t=s(e.currentTarget).attr("data-config-value");gh(t),Iy()});s(".pageSettings .section.tags").on("click",".tagsList .tag .tagButton",e=>{const t=e.currentTarget,a=s(t).parent(".tag").attr("data-id");My(a),s(t).toggleClass("active")});s(".pageSettings .section.presets").on("click",".presetsList .preset .presetButton",async e=>{const t=e.currentTarget,a=s(t).parent(".preset").attr("data-id");await ax(a),Ya()});s("#importSettingsButton").on("click",()=>{Ly("import")});s("#exportSettingsButton").on("click",()=>{const e=JSON.stringify(i);navigator.clipboard.writeText(e).then(function(){m("JSON Copied to clipboard",0)},function(){Ly("export")})});s(".pageSettings .sectionGroupTitle").on("click",e=>{Py(s(e.currentTarget).attr("group"))});s(".pageSettings .section[data-config-name='customBackgroundSize'] .inputAndButton button.save").on("click",()=>{bl(s(".pageSettings .section[data-config-name='customBackgroundSize'] .inputAndButton input").val())});s(".pageSettings .section[data-config-name='customBackgroundSize'] .inputAndButton input").on("keypress",e=>{e.key==="Enter"&&bl(s(".pageSettings .section[data-config-name='customBackgroundSize'] .inputAndButton input").val())});s(".pageSettings .section[data-config-name='fontSize'] .inputAndButton button.save").on("click",()=>{wl(parseFloat(s(".pageSettings .section[data-config-name='fontSize'] .inputAndButton input").val()))&&m("Saved",1,{duration:1})});s(".pageSettings .section[data-config-name='fontSize'] .inputAndButton input").on("keypress",e=>{e.key==="Enter"&&wl(parseFloat(s(".pageSettings .section[data-config-name='fontSize'] .inputAndButton input").val()))&&m("Saved",1,{duration:1})});s(".pageSettings .section[data-config-name='customLayoutfluid'] .inputAndButton button.save").on("click",()=>{Dd(s(".pageSettings .section[data-config-name='customLayoutfluid'] .inputAndButton input").val()).then(e=>{e&&m("Custom layoutfluid saved",1)})});s(".pageSettings .section[data-config-name='customLayoutfluid'] .inputAndButton .input").on("keypress",e=>{e.key==="Enter"&&Dd(s(".pageSettings .section[data-config-name='customLayoutfluid'] .inputAndButton input").val()).then(t=>{t&&m("Custom layoutfluid saved",1)})});s(".pageSettings .quickNav .links a").on("click",e=>{const t=e.target.innerText;s(`.pageSettings .settingsGroup.${t}`).hasClass("slideup")&&Py(t)});s(".pageSettings .section.discordIntegration .getLinkAndGoToOauth").on("click",()=>{E.users.getOauthLink().then(e=>{var t;window.open((t=e.data)==null?void 0:t.url,"_self")})});let qy=!1;function tl(e){qy=e}he(e=>{e==="fullConfigChange"&&tl(!0),e==="fullConfigChangeFinished"&&tl(!1),!(qy||e==="saveToLocalStorage")&&ne()==="settings"&&e!=="theme"&&Ya()});const ux=new Ra("settings",s(".page.pageSettings"),"/settings",async()=>{},async()=>{lx(),Ve("pageSettings")},async()=>{at("pageSettings","main"),await cx(),await Ya(!1)},async()=>{});s(async()=>{st("pageSettings")});function kc(e,t,a){if(!We()){m("You are offline",0,{duration:2});return}Fy.show({focusFirstInput:!0,beforeAnimation:async()=>{s("#editPresetModal .modal .text").addClass("hidden"),e==="add"?(s("#editPresetModal .modal").attr("data-action","add"),s("#editPresetModal .modal .title").html("Add new preset"),s("#editPresetModal .modal button").html("add"),s("#editPresetModal .modal input").val(""),s("#editPresetModal .modal input").removeClass("hidden"),s("#editPresetModal .modal label").addClass("hidden")):e==="edit"&&t!==void 0&&a!==void 0?(s("#editPresetModal .modal").attr("data-action","edit"),s("#editPresetModal .modal").attr("data-preset-id",t),s("#editPresetModal .modal .title").html("Edit preset"),s("#editPresetModal .modal button").html("save"),s("#editPresetModal .modal input").val(a),s("#editPresetModal .modal input").removeClass("hidden"),s("#editPresetModal .modal label input").prop("checked",!1),s("#editPresetModal .modal label").removeClass("hidden")):e==="remove"&&t!==void 0&&a!==void 0&&(s("#editPresetModal .modal").attr("data-action","remove"),s("#editPresetModal .modal").attr("data-preset-id",t),s("#editPresetModal .modal .title").html("Delete preset"),s("#editPresetModal .modal button").html("delete"),s("#editPresetModal .modal input").addClass("hidden"),s("#editPresetModal .modal label").addClass("hidden"),s("#editPresetModal .modal .text").removeClass("hidden"),s("#editPresetModal .modal .text").text(`Are you sure you want to delete the preset ${a}?`))}})}function fx(){Fy.hide()}async function px(){var c,d;const e=s("#editPresetModal .modal").attr("data-action"),t=s("#editPresetModal .modal input").val(),a=t.replaceAll(" ","_"),o=s("#editPresetModal .modal").attr("data-preset-id"),n=s("#editPresetModal .modal label input").prop("checked");let r={};if(n&&e==="edit"||e==="add"){r=Rb();const f=(((c=S())==null?void 0:c.tags)??[]).filter(p=>p.active).map(p=>p._id);r.tags=f}const l=((d=S())==null?void 0:d.presets)??[];if(fx(),oe(),e==="add"){const u=await E.presets.add(a,r);u.status!==200||u.data===null?m("Failed to add preset: "+u.message.replace(a,t),-1):(m("Preset added",1,{duration:2}),l.push({name:a,config:r,display:t,_id:u.data.presetId}))}else if(e==="edit"){const u=await E.presets.edit(o,a,r);if(u.status!==200)m("Failed to edit preset: "+u.message,-1);else{m("Preset updated",1);const f=l.filter(p=>p._id===o)[0];f.name=a,f.display=a.replace(/_/g," "),n&&(f.config=r)}}else if(e==="remove"){const u=await E.presets.delete(o);u.status!==200?m("Failed to remove preset: "+u.message,-1):(m("Preset removed",1),l.forEach((f,p)=>{f._id===o&&l.splice(p,1)}))}Ya(),Q()}const Fy=new le({dialogId:"editPresetModal",setup:async e=>{e.addEventListener("submit",t=>{t.preventDefault(),px()})}});function cr(e,t,a,o){if(!We()){m("You are offline",0,{duration:2});return}Dy.show({focusFirstInput:!0,modalChain:o,beforeAnimation:async()=>{s("#editTagModal .modal .text").addClass("hidden"),e==="add"?(s("#editTagModal .modal").attr("data-action","add"),s("#editTagModal .modal .title").html("Add new tag"),s("#editTagModal .modal button").html("add"),s("#editTagModal .modal input").val(""),s("#editTagModal .modal input").removeClass("hidden")):e==="edit"&&t!==void 0&&a!==void 0?(s("#editTagModal .modal").attr("data-action","edit"),s("#editTagModal .modal").attr("data-tag-id",t),s("#editTagModal .modal .title").html("Edit tag"),s("#editTagModal .modal button").html("save"),s("#editTagModal .modal input").val(a),s("#editTagModal .modal input").removeClass("hidden")):e==="remove"&&t!==void 0&&a!==void 0?(s("#editTagModal .modal").attr("data-action","remove"),s("#editTagModal .modal").attr("data-tag-id",t),s("#editTagModal .modal .title").html("Delete tag"),s("#editTagModal .modal .text").removeClass("hidden"),s("#editTagModal .modal .text").html(`Are you sure you want to delete tag ${a}?`),s("#editTagModal .modal button").html("delete"),s("#editTagModal .modal input").addClass("hidden")):e==="clearPb"&&t!==void 0&&a!==void 0&&(s("#editTagModal .modal").attr("data-action","clearPb"),s("#editTagModal .modal").attr("data-tag-id",t),s("#editTagModal .modal .title").html("Clear personal bests"),s("#editTagModal .modal .text").removeClass("hidden"),s("#editTagModal .modal .text").html(`Are you sure you want to clear personal bests for tag ${a}?`),s("#editTagModal .modal button").html("clear"),s("#editTagModal .modal input").addClass("hidden"))}})}function mx(e=!1){Dy.hide({clearModalChain:e})}async function gx(){var n,r,l,c,d,u,f,p;const e=s("#editTagModal .modal").attr("data-action"),t=s("#editTagModal .modal input").val(),a=t.replaceAll(" ","_"),o=s("#editTagModal .modal").attr("data-tag-id");if(mx(!0),oe(),e==="add"){const g=await E.users.createTag(a);if(g.status!==200)m("Failed to add tag: "+g.message.replace(a,t),-1);else{if(g.data===null){m("Tag was added but data returned was null",-1),Q();return}m("Tag added",1),(r=(n=S())==null?void 0:n.tags)==null||r.push({display:t,name:g.data.name,_id:g.data._id,personalBests:{time:{},words:{},quote:{},zen:{},custom:{}}}),Ya()}}else if(e==="edit"){const g=await E.users.editTag(o,a);g.status!==200?m("Failed to edit tag: "+g.message,-1):(m("Tag updated",1),(c=(l=S())==null?void 0:l.tags)==null||c.forEach(h=>{h._id===o&&(h.name=a,h.display=t)}),Ya())}else if(e==="remove"){const g=await E.users.deleteTag(o);g.status!==200?m("Failed to remove tag: "+g.message,-1):(m("Tag removed",1),(u=(d=S())==null?void 0:d.tags)==null||u.forEach((h,y)=>{var w,k;h._id===o&&((k=(w=S())==null?void 0:w.tags)==null||k.splice(y,1))}),Ya())}else if(e==="clearPb"){const g=await E.users.deleteTagPersonalBest(o);g.status!==200?m("Failed to clear tag pb: "+g.message,-1):(m("Tag PB cleared",1),(p=(f=S())==null?void 0:f.tags)==null||p.forEach(h=>{h._id===o&&(h.personalBests={time:{},words:{},quote:{},zen:{},custom:{}})}),Ya())}Q()}const Dy=new le({dialogId:"editTagModal",setup:async e=>{e.addEventListener("submit",t=>{t.preventDefault(),gx()})}}),hx=["gmaill.com","gamil.com","gnail.com","gmil.com","gamail.com","hotmai.com","gmial.com","hotmal.com","yaho.com","outlokk.com","gmil.com","hotmial.com","yahooo.com","otulook.com","gamil.com","hotnail.com","yaoo.com","outlok.com","gmail.cmo","hotmail.cmo","yahho.com","outloook.com","gmaail.com","hottmail.com","yaho.com","outllok.com","gmai.com","hotmil.com","yhaoo.com","outlookk.com","gmil.com","htmial.com","yaahoo.com","otlook.com","gamail.com","hotnail.com","yaoho.com","outlok.com","gemail.com","hotmiall.com","yahhoo.com","outloookk.com","gmal.com","hottmail.com","yahio.com","outlokkk.com",".comm",".con",".cmo",".coom",".cim",".vom","-online.de","-tonline.de","acor.de","aecor.de","ahoo.de","al.com","ao.com","aol.cm","aol.con","aol.ocm","aol.om","aoll.com","apl.com","arco.de","arocr.de","aror.de","feenet.de","freeenet.de","freeent.de","freeet.de","freemet.de","freeneet.de","freent.de","frenet.de","gm.de","gm.net","gm.xde","gmc.de","gmx.ded","gmx.dw","gmxx.de","gmy.de","gx.de","hmx.de","homail.de","hotmai.de","hotmal.de","mx.de","mx.net","otmail.com","r-online.de","rcor.de","reenet.de","t--online.de","t-0nline.de","t-nline.de","t-oline.de","t-omline.de","t-onine.de","t-onlien.de","t-onliine.de","t-onlin.de","t-onlinde.de","t-onlinr.de","t-onlione.de","t-onlline.de","t-onlne.de","t-onlone.de","t.-online.de","t.online.de","tonline.de","wb.de","we.de","web.ded","web.dw","wed.de","weeb.de","wen.de","wweb.de","yaho.de","yahooo.de","yaoo.de","yhoo.de","yahhoo.de"];function Yl(){s(".page.pageLogin .register.side button").prop("disabled",!1)}function Jl(){s(".page.pageLogin .register.side button").prop("disabled",!0)}function $t(){s(".pageLogin input").prop("disabled",!1),s(".pageLogin button").prop("disabled",!1)}function Du(){s(".pageLogin input").prop("disabled",!0),s(".pageLogin button").prop("disabled",!0)}function Ru(){s(".pageLogin .preloader").removeClass("hidden")}function gt(){s(".pageLogin .preloader").addClass("hidden")}const yt=()=>{Ja.get()!=="available"||ca.get()!=="valid"&&ca.get()!=="typo"&&ca.get()!=="edu"||jo.get()!=="match"||Za.get()!=="good"||Qo.get()!=="match"?Jl():Yl()},yx=Et(1e3,async()=>{const e=s(".page.pageLogin .register.side .usernameInput").val();if(!e){yt();return}const t=await E.users.getNameAvailability(e);t.status===200?Ja.show("available",t.message):t.status===422?Ja.show("unavailable",t.message):t.status===409?Ja.show("taken",t.message):(Ja.show("unavailable",t.message),m("Failed to check name availability: "+t.message,-1)),yt()}),vx=()=>{const e=s(".page.pageLogin .register.side .emailInput").val(),t=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,a=/@.*(education|\.edu$|\.edu\.|\.ac\.|\.sch\.)/i,o=hx.some(n=>e.endsWith(n));t.test(e)?o?ca.show("typo","Please check your email address, it may contain a typo."):a.test(e)?ca.show("edu","Some education emails will fail to receive our messages. Consider using a personal email address."):ca.show("valid"):ca.show("invalid"),yt()},Ry=()=>{const e=s(".page.pageLogin .register.side .emailInput").val(),t=s(".page.pageLogin .register.side .verifyEmailInput").val();e===t?jo.show("match"):jo.show("mismatch"),yt()},Oy=()=>{const e=s(".page.pageLogin .register.side .passwordInput").val();yd(e)?Za.show("good","Password is good"):e.length<8?Za.show("short","Password must be at least 8 characters"):e.length>64?Za.show("long","Password must be at most 64 characters"):Za.show("weak","Password must contain at least one capital letter, number, and special character"),yt()},Hy=()=>{const e=s(".page.pageLogin .register.side .passwordInput").val(),t=s(".page.pageLogin .register.side .verifyPasswordInput").val();e===t?Qo.show("match"):Qo.show("mismatch"),yt()},Ja=new bs(s(".page.pageLogin .register.side input.usernameInput"),{available:{icon:"fa-check",level:1},unavailable:{icon:"fa-times",level:-1},taken:{icon:"fa-user",level:-1},checking:{icon:"fa-circle-notch",spinIcon:!0,level:0}}),ca=new bs(s(".page.pageLogin .register.side input.emailInput"),{valid:{icon:"fa-check",level:1},invalid:{icon:"fa-times",level:-1},typo:{icon:"fa-exclamation-triangle",level:1},edu:{icon:"fa-exclamation-triangle",level:1}}),jo=new bs(s(".page.pageLogin .register.side input.verifyEmailInput"),{match:{icon:"fa-check",level:1},mismatch:{icon:"fa-times",level:-1}}),Za=new bs(s(".page.pageLogin .register.side input.passwordInput"),{good:{icon:"fa-check",level:1},short:{icon:"fa-times",level:-1},long:{icon:"fa-times",level:-1},weak:{icon:"fa-times",level:-1}}),Qo=new bs(s(".page.pageLogin .register.side input.verifyPasswordInput"),{match:{icon:"fa-check",level:1},mismatch:{icon:"fa-times",level:-1}});s(".page.pageLogin .register.side .usernameInput").on("input",()=>{setTimeout(()=>{if(s(".page.pageLogin .register.side .usernameInput").val()==="")return Ja.hide();Ja.show("checking"),yx()},1)});s(".page.pageLogin .register.side .emailInput").on("input",()=>{const e=s(".page.pageLogin .register.side .emailInput").val(),t=s(".page.pageLogin .register.side .verifyEmailInput").val();if(!e&&!t){ca.hide(),jo.hide();return}vx(),Ry()});s(".page.pageLogin .register.side .verifyEmailInput").on("input",()=>{const e=s(".page.pageLogin .register.side .emailInput").val(),t=s(".page.pageLogin .register.side .verifyEmailInput").val();if(!e&&!t){ca.hide(),jo.hide();return}Ry()});s(".page.pageLogin .register.side .passwordInput").on("input",()=>{const e=s(".page.pageLogin .register.side .passwordInput").val(),t=s(".page.pageLogin .register.side .verifyPasswordInput").val();if(!e&&!t){Za.hide(),Qo.hide();return}Oy(),Hy()});s(".page.pageLogin .register.side .verifyPasswordInput").on("input",()=>{const e=s(".page.pageLogin .register.side .passwordInput").val(),t=s(".page.pageLogin .register.side .verifyPasswordInput").val();if(!e&&!t){Za.hide(),Qo.hide();return}Oy(),Hy()});const wx=new Ra("login",s(".page.pageLogin"),"/login",async()=>{},async()=>{s(".pageLogin input").val(""),Ja.hide(),ca.hide(),jo.hide(),Za.hide(),Qo.hide(),Ve("pageLogin")},async()=>{at("pageLogin","main"),Yl(),$t()},async()=>{});s(()=>{st("pageLogin")});let al,_y=new Promise(e=>{al=e});function bx(){Ny.show({mode:"dialog",beforeAnimation:async e=>{_y=new Promise(t=>{al=t}),sn("register"),Ii(e.querySelector(".g-recaptcha"),"register",t=>{al(t),id()})}})}function id(e=!1){e&&al(),Ny.hide()}const Ny=new le({dialogId:"registerCaptchaModal",customEscapeHandler:async()=>{id(!0)},customWrapperClickHandler:async()=>{id(!0)}});async function Kf(e){if(!e)return;const t=new URLSearchParams(e.slice(1));if(t.has("access_token")){history.replaceState(null,"","/");const a=t.get("access_token"),o=t.get("token_type"),n=t.get("state");oe();const r=await E.users.linkDiscord(o,a,n);if(Q(),r.status!==200)return m("Failed to link Discord: "+r.message,-1);if(r.data===null)return m("Failed to link Discord: data returned was null",-1);m(r.message,1);const l=S();if(!l)return;const{discordId:c,discordAvatar:d}=r.data;c!==void 0?l.discordId=c:l.discordAvatar=d,ut(l),vl(void 0,c,d),Ql()}}function zf(e){const t=Fp("customTheme",e);if(t===null)return;let a=null;try{a=JSON.parse(atob(t))}catch{return m("Invalid custom theme ",0)}let o=[],n,r,l;if(Array.isArray(a.c)&&a.c.length===10?(o=a.c,n=a.i,r=a.s,l=a.f):Array.isArray(a)&&a.length===10&&(o=a),o.length===0)return m("Invalid custom theme ",0);const c=i.customTheme,d=i.customThemeColors;try{Kn(o),m("Custom theme applied",1),n!==void 0&&(bl(n),Rd(r),Od(l)),i.customTheme||es(!0)}catch(u){m("Something went wrong. Reverting to previous state.",0),console.error(u),es(c),Kn(d)}}function Uf(e){const t=Fp("testSettings",e);if(t===null)return;const a=JSON.parse(vw.decompressFromURI(t)??""),o={};if(a[0]!==null&&(Ge(a[0],!0),o.mode=a[0]),a[1]!==null&&(i.mode==="time"?ia(parseInt(a[1],10),!0):i.mode==="words"?ns(parseInt(a[1],10),!0):i.mode==="quote"&&($a(-2,!1),Sd(parseInt(a[1],10)),ie()),o.mode2=a[1]),a[2]!==null){const r=a[2];bt(r.text.join(r.delimiter),!0),qa(r.text),js(r.isTimeRandom),Vs(r.isWordRandom),r.isTimeRandom&&Qs(r.time),r.isWordRandom&&Gs(r.word),Qn(r.delimiter),o["custom text settings"]=""}a[3]!==null&&(ua(a[3],!0),o.punctuation=a[3]?"on":"off"),a[4]!==null&&(zt(a[4],!0),o.numbers=a[4]?"on":"off"),a[5]!==null&&(Oo(a[5],!0),o.language=a[5]),a[6]!==null&&(ta(a[6],!0),o.difficulty=a[6]),a[7]!==null&&(ka(a[7],!0),o.funbox=a[7]),Y();let n="";Object.keys(o).forEach(r=>{const l=o[r];l!==void 0&&(n+=`${r}${l?": "+l:""}<br>`)}),n!==""&&m("Settings applied from URL:<br><br>"+n,1,{duration:10,allowHTML:!0})}let Yt=[],Ky=0,Ta=[],Ds=[];const as={notifications:[],psas:[]};function Sc(){zy(!1),Vy.hide({afterAnimation:async()=>{var l;s("#alertsPopup .notificationHistory .list").empty(),s("#alertsPopup .psas .list").empty();const e=[];let t=0;if(Ta.length===0&&Ds.length===0)return;const a=await E.users.updateInbox({mailIdsToMarkRead:Ta.length>0?Ta:void 0,mailIdsToDelete:Ds.length>0?Ds:void 0}),o=a.status,n=a.message;if(o!==200){m(`Failed to update inbox: ${n}`,-1);return}const r=Yt.filter(c=>c.rewards.length>0&&Ta.includes(c.id)).map(c=>c.rewards).reduce(function(c,d){return c.concat(d)},[]);for(const c of r)if(c.type==="xp")t+=c.item;else if(c.type==="badge"){const d=R1(c.item.id);d&&(e.push(d.name),vb(c.item))}if(e.length>0&&m(`New badge${e.length>1?"s":""} unlocked: ${e.join(", ")}`,1,{duration:5,customTitle:"Reward",customIcon:"gift"}),t>0){const c=((l=S())==null?void 0:l.xp)??0;am(c,t),Jp(t)}}})}async function Cx(){Vy.show({beforeAnimation:async()=>{z()?(s("#alertsPopup .accountAlerts").removeClass("hidden"),s("#alertsPopup .separator.accountSeparator").removeClass("hidden"),s("#alertsPopup .accountAlerts .list").html(`
          <div class="preloader"><i class="fas fa-fw fa-spin fa-circle-notch"></i></div>`)):(s("#alertsPopup .accountAlerts").addClass("hidden"),s("#alertsPopup .separator.accountSeparator").addClass("hidden")),Yt=[],Ds=[],Ta=[],xx(),Tx()},afterAnimation:async()=>{z()&&kx()}})}async function kx(){if(!We()){s("#alertsPopup .accountAlerts .list").html(`
    <div class="nothing">
    You are offline
    </div>
    `);return}const e=await E.users.getInbox();if(e.status===503){s("#alertsPopup .accountAlerts .list").html(`
    <div class="nothing">
    Account inboxes are temporarily unavailable
    </div>
    `);return}else if(e.status!==200){s("#alertsPopup .accountAlerts .list").html(`
    <div class="nothing">
    Error getting inbox: ${e.message} Please try again later
    </div>
    `);return}const t=e.data;if(Yt=t.inbox,Ou(),Yt.length===0){s("#alertsPopup .accountAlerts .list").html(`
    <div class="nothing">
    Nothing to show
    </div>
    `);return}Ky=t.maxMail,Uy(),s("#alertsPopup .accountAlerts .list").empty();for(const a of Yt){!a.read&&a.rewards.length===0&&Ta.push(a.id);let o="";a.rewards.length>0&&!a.read&&(o=`<div class="rewards">
        <i class="fas fa-fw fa-gift"></i>
        <span>${a.rewards.length}</span>
      </div>`),s("#alertsPopup .accountAlerts .list").append(`
    
      <div class="item" data-id="${a.id}">
        <div class="indicator ${a.read?"":"main"}"></div>
        <div class="timestamp">${Rp(new Date(a.timestamp))} ago</div>
        <div class="title">${a.subject}</div>
        <div class="body">
          ${a.body}

${o}
        </div>
        <div class="buttons">
          ${a.rewards.length>0&&!a.read?'<button class="markReadAlert textButton" aria-label="Claim" data-balloon-pos="left"><i class="fas fa-gift"></i></button>':""}
          ${a.rewards.length>0&&a.read||a.rewards.length===0?'<button class="deleteAlert textButton" aria-label="Delete" data-balloon-pos="left"><i class="fas fa-trash"></i></button>':""}
        </div>
      </div>
    
    `)}}function Sx(e,t){as.psas.push({message:e,level:t})}function Tx(){if(as.psas.length===0)s("#alertsPopup .psas .list").html('<div class="nothing">Nothing to show</div>');else{s("#alertsPopup .psas .list").empty();for(const e of as.psas){const{message:t,level:a}=e;let o="";a===-1?o="error":a===1?o="main":a===0&&(o="sub"),s("#alertsPopup .psas .list").prepend(`
        <div class="item">
        <div class="indicator ${o}"></div>
        <div class="body">
          ${aa(t)}
        </div>
      </div>
      `)}}}function xx(){if(as.notifications.length===0)s("#alertsPopup .notificationHistory .list").html('<div class="nothing">Nothing to show</div>');else{s("#alertsPopup .notificationHistory .list").empty();for(const e of as.notifications){const{message:t,level:a,customTitle:o}=e;let n="Notice",r="sub";a===-1?(r="error",n="Error"):a===1&&(r="main",n="Success"),o!==void 0&&(n=o),s("#alertsPopup .notificationHistory .list").prepend(`
      <div class="item">
      <div class="indicator ${r}"></div>
      <div class="title">${n}</div>
      <div class="body">
        ${aa(t)}
      </div>
    </div>
    `)}}}function zy(e){e?s("header nav .showAlerts .notificationBubble").removeClass("hidden"):s("header nav .showAlerts .notificationBubble").addClass("hidden")}function Uy(){s("#alertsPopup .accountAlerts .title .right").text(`${Yt.length}/${Ky}`)}function Vf(e){Ds.push(e),s(`#alertsPopup .accountAlerts .list .item[data-id="${e}"]`).remove(),s("#alertsPopup .accountAlerts .list .item").length==0&&s("#alertsPopup .accountAlerts .list").html(`
    <div class="nothing">
    Nothing to show
    </div>
    `),Ou(),Uy()}function jf(e){Ta.push(e);const t=s(`#alertsPopup .accountAlerts .list .item[data-id="${e}"]`);Ou(),t.find(".indicator").removeClass("main"),t.find(".buttons").empty(),t.find(".buttons").append('<button class="deleteAlert textButton" aria-label="Delete" data-balloon-pos="left"><i class="fas fa-trash"></i></button>'),t.find(".rewards").animate({opacity:0,height:0,marginTop:0},250,"easeOutCubic",()=>{t.find(".rewards").remove()})}function Ou(){const e=s("#alertsPopup .accountAlerts .claimAll"),t=s("#alertsPopup .accountAlerts .deleteAll");if(e.addClass("hidden"),t.addClass("hidden"),Yt.length>0){let a=0;for(const o of Yt)!o.read&&!Ta.includes(o.id)&&(a+=o.rewards.length);a>0?e.removeClass("hidden"):t.removeClass("hidden")}Ds.length===Yt.length&&t.addClass("hidden")}s("header nav .showAlerts").on("click",()=>{Cx()});qw((e,t,a)=>{as.notifications.push({message:e,level:t,customTitle:a}),as.notifications.length>25&&as.notifications.shift()});const Vy=new le({dialogId:"alertsPopup",customAnimations:{show:{modal:{from:{marginRight:"-10rem"},to:{marginRight:"0"},easing:"easeOutCirc"}},hide:{modal:{from:{marginRight:"0"},to:{marginRight:"-10rem"},easing:"easeInCirc"}}},customEscapeHandler:()=>{Sc()},customWrapperClickHandler:()=>{Sc()},setup:async()=>{s("#alertsPopup .accountAlerts").on("click",".claimAll",()=>{for(const e of Yt)!e.read&&!Ta.includes(e.id)&&jf(e.id)}),s("#alertsPopup .accountAlerts").on("click",".deleteAll",()=>{for(const e of Yt)Ds.includes(e.id)||Vf(e.id)}),s("#alertsPopup .mobileClose").on("click",()=>{Sc()}),s("#alertsPopup .accountAlerts .list").on("click",".item .buttons .deleteAlert",e=>{const t=s(e.currentTarget).closest(".item").attr("data-id");Vf(t)}),s("#alertsPopup .accountAlerts .list").on("click",".item .buttons .markReadAlert",e=>{const t=s(e.currentTarget).closest(".item").attr("data-id");jf(t)})}}),jy=[];function $x(e){jy.push(e)}function Ax(e,t){jy.forEach(a=>{try{a(e,t)}catch(o){console.error("Google Sign Up event subscriber threw an error"),console.error(o)}})}const Mx=new Ra("test",s(".page.pageTest"),"/",async()=>{ie(),Y(),To(),cs(),s("#wordsInput").trigger("focusout")},async()=>{Yr(!0)},async()=>{Yr(!1),sh(),ie(),Y({noAnim:!0}),uS(),Dl(),Qr()},async()=>{});function Lx(){s(".pageAbout .contributors").empty(),s(".pageAbout .supporters").empty(),Bo.getDataset("count").data=[],Bo.updateColors()}let sl,Ua;function Wx(){var e;if(sl){Bo.updateColors();const t=Bx(sl);Bo.data.labels=t.labels,Bo.getDataset("count").data=t.data}if(Ua){const t=Math.round(Ua.timeTyping),a=ww({start:0,end:t*1e3});s(".pageAbout #totalTimeTypingStat .val").text(((e=a.years)==null?void 0:e.toString())??""),s(".pageAbout #totalTimeTypingStat .valSmall").text("years"),s(".pageAbout #totalTimeTypingStat").attr("aria-label",sc(Math.round(t/3600))+" hours");const o=Zu(Ua.testsStarted);s(".pageAbout #totalStartedTestsStat .val").text(o.rounded<10?o.roundedTo2:o.rounded),s(".pageAbout #totalStartedTestsStat .valSmall").text(o.orderOfMagnitude),s(".pageAbout #totalStartedTestsStat").attr("aria-label",sc(Ua.testsStarted)+" tests");const n=Zu(Ua.testsCompleted);s(".pageAbout #totalCompletedTestsStat .val").text(n.rounded<10?n.roundedTo2:n.rounded),s(".pageAbout #totalCompletedTestsStat .valSmall").text(n.orderOfMagnitude),s(".pageAbout #totalCompletedTestsStat").attr("aria-label",sc(Ua.testsCompleted)+" tests")}}async function Ix(){if(sl&&Ua)return;if(!We()){m("Cannot update all time stats - offline",0);return}const e=await E.publicStats.getSpeedHistogram({language:"english",mode:"time",mode2:"60"});e.status>=200&&e.status<300?sl=e.data:m(`Failed to get global speed stats for histogram: ${e.message}`,-1);const t=await E.publicStats.getTypingStats();t.status>=200&&t.status<300?Ua=t.data:m(`Failed to get global typing stats: ${e.message}`,-1)}async function Ex(){let e;try{e=await jv()}catch(l){m(ee(l,"Failed to get supporters"),-1),e=[]}let t;try{t=await Qv()}catch(l){m(ee(l,"Failed to get contributors"),-1),t=[]}Ix().then(()=>{Wx()});const a=document.querySelector(".pageAbout .supporters");let o="";for(const l of e)o+=`<div>${l}</div>`;a&&(a.innerHTML=o);const n=document.querySelector(".pageAbout .contributors");let r="";for(const l of t)r+=`<div>${l}</div>`;n&&(n.innerHTML=r)}function Bx(e){const t=[],a=[],o=Object.keys(e).sort((n,r)=>parseInt(n,10)-parseInt(r,10));for(const[n,r]of o.entries()){const l=o[n+1],c=parseInt(r,10);if(t.push({x:c,y:e[c]}),a.push(`${c} - ${c+9}`),l!==void 0&&c+10!==parseInt(l,10))for(let d=c+10;d<parseInt(l,10);d+=10)t.push({x:d,y:0}),a.push(`${d} - ${d+9}`)}return{data:t,labels:a}}const Px=new Ra("about",s(".page.pageAbout"),"/about",async()=>{},async()=>{Lx(),Ve("pageAbout")},async()=>{at("pageAbout","main"),Ex()},async()=>{});s(()=>{st("pageAbout")});const ol={userUid:void 0,lbOptOut:void 0};let xn;async function qx(e){if(!z())return m("You must be logged in to submit a report",0);Qy.show({focusFirstInput:!0,beforeAnimation:async t=>{Ii(t.querySelector(".g-recaptcha"),"userReportModal");const{name:a}=e;ol.userUid=e.uid,ol.lbOptOut=e.lbOptOut,t.querySelector(".user").textContent=a,t.querySelector(".reason").value="Inappropriate name",t.querySelector(".comment").value="",t.querySelector(".characterCount").textContent="-",xn=new At({select:t.querySelector(".reason"),settings:{showSearch:!1,contentLocation:t}})}})}async function Fx(){Qy.hide({afterAnimation:async()=>{xn==null||xn.destroy(),xn=void 0,sn("userReportModal")}})}async function Dx(){const e=zl("userReportModal");if(!e)return m("Please complete the captcha");const t=s("#userReportModal .reason").val(),a=s("#userReportModal .comment").val(),o=e;if(!t)return m("Please select a valid report reason");if(!a)return m("Please provide a comment");if(t==="Suspected cheating"&&ol.lbOptOut)return m("You cannot report this user for suspected cheating as they have opted out of the leaderboards.",0,{duration:10});const n=a.length-250;if(n>0)return m(`Report comment is ${n} character(s) too long`);oe();const r=await E.users.report(ol.userUid,t,a,o);if(Q(),r.status!==200)return m("Failed to report user: "+r.message,-1);m("Report submitted. Thank you!",1),Fx()}const Qy=new le({dialogId:"userReportModal",setup:async e=>{var t,a;(t=e.querySelector("button"))==null||t.addEventListener("click",()=>{Dx()}),(a=e.querySelector(".comment"))==null||a.addEventListener("input",o=>{setTimeout(()=>{const n=o.target.value.length,r=e.querySelector(".characterCount");r.textContent=n.toString(),n>250?r.classList.add("red"):r.classList.remove("red")},1)})}});function Qf(){s(".page.pageProfile .preloader").removeClass("hidden"),s(".page.pageProfile .profile").html(`
      <div class="details none">
        <div class="avatarAndName">
          <div class="avatars">
            <div class="placeholderAvatar">
              <i class="fas fa-user-circle"></i>
            </div>
            <div class="avatar"></div>
          </div>
          <div>
             <div class="user">
              <div class="name">-</div>
              <div class="userFlags"></div>
            </div>
            <div class="badges"></div>
            <div class="allBadges"></div>
            <div class="joined" data-balloon-pos="up">-</div>
	          <div class="streak" data-balloon-pos="up">-</div>
          </div>
          <div class="levelAndBar">
            <div class="level">-</div>
            <div class="xpBar">
              <div class="bar" style="width: 0%;"></div>
            </div>
            <div class="xp" data-balloon-pos="up">-/-</div>
          </div>
        </div>
        <div class="separator sep1"></div>
        <div class="typingStats vertical">
          <div class="started">
            <div class="title">tests started</div>
            <div class="value">-</div>
          </div>
          <div class="completed">
            <div class="title">tests completed</div>
            <div class="value">-</div>
          </div>
          <div class="timeTyping">
            <div class="title">time typing</div>
            <div class="value">-</div>
          </div>
        </div>
        <div class="separator sep2 hidden"></div>

        <div class="bioAndKeyboard vertical hidden">
          <div class="bio">
            <div class="title">bio</div>
            <div class="value">-</div>
          </div>
          <div class="keyboard hidden">
            <div class="title">keyboard</div>
            <div class="value">-</div>
          </div>
        </div>
        <div class="separator sep3 hidden"></div>

        <div class="socials big hidden">
          <div class="title">socials</div>
          <div class="value">-</div>
        </div>
        <div class="buttonGroup">
          <button
            class="userReportButton"
            data-balloon-pos="left"
            aria-label="Report user"
          >
            <i class="fas fa-flag"></i>
          </button>
        </div>
      </div>
      <div class="leaderboardsPositions">
        <div class="title">All-Time English Leaderboards</div>
        <div class="group t15">
          <div class="testType">15 seconds</div>
          <div class="pos">-</div>
          <div class="topPercentage">-</div>
        </div>
        <div class="group t60">
          <div class="testType">60 seconds</div>
          <div class="pos">-</div>
          <div class="topPercentage">-</div>
        </div>
      </div>
      <div class="pbsWords">
        <div class="group">
          <div class="quick">
            <div class="test">10 words</div>
            <div class="wpm">-</div>
            <div class="acc">-</div>
          </div>
        </div>
        <div class="group">
          <div class="quick">
            <div class="test">25 words</div>
            <div class="wpm">-</div>
            <div class="acc">-</div>
          </div>
        </div>
        <div class="group">
          <div class="quick">
            <div class="test">50 words</div>
            <div class="wpm">-</div>
            <div class="acc">-</div>
          </div>
        </div>
        <div class="group">
          <div class="quick">
            <div class="test">100 words</div>
            <div class="wpm">-</div>
            <div class="acc">-</div>
          </div>
        </div>
      </div>
      <div class="pbsTime">
        <div class="group">
          <div class="quick">
            <div class="test">15 seconds</div>
            <div class="wpm">-</div>
            <div class="acc">-</div>
          </div>
        </div>
        <div class="group">
          <div class="quick">
            <div class="test">30 seconds</div>
            <div class="wpm">-</div>
            <div class="acc">-</div>
          </div>
        </div>
        <div class="group">
          <div class="quick">
            <div class="test">60 seconds</div>
            <div class="wpm">-</div>
            <div class="acc">-</div>
          </div>
        </div>
        <div class="group">
          <div class="quick">
            <div class="test">120 seconds</div>
            <div class="wpm">-</div>
            <div class="acc">-</div>
          </div>
        </div>
      </div><div class="lbOptOutReminder hidden"></div>`)}async function Rx(e){const t=Gv("isUid");if(e.data)s(".page.pageProfile .preloader").addClass("hidden"),await Xr("profile",e.data),Jc(e.data.personalBests,!0);else if(e.uidOrName!==void 0&&e.uidOrName!==""){const a=t?await E.users.getProfileByUid(e.uidOrName):await E.users.getProfileByName(e.uidOrName);if(s(".page.pageProfile .preloader").addClass("hidden"),a.status===404||a.data===null){const o=t?"User not found":`User ${e.uidOrName} not found`;s(".page.pageProfile .preloader").addClass("hidden"),s(".page.pageProfile .error").removeClass("hidden"),s(".page.pageProfile .error .message").text(o)}else{if(a.status!==200)return m("Failed to load profile: "+a.message,-1);window.history.replaceState(null,"",`/profile/${a.data.name}`),await Xr("profile",a.data),Jc(a.data.personalBests,!0)}}else m("Missing update parameter!",-1)}s(".page.pageProfile").on("click",".profile .userReportButton",()=>{const e=s(".page.pageProfile .profile").attr("uid")??"",t=s(".page.pageProfile .profile").attr("name")??"",a=(s(".page.pageProfile .profile").attr("lbOptOut")??"false")==="true";qx({uid:e,name:t,lbOptOut:a})});const Ox=new Ra("profile",s(".page.pageProfile"),"/profile",async()=>{},async()=>{Ve("pageProfile"),Qf()},async e=>{var a;at("pageProfile","main");const t=((a=e==null?void 0:e.params)==null?void 0:a.uidOrName)??"";t?(s(".page.pageProfile .preloader").removeClass("hidden"),s(".page.pageProfile .search").addClass("hidden"),s(".page.pageProfile .content").removeClass("hidden"),Qf(),Rx({uidOrName:t,data:e==null?void 0:e.data})):(s(".page.pageProfile .preloader").addClass("hidden"),s(".page.pageProfile .search").removeClass("hidden"),s(".page.pageProfile .content").addClass("hidden"))},async()=>{});st("pageProfile");const Hx=new Ra("profileSearch",s(".page.pageProfileSearch"),"/profile",async()=>{},async()=>{Ve("pageProfileSearch")},async()=>{at("pageProfileSearch","main"),s(".page.pageProfileSearch input").val("")},async()=>{s(".page.pageProfileSearch input").focus()}),_x=new Ra("404",s(".page.page404"),"/404",async()=>{},async()=>{Ve("page404")},async()=>{at("page404","main")},async()=>{});st("page404");async function ya(e,t={}){return t={...{force:!1},...t},new Promise(o=>{if(Rn())return console.debug(`change page to ${e} stopped, page transition is true`),o(!1);if(!t.force&&ne()===e)return console.debug(`change page ${e} stoped, page already active`),o(!1);console.log(`changing page ${e}`);const n={loading:ib,test:Mx,settings:ux,about:Px,account:G1,login:wx,profile:Ox,profileSearch:Hx,404:_x},r=n[ne()],l=n[e];r==null||r.beforeHide().then(()=>{Ks(!0),s(".page").removeClass("active"),Hs(r.element,l.element,250,async()=>{Ks(!1),l.element.addClass("active"),o(!0),await(l==null?void 0:l.afterShow()),Zk()},async()=>{l.name==="test"?Xu():Xu(pi(l.name)+" | Monkeytype"),ys(!1),L0(l.name),await(r==null?void 0:r.afterHide()),await(l==null?void 0:l.beforeShow({params:t.params,data:t.data}))})})})}const Hu="leaderboardsWrapper";let Lt="allTime",fs="english",Go=!1,Xe={15:[],60:[]},vt={15:{},60:{}},oo={15:[],60:[]};const dr={15:!1,60:!1},Yo=50;let rd;function nl(e){e==="15"?s("#leaderboardsWrapper table.left tbody").empty():e==="60"&&s("#leaderboardsWrapper table.right tbody").empty()}function Gf(e){e==="15"?s("#leaderboardsWrapper table.left tfoot").empty():e==="60"&&s("#leaderboardsWrapper table.right tfoot").empty()}function Nx(){Xe={15:[],60:[]},vt={15:{},60:{}},oo={15:[],60:[]}}function Kx(){clearInterval(rd),rd=void 0,s("#leaderboards .subTitle").text("-")}function Yf(){if(Lt==="daily"){const e=new Date;e.setUTCHours(0,0,0,0),e.setDate(e.getDate()+1);const t=new Date;t.setUTCMilliseconds(0);const a=bw(e,t);s("#leaderboards .subTitle").text("Next reset in: "+dt(a,!0))}else{const e=new Date,t=14-e.getMinutes()%15,a=60-e.getSeconds(),o=t*60+a;s("#leaderboards .subTitle").text("Next update in: "+dt(o,!0))}}function zx(){Yf(),rd=setInterval(()=>{Yf()},1e3)}function il(e){e==="15"?s("#leaderboardsWrapper .leftTableLoader").removeClass("hidden"):e==="60"&&s("#leaderboardsWrapper .rightTableLoader").removeClass("hidden")}function Rs(e){e==="15"?s("#leaderboardsWrapper .leftTableLoader").addClass("hidden"):e==="60"&&s("#leaderboardsWrapper .rightTableLoader").addClass("hidden")}function Ux(e){var r,l,c,d;let t;if(e==="15"?t="left":t="right",!z()){s(`#leaderboardsWrapper table.${t} tfoot`).html(`
    <tr>
      <td colspan="6" style="text-align:center;"></>
    </tr>
    `);return}if((((l=(r=S())==null?void 0:r.typingStats)==null?void 0:l.timeTyping)??0)<7200){s(`#leaderboardsWrapper table.${t} tfoot`).html(`
    <tr>
      <td colspan="6" style="text-align:center;">Your account must have 2 hours typed to be placed on the leaderboard.</>
    </tr>
    `);return}if(((c=S())==null?void 0:c.lbOptOut)===!0){s(`#leaderboardsWrapper table.${t} tfoot`).html(`
    <tr>
      <td colspan="6" style="text-align:center;">You have opted out of the leaderboards</>
    </tr>
    `);return}const a=vt[e];if(Lt==="daily"&&a!==null&&a.minWpm===void 0){s(`#leaderboardsWrapper table.${t} tfoot`).html(`
    <tr>
      <td colspan="6" style="text-align:center;">Looks like the server returned data in a new format, please refresh</>
    </tr>
    `);return}let o="";if(Lt==="allTime"&&a!==void 0&&(a!=null&&a.rank)){const u=U(a.rank/vt[e].count*100);vt[e].rank===1?o="GOAT":o=`Top ${u}%`,o=`<br><span class="sub">${o}</span>`}const n=a==null?void 0:a.entry;if(n){const u=new Date(n.timestamp);s(`#leaderboardsWrapper table.${t} tfoot`).html(`
    <tr>
    <td>${a.rank}</td>
    <td><span class="top">You</span>${o||""}</td>
    <td class="alignRight">${_.typingSpeed(n.wpm,{showDecimalPlaces:!0})}<br>
    <div class="sub">${_.percentage(n.acc,{showDecimalPlaces:!0})}</div></td>
    <td class="alignRight">${_.typingSpeed(n.raw,{showDecimalPlaces:!0})}<br>
    <div class="sub">${_.percentage(n.consistency,{showDecimalPlaces:!0})}</div></td>
    <td class="alignRight">${_e(u,"dd MMM yyyy")}<br>
    <div class='sub'>${_e(u,"HH:mm")}</div></td>
  </tr>
  `)}else Lt==="daily"?s(`#leaderboardsWrapper table.${t} tfoot`).html(`
    <tr>
      <td colspan="6" style="text-align:center;">Not qualified ${`(min speed required: ${(d=vt[e])==null?void 0:d.minWpm} wpm)`}</>
    </tr>
    `):s(`#leaderboardsWrapper table.${t} tfoot`).html(`
    <tr>
      <td colspan="6" style="text-align:center;">Not qualified</>
    </tr>
    `)}function Vx(e){var n,r,l,c,d;if(Lt==="daily")return;let t;e==="15"?t="left":t="right";const a=((c=(l=(r=(n=S())==null?void 0:n.lbMemory)==null?void 0:r.time)==null?void 0:l[e])==null?void 0:c.english)??0,o=(d=vt[e])==null?void 0:d.rank;if(o){const u=a-o;u>0?(df("time",e,"english",o,!0),a!==0&&s(`#leaderboardsWrapper table.${t} tfoot tr td .top`).append(` (<i class="fas fa-fw fa-angle-up"></i>${Math.abs(u)} since you last checked)`)):u<0?(df("time",e,"english",o,!0),a!==0&&s(`#leaderboardsWrapper table.${t} tfoot tr td .top`).append(` (<i class="fas fa-fw fa-angle-down"></i>${Math.abs(u)} since you last checked)`)):a!==0&&s(`#leaderboardsWrapper table.${t} tfoot tr td .top`).append(" ( = since you last checked)")}}async function _u(e){var n;if(Xe[e]===void 0)return;let t;e==="15"?t="left":t="right",Xe[e].length===0&&s(`#leaderboardsWrapper table.${t} tbody`).html("<tr><td colspan='7'>No results found</td></tr>");const a=(n=S())==null?void 0:n.name;let o="";for(let r=0;r<Xe[e].length;r++){const l=Xe[e][r];if(l===void 0)break;let c="";l.name===a&&(c=' class="me"');const d=new Date(l.timestamp);Lt==="daily"&&!l.rank&&(l.rank=r+1);let u='<div class="avatarPlaceholder"><i class="fas fa-user-circle"></i></div>';l.discordAvatar!==void 0&&(u='<div class="avatarPlaceholder"><i class="fas fa-circle-notch fa-spin"></i></div>'),o+=`
    <tr ${c}>
    <td>${l.rank===1?'<i class="fas fa-fw fa-crown"></i>':l.rank}</td>
    <td>
    <div class="avatarNameBadge">
      <div class="lbav">${u}</div>
      <a href="${location.origin}/profile/${l.uid}?isUid" class="entryName" uid=${l.uid} router-link>${l.name}</a>
      <div class="flagsAndBadge">
        ${El(l)}
        ${l.badgeId?Zr(l.badgeId):""}
      </div>
    </div>
    </td>
    <td class="alignRight">${_.typingSpeed(l.wpm,{showDecimalPlaces:!0})}<br>
    <div class="sub">${_.percentage(l.acc,{showDecimalPlaces:!0})}</div></td>
    <td class="alignRight">${_.typingSpeed(l.raw,{showDecimalPlaces:!0})}<br>
    <div class="sub">${_.percentage(l.consistency,{showDecimalPlaces:!0})}</div></td>
    <td class="alignRight">${_e(d,"dd MMM yyyy")}<br>
    <div class='sub'>${_e(d,"HH:mm")}</div></td>
  </tr>
  `}s(`#leaderboardsWrapper table.${t} tbody`).html(o)}const Jf=s("#leaderboardsWrapper .showYesterdayButton"),Zf=s("#leaderboardsWrapper .showYesterdayButton .text");function Nu(){s("#leaderboardsWrapper").stop(!0,!0).css("opacity",1).animate({opacity:0},100,()=>{nl("15"),nl("60"),Gf("15"),Gf("60"),Nx(),Kx(),Go=!1,Ku(),s("#leaderboardsWrapper").addClass("hidden"),Ve(Hu)})}function Gy(){const e=s("#leaderboardsWrapper .mainTitle"),t=Lt==="daily"?"Daily":"All-Time",a=fs.charAt(0).toUpperCase()+fs.slice(1);let o=`${t} ${a} Leaderboards`;Go&&Lt!=="allTime"&&(o+=" (Yesterday)"),e.text(o)}function Ku(){Jf.addClass("hidden"),Lt==="daily"&&Jf.removeClass("hidden"),Go?Zf.text("Show today"):Zf.text("Show yesterday")}function rl(){const e=Lt==="daily";return{isDaily:e,daysBefore:e&&Go?1:0}}async function Bi(){var p;fa=!1,ci=!1,il("15"),il("60");const e=["15","60"],t=e.map(async g=>E.leaderboards.get({language:fs,mode:"time",mode2:g,...rl()})),a=[];z()&&a.push(...e.map(async g=>E.leaderboards.getRank({language:fs,mode:"time",mode2:g,...rl()})));const o=await Promise.all(t),n=await Promise.all(a),r=[...o.filter(g=>g.status!==200)??[],...n.filter(g=>g.status!==200)??[]];if(r.length>0)return Rs("15"),Rs("60"),m("Failed to load leaderboards: "+((p=r[0])==null?void 0:p.message),-1);const[l,c]=o.map(g=>g.data),[d,u]=n.map(g=>g.data);l!=null&&(Xe[15]=l),c!=null&&(Xe[60]=c),d!=null&&(vt[15]=d),u!=null&&(vt[60]=u),["15","60"].forEach(async g=>{Rs(g),nl(g),Ux(g),Vx(g),await _u(g),zu(Xe[g]).then(h=>{oo[g]=h,Uu(g)})}),s("#leaderboardsWrapper .leftTableWrapper").removeClass("invisible"),s("#leaderboardsWrapper .rightTableWrapper").removeClass("invisible"),Gy(),Ku(),s("#leaderboardsWrapper .buttons .button").removeClass("active"),s("#leaderboardsWrapper .buttonGroup.timeRange .button."+Lt).addClass("active"),s("#leaderboardsWrapper #leaderboards .leftTableWrapper").scrollTop(0),s("#leaderboardsWrapper #leaderboards .rightTableWrapper").scrollTop(0),fa=!0,ci=!0}async function jx(e,t=!1){var l,c,d;if(t&&((l=Xe[e][0])==null?void 0:l.rank)===1||dr[e])return;dr[e]=!0,il(e);let a=(c=Xe[e][Xe[e].length-1])==null?void 0:c.rank;t&&(a=(((d=Xe[e][0])==null?void 0:d.rank)??0)-Yo);let o;a<0&&(o=Math.abs(a)-1,a=0);const n=await E.leaderboards.get({language:fs,mode:"time",mode2:e,skip:a,limit:o,...rl()}),r=n.data;if(n.status!==200||r===null||r.length===0){Rs(e),dr[e]=!1;return}t?Xe[e].unshift(...r):Xe[e].push(...r),t&&!o&&(o=Yo-1),await _u(e),zu(r).then(u=>{t?oo[e].unshift(...u):oo[e].push(...u),Uu(e)}),Rs(e),dr[e]=!1}async function Zl(e,t){il(e);const a=await E.leaderboards.get({language:fs,mode:"time",mode2:e,skip:t,...rl()}),o=a.data;if(a.status===503){m("Leaderboards are currently updating - please try again later",-1);return}if(nl(e),Xe[e]=[],oo[e]=[],a.status!==200||o===null||o.length===0){Rs(e);return}Xe[e]=o,await _u(e),zu(o).then(n=>{oo[e]=n,Uu(e)}),Rs(e)}async function zu(e){return Promise.allSettled(e.map(async t=>pd(t.discordId,t.discordAvatar))).then(t=>t.map(a=>a.status==="fulfilled"?a.value:null))}function Uu(e){const a=s(`#leaderboardsWrapper table.${e==="15"?"left":"right"} tbody .lbav`);for(const[o,n]of oo[e].entries()){const r=a[o];n!==null?s(r).html(`<div class="avatar" style="background-image:url(${n})"></div>`):s(r).html('<div class="avatarPlaceholder"><i class="fas fa-user-circle"></i></div>')}}function Qx(){if(!We()){m("You can't view leaderboards while offline",0);return}at(Hu,"popups"),Le("leaderboardsWrapper")||(z()?(s("#leaderboardsWrapper #leaderboards .rightTableJumpToMe").removeClass("disabled"),s("#leaderboardsWrapper #leaderboards .leftTableJumpToMe").removeClass("disabled")):(s("#leaderboardsWrapper #leaderboards .rightTableJumpToMe").addClass("disabled"),s("#leaderboardsWrapper #leaderboards .leftTableJumpToMe").addClass("disabled")),s("#leaderboards table thead tr td:nth-child(3)").html(i.typingSpeedUnit+'<br><div class="sub">accuracy</div>'),s("#leaderboardsWrapper").stop(!0,!0).css("opacity",0).removeClass("hidden").animate({opacity:1},125,()=>{Bi(),zx()}))}s("#leaderboardsWrapper").on("click",e=>{s(e.target).attr("id")==="leaderboardsWrapper"&&Nu()});const ld=new At({select:"#leaderboardsWrapper #leaderboards .leaderboardsTop .buttonGroup.timeRange .languageSelect",settings:{showSearch:!1,contentLocation:document.querySelector("#leaderboardsWrapper")},data:[{value:"english",text:"english",selected:!0},{value:"spanish",text:"spanish"},{value:"german",text:"german"},{value:"french",text:"french"},{value:"portuguese",text:"portuguese"},{value:"indonesian",text:"indonesian"},{value:"italian",text:"italian"},{value:"russian",text:"russian"}],events:{afterChange:e=>{var t;fs=(t=e[0])==null?void 0:t.value,Gy(),Bi()}}});let fa=!0;s("#leaderboardsWrapper #leaderboards .leftTableWrapper").on("scroll",e=>{if(!fa)return;const t=s(e.currentTarget);Math.round(t.scrollTop())<=50&&Xl("15",!0)});const Xl=Et(500,jx);s("#leaderboardsWrapper #leaderboards .leftTableWrapper").on("scroll",e=>{if(!fa)return;const t=s(e.currentTarget);t===void 0||t[0]===void 0||Math.round(t[0].scrollHeight-t.scrollTop())<=Math.round(t.outerHeight())+50&&Xl("15")});let ci=!0;s("#leaderboardsWrapper #leaderboards .rightTableWrapper").on("scroll",e=>{if(!ci)return;const t=s(e.currentTarget);Math.round(t.scrollTop())<=50&&Xl("60",!0)});s("#leaderboardsWrapper #leaderboards .rightTableWrapper").on("scroll",e=>{const t=s(e.currentTarget);t===void 0||t[0]===void 0||Math.round(t[0].scrollHeight-t.scrollTop())<=Math.round(t.outerHeight()+50)&&Xl("60")});s("#leaderboardsWrapper #leaderboards .leftTableJumpToTop").on("click",async()=>{fa=!1,s("#leaderboardsWrapper #leaderboards .leftTableWrapper").scrollTop(0),await Zl("15",0),fa=!0});s("#leaderboardsWrapper #leaderboards .leftTableJumpToMe").on("click",async()=>{var t;if(!((t=vt[15])!=null&&t.rank))return;fa=!1,await Zl("15",vt[15].rank-Yo/2);const e=s("#leaderboardsWrapper #leaderboards .leftTableWrapper table tbody td").outerHeight();s("#leaderboardsWrapper #leaderboards .leftTableWrapper").animate({scrollTop:e*Math.min(vt[15].rank,Yo/2)-s("#leaderboardsWrapper #leaderboards .leftTableWrapper").outerHeight()/2.25},0,()=>{fa=!0})});s("#leaderboardsWrapper #leaderboards .rightTableJumpToTop").on("click",async()=>{ci=!1,s("#leaderboardsWrapper #leaderboards .rightTableWrapper").scrollTop(0),await Zl("60",0),ci=!0});s("#leaderboardsWrapper #leaderboards .rightTableJumpToMe").on("click",async()=>{var t;if(!((t=vt[60])!=null&&t.rank))return;fa=!1,await Zl("60",vt[60].rank-Yo/2);const e=s("#leaderboardsWrapper #leaderboards .rightTableWrapper table tbody td").outerHeight();s("#leaderboardsWrapper #leaderboards .rightTableWrapper").animate({scrollTop:e*Math.min(vt[60].rank,Yo/2)-s("#leaderboardsWrapper #leaderboards .rightTableWrapper").outerHeight()/2.25},0,()=>{fa=!0})});s("#leaderboardsWrapper #leaderboards .leaderboardsTop .buttonGroup.timeRange .allTime").on("click",()=>{Lt="allTime",fs="english",ld.disable(),ld.setSelected("english"),Bi()});s("#leaderboardsWrapper #leaderboards .leaderboardsTop .buttonGroup.timeRange .daily").on("click",()=>{Lt="daily",Ku(),ld.enable(),Bi()});s("#leaderboardsWrapper .showYesterdayButton").on("click",()=>{Go=!Go,Bi()});s(document).on("keydown",e=>{e.key==="Escape"&&Le("leaderboardsWrapper")&&(Nu(),e.preventDefault())});s("header nav").on("click",".textButton",e=>{s(e.currentTarget).hasClass("leaderboards")&&Qx()});st(Hu);function Gx(e){return new RegExp("^"+e.replace(/\//g,"\\/").replace(/:\w+/g,"(.+)")+"$")}function Yx(e){const t=e.result.slice(1),a=Array.from(e.route.path.matchAll(/:(\w+)/g)).map(o=>o[1]);return Object.fromEntries(a.map((o,n)=>[o,t[n]]))}const Jx={path:"404",load:()=>{ya("404")}},Zx=[{path:"/",load:()=>{ya("test")}},{path:"/verify",load:()=>{ya("test")}},{path:"/about",load:()=>{ya("about")}},{path:"/settings",load:()=>{ya("settings")}},{path:"/login",load:()=>{if(!Pe){wt("/");return}if(z()){wt("/account");return}ya("login")}},{path:"/account",load:(e,t)=>{if(!Pe){wt("/");return}ya("account",{data:t.data})}},{path:"/profile",load:e=>{ya("profileSearch")}},{path:"/profile/:uidOrName",load:(e,t)=>{ya("profile",{force:!0,params:{uidOrName:e.uidOrName},data:t.data})}}];function wt(e=window.location.pathname+window.location.search,t={}){if(Ct||Zs||Rn()){console.debug(`navigate: ${e} ignored, page is busy (testRestarting: ${Ct}, resultCalculating: ${Zs}, pageTransition: ${Rn()})`);return}e=e.replace(/\/$/,""),e===""&&(e="/"),history.pushState(null,"",e),Yy(t)}async function Yy(e={}){const a=Zx.map(o=>({route:o,result:location.pathname.match(Gx(o.path))})).find(o=>o.result!==null);if(a===void 0){Jx.load({},{});return}a.route.load(Yx(a),e)}window.addEventListener("popstate",()=>{Yy()});document.addEventListener("DOMContentLoaded",()=>{document.body.addEventListener("click",e=>{const t=e==null?void 0:e.target;t.matches("[router-link]")&&(t!=null&&t.href)&&(e.preventDefault(),wt(t.href))})});s("#popups").on("click","#leaderboards a.entryName",()=>{Nu()});let Jy=!1;const Vu=new Cw;async function Zy(){if(Pe===void 0){m("Authentication uninitialized",-1,{duration:3});return}oe(),s(".sendVerificationEmail").prop("disabled",!0);const e=await E.users.verificationEmail();s(".sendVerificationEmail").prop("disabled",!1),e.status!==200?(Q(),m("Failed to request verification email: "+e.message,-1)):(Q(),m("Verification email sent",1))}async function Xx(){try{console.log("getting account data"),window.location.pathname!=="/account"?oa(90):oa(45),$r("Downloading user data..."),await Up(),await db()}catch(a){const o=a;_t(!1),o.responseCode===429&&(m("Doing so will save you bandwidth, make the next test be ready faster and will not sign you out (which could mean your new personal best would not save to your account).",0,{duration:0}),m("You will run into this error if you refresh the website to restart the test. It is NOT recommended to do that. Instead, use tab + enter or just tab (with quick tab mode enabled) to restart the test.",0,{duration:0}));const n=o.message||"Unknown error";return m("Failed to get user data: "+n,-1),console.error(o),s("header nav .account").css("opacity",1),!1}ne()==="loading"?oa(100):oa(45),$r("Applying settings...");const e=S();s("nav .textButton.account > .text").text(e.name),s("nav .textButton.account > .text").append(El(e,{iconsOnly:!0})),pS(),M1(e.tags),Promise.all([hd(),ui()]).then(a=>{const[o,n]=a;o.forEach(r=>{Tt.language[r]=!0}),n.forEach(r=>{Tt.funbox[r.name]=!0}),k1()}).catch(a=>{console.log(ee(a,"Something went wrong while loading the filters"))}),e.needsToChangeName&&Ro("You need to update your account name. <a class='openNameChange'>Click here</a> to change it and learn more about why.",-1,void 0,!0,void 0,!0);const t=JSON.stringify(i)===JSON.stringify(e.config);return(om===void 0||!t)&&(console.log("no local config or local and db configs are different - applying db"),await vi(e.config),Jo(!0)),_t(!1),tx(),window.location.pathname==="/account"&&(oa(90),await Eu()),window.location.pathname==="/login"?wt("/account"):wt(),!0}async function Pi(e){Ks(!1),_t(!0),await Xx()||rn();const{discordId:t,discordAvatar:a,xp:o,inboxUnreadSize:n}=S();if(vl(o,t,a),zy(n>0),gt(),s("header .signInOut .icon").html('<i class="fas fa-fw fa-sign-out-alt"></i>'),ct!==null&&!Jy){Tu(e.uid);const r=await E.results.save(ct);if(r.status!==200)return m("Failed to save last result: "+r.message,-1);g1(),m("Last test result saved",1)}}let ec;var hp;Pe&&We()?ec=(hp=Pe)==null?void 0:hp.onAuthStateChanged(async function(e){const t=window.location.search,a=window.location.hash;if(console.log(`auth state changed, user ${!!e}`),console.debug(e),e?(s("header .signInOut .icon").html('<i class="fas fa-fw fa-sign-out-alt"></i>'),await Pi(e)):(s("header .signInOut .icon").html('<i class="far fa-fw fa-user"></i>'),window.location.pathname==="/account"&&window.history.replaceState("","","/login"),Ks(!1)),e||wt(),zf(t),Uf(t),Kf(a),/challenge_.+/g.test(window.location.pathname)){m("Challenge links temporarily disabled. Please use the command line to load the challenge manually",0,{duration:7});return}}):(s("nav .signInOut").addClass("hidden"),s("document").ready(async()=>{const e=window.location.search,t=window.location.hash;if(s("header .signInOut .icon").html('<i class="far fa-fw fa-user"></i>'),window.location.pathname==="/account"&&window.history.replaceState("","","/login"),Ks(!1),wt(),zf(e),Uf(e),Kf(t),/challenge_.+/g.test(window.location.pathname)){m("Challenge links temporarily disabled. Please use the command line to load the challenge manually",0,{duration:7});return}}));async function e$(){if(Pe===void 0){m("Authentication uninitialized",-1);return}if(!We()){m("You are offline",0,{duration:2});return}ec(),Ru(),Du(),Jl();const e=s(".pageLogin .login input")[0].value,t=s(".pageLogin .login input")[1].value;if(e===""||t===""){m("Please fill in all fields",0),gt(),$t(),Yl();return}const a=s(".pageLogin .login #rememberMe input").prop("checked")?Op:Hp;return await _p(Pe,a),kw(Pe,e,t).then(async o=>{await Pi(o.user)}).catch(function(o){console.error(o);let n=o.message;o.code==="auth/wrong-password"?n="Incorrect password":o.code==="auth/user-not-found"?n="User not found":o.code==="auth/invalid-email"?n="Invalid email format (make sure you are using your email to login - not your username)":o.code==="auth/invalid-credential"&&(n="Email/password is incorrect or your account does not have password authentication enabled."),m(n,-1),gt(),$t(),yt()})}async function t$(){if(Pe===void 0){m("Authentication uninitialized",-1,{duration:3});return}if(!We()){m("You are offline",0,{duration:2});return}Ru(),Du(),Jl(),ec();const e=s(".pageLogin .login #rememberMe input").prop("checked")?Op:Hp;await _p(Pe,e),Sw(Pe,Vu).then(async t=>{var a;(a=bd(t))!=null&&a.isNewUser?Ax(t,!0):await Pi(t.user)}).catch(t=>{let a=t.message;if(t.code==="auth/wrong-password")a="Incorrect password";else if(t.code==="auth/user-not-found")a="User not found";else if(t.code==="auth/invalid-email")a="Invalid email format (make sure you are using your email to login - not your username)";else{if(t.code==="auth/popup-closed-by-user")return;if(t.code==="auth/user-cancelled")return}m(a,-1),gt(),$t(),yt()})}async function a$(){if(Pe===void 0){m("Authentication uninitialized",-1,{duration:3});return}oe(),z()&&Tw(gl(),Vu).then(function(){Q(),m("Google authentication added",1),Gl()}).catch(function(e){Q(),m("Failed to add Google authentication: "+e.message,-1)})}function rn(){if(Pe===void 0){m("Authentication uninitialized",-1,{duration:3});return}z()&&Pe.signOut().then(function(){m("Signed out",0,{duration:2}),Lu(),Wy(),vl(),wt("/login"),ut(void 0),s("header .signInOut .icon").html('<i class="far fa-fw fa-user"></i>'),setTimeout(()=>{mS()},125)}).catch(function(e){m(e.message,-1)})}async function s$(){if(Pe===void 0){m("Authentication uninitialized",-1,{duration:3});return}if(!We()){m("You are offline",0,{duration:2});return}bx();const e=await _y;if(e===void 0||e===""){m("Please complete the captcha",-1);return}Du(),Jl(),Ru();const t=s(".pageLogin .register input")[0].value,a=s(".pageLogin .register input")[1].value,o=s(".pageLogin .register input")[2].value,n=s(".pageLogin .register input")[3].value,r=s(".pageLogin .register input")[4].value;if(t===""||a===""||o===""||n===""){gt(),$t(),yt(),m("Please fill in all fields",0);return}if(!a.match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)){m("Invalid email",0),gt(),$t(),yt();return}if(a!==o){m("Emails do not match",0),gt(),$t(),yt();return}if(n!==r){m("Passwords do not match",0),gt(),$t(),yt();return}if(!yd(n)){m("Password must contain at least one capital letter, number, a special character and must be between 8 and 64 characters long",0,{duration:4}),gt(),$t(),yt();return}ec();try{const l=await xw(Pe,a,n),c=await E.users.create(t,e,a,l.user.uid);if(c.status!==200)throw new Error(`Failed to sign in: ${c.message}`);if(await Np(l.user,{displayName:t}),await Zy(),Lu(),s("nav .textButton.account .text").text(t),gt(),await Pi(l.user),ct!==null&&(Tu(l.user.uid),(await E.results.save(ct)).status===200)){const u=ct;$d(u),Ad(1,u.testDuration+u.incompleteTestSeconds-u.afkDuration)}m("Account created",1)}catch(l){let c=ee(l,"Failed to create account");l instanceof Error&&"code"in l&&l.code==="auth/email-already-in-use"&&(c=ee({message:"Email already in use"},"Failed to create account")),m(c,-1),gt(),$t(),yt(),rn();return}}s(".pageLogin .login form").on("submit",e=>{e.preventDefault(),e$()});s(".pageLogin .login button.signInWithGoogle").on("click",()=>{t$()});s("header .signInOut").on("click",()=>{if(Pe===void 0){m("Authentication uninitialized",-1,{duration:3});return}z()?(rn(),Jy=!0):wt("/login")});s(".pageLogin .register form").on("submit",e=>{e.preventDefault(),s$()});s(".pageSettings #addGoogleAuth").on("click",async()=>{if(!We()){m("You are offline",0,{duration:2});return}a$()});s(".pageAccount").on("click",".sendVerificationEmail",()=>{if(!We()){m("You are offline",0,{duration:2});return}Zy()});let Os=null;const ve={updateEmail:void 0,updateName:void 0,updatePassword:void 0,removeGoogleAuth:void 0,addPasswordAuth:void 0,deleteAccount:void 0,resetAccount:void 0,clearTagPb:void 0,optOutOfLeaderboards:void 0,applyCustomFont:void 0,resetPersonalBests:void 0,resetSettings:void 0,revokeAllTokens:void 0,unlinkDiscord:void 0,generateApeKey:void 0,viewApeKey:void 0,deleteApeKey:void 0,editApeKey:void 0,deleteCustomText:void 0,deleteCustomTextLong:void 0,resetProgressCustomTextLong:void 0,updateCustomTheme:void 0,deleteCustomTheme:void 0,forgotPassword:void 0},$n=new le({dialogId:"simpleModal",setup:async e=>{e.addEventListener("submit",t=>{t.preventDefault(),Os==null||Os.exec()})},customEscapeHandler:e=>{Xf()},customWrapperClickHandler:e=>{Xf()}});class Se{constructor(t){this.parameters=[],this.id=t.id,this.type=t.type,this.execFn=t.execFn,this.title=t.title,this.inputs=t.inputs??[],this.text=t.text,this.wrapper=$n.getWrapper(),this.element=$n.getModal(),this.buttonText=t.buttonText,this.beforeInitFn=t.beforeInitFn,this.beforeShowFn=t.beforeShowFn,this.canClose=t.canClose??!0,this.onlineOnly=t.onlineOnly??!1,this.hideCallsExec=t.hideCallsExec??!1}reset(){this.element.innerHTML=`
    <div class="title"></div>
    <div class="inputs"></div>
    <div class="text"></div>
    <button type="submit" class="submitButton"></button>`}init(){const t=s(this.element);t.find("input").val(""),this.reset(),t.attr("data-popup-id",this.id),t.find(".title").text(this.title),t.find(".text").text(this.text??""),this.initInputs(),this.buttonText===""?t.find(".submitButton").remove():t.find(".submitButton").text(this.buttonText),(this.text??"")===""?t.find(".text").addClass("hidden"):t.find(".text").removeClass("hidden")}initInputs(){const t=s(this.element);if(this.inputs.every(o=>o.hidden)||this.inputs.length===0){t.find(".inputs").addClass("hidden");return}this.type==="number"?this.inputs.forEach(o=>{t.find(".inputs").append(`
            <input
              type="number"
              min="1"
              value="${o.initVal}"
              placeholder="${o.placeholder}"
              class="${o.hidden?"hidden":""}"
              ${o.hidden?"":"required"}
              autocomplete="off"
            >
          `)}):this.type==="text"&&this.inputs.forEach(o=>{o.type!==void 0&&o.type!==""?o.type==="textarea"?t.find(".inputs").append(`
                <textarea
                  placeholder="${o.placeholder}"
                  class="${o.hidden?"hidden":""}"
                  ${o.hidden?"":"required"}
                  ${o.disabled?"disabled":""}
                  autocomplete="off"
                >${o.initVal}</textarea>
              `):o.type==="checkbox"?t.find(".inputs").append(`
              <label class="checkbox">
                <input type="checkbox" checked="">
                <div>${o.label}</div>
              </label>
              `):t.find(".inputs").append(`
              <input
              type="${o.type}"
              value="${o.initVal}"
              placeholder="${o.placeholder}"
              class="${o.hidden?"hidden":""}"
              ${o.hidden?"":"required"}
              ${o.disabled?"disabled":""}
              autocomplete="off"
              >
              `):t.find(".inputs").append(`
              <input
                type="text"
                value="${o.initVal}"
                placeholder="${o.placeholder}"
                class="${o.hidden?"hidden":""}"
                ${o.hidden?"":"required"}
                ${o.disabled?"disabled":""}
                autocomplete="off"
              >
            `)}),t.find(".inputs").removeClass("hidden")}exec(){if(!this.canClose)return;const t=[];for(const o of s("#simpleModal input, #simpleModal textarea"))s(o).is(":checkbox")?t.push(s(o).is(":checked")?"true":"false"):t.push(s(o).val());const a=[];for(let o=0;o<this.inputs.length;o++)a.push({...this.inputs[o],currentValue:t[o]});if(a.filter(o=>!o.hidden).some(o=>o.currentValue===void 0||o.currentValue==="")){m("Please fill in all fields",0);return}this.disableInputs(),oe(),this.execFn(this,...t).then(o=>{Q(),(o.showNotification??!0)&&m(o.message,o.status,o.notificationOptions),o.status===1?this.hide(!0,o.hideOptions).then(()=>{o.afterHide&&o.afterHide()}):(this.enableInputs(),s(s("#simpleModal").find("input")[0]).trigger("focus"))})}disableInputs(){s("#simpleModal input").prop("disabled",!0),s("#simpleModal button").prop("disabled",!0),s("#simpleModal textarea").prop("disabled",!0),s("#simpleModal .checkbox").addClass("disabled")}enableInputs(){s("#simpleModal input").prop("disabled",!1),s("#simpleModal button").prop("disabled",!1),s("#simpleModal textarea").prop("disabled",!1),s("#simpleModal .checkbox").removeClass("disabled")}show(t=[],a){Os=this,this.parameters=t,$n.show({...a,focusFirstInput:!0,beforeAnimation:async()=>{var o,n;(o=this.beforeInitFn)==null||o.call(this,this),this.init(),(n=this.beforeShowFn)==null||n.call(this,this)}})}async hide(t,a){this.canClose&&(this.hideCallsExec&&!t?this.exec():(Os=null,await $n.hide(a)))}}function Xf(){if(Os){Os.hide();return}}async function pa(e,t){if(Pe===void 0)return{status:-1,message:"Authentication is not initialized"};if(!z())return{status:-1,message:"User is not signed in"};const a=gl();try{const o=a.providerData.some(n=>(n==null?void 0:n.providerId)==="password");if(!o&&e==="passwordOnly")return{status:-1,message:"Failed to reauthenticate in password only mode: password authentication is not enabled on this account"};if(o){const n=Kp.credential(a.email,t);await Lw(a,n)}else e==="passwordFirst"&&await Ww(a,Vu);return{status:1,message:"Reauthenticated",user:a}}catch(o){const n=o;return n.code==="auth/wrong-password"?{status:0,message:"Incorrect password"}:{status:-1,message:"Failed to reauthenticate: "+((n==null?void 0:n.message)??JSON.stringify(o))}}}ve.updateEmail=new Se({id:"updateEmail",type:"text",title:"Update email",inputs:[{placeholder:"Password",type:"password",initVal:""},{placeholder:"New email",initVal:""},{placeholder:"Confirm new email",initVal:""}],buttonText:"update",onlineOnly:!0,execFn:async(e,t,a,o)=>{if(a!==o)return{status:0,message:"Emails don't match"};const n=await pa("passwordOnly",t);if(n.status!==1)return{status:n.status,message:n.message};const r=await E.users.updateEmail(a,n.user.email);return r.status!==200?{status:-1,message:"Failed to update email: "+r.message}:(rn(),{status:1,message:"Email updated"})},beforeInitFn:e=>{z()&&(Oa()||(e.inputs=[],e.buttonText="",e.text="Password authentication is not enabled"))}});ve.removeGoogleAuth=new Se({id:"removeGoogleAuth",type:"text",title:"Remove Google authentication",inputs:[{placeholder:"Password",type:"password",initVal:""}],onlineOnly:!0,buttonText:"remove",execFn:async(e,t)=>{const a=await pa("passwordOnly",t);if(a.status!==1)return{status:a.status,message:a.message};try{await $w(a.user,"google.com")}catch(o){return{status:-1,message:ee(o,"Failed to unlink Google account")}}return Gl(),ps(3),{status:1,message:"Google authentication removed"}},beforeInitFn:e=>{z()&&(Oa()||(e.inputs=[],e.buttonText="",e.text="Password authentication is not enabled"))}});ve.updateName=new Se({id:"updateName",type:"text",title:"Update name",inputs:[{placeholder:"password",type:"password",initVal:""},{placeholder:"new name",type:"text",initVal:""}],buttonText:"update",onlineOnly:!0,execFn:async(e,t,a)=>{const o=await pa("passwordFirst",t);if(o.status!==1)return{status:o.status,message:o.message};const n=await E.users.getNameAvailability(a);if(n.status===409)return{status:0,message:"Name not available"};if(n.status!==200)return{status:-1,message:"Failed to check name: "+n.message};const r=await E.users.updateName(a);if(r.status!==200)return{status:-1,message:"Failed to update name: "+r.message};const l=S();return l&&(l.name=a,l.needsToChangeName&&ps(2)),s("nav .textButton.account .text").text(a),{status:1,message:"Name updated"}},beforeInitFn:e=>{if(!z())return;const t=S();t&&(Oa()||(e.inputs[0].hidden=!0,e.buttonText="reauthenticate to update"),t.needsToChangeName===!0&&(e.text="You need to change your account name. This might be because you have a duplicate name, no account name or your name is not allowed (contains whitespace or invalid characters). Sorry for the inconvenience."))}});ve.updatePassword=new Se({id:"updatePassword",type:"text",title:"Update password",inputs:[{placeholder:"current password",type:"password",initVal:""},{placeholder:"new password",type:"password",initVal:""},{placeholder:"confirm new password",type:"password",initVal:""}],buttonText:"update",onlineOnly:!0,execFn:async(e,t,a,o)=>{if(a!==o)return{status:0,message:"New passwords don't match"};if(a===t)return{status:0,message:"New password must be different from previous password"};if(!yd(a))return{status:0,message:"New password must contain at least one capital letter, number, a special character and must be between 8 and 64 characters long"};const n=await pa("passwordOnly",t);if(n.status!==1)return{status:n.status,message:n.message};try{await Aw(n.user,a)}catch(r){return{status:-1,message:ee(r,"Failed to update password")}}return ps(3),{status:1,message:"Password updated"}},beforeInitFn:e=>{z()&&(Oa()||(e.inputs=[],e.buttonText="",e.text="Password authentication is not enabled"))}});ve.addPasswordAuth=new Se({id:"addPasswordAuth",type:"text",title:"Add password authentication",inputs:[{placeholder:"email",type:"email",initVal:""},{placeholder:"confirm email",type:"email",initVal:""},{placeholder:"new password",type:"password",initVal:""},{placeholder:"confirm new password",type:"password",initVal:""}],buttonText:"reauthenticate to add",onlineOnly:!0,execFn:async(e,t,a,o,n)=>{if(t!==a)return{status:0,message:"Emails don't match"};if(o!==n)return{status:0,message:"Passwords don't match"};const r=await pa("passwordFirst",o);if(r.status!==1)return{status:r.status,message:r.message};try{const c=Kp.credential(t,o);await Mw(r.user,c)}catch(c){return{status:-1,message:ee(c,"Failed to add password authentication")}}const l=await E.users.updateEmail(t,r.user.email);return l.status!==200?{status:-1,message:"Password authentication added but updating the database email failed. This shouldn't happen, please contact support. Error: "+l.message}:(Gl(),{status:1,message:"Password authentication added"})}});ve.deleteAccount=new Se({id:"deleteAccount",type:"text",title:"Delete account",inputs:[{placeholder:"password",type:"password",initVal:""}],text:"This is the last time you can change your mind. After pressing the button everything is gone.",buttonText:"delete",onlineOnly:!0,execFn:async(e,t)=>{const a=await pa("passwordFirst",t);if(a.status!==1)return{status:a.status,message:a.message};m("Deleting all data...",0);const o=await E.users.delete();return o.status!==200?{status:-1,message:"Failed to delete user data: "+o.message}:(ps(3),{status:1,message:"Account deleted, goodbye"})},beforeInitFn:e=>{z()&&(Oa()||(e.inputs=[],e.buttonText="reauthenticate to delete"))}});ve.resetAccount=new Se({id:"resetAccount",type:"text",title:"Reset account",inputs:[{placeholder:"password",type:"password",initVal:""}],text:"This is the last time you can change your mind. After pressing the button everything is gone.",buttonText:"reset",onlineOnly:!0,execFn:async(e,t)=>{const a=await pa("passwordFirst",t);if(a.status!==1)return{status:a.status,message:a.message};m("Resetting settings...",0),await Hd(),m("Resetting account...",0);const o=await E.users.reset();return o.status!==200?{status:-1,message:"Failed to reset account: "+o.message}:(ps(3),{status:1,message:"Account reset"})},beforeInitFn:e=>{z()&&(Oa()||(e.inputs=[],e.buttonText="reauthenticate to reset"))}});ve.optOutOfLeaderboards=new Se({id:"optOutOfLeaderboards",type:"text",title:"Opt out of leaderboards",inputs:[{placeholder:"password",type:"password",initVal:""}],text:"Are you sure you want to opt out of leaderboards?",buttonText:"opt out",onlineOnly:!0,execFn:async(e,t)=>{const a=await pa("passwordFirst",t);if(a.status!==1)return{status:a.status,message:a.message};const o=await E.users.optOutOfLeaderboards();return o.status!==200?{status:-1,message:"Failed to opt out: "+o.message}:(ps(3),{status:1,message:"Leaderboards opt out successful"})},beforeInitFn:e=>{z()&&(Oa()||(e.inputs=[],e.buttonText="reauthenticate to opt out"))}});ve.clearTagPb=new Se({id:"clearTagPb",type:"text",title:"Clear tag PB",text:"Are you sure you want to clear this tags PB?",buttonText:"clear",execFn:async e=>{var n,r;const t=e.parameters[0],a=await E.users.deleteTagPersonalBest(t);if(a.status!==200)return{status:-1,message:"Failed to clear tag PB: "+a.message};const o=(r=(n=S())==null?void 0:n.tags)==null?void 0:r.filter(l=>l._id===t)[0];return o===void 0?{status:-1,message:"Tag not found"}:(o.personalBests={time:{},words:{},quote:{},zen:{},custom:{}},s(`.pageSettings .section.tags .tagsList .tag[id="${t}"] .clearPbButton`).attr("aria-label","No PB found"),{status:1,message:"Tag PB cleared"})},beforeInitFn:e=>{e.text=`Are you sure you want to clear PB for tag ${e.parameters[1]}?`}});ve.applyCustomFont=new Se({id:"applyCustomFont",type:"text",title:"Custom font",inputs:[{placeholder:"Font name",initVal:""}],text:"Make sure you have the font installed on your computer before applying",buttonText:"apply",execFn:async(e,t)=>{var a;return(a=F.fontFamily)==null||a.setValue(t.replace(/\s/g,"_")),{status:1,message:"Font applied"}}});ve.resetPersonalBests=new Se({id:"resetPersonalBests",type:"text",title:"Reset personal bests",inputs:[{placeholder:"password",type:"password",initVal:""}],buttonText:"reset",onlineOnly:!0,execFn:async(e,t)=>{const a=await pa("passwordFirst",t);if(a.status!==1)return{status:a.status,message:a.message};const o=await E.users.deletePersonalBests();if(o.status!==200)return{status:-1,message:"Failed to reset personal bests: "+o.message};const n=S();return n?(n.personalBests={time:{},words:{},quote:{},zen:{},custom:{}},{status:1,message:"Personal bests reset"}):{status:-1,message:"Failed to reset personal bests: no snapshot"}},beforeInitFn:e=>{z()&&(Oa()||(e.inputs=[],e.buttonText="reauthenticate to reset"))}});ve.resetSettings=new Se({id:"resetSettings",type:"text",title:"Reset settings",text:"Are you sure you want to reset all your settings?",buttonText:"reset",onlineOnly:!0,execFn:async()=>(await Hd(),{status:1,message:"Settings reset"})});ve.revokeAllTokens=new Se({id:"revokeAllTokens",type:"text",title:"Revoke all tokens",inputs:[{placeholder:"password",type:"password",initVal:""}],text:"Are you sure you want to this? This will log you out of all devices.",buttonText:"revoke all",onlineOnly:!0,execFn:async(e,t)=>{const a=await pa("passwordFirst",t);if(a.status!==1)return{status:a.status,message:a.message};const o=await E.users.revokeAllTokens();return o.status!==200?{status:-1,message:"Failed to revoke tokens: "+o.message}:(ps(3),{status:1,message:"Tokens revoked"})},beforeInitFn:e=>{!z()||!S()||Oa()||(e.inputs[0].hidden=!0,e.buttonText="reauthenticate to revoke all tokens")}});ve.unlinkDiscord=new Se({id:"unlinkDiscord",type:"text",title:"Unlink Discord",text:"Are you sure you want to unlink your Discord account?",buttonText:"unlink",onlineOnly:!0,execFn:async()=>{const e=S();if(!e)return{status:-1,message:"Failed to unlink Discord: no snapshot"};const t=await E.users.unlinkDiscord();return t.status!==200?{status:-1,message:"Failed to unlink Discord: "+t.message}:(e.discordAvatar=void 0,e.discordId=void 0,vl(),ut(e),Ql(),{status:1,message:"Discord unlinked"})}});ve.generateApeKey=new Se({id:"generateApeKey",type:"text",title:"Generate new Ape key",inputs:[{placeholder:"Name",initVal:""}],buttonText:"generate",onlineOnly:!0,execFn:async(e,t)=>{const a=await E.apeKeys.generate(t,!1);if(a.status!==200)return{status:-1,message:"Failed to generate key: "+a.message};const o=a.data,n=$n.getPreviousModalInChain();return{status:1,message:"Key generated",hideOptions:{clearModalChain:!0,animationMode:"modalOnly"},afterHide:()=>{ke("viewApeKey",[o.apeKey],{modalChain:n,animationMode:"modalOnly"})}}}});ve.viewApeKey=new Se({id:"viewApeKey",type:"text",title:"Ape key",inputs:[{type:"textarea",disabled:!0,placeholder:"key",initVal:""}],text:"This is your new Ape Key. Please keep it safe. You will only see it once!",buttonText:"close",hideCallsExec:!0,execFn:async e=>({status:1,message:"Key generated",showNotification:!1,hideOptions:{clearModalChain:!0}}),beforeInitFn:e=>{e.inputs[0].initVal=e.parameters[0]},beforeShowFn:e=>{e.canClose=!1,s("#simpleModal textarea").css("height","110px"),s("#simpleModal .submitButton").addClass("hidden"),setTimeout(()=>{e.canClose=!0,s("#simpleModal .submitButton").removeClass("hidden")},5e3)}});ve.deleteApeKey=new Se({id:"deleteApeKey",type:"text",title:"Delete Ape key",text:"Are you sure?",buttonText:"delete",onlineOnly:!0,execFn:async e=>{const t=await E.apeKeys.delete(e.parameters[0]??"");return t.status!==200?{status:-1,message:"Failed to delete key: "+t.message}:{status:1,message:"Key deleted",hideOptions:{clearModalChain:!0}}}});ve.editApeKey=new Se({id:"editApeKey",type:"text",title:"Edit Ape key",inputs:[{placeholder:"name",initVal:""}],buttonText:"edit",onlineOnly:!0,execFn:async(e,t)=>{const a=await E.apeKeys.update(e.parameters[0]??"",{name:t});return a.status!==200?{status:-1,message:"Failed to update key: "+a.message}:{status:1,message:"Key updated",hideOptions:{clearModalChain:!0}}}});ve.deleteCustomText=new Se({id:"deleteCustomText",type:"text",title:"Delete custom text",text:"Are you sure?",buttonText:"delete",execFn:async e=>(zd(e.parameters[0],!1),lo("",void 0),Vl(!0),{status:1,message:"Custom text deleted"}),beforeInitFn:e=>{e.text=`Are you sure you want to delete custom text ${e.parameters[0]}?`}});ve.deleteCustomTextLong=new Se({id:"deleteCustomTextLong",type:"text",title:"Delete custom text",text:"Are you sure?",buttonText:"delete",execFn:async e=>(zd(e.parameters[0],!0),lo("",void 0),Vl(!0),{status:1,message:"Custom text deleted"}),beforeInitFn:e=>{e.text=`Are you sure you want to delete custom text ${e.parameters[0]}?`}});ve.resetProgressCustomTextLong=new Se({id:"resetProgressCustomTextLong",type:"text",title:"Reset progress for custom text",text:"Are you sure?",buttonText:"reset",execFn:async e=>(Br(e.parameters[0],0),Vl(!0),bt(Gn(e.parameters[0],!0).join(" ")),{status:1,message:"Custom text progress reset"}),beforeInitFn:e=>{e.text=`Are you sure you want to reset your progress for custom text ${e.parameters[0]}?`}});ve.updateCustomTheme=new Se({id:"updateCustomTheme",type:"text",title:"Update custom theme",inputs:[{type:"text",placeholder:"name",initVal:""},{type:"checkbox",initVal:"false",label:"Update custom theme to current colors"}],buttonText:"update",onlineOnly:!0,execFn:async(e,t,a)=>{var d;const o=S();if(!o)return{status:-1,message:"Failed to update custom theme: no snapshot"};const n=(d=o.customThemes)==null?void 0:d.find(u=>u._id===e.parameters[0]);if(n===void 0)return{status:-1,message:"Failed to update custom theme: theme not found"};let r=[];if(a==="true")for(const u of Da)r.push(s(`.pageSettings .customTheme .customThemeEdit #${u}[type='color']`).attr("value"));else r=n.colors;const l={name:t.replaceAll(" ","_"),colors:r};return await fb(n._id,l)?(Kn(r),Vo(),{status:1,message:"Custom theme updated"}):{status:-1,message:"Failed to update custom theme"}},beforeInitFn:e=>{var o;const t=S();if(!t)return;const a=(o=t.customThemes)==null?void 0:o.find(n=>n._id===e.parameters[0]);a&&(e.inputs[0].initVal=a.name)}});ve.deleteCustomTheme=new Se({id:"deleteCustomTheme",type:"text",title:"Delete custom theme",text:"Are you sure?",buttonText:"delete",onlineOnly:!0,execFn:async e=>(await pb(e.parameters[0]),Vo(),{status:1,message:"Custom theme deleted"})});ve.forgotPassword=new Se({id:"forgotPassword",type:"text",title:"Forgot password",inputs:[{type:"text",placeholder:"email",initVal:""}],buttonText:"send",execFn:async(e,t)=>{const a=await E.users.forgotPasswordEmail(t.trim());return a.status!==200?{status:-1,message:"Failed to send password reset email: "+a.message}:{status:1,message:a.message,notificationOptions:{duration:8}}},beforeInitFn:e=>{const t=s('.pageLogin .login input[name="current-email"]').val();t&&(e.inputs[0].initVal=t)}});function Oa(){var e,t;return((t=(e=Pe)==null?void 0:e.currentUser)==null?void 0:t.providerData.find(a=>(a==null?void 0:a.providerId)==="password"))!==void 0}function ke(e,t=[],a={}){const o=ve[e];if(o===void 0){m("Failed to show popup - popup is not defined",-1);return}if(o.onlineOnly===!0&&!We()){m("You are offline",0,{duration:2});return}o.show(t,a)}s(".pageLogin #forgotPasswordButton").on("click",()=>{ke("forgotPassword")});s(".pageSettings .section.discordIntegration #unlinkDiscordButton").on("click",()=>{ke("unlinkDiscord")});s(".pageSettings #removeGoogleAuth").on("click",()=>{ke("removeGoogleAuth")});s("#resetSettingsButton").on("click",()=>{ke("resetSettings")});s("#revokeAllTokens").on("click",()=>{ke("revokeAllTokens")});s(".pageSettings #resetPersonalBestsButton").on("click",()=>{ke("resetPersonalBests")});s(".pageSettings #updateAccountName").on("click",()=>{ke("updateName")});s("#bannerCenter").on("click",".banner .text .openNameChange",()=>{ke("updateName")});s(".pageSettings #addPasswordAuth").on("click",()=>{ke("addPasswordAuth")});s(".pageSettings #emailPasswordAuth").on("click",()=>{ke("updateEmail")});s(".pageSettings #passPasswordAuth").on("click",()=>{ke("updatePassword")});s(".pageSettings #deleteAccount").on("click",()=>{ke("deleteAccount")});s(".pageSettings #resetAccount").on("click",()=>{ke("resetAccount")});s(".pageSettings #optOutOfLeaderboardsButton").on("click",()=>{ke("optOutOfLeaderboards")});s(".pageSettings").on("click",".section.themes .customTheme .delButton",e=>{const a=s(e.currentTarget).parent(".customTheme.button").attr("customThemeId");ke("deleteCustomTheme",[a])});s(".pageSettings").on("click",".section.themes .customTheme .editButton",e=>{const a=s(e.currentTarget).parent(".customTheme.button").attr("customThemeId");ke("updateCustomTheme",[a])});s("#popups").on("click","#savedTextsPopupWrapper .list .savedText .button.delete",e=>{const t=s(e.target).siblings(".button.name").text();ke("deleteCustomText",[t])});s("#popups").on("click","#savedTextsPopupWrapper .listLong .savedText .button.delete",e=>{const t=s(e.target).siblings(".button.name").text();ke("deleteCustomTextLong",[t])});s("#popups").on("click","#savedTextsPopupWrapper .listLong .savedText .button.resetProgress",e=>{const t=s(e.target).siblings(".button.name").text();ke("resetProgressCustomTextLong",[t])});s(".pageSettings").on("click",".section[data-config-name='fontFamily'] button[data-config-value='custom']",()=>{ke("applyCustomFont")});let xo={};async function o$(){oe();const e=await E.apeKeys.get();if(Q(),e.status!==200){m("Error getting ape keys: "+e.message,-1);return}xo=e.data}function Xy(){var o,n,r;const e=xo;if(e==null)return;const t=s("#apeKeysModal table tbody");t.empty();const a=Object.keys(e);if(a.length===0){t.append("<tr><td colspan='6' style='text-align: center;'>No keys found</td></tr>");return}a.forEach(l=>{const c=e[l];t.append(`
      <tr keyId="${l}">
        <td>
          <button class="textButton toggleActive">
            ${c.enabled?'<i class="fas fa-fw fa-check-square"></i>':'<i class="far fa-fw fa-square"></i>'}
          </button>
        </td>
        <td  onClick=${console.log(c)}>${c.name}</td>
        <td>${_e(new Date(c.createdOn),"dd MMM yyyy HH:mm")}</td>
        <td>${_e(new Date(c.modifiedOn),"dd MMM yyyy HH:mm")}</td>
        <td>${c.lastUsedOn===-1?"-":_e(new Date(c.lastUsedOn),"dd MMM yyyy HH:mm")}</td>
        <td>
          <div class="keyButtons">
            <button class="editButton">
              <i class="fas fa-fw fa-pen"></i>
            </button>
            <button class="deleteButton">
              <i class="fas fa-fw fa-trash-alt"></i>
            </button>
          </div>
        </td>
      </tr>
    `)});for(const l of t.find("tr")){const c=l.getAttribute("keyid");(o=l.querySelector("button.deleteButton"))==null||o.addEventListener("click",d=>{ke("deleteApeKey",[c],{modalChain:ll})}),(n=l.querySelector("button.editButton"))==null||n.addEventListener("click",d=>{ke("editApeKey",[c],{modalChain:ll})}),(r=l.querySelector("button.toggleActive"))==null||r.addEventListener("click",d=>{i$(c)})}}async function n$(e){if(!We()){m("You are offline",0,{duration:2});return}ll.show({...e,beforeAnimation:async()=>{await o$(),Xy()}})}async function i$(e){const t=xo==null?void 0:xo[e];if(!t||xo===void 0)return;oe();const a=await E.apeKeys.update(e,{enabled:!t.enabled});if(Q(),a.status!==200)return m("Failed to update key: "+a.message,-1);t.enabled=!t.enabled,Xy(),t.enabled?m("Key active",1):m("Key inactive",1)}async function r$(e){var t;(t=e.querySelector(".generateApeKey"))==null||t.addEventListener("click",async()=>{ke("generateApeKey",[],{modalChain:ll})})}const ll=new le({dialogId:"apeKeysModal",setup:r$}),je=document.querySelector("#pageSettings");var yp;(yp=je==null?void 0:je.querySelector("#shareCustomThemeButton"))==null||yp.addEventListener("click",()=>{UT()});var vp;(vp=je==null?void 0:je.querySelector(".section.updateCookiePreferences button"))==null||vp.addEventListener("click",()=>{xy(!0)});var wp;(wp=je==null?void 0:je.querySelector("#setStreakHourOffset"))==null||wp.addEventListener("click",()=>{YT()});var bp;(bp=je==null?void 0:je.querySelector(".section.presets"))==null||bp.addEventListener("click",e=>{var a,o,n,r;const t=e.target;if(t.classList.contains("addPresetButton"))kc("add");else if(t.classList.contains("editButton")){const l=(a=t.parentElement)==null?void 0:a.getAttribute("data-id"),c=(o=t.parentElement)==null?void 0:o.getAttribute("data-name");if(l===void 0||c===void 0||l===""||c===""||l===null||c===null){m("Failed to edit preset: Could not find preset id or name",-1);return}kc("edit",l,c)}else if(t.classList.contains("removeButton")){const l=(n=t.parentElement)==null?void 0:n.getAttribute("data-id"),c=(r=t.parentElement)==null?void 0:r.getAttribute("data-name");if(l===void 0||c===void 0||l===""||c===""||l===null||c===null){m("Failed to remove preset: Could not find preset id or name",-1);return}kc("remove",l,c)}});var Cp;(Cp=je==null?void 0:je.querySelector(".section.tags"))==null||Cp.addEventListener("click",e=>{var a,o,n,r,l,c;const t=e.target;if(t.classList.contains("addTagButton"))cr("add");else if(t.classList.contains("editButton")){const d=(a=t.parentElement)==null?void 0:a.getAttribute("data-id"),u=(o=t.parentElement)==null?void 0:o.getAttribute("data-display");if(d===void 0||u===void 0||d===""||u===""||d===null||u===null){m("Failed to edit tag: Could not find tag id or name",-1);return}cr("edit",d,u)}else if(t.classList.contains("clearPbButton")){const d=(n=t.parentElement)==null?void 0:n.getAttribute("data-id"),u=(r=t.parentElement)==null?void 0:r.getAttribute("data-display");if(d===void 0||u===void 0||d===""||u===""||d===null||u===null){m("Failed to clear tag PB: Could not find tag id or name",-1);return}cr("clearPb",d,u)}else if(t.classList.contains("removeButton")){const d=(l=t.parentElement)==null?void 0:l.getAttribute("data-id"),u=(c=t.parentElement)==null?void 0:c.getAttribute("data-display");if(d===void 0||u===void 0||d===""||u===""||d===null||u===null){m("Failed to remove tag: Could not find tag id or name",-1);return}cr("remove",d,u)}});var kp;(kp=je==null?void 0:je.querySelector(".section.apeKeys #showApeKeysPopup"))==null||kp.addEventListener("click",()=>{n$()});function l$(e){var l;const t=tv.getModal();t.querySelector("table tbody").innerHTML="",t.querySelector("table thead tr td").textContent=e,t.querySelector("table thead tr td span.unit").textContent=i.typingSpeedUnit;const a=S();if(!a)return;const o=(l=a.personalBests)==null?void 0:l[e];if(o===void 0)return;const n=[];Object.keys(o).forEach(function(c){let d=o[c]??[];d=d.sort(function(u,f){return f.wpm-u.wpm}),d.forEach(function(u){u.mode2=c,n.push(u)})});let r;n.forEach(c=>{var f;let d='-<br><span class="sub">-</span>';const u=new Date(c.timestamp);c.timestamp&&(d=_e(u,"dd MMM yyyy")+"<br><div class='sub'>"+_e(u,"HH:mm")+"</div>"),(f=t.querySelector("table tbody"))==null||f.insertAdjacentHTML("beforeend",`
      <tr>
        <td>${r===c.mode2?"":c.mode2}</td>
        <td>
          ${_.typingSpeed(c.wpm)}
          <br />
          <span class="sub">${_.accuracy(c.acc)}</span>
        </td>
        <td>
          ${_.typingSpeed(c.raw)}
          <br />
          <span class="sub">${_.percentage(c.consistency)}</span>
        </td>
        <td>${c.difficulty}</td>
        <td>${c.language?os(c.language):"-"}</td>
        <td>${c.punctuation?'<i class="fas fa-check"></i>':""}</td>
        <td>${c.numbers?'<i class="fas fa-check"></i>':""}</td>
        <td>${c.lazyMode?'<i class="fas fa-check"></i>':""}</td>
        <td>${d}</td>
      </tr>
    `),r=c.mode2})}function ev(e){tv.show({beforeAnimation:async()=>{l$(e)}})}const tv=new le({dialogId:"pbTablesModal"});function c$(){if(!We()){m("You are offline",0,{duration:2});return}rv.show({beforeAnimation:async()=>{u$()}})}function d$(){rv.hide({afterAnimation:async()=>{const e=S();e&&Xr("account",e)}})}const av=s("#editProfileModal .bio"),sv=s("#editProfileModal .keyboard"),ov=s("#editProfileModal .twitter"),nv=s("#editProfileModal .github"),iv=s("#editProfileModal .website"),ur=s("#editProfileModal .badgeSelectionContainer");let $o=-1;function u$(){var r;const e=S();if(!e)return;const t=((r=e.inventory)==null?void 0:r.badges)??[],{bio:a,keyboard:o,socialProfiles:n}=e.details??{};$o=-1,av.val(a??""),sv.val(o??""),ov.val((n==null?void 0:n.twitter)??""),nv.val((n==null?void 0:n.github)??""),iv.val((n==null?void 0:n.website)??""),ur.html(""),t==null||t.forEach(l=>{l.selected&&($o=l.id);const c=Zr(l.id,!1,!0),d=`<button type="button" class="badgeSelectionItem ${l.selected?"selected":""}" selection-id=${l.id}>${c}</button>`;ur.append(d)}),ur.prepend(`<button type="button" class="badgeSelectionItem ${$o===-1?"selected":""}" selection-id=-1>
      <div class="badge">
        <i class="fas fa-frown-open"></i>
        <div class="text">none</div>
      </div>
    </button>`),s(".badgeSelectionItem").on("click",({currentTarget:l})=>{const c=s(l).attr("selection-id");$o=parseInt(c,10),ur.find(".badgeSelectionItem").removeClass("selected"),s(l).addClass("selected")})}function f$(){const e=av.val()??"",t=sv.val()??"",a=ov.val()??"",o=nv.val()??"",n=iv.val()??"";return{bio:e,keyboard:t,socialProfiles:{twitter:a,github:o,website:n}}}async function p$(){var r;const e=S();if(!e)return;const t=f$(),a=39;if(t.socialProfiles.github!==void 0&&t.socialProfiles.github.length>a){m(`GitHub username exceeds maximum allowed length (${a} characters).`,-1);return}const o=20;if(t.socialProfiles.twitter!==void 0&&t.socialProfiles.twitter.length>o){m(`Twitter username exceeds maximum allowed length (${o} characters).`,-1);return}oe();const n=await E.users.updateProfile(t,$o);if(Q(),n.status!==200){m("Failed to update profile: "+n.message,-1);return}e.details=t,(r=e.inventory)==null||r.badges.forEach(l=>{l.id===$o?l.selected=!0:delete l.selected}),m("Profile updated",1),d$()}const rv=new le({dialogId:"editProfileModal",setup:async e=>{e.addEventListener("submit",async t=>{t.preventDefault(),await p$()})}});function m$(e){lv.show({...e,focusFirstInput:!0,beforeAnimation:async t=>{t.querySelector("input").value=""}})}function g$(e=!1){lv.hide({clearModalChain:e})}function h$(){const e=s("#newFilterPresetModal input").val();if(e===""){m("Name cannot be empty",0);return}x1(e),g$(!0)}async function y$(e){e.addEventListener("submit",t=>{t.preventDefault(),h$()})}const lv=new le({dialogId:"newFilterPresetModal",setup:y$}),qi=document.querySelector("#pageAccount");s(qi).on("click",".pbsTime .showAllButton",()=>{ev("time")});s(qi).on("click",".pbsWords .showAllButton",()=>{ev("words")});s(qi).on("click",".editProfileButton",()=>{if(!z()){m("You must be logged in to edit your profile",0);return}const e=S();if(!e){m("Failed to open edit profile modal: No user snapshot found",-1);return}if(e.banned===!0){m("Banned users cannot edit their profile",0);return}c$()});s(qi).on("click",".group.history .resultEditTagsButton",e=>{const t=s(e.target).attr("data-result-id"),a=s(e.target).attr("data-tags");ry(t??"",JSON.parse(a??"[]"),"accountPage")});s(qi).find("button.createFilterPresetBtn").on("click",()=>{m$()});let lt;function v$(e){cv.show({focusFirstInput:!0,beforeAnimation:async()=>{sn("googleSignUpModal"),Ii(s("#googleSignUpModal .captcha")[0],"googleSignUpModal"),C$(),ju(),lt=e}})}async function cl(){cv.hide({afterAnimation:async()=>{var e;lt!==void 0&&(m("Sign up process cancelled",0,{duration:5}),gt(),$t(),(e=bd(lt))!=null&&e.isNewUser&&(await E.users.delete(),await lt.user.delete()),rn(),lt=void 0)}})}async function w$(){var a;if(!lt)return m("Missing user credential. Please close the popup and try again.",-1);const e=zl("googleSignUpModal");if(!e)return m("Please complete the captcha",0);k$(),ju(),oe();const t=s("#googleSignUpModal input").val();try{if(t.length===0)throw new Error("Name cannot be empty");const o=await E.users.create(t,e);if(o.status!==200)throw new Error(`Failed to create user: ${o.message}`);if(o.status===200){if(await Np(lt.user,{displayName:t}),await Iw(lt.user),Lu(),m("Account created",1),s("nav .textButton.account .text").text(t),$t(),gt(),await Pi(lt.user),ct!==null&&(Tu(lt.user.uid),(await E.results.save(ct)).status===200)){const r=ct;$d(r),Ad(1,r.testDuration+r.incompleteTestSeconds-r.afkDuration)}lt=void 0,Q(),cl()}}catch(o){console.log(o);const n=ee(o,"Failed to sign in with Google");m(n,-1),gt(),$t(),Yl(),lt&&((a=bd(lt))!=null&&a.isNewUser)&&(await E.users.delete(),await lt.user.delete()),rn(),lt=void 0,cl(),Q();return}}function b$(){s("#googleSignUpModal button").prop("disabled",!1)}function ju(){s("#googleSignUpModal button").prop("disabled",!0)}function C$(){s("#googleSignUpModal input").prop("disabled",!1)}function k$(){s("#googleSignUpModal input").prop("disabled",!0)}const Ao=new bs(s("#googleSignUpModal input"),{available:{icon:"fa-check",level:1},unavailable:{icon:"fa-times",level:-1},taken:{icon:"fa-user",level:-1},checking:{icon:"fa-circle-notch",spinIcon:!0,level:0}}),S$=Et(1e3,async()=>{const e=s("#googleSignUpModal input").val();if(!e)return;const t=await E.users.getNameAvailability(e);if(t.status===200){Ao.show("available",t.message),b$();return}if(t.status===422){Ao.show("unavailable",t.message);return}if(t.status===409){Ao.show("taken",t.message);return}if(t.status!==200)return Ao.show("unavailable"),m("Failed to check name availability: "+t.message,-1)});async function T$(e){var t;e.addEventListener("submit",a=>{a.preventDefault(),w$()}),(t=e.querySelector("input"))==null||t.addEventListener("input",()=>{if(ju(),s("#googleSignUpModal input").val()==="")return Ao.hide();Ao.show("checking"),S$()})}$x((e,t)=>{e!==void 0&&t&&v$(e)});const cv=new le({dialogId:"googleSignUpModal",setup:T$,customEscapeHandler:async()=>{cl()},customWrapperClickHandler:async()=>{cl()}}),dv=console.log,x$=console.warn,$$=console.error;let An=localStorage.getItem("debugLogs")==="true";function A$(){An=!An,uv(`Debug logs ${An?"enabled":"disabled"}`),localStorage.setItem("debugLogs",An.toString())}function uv(...e){dv("%cINFO","background:#4CAF50;color: #111;padding:0 5px;border-radius:10px",...e)}function M$(...e){x$("%cWRN","background:#FFC107;color: #111;padding:0 5px;border-radius:10px",...e)}function L$(...e){$$("%cERR","background:#F44336;color: #111;padding:0 5px;border-radius:10px",...e)}function W$(...e){An&&dv("%cDEBG","background:#2196F3;color: #111;padding:0 5px;border-radius:10px",...e)}console.log=uv;console.warn=M$;console.error=L$;console.debug=W$;let cd=!1;function I$(e){document.documentElement.style.setProperty("--font",'"'+e.replace(/_/g," ")+'", "Roboto Mono", "Vazirmatn"'),cd=!0}function cA(){cd&&(I$(i.fontFamily),cd=!1)}function E$(){const e=window.navigator.userAgent.toLowerCase().includes("mac")?"cmd":"ctrl",t=i.quickRestart==="esc"?"tab":"esc";s("footer .keyTips").html(`
    <key>${i.quickRestart}</key> - restart test<br>
    <key>${t}</key> or <key>${e}</key>+<key>shift</key>+<key>p</key> - command line`)}window.addEventListener("keydown",function(e){e.code==="Space"&&e.target===document.body&&e.preventDefault()});window.addEventListener("beforeunload",e=>{i.mode==="words"&&i.words<1e3||i.mode==="time"&&i.time<3600||i.mode==="quote"||i.mode==="custom"&&fe&&Re<1e3||i.mode==="custom"&&pe&&Wt<1e3||i.mode==="custom"&&!fe&&Be.length<1e3||Ae&&(e.preventDefault(),e.returnValue="")});const B$=Et(250,()=>{if(da(),ne()==="test"&&!qe)if(i.tapeMode!=="off")ko();else{const e=document.querySelectorAll("#words .word")[Oe-1];if(e){const t=Math.floor(e.offsetTop);au(t)}}setTimeout(()=>{s("#wordsInput").is(":focus")&&xg()},250)}),P$=wd(250,()=>{Ci()});s(window).on("resize",()=>{P$(),B$()});he(e=>{e==="quickRestart"&&E$()});let dd=!1;const q$=new RegExp("\\p{P}","u");async function F$(e){function t(d,u){let f=d.shiftKey;const p=dd&&u.length>2?2:0,g=!q$.test(u.slice(p,p+2));ba&&g&&(f=!d.shiftKey);const h=u[(f?1:0)+p]??"",y=u[f?1:0]??"",w=u[0];return h||y||w}let a;try{a=await fi(i.layout)}catch(d){return m(ee(d,"Failed to emulate event"),-1),null}let o=[];if(a.type==="ansi"?o=["Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal","KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight","Backslash","KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote","KeyZ","KeyX","KeyC","KeyV","KeyB","KeyN","KeyM","Comma","Period","Slash","Space"]:a.type==="iso"?o=["Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal","KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight","KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote","Backslash","IntlBackslash","KeyZ","KeyX","KeyC","KeyV","KeyB","KeyN","KeyM","Comma","Period","Slash","Space"]:a.type==="matrix"&&(o=["Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal","KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight","Backslash","KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote","KeyZ","KeyX","KeyC","KeyV","KeyB","KeyN","KeyM","Comma","Period","Slash","Space"]),!o.includes(e.code))return null;const n=a.keys,r=n.row1.concat(n.row2).concat(n.row3).concat(n.row4).concat(n.row5),l=o.indexOf(e.code);if(l===-1)return e.code.includes("Numpad")?e.key:null;const c=t(e,r[l]??"");return c!==void 0?c:null}function fv(e){const t=e.code==="AltLeft"&&navigator.userAgent.includes("Mac");e.code!=="AltRight"&&!t||(e.type==="keydown"&&(dd=!0),e.type==="keyup"&&(dd=!1))}s(document).on("keydown",fv);s(document).on("keyup",fv);const pv=["MediaTrackNext","MediaTrackPrevious","MediaPlayPause","AudioVolumeUp","AudioVolumeDown","AudioVolumeMute"],D$=["Alt","AltGraph","CapsLock","Control","Fn","FnLock","Hyper","Meta","OS","NumLock","ScrollLock","Scroll","Shift","Super","Symbol","SymbolLock"];let dl=!1,ul=!0,Tc=!1,mv,xc=0;const ep=document.getElementById("wordsInput"),gv=document.getElementById("koInputVisual");function jt(e){e!==ep.value&&(ep.value=e)}function ud(){var t;const e=U(xi());if(isNaN(e)||dC(e),i.keymapMode==="next"&&i.mode!=="zen")if(!i.language.startsWith("korean"))Sa(A.getCurrent().charAt(T.current.length).toString());else{const a=Ue.disassemble(A.getCurrent(),!0),o=Ue.disassemble(T.current,!0),n=o.length-1;if(o[n]){const r=o[n].length;try{const l=a[n][r]??a[o.length][r-a[n].length];Sa(l)}catch{Sa("")}}else{const r=(t=a==null?void 0:a[0])==null?void 0:t[0];r!==void 0&&Sa(r)}}}function hv(){var e;if(Ae&&!(T.history.length===0||Oe===0)&&!(T.history[A.currentIndex-1]==A.get(A.currentIndex-1)&&!i.freedomMode||s(s(".word")[A.currentIndex-1]).hasClass("hidden"))&&!(i.confidenceMode==="on"||i.confidenceMode==="max")){if(T.current=T.popHistory(),Ne.popHistory(),V(i.funbox).find(t=>{var a;return(a=t.properties)==null?void 0:a.includes("nospace")})&&(T.current=T.current.slice(0,-1),jt(" "+T.current+" ")),A.decreaseCurrentIndex(),Nr(Oe-1),Jn(!0),Zn(A.getCurrent()),ra(),i.mode==="zen"){Mi();const t=((e=document.querySelector("#words"))==null?void 0:e.children)??[];for(let a=t.length-1;a>=0;a--){const o=t[a];if(o.classList.contains("newline"))o.remove();else break}}da(),Bs("backWord")}}function tp(){var l,c,d;if(!Ae||T.current===""||Ps()&&i.language.startsWith("chinese"))return;i.mode==="zen"&&(s("#words .word.active").removeClass("active"),s("#words").append("<div class='word active'></div>"));const e=A.getCurrent();for(const u of V(i.funbox))(l=u.functions)!=null&&l.handleSpace&&u.functions.handleSpace();dl=!0;const t=oh();cC(Math.round(t)),vg(t);const a=V(i.funbox).find(u=>{var f;return(f=u.properties)==null?void 0:f.includes("nospace")})!==void 0,o=e===T.current||i.mode==="zen";if(Qh(o,!0),fg(o),o){if(i.indicateTypos!=="off"&&i.stopOnError==="letter"&&ra(),Af(!0,e),T.pushHistory(),A.increaseCurrentIndex(),Nr(Oe+1),Jn(),Zn(A.getCurrent()),da(),Pc(),qc(A.currentIndex),a||Fa(),Bs("submitCorrectWord"),A.currentIndex===A.length){ao();return}}else{a||(i.playSoundOnError==="off"||i.blindMode?Fa():Ll()),gg(A.getCurrent()),ug();const u=T.current.length;if(u<=A.getCurrent().length&&(u>=Ne.current.length?Ne.current+="_":Ne.current=Ne.current.substring(0,u)+"_"+Ne.current.substring(u+1)),i.stopOnError!=="off"){if(i.difficulty==="expert"||i.difficulty==="master"){qn("difficulty");return}i.stopOnError==="word"&&(dl=!1,Bs("incorrectLetter","_"),ra(!0),da());return}if(Af(!1,e),i.blindMode&&i.highlightMode!=="off"&&s("#words .word.active letter").addClass("correct"),T.pushHistory(),Y0(Oe,!i.blindMode),A.increaseCurrentIndex(),Nr(Oe+1),Jn(),Zn(A.getCurrent()),da(),Pc(),qc(A.currentIndex),i.difficulty==="expert"||i.difficulty==="master"){qn("difficulty");return}else if(A.currentIndex===A.length){ao();return}Bs("submitErrorWord")}let n;i.mode==="zen"?n=T.current.length:n=A.getCurrent().length;const r=Yv(i.minBurstCustomSpeed,n);if(i.minBurst==="fixed"&&t<i.minBurstCustomSpeed||i.minBurst==="flex"&&t<r){qn("min burst");return}if(Ne.pushHistory(),!i.showAllLines||i.mode==="time"||fe&&Re===0||pe){const u=Math.floor(((c=document.querySelectorAll("#words .word")[Oe-1])==null?void 0:c.offsetTop)??0);let f;try{f=Math.floor(((d=document.querySelectorAll("#words .word")[Oe])==null?void 0:d.offsetTop)??0)}catch{f=0}f>u&&au(u)}i.keymapMode==="react"&&dh(" ",!0),(i.mode==="words"||i.mode==="custom"||i.mode==="quote"||i.mode==="zen")&&Mi(),(i.mode==="time"||i.mode==="words"||i.mode==="custom"||i.mode==="quote")&&y1()}function R$(e,t){var n;if(!ul)return!1;if(i.mode==="zen")return!0;if(T.getKoreanStatus()){const l=Ue.disassemble(A.getCurrent())[t];return l===void 0?!1:l===e}const a=A.getCurrent()[t];if(a===void 0)return!1;if(a===e)return!0;const o=V(i.funbox).find(r=>{var l;return(l=r.functions)==null?void 0:l.isCharCorrect});return(n=o==null?void 0:o.functions)!=null&&n.isCharCorrect?o.functions.isCharCorrect(e,a):!!(i.language.startsWith("russian")&&(e==="ё"||e==="е"||e==="e")&&(a==="ё"||a==="е"||a==="e")||(e==="’"||e==="‘"||e==="'"||e==="ʼ"||e==="׳")&&(a==="’"||a==="‘"||a==="'"||a==="ʼ"||a==="׳")||(e==='"'||e==="”"||e==="“"||e==="„")&&(a==='"'||a==="”"||a==="“"||a==="„")||(e==="–"||e==="—"||e==="-")&&(a==="-"||a==="–"||a==="—"))}function Ia(e,t,a){var h,y,w,k,L;if(Zs||qe)return;console.debug("Handling char",e,t,a);const o=performance.now(),n=T.getKoreanStatus();if(e==="…"&&A.getCurrent()[t]!=="…"){for(let x=0;x<3;x++)Ia(".",t+x);return}for(const x of V(i.funbox))(h=x.functions)!=null&&h.handleChar&&(e=x.functions.handleChar(e));const r=V(i.funbox).find(x=>{var B;return(B=x.properties)==null?void 0:B.includes("nospace")})!==void 0;if(e!==`
`&&e!=="	"&&/\s/.test(e)){if(r)return;if(tp(),i.difficulty!=="normal"||i.strictSpace&&i.mode!=="zen"||i.stopOnError==="word"&&t>0){if(dl){dl=!1;return}}else return}if(i.mode!=="zen"&&A.getCurrent()[t]!==`
`&&e===`
`||!Ae&&!h1(o))return;ys(!0),Sg();const l=R$(e,t);let c;if(l&&i.mode!=="zen"&&(e=n?Ue.disassemble(A.getCurrent())[t]??"":A.getCurrent().charAt(t)),!l&&e===`
`){if(T.current==="")return;e=" "}if(T.current===""&&Yb(o),n||i.language.startsWith("korean")?(c=(a??"").slice(1),gv.innerText=c.slice(-1)):i.language.startsWith("chinese")?c=(a??"").slice(1):c=T.current.substring(0,t)+e+T.current.substring(t+1),!l&&Ps()&&!i.language.startsWith("korean")){T.current=c,ra(),da();return}if(Qh(l),fg(l),l||(ug(),gg(A.getCurrent())),bC(i.mode==="zen"?e:A.getCurrent()[t]??"",l),l||i.playSoundOnError==="off"||i.blindMode?Fa():Ll(),i.keymapMode==="react"&&dh(e,l),i.difficulty!=="master")if(ul)xc=0;else{xc++,xc>=5&&m("Opposite shift mode is on.",0,{important:!0,customTitle:"Reminder"});return}if(Ne.current==="")Ne.current+=n?Ue.disassemble(c).join(""):c;else{const x=n?Ue.disassemble(Ne.current).length:Ne.current.length;t>=x?Ne.current+=n?Ue.disassemble(e).concat():e:l||(Ne.current=Ne.current.substring(0,t)+e+Ne.current.substring(t+1))}if(Pc(),qc(A.currentIndex),i.difficulty!=="master"&&i.stopOnError==="letter"&&!l){i.indicateTypos!=="off"&&ra(void 0,T.current+e);return}if(Bs(l?"correctLetter":"incorrectLetter",e),(n?Ue.disassemble(T.current).length:T.current.length)===1&&A.currentIndex===0&&O0((y=document.querySelector("#words .active"))==null?void 0:y.offsetTop),i.mode==="zen"&&t<30||i.mode!=="zen"&&c.length<A.getCurrent().length+20?T.current=c:console.error("Hitting word limit"),!l&&i.difficulty==="master"){qn("difficulty");return}if(i.mode!=="zen"){const x=A.getCurrent(),D=A.currentIndex===A.length-1,v=x===T.current,C=i.quickEnd&&!i.language.startsWith("korean")&&x.length===T.current.length&&i.stopOnError==="off",q=i.language.startsWith("chinese");if(D&&(v||C)&&(!q||a!==void 0&&t+2==a.length)){ao();return}}const u=(w=document.querySelector("#words .word.active"))==null?void 0:w.offsetTop;if(ra(),!i.hideExtraLetters){const x=(k=document.querySelector("#words .word.active"))==null?void 0:k.offsetTop;if(u<x&&!_c&&T.current.length>1)if(i.mode==="zen"){const B=Math.floor(((L=document.querySelectorAll("#words .word")[Oe-1])==null?void 0:L.offsetTop)??0);i.showAllLines||au(B)}else T.current=T.current.slice(0,-1),ra()}(r&&T.current.length===A.getCurrent().length||e===`
`&&l)&&tp();const f=A.getCurrent(),p=/^\t+/.test(A.getCurrent()),g=f[T.current.length]==="	";if(l&&i.language.startsWith("code")&&p&&g){const x=new KeyboardEvent("keydown",{key:"Tab",code:"Tab"});document.dispatchEvent(x)}e!==`
`&&da()}function O$(e,t){var n;if(Zs){e.preventDefault();return}if(s("#customTextPopup .textarea").is(":focus")){e.preventDefault();const r=s("#customTextPopup .textarea")[0],l=r.selectionStart,c=r.selectionEnd;r.value=r.value.substring(0,l)+"	"+r.value.substring(c),r.selectionStart=r.selectionEnd=l+1,bt(r.value);return}let a=!1;(i.mode==="zen"&&!e.shiftKey||zn&&!e.shiftKey)&&(a=!0);const o=Le("commandLineWrapper")||t;if(i.quickRestart==="esc"){if(o||ne()==="login")return;if(e.preventDefault(),!qe&&a){Ia("	",T.current.length),jt(" "+T.current);return}}else if(i.quickRestart==="tab"){if(o||ne()==="login")return;if(ne()!=="test"){wt("/");return}if(e.shiftKey?ie():Un(),!qe&&a){e.preventDefault(),Ia("	",T.current.length),jt(" "+T.current);return}Y({event:e})}else{if(o||ne()!=="test"||qe)return;if(a){e.preventDefault(),Ia("	",T.current.length),jt(" "+T.current);return}((n=document.activeElement)==null?void 0:n.id)!=="wordsInput"&&ys(!1)}}s("#wordsInput").on("keydown",e=>{const t=ne()==="test",a=Le("commandLineWrapper"),o=Le("leaderboardsWrapper"),n=pl();t&&!a&&!o&&!n&&!qe&&e.key!=="Enter"||e.preventDefault()});let $c=-1;s(document).on("keydown",async e=>{var d,u;if(ne()==="loading"){console.debug("Ignoring keydown event on loading page.");return}if(pv.includes(e.key)){console.debug(`Key ${e.key} is on the list of ignored keys. Stopping keydown event.`);return}const t=s("#wordsInput").is(":focus"),a=ne()==="test",o=Le("commandLineWrapper"),n=Le("leaderboardsWrapper"),r=pl(),l=a&&!o&&!n&&!r&&!qe&&(t||e.key!=="Enter");if(l&&!t&&!["Enter","Tab",...D$].includes(e.key)&&(Bl(),i.showOutOfFocusWarning&&!e.ctrlKey&&!e.metaKey&&e.preventDefault()),e.key==="Tab"&&O$(e,r),e.key==="Escape"&&i.quickRestart==="esc"){if(Le("commandLineWrapper")||r)return;if(ne()!=="test"){wt("/");return}e.shiftKey?ie():Un(),Y({event:e})}if(e.key==="Enter"&&i.quickRestart==="enter"){const f=document.activeElement;if((f==null?void 0:f.tagName)==="BUTTON"||(f==null?void 0:f.tagName)==="A"||(f==null?void 0:f.classList.contains("button"))||(f==null?void 0:f.classList.contains("textButton"))||(f==null?void 0:f.tagName)==="INPUT"&&(f==null?void 0:f.id)!=="wordsInput"||Le("commandLineWrapper")||r)return;if(ne()!=="test"){wt("/");return}if(qe){Y({event:e});return}i.mode==="zen"||(!Lr||Lr&&e.shiftKey?(e.shiftKey?ie():Un(),Y({event:e})):(jt(" "+T.current),i.tapeMode!=="off"&&ko()))}if(!l)return;if(!((d=e.originalEvent)!=null&&d.isTrusted)||Ct){e.preventDefault();return}if(dg(),e.key==="Backspace"&&(Fa(),/INPUT|SELECT|TEXTAREA/i.test(e.target.tagName)||e.preventDefault(),i.confidenceMode==="max")){e.preventDefault();return}if(pk(),e.key==="Backspace"&&T.current.length===0&&(hv(),T.current&&jt(" "+T.current+" ")),e.key==="Enter")if(e.shiftKey){if(i.mode==="zen")ao();else if(!md(i.mode,i.words,i.time,Vd,hs()??!1)){const f=Date.now()-$c;$c===-1||f>200?($c=Date.now(),f>=5e3&&m("Please double tap shift+enter to confirm bail out",0,{important:!0,duration:5})):(Qp(!0),ao())}}else Ia(`
`,T.current.length),jt(" "+T.current),i.tapeMode!=="off"&&ko();if(e.key==="Dead"&&!Ps()){Fa();const f=document.querySelector("#words .word.active"),p=T.current.length,g=f==null?void 0:f.querySelectorAll("letter")[p];g&&g.classList.toggle("dead")}if(i.oppositeShiftMode!=="off")if(i.oppositeShiftMode==="keymap"&&i.keymapLayout!=="overrideSync"){const f=await fi(i.keymapLayout).catch(()=>{});if(f===void 0){m("Failed to load keymap layout",-1);return}const p=Mg(e.key,f);ul=p===void 0?!0:Fc(p)}else ul=Fc(e.code);const c=V(i.funbox).find(f=>{var p;return(p=f.functions)==null?void 0:p.preventDefaultEvent});if((u=c==null?void 0:c.functions)!=null&&u.preventDefaultEvent&&await c.functions.preventDefaultEvent(e)&&(e.preventDefault(),Ia(e.key,T.current.length),ud(),jt(" "+T.current),i.tapeMode!=="off"&&ko()),i.layout!=="default"&&!(e.ctrlKey||e.altKey&&window.navigator.platform.search("Linux")>-1)){const f=await F$(e);f!==null&&(e.preventDefault(),Ia(f,T.current.length),ud(),jt(" "+T.current)),i.tapeMode!=="off"&&ko()}mv=e.key==="Backspace"||e.key==="delete"});s("#wordsInput").on("keydown",e=>{var a;if((a=e.originalEvent)!=null&&a.repeat){console.log("spacing debug keydown STOPPED - repeat",e.key,e.code,e.which);return}e.code==="NumpadEnter"&&i.funbox.includes("58008")&&(e.code="Space"),e.code.includes("Arrow")&&i.funbox.includes("arrows")&&(e.code="NoCode");const t=performance.now();setTimeout(()=>{const o=e.code===""||e.which===231?"NoCode":e.code;Zb(t,o)},0)});s("#wordsInput").on("keyup",e=>{var a;if((a=e.originalEvent)!=null&&a.repeat){console.log("spacing debug keydown STOPPED - repeat",e.key,e.code,e.which);return}e.code==="NumpadEnter"&&i.funbox.includes("58008")&&(e.code="Space"),e.code.includes("Arrow")&&i.funbox.includes("arrows")&&(e.code="NoCode");const t=performance.now();setTimeout(()=>{const o=e.code===""||e.which===231?"NoCode":e.code;pg(t,o)},0)});s("#wordsInput").on("keyup",e=>{var t;if(!((t=e.originalEvent)!=null&&t.isTrusted)||Ct){e.preventDefault();return}pv.includes(e.key)||qe||mk()});s("#wordsInput").on("beforeinput",e=>{var t;(t=e.originalEvent)!=null&&t.isTrusted&&e.target.value===""&&(e.target.value=" ")});s("#wordsInput").on("input",e=>{var d;if(!((d=e.originalEvent)!=null&&d.isTrusted)||Ct){e.target.value=" ";return}if(pl()){e.preventDefault();return}dg(),(i.layout==="default"||i.layout==="korean")&&e.target.value.normalize().match(/[\uac00-\ud7af]|[\u1100-\u11ff]|[\u3130-\u318f]|[\ua960-\ua97f]|[\ud7b0-\ud7ff]/g)&&T.setKoreanStatus(!0);const a=T.getKoreanStatus(),o=i.language.startsWith("chinese"),n=e.target.value.normalize(),r=a?Ue.disassemble(n).join("").slice(1):n.slice(1),l=a?Ue.disassemble(T.current).join(""):T.current;if(a&&!mv&&(Tc||n.slice(1).length<T.current.length&&Ue.disassemble(T.current.slice(-1)).length>1)){Tc=!Tc;return}if(i.layout!=="default"&&r.length>=l.length){jt(" "+l);return}if(n.length===0&&l.length===0)hv();else if(r.length<l.length){if(o)if(l.length-r.length<=2&&l.startsWith(l))T.current=r;else{let u=0;for(;r[u]===l[u];)u++;let f=0;i.stopOnError!=="word"&&/.+ .+/.test(r)&&(f=r.indexOf(" ")+1);for(let p=u;p<r.length;p++)Ia(r[p],p-f,n)}else if(a){const u=e.target.value.normalize().slice(1);T.current=u,gv.innerText=u.slice(-1)}else T.current=r;ra(),da(),Ps()||((e==null?void 0:e.originalEvent).inputType==="deleteWordBackward"?Bs("setLetterIndex",0):Bs("setLetterIndex",l.length-1))}if(r!==l){let u=0;for(;r[u]===l[u];)u++;let f=0;i.stopOnError!=="word"&&/.+ .+/.test(r)&&(f=r.indexOf(" ")+1);for(let p=u;p<r.length;p++)Ia(r[p],p-f,n)}jt(" "+T.current),ud(),i.tapeMode!=="off"&&ko();const c=Ps();setTimeout(()=>{const u=Ps();c!==u&&ra(),e.target.selectionStart!==e.target.value.length&&(!za.test(e.target.value)||(e.target.selectionStart??0)<e.target.value.search(za))&&(e.target.selectionStart=e.target.selectionEnd=e.target.value.length)},0)});s("#wordsInput").on("focus",e=>{e.target.selectionStart=e.target.selectionEnd=e.target.value.length});s("#wordsInput").on("copy paste",e=>{e.preventDefault()});s("#wordsInput").on("select selectstart",e=>{e.preventDefault()});s("#wordsInput").on("keydown",e=>{e.key.startsWith("Arrow")&&e.preventDefault()});s("#wordsInput").on("compositionstart",()=>{i.layout==="default"&&(Rg(!0),C0(T.current.length))});s("#wordsInput").on("compositionend",()=>{i.layout==="default"&&Rg(!1)});function ap(e){window.localStorage.setItem("lastSeenVersion",e)}function H$(){return window.localStorage.getItem("lastSeenVersion")??""}async function _$(e){const t=await H$();if(t===""){ap(e);return}t!==e&&(caches.keys().then(function(a){for(const o of a)caches.delete(o)}),s("#newVersionIndicator").removeClass("hidden"),ap(e))}function N$(){window.localStorage.setItem("confirmedPSAs",JSON.stringify([]))}function yv(){return JSON.parse(window.localStorage.getItem("confirmedPSAs")??"[]")??[]}function K$(e){const t=yv();t.push(e),window.localStorage.setItem("confirmedPSAs",JSON.stringify(t))}async function z$(){const e=await E.psas.get();return e.status===500?(Ro("Looks like the server is experiencing maintenance or some unexpected down time.<br>Check the <a target= '_blank' href='https://monkeytype.instatus.com/'>status page</a> or <a target= '_blank' href='https://twitter.com/monkeytypegame'>Twitter</a> for more information.",-1,"exclamation-triangle",!1,void 0,!0),null):e.status===503?(Ro("Server is currently under maintenance. <a target= '_blank' href='https://monkeytype.instatus.com/'>Check the status page</a> for more info.",-1,"bullhorn",!0,void 0,!0),null):e.status!==200?null:e.data}async function U$(){const e=await z$();if(e===null)return;if(e.length===0){N$();return}const t=yv();e.forEach(a=>{if(a.date){const o=new Date(a.date),n=a.date-Date.now(),r=dt(n/1e3,!1,!1,"text",!1,!0);a.message=a.message.replace("{dateDifference}",r),a.message=a.message.replace("{dateNoTime}",_e(o,"dd MMM yyyy")),a.message=a.message.replace("{date}",_e(o,"dd MMM yyyy HH:mm"))}Sx(a.message,a.level??-1),!(t.includes(a._id)&&!(a.sticky??!1))&&Ro(a.message,a.level,"bullhorn",a.sticky,()=>{K$(a._id)},!0)})}Jv().then(e=>{s("footer .currentVersion .text").text(e),_$(e)}).catch(e=>{s("footer .currentVersion .text").text("unknown")});ie();Fb();ys(!0,!0);s(document).ready(()=>{oc("/css/slimselect.min.css",!0),oc("/css/balloon.min.css",!0),oc("/css/fa.min.css",!0),GT(),s("body").css("transition","background .25s, transform .05s"),i.quickRestart!=="off"&&s("#restartTestButton").addClass("hidden"),window.localStorage.getItem("merchbannerclosed")==="true"||Ro('Check out our merchandise, available at <a target="_blank" rel="noopener" href="https://monkeytype.store/">monkeytype.store</a>',1,"./images/merch2.png",!1,()=>{window.localStorage.setItem("merchbannerclosed","true")},!0),setTimeout(()=>{V(i.funbox).forEach(t=>{var a,o;return(o=(a=t.functions)==null?void 0:a.applyGlobalCSS)==null?void 0:o.call(a)})},500),s("#contentWrapper").css("opacity","0").removeClass("hidden").stop(!0,!0).animate({opacity:1},250),We()&&(U$(),H1().then(()=>{var t;(t=Iu())!=null&&t.users.signUp||(s(".signInOut").addClass("hidden"),s(".register").addClass("hidden"),s(".login").addClass("hidden"),s(".disabledNotification").removeClass("hidden"))})),OS(),new Ew("https://keymash.io/"),st("commandLine")});window.onerror=function(e,t,a,o,n){Pa("error",{error:(n==null?void 0:n.stack)??""})};window.onunhandledrejection=function(e){Pa("error",{error:e.reason.stack??""})};let fr=!1;s(document).on("click",".scrollToTopButton",()=>{window.scrollTo({top:0,behavior:"smooth"})});s(window).on("scroll",()=>{const e=ne();if(e!=="test"&&(e==="about"||e==="settings"||e==="account")){const t=window.scrollY;!fr&&t>100?(s(".scrollToTopButton").removeClass("invisible"),fr=!0):fr&&t<100&&(s(".scrollToTopButton").addClass("invisible"),fr=!1)}});s("#nocss .requestedStylesheets").html("Requested stylesheets:<br>"+[...document.querySelectorAll("link[rel=stylesheet")].map(e=>e.href).filter(e=>/\/css\/style/gi.test(e)).join("<br>"));s("#nocss .requestedJs").html("Requested Javascript files:<br>"+[...document.querySelectorAll("script")].map(e=>e.src).filter(e=>/(\/js\/mon|\/js\/vendor)/gi.test(e)).join("<br>")+"<br><br>Client version:<br>"+mi.clientVersion);window.navigator.userAgent.toLowerCase().includes("mac")?s("#nocss .keys").html(`
    <span
      style="
        padding: 1rem;
        display: inline-block;
        border-radius: 1rem;
        background: #2c2e31;
        margin-top: 1rem;
        margin-bottom: 1rem;
      "
    >
      Cmd
    </span>
    +
    <span
      style="
        padding: 1rem;
        display: inline-block;
        border-radius: 1rem;
        background: #2c2e31;
      "
    >
      Shift
    </span>
    +
    <span
      style="
        padding: 1rem;
        display: inline-block;
        border-radius: 1rem;
        background: #2c2e31;
      "
    >
      R
    </span>
  `):s("#nocss .keys").html(`
    <span
      style="
        padding: 1rem;
        display: inline-block;
        border-radius: 1rem;
        background: #2c2e31;
        margin-bottom: 1rem;
      "
    >
      Ctrl
    </span>
    +
    <span
      style="
        padding: 1rem;
        display: inline-block;
        border-radius: 1rem;
        background: #2c2e31;
      "
    >
      Shift
    </span>
    +
    <span
      style="
        padding: 1rem;
        display: inline-block;
        border-radius: 1rem;
        background: #2c2e31;
      "
    >
      R
    </span>
  `);const di="videoAdPopupWrapper";async function V$(){if(at(di,"popups"),await Cu(),Nl){m("Looks like you're using an adblocker. Video ads will not work until you disable it.",0,{duration:6});return}if(await ku(),si){m("Looks like you're using a cookie popup blocker. Video ads will not work without giving your consent through the popup.",0,{duration:7});return}Le(di)||s("#videoAdPopupWrapper").stop(!0,!0).css("opacity",0).removeClass("hidden").animate({opacity:1},125,()=>{window.dataLayer.push({event:"EG_Video"})})}function sp(){Le(di)&&s("#videoAdPopupWrapper").stop(!0,!0).css("opacity",1).animate({opacity:0},125,()=>{s("#videoAdPopupWrapper").addClass("hidden"),Ve(di)})}function j$(e){const t=e.event;t==="started"||(t==="finished"?sp():t==="empty"&&(m("Failed to load video ad. Please try again later",-1,{duration:3}),sp()))}s(".pageTest #watchVideoAdButton").on("click",()=>{V$()});st(di);let Xa;async function vv(e=i.language){if(!Xa)return;const a=(await gd(e)).bcp47??"en-US";Xa.lang=a}async function wv(){Xa=new SpeechSynthesisUtterance,await vv()}function Q$(){Xa=void 0}async function G$(e){window.speechSynthesis.cancel(),Xa===void 0&&await wv(),Xa!==void 0&&(Xa.text=e,window.speechSynthesis.speak(Xa))}he((e,t)=>{e==="funbox"&&(t==="none"?Q$():t==="tts"&&wv()),e==="language"&&i.funbox.split("#").includes("tts")&&vv()});pC(e=>{G$(e)});let kr=0,bv,fd,Qu=!0;const $s=document.querySelector("#fpsCounter");function Cv(e){if(Qu)return;const t=e-fd;if(kr++,t>500){const a=U(kr*1e3/t).toFixed(2);kr=0,fd=e,Y$(a)}window.requestAnimationFrame(Cv)}function dA(){Qu=!1,kr=0,fd=performance.now(),bv=window.requestAnimationFrame(Cv),$s.classList.remove("hidden")}function uA(){cancelAnimationFrame(bv),Qu=!0,$s.classList.add("hidden")}async function Y$(e){$s.innerHTML=`FPS ${e}`;const t=parseFloat(e);$s.classList.remove("error"),$s.classList.remove("main"),t<30?$s.classList.add("error"):t>55&&$s.classList.add("main")}const vn=new bs(s(".page.pageProfileSearch .search input"),{notFound:{icon:"fa-user-slash",level:-1},error:{icon:"fa-times",level:-1},checking:{icon:"fa-circle-notch",spinIcon:!0,level:1}});function J$(){s(".page.pageProfileSearch .search button").addClass("disabled"),s(".page.pageProfileSearch .search input").attr("disabled","disabled")}function Z$(){s(".page.pageProfileSearch .search button").removeClass("disabled"),s(".page.pageProfileSearch .search input").removeAttr("disabled")}function X$(){return s(".page.pageProfileSearch .search input").attr("disabled")!==void 0}function op(){s(".page.pageProfileSearch .search input").trigger("focus")}async function eA(){vn.hide();const e=s(".page.pageProfileSearch .search input").val();if(e==="")return;vn.show("checking"),J$(),await Te(500);const t=await E.users.getProfileByName(e);if(Z$(),t.status===404){op(),vn.show("notFound","User not found");return}else if(t.status!==200){op(),vn.show("error",`Error: ${t.message}`);return}vn.hide(),wt(`/profile/${e}`,{data:t.data})}s(".page.pageProfileSearch form").on("submit",e=>{e.preventDefault(),!X$()&&eA()});st("pageProfileSearch");function tA(e){for(const[t,a]of Object.entries(e))window[t]=a}tA({snapshot:S,config:i,toggleFilterDebug:U1,glarsesMode:iS,stats:X0,replay:v0,enableTimerDebug:yk,getTimerStats:$k,toggleUnsmoothedRaw:gS,egVideoListener:j$,toggleDebugLogs:A$});export{ym as $,Am as A,cs as B,im as C,Ll as D,lm as E,Fa as F,Tm as G,Km as H,dm as I,um as J,Nm as K,Nn as L,_n as M,xm as N,fm as O,wm as P,bm as Q,rm as R,rA as S,m0 as T,hf as U,gm as V,et as W,i as X,Bd as Y,hm as Z,Pd as _,Ge as a,st as a$,qd as a0,es as a1,Xm as a2,ta as a3,Wm as a4,pm as a5,Ed as a6,Lm as a7,mm as a8,Dm as a9,uu as aA,Rd as aB,Od as aC,Bc as aD,cr as aE,ut as aF,Ei as aG,S as aH,My as aI,Uc as aJ,Th as aK,Kn as aL,tl as aM,ax as aN,Ya as aO,kc as aP,Es as aQ,qC as aR,Ld as aS,gh as aT,Ym as aU,lA as aV,I$ as aW,Um as aX,cA as aY,Oo as aZ,Is as a_,Rm as aa,Om as ab,gs as ac,Fd as ad,eg as ae,Gt as af,ag,tg as ah,sg as ai,Mm as aj,km as ak,qb as al,hs as am,fe as an,Re as ao,pe as ap,Be as aq,Wt as ar,Qp as as,ao as at,iA as au,wt as av,wl as aw,qe as ax,Gg as ay,U0 as az,ie as b,Ve as b0,se as b1,It as b2,at as b3,jl as b4,vy as b5,Dd as b6,bl as b7,tk as b8,Pb as b9,V$ as ba,vi as bb,Jo as bc,X0 as bd,dA as be,uA as bf,ys as bg,$f as bh,Pa as bi,le as bj,hi as bk,bb as bl,ne as bm,Bl as bn,ia as c,ns as d,jm as e,$a as f,Id as g,zt as h,_m as i,zm as j,Sm as k,Em as l,Bm as m,Pm as n,qm as o,Im as p,Hm as q,Y as r,ua as s,Vm as t,$m as u,cm as v,vm as w,Qm as x,Fm as y,Cm as z};function __vite__mapDeps(indexes){if(!__vite__mapDeps.viteFileDeps){__vite__mapDeps.viteFileDeps=["js/commandline.CRBlGJBp.js","js/vendor.mtKfjGfe.js","js/firebase.2lhnjcQw.js","js/misc.C476mBjA.js","css/index.CWMZTPOo.css","js/howler.BYgBeqzQ.js"]}
return indexes.map((i)=>__vite__mapDeps.viteFileDeps[i])}